//*
//* JOBCARD REPLACED BY sysgen.py
//*
//* WARNING: Editing this file in VS Code will corrupt it!
//*
//*ZP60041  JOB (SYSGEN),'ZP60041 + 42 + 43',
//*             CLASS=A,
//*             MSGCLASS=A,
//*             MSGLEVEL=(1,1),
//*             REGION=4096K,USER=IBMUSER,PASSWORD=SYS1
/*JOBPARM LINES=100
//JOBCAT   DD  DSN=SYS1.VSAM.MASTER.CATALOG,DISP=SHR
//*
//*  ADD SUPPORT FOR INDIRECT CATALOGING USING VOLUME(******).
//*  _________________________________________________________
//*
//*  USERMOD ZP60041
//U41S01  EXEC PGM=IEBGENER
//SYSPRINT DD  SYSOUT=*
//SYSUT1   DD  DATA
++USERMOD(ZP60041)              /* ADD INDIRECT CATALOGING */  .
++VER(Z038) FMID(FBB1221)
  PRE(UZ50553,UZ56782)
 /*
   PROBLEM DESCRIPTION:
     THERE IS NO WAY TO CATALOG A DATA SET ON "THE CURRENT SYSRES".
       CATALOG ENTRIES FOR SINGLE-VOLUME NON-VSAM DATA SETS SPECIFY
       THE DEVICE TYPE AND THE VOLUME SERIAL NUMBER.  THERE IS NO
       WAY TO INDICATE THAT THE DATA SET WILL BE FOUND ON WHICHEVER
       VOLUME HAPPENS TO BE THE CURRENT IPL OR SYSTEM RESIDENCE
       VOLUME.

       THIS USERMOD UPDATES ALLOCATION'S VOLUME/UNIT TABLE COMPLETION
       ROUTINE TO RECOGNISE THAT WHEN THE VOLUME SERIAL IN THE
       CATALOG ENTRY OF A SINGLE-VOLUME NON-VSAM DATA SET IS SIX
       ASTERISKS, THE DEVICE TYPE AND VOLUME SERIAL SHOULD BE
       RESOLVED TO BE THAT OF THE CURRENT SYSTEM RESIDENCE VOLUME.

       NOTE THAT WITH NO CHANGE TO IDCAMS, A COMMAND SIMILAR TO
         DEFINE NONVSAM(NAME(DS.NAME) VOLUME(******) DEVT(3350))
       WILL BE SUCCESSFULLY PERFORMED FOR VSAM (BUT NOT OS SYSCTLG
       OR CVOL) CATALOGS.

       UNLIKE MVS/SP, DEVT(0000) IS NOT SUPPORTED - A VALID DEVICE
       TYPE MUST BE SPECIFIED.  ANY SPECIFIED DEVICE TYPE IS REPLACED
       BY THE IPL VOLUME'S DEVICE TYPE WHEN THE SIX ASTERISKS ARE
       REPLACED BY THE IPL VOLUME'S VOLUME SERIAL NUMBER.

   PROBLEM DESCRIPTION:
     EACH VOLUME MUST BE NAMED IN PARMLIB TO SET MOUNT ATTRIBUTES.
       EVERY VOLUME REQUIRING NON-DEFAULT MOUNT ATTRIBUTES MUST BE
       EXPLICITLY NAMED IN THE ACTIVE VATLST MEMBER OF SYS1.PARMLIB.
       THERE IS NO PROVISION TO ASSIGN ATTRIBUTES TO A GROUP OF
       DASD VOLUMES WITH A SINGLE SPECIFICATION IN VATLST.

       THIS USERMOD UPDATES THE VOLUME ATTRIBUTE PROCESSOR (IEAVAP00)
       TO ACCEPT GENERIC MASKS SUCH THAT A SINGLE VATLST STATEMENT
       CAN ASSIGN THE SPECIFIED MOUNT ATTRIBUTES TO EVERY ONLINE
       DASD VOLUME WITH A SERIAL NUMBER MATCHING THE MASK (AND WITH
       A MATCHING DEVICE TYPE).

       GENERIC MASKS FOR VOLUME SERIAL NUMBERS MAY CONTAIN ASTERISKS
       AND PERCENT SIGNS WHERE EACH ASTERISK REPRESENTS A GROUP OF
       ZERO OR MORE CHARACTERS AND EACH PERCENT SIGN REPRESENTS
       EXACTLY ONE CHARACTER.  VOLUME SERIAL CHARACTERS CORRESPONDING
       TO THESE MASKING CHARACTERS IN A COMPARE WILL BE CONSIDERED TO
       MATCH.

       CONSECUTIVE ASTERISKS SHOULD NOT BE CODED EXCEPT FOR THE
       SPECIAL MASK OF SIX ASTERISKS WHICH CAN BE USED TO SPECIFY
       THE CURRENT IPL (OR SYSTEM RESIDENCE) VOLUME.

       TO SPECIFY AN EXACT VOLUME SERIAL CONTAINING AN ASTERISK OR
       PERCENT SIGN, CODE AN 'S' IN COLUMN 7 INSTEAD OF A COMMA.

       THE ONLY GENERIC MASK RECOGNISED FOR THE DEVICE TYPE FIELD IS
       A SINGLE ASTERISK WHICH SPECIFIES THAT ALL DASD DEVICE TYPES
       ARE ACCEPTABLE.  THIS DEVICE TYPE GENERIC MASK CAN BE USED ON
       VATLST STATEMENTS WITH A SPECIFIC OR A GENERIC VOLUME SERIAL.

       IEA166I NO VOLUME MATCH
       IS A NEW MESSAGE ISSUED WHEN NO VOLUMES WERE FOUND TO MATCH
       A GENERIC VOLUME MASK.

       IEA855I MESSAGES WILL CONTINUE TO BE GENERATED WHEN NO VOLUMES
       MATCH A SPECIFICALLY NAMED VOLUME.

   SPECIAL CONDITIONS:
     ACTION:
       THIS SYSMOD SHOULD BE ACTIVATED SIMULTANEOUSLY WITH ZP60042.
       A "CLPA" MUST BE PERFORMED AT IPL TIME FOR THIS SYSMOD TO
       BECOME ACTIVE.

   COMMENTS:
     PRYCROFT SIX P/L PUBLIC DOMAIN USERMOD FOR MVS 3.8 NUMBER 41.
       IEFAB464 CHANGES CONTRIBUTED BY GREG PRICE.
       IEAVAP00 CHANGES CONTRIBUTED BY TOM ARMSTRONG.

     REWORK HISTORY:
       2021-11-05: INITIAL AVAILABILITY.

     THE FOLLOWING MODULES AND/OR MACROS ARE AFFECTED BY THIS USERMOD:
     MODULES:
       IEFAB464
       IEAVAP00
 */.
++MOD(IEFAB464) DISTLIB(AOSB3).
/*
//SYSUT2   DD  DSN=&&SMPMCS,DISP=(NEW,PASS),UNIT=VIO,SPACE=(CYL,10),
//             DCB=(DSORG=PS,RECFM=FB,LRECL=80,BLKSIZE=4080)
//SYSIN    DD  DUMMY
//*
//U41S02  EXEC PGM=IEBUPDTE,PARM='NEW'
//SYSPRINT DD  SYSOUT=*
//SYSUT2   DD  DSN=&&PVTMACS,DISP=(NEW,PASS),
//             UNIT=VIO,SPACE=(TRK,(2,2,2)),
//             DCB=SYS1.MACLIB
//SYSIN    DD  *
./ ADD NAME=FSPACE,SSI=33250485
             MACRO                                                      00050002
&NAME        FSPACE &R,&LV=,&A=                                         00100002
.*****************************************************************      00150002
.*                                                                      00200002
.* MACRO NAME - FSPACE                                                  00250002
.*                                                                      00300002
.* DESCRIPTIVE NAME -FREE SPACE MACRO (THIS IS FREEMAIN LIKE)           00350002
.*                                                                      00400002
.* COPYRIGHT - N/A                                                      00450002
.*                                                                      00500002
.* STATUS - OS/VS2 REL. 2.0                                             00550002
.*                                                                      00600002
.* FUNCTION -                                                           00650002
.*                                                                      00700002
.*   THE FUNCTION OF THIS MACRO IS TO SETUP THE INPUT REGS TO THE       00750002
.*   FSPACE SERVICE ROUTINE LOCATED IN MODULE IEFAB4F6.                 00800002
.*                                                                      00850002
.*   OPERATION -                                                        00900002
.*                                                                      00950002
.*      THIS MACRO REQUIRES - FSPACE R,LV=(0)                           01000002
.*      1) IF INVALID PARAMETERS PRINT MNOTE.                           01050002
.*      2) INSERT CODE                                                  01100002
.*      3) EXIT                                                         01150002
.*                                                                      01200002
.* NOTES -                                                              01250002
.*   DEPENDENCIES -                                                     01300002
.*      THIS MACRO IS CALLED BY USING THE PL/S STACK OPTION.            01350002
.*      THEREFORE CHANGES TO PL/S MAY IMPACT THIS MACRO                 01400002
.*      THE ONLY REGISTERS THE MACRO MAY ALTER ARE 0,1,14,15.           01450002
.*                                                                      01500002
.*   RESTRICTIONS                                                       01550002
.*      NONE.                                                           01600002
.*   REGISTER CONVENTIONS -                                             01650002
.*      MAY ONLY USE 14 THRU 1                                          01700002
.*                                                                      01750002
.*   PATCH LABEL - N/A                                                  01800002
.*                                                                      01850002
.* MODULE TYPE - MACRO                                                  01900002
.*                                                                      01950002
.*   PROCESSER - ASSEM                                                  02000002
.*   MODULE SIZE - N/A                                                  02050002
.*   ATTRIBUTES - EXECUTABLE MACRO                                      02100002
.*                                                                      02150002
.* ENTRY POINT - N/A                                                    02200002
.*                                                                      02250002
.* EXIT -                                                               02300002
.*   R0- UNPREDICTABLE                                                  02350002
.*   R1- UNPREDICTABLE                                                  02400002
.*   R2-R13 NOT CHANGED                                                 02450002
.*   R14 - UNPREDICTABLE                                                02500002
.*   R15 - UNPREDICTABLE                                                02550002
.*                                                                      02600002
.* EXTERNAL REFERENCES - NONE                                           02650002
.*                                                                      02700002
.* TABLES - NONE                                                        02750002
.* MACROS - NONE                                                        02800002
.*                                                                      02850002
.* CHANGE ACTIVITY - Y02670                                             02900002
.*                                                                      02950002
.* MESSAGES - SEE MNOTE IN MACRO CODE.                                  03000002
.*                                                                      06000002
.* ABEND CODES - NONE                                                   09000002
.*                                                                      12000002
.*****************************************************************      15000002
             AIF ('&R' EQ 'R' AND '&LV' EQ '(0)' AND '&A' EQ '(1)').OK  18000002
             MNOTE 4,'FSPACE PARAMETERS INVALID'                        21000002
.OK          ANOP                                                       24000002
&NAME        L     15,GS&SYSNDX.C      SET FSPACE EP IN REG 15          27000002
             CNOP  2,4                 *                                30000002
GS&SYSNDX.L  BALR  14,15               CALL FSPACE                      33000002
             B     GS&SYSNDX.E         +0 RETURN IS NORMAL RETURN       36000002
             B     GS&SYSNDX.D         +4 RETURN REQUIRES FREEMAIN      39000002
GS&SYSNDX.C  DC    V(FSPACE)           FSPACE ENTRY POINT               42000002
GS&SYSNDX.D  SVC   10                  FREEMAIN                         45000002
GS&SYSNDX.E  EQU   *                   *                                48000002
             MEND                                                       51000002
./ ADD NAME=GSPACE,SSI=80520091
             MACRO                                                      00050002
&NAME        GSPACE &R,&LV=                                             00070003
.*****************************************************************      00150002
.*                                                                      00200002
.* MACRO NAME - GSPACE                                                  00250002
.*                                                                      00300002
.* DESCRIPTIVE NAME -GET SPACE MACRO (THIS IS GETMAIN LIKE)             00350002
.*                                                                      00400002
.* COPYRIGHT - N/A                                                      00450002
.*                                                                      00500002
.* STATUS - OS/VS2 REL. 3.7 PTF                                @ZA28413 00550003
.*                                                                      00600002
.* FUNCTION -                                                           00650002
.*                                                                      00700002
.*   THE FUNCTION OF THIS MACRO IS TO SETUP THE INPUT REGS TO THE       00750002
.*   GSPACE SERVICE ROUTINE LOCATED IN MODULE IEFAB4F6.                 00800002
.*                                                                      00850002
.*   OPERATION -                                                        00900002
.*                                                                      00950002
.*      THIS MACRO REQUIRES - GSPACE R,LV=(0),A=(1)                     00970003
.*      1) IF INVALID PARAMETERS PRINT MNOTE.                           01050002
.*      2) INSERT CODE                                                  01100002
.*      3) EXIT                                                         01150002
.*                                                                      01200002
.* NOTES -                                                              01250002
.*   DEPENDENCIES -                                                     01300002
.*      THIS MACRO IS CALLED BY USING THE PL/S STACK OPTION.            01350003
.*      THEREFORE CHANGES TO PL/S MAY IMPACT THIS MACRO                 01380003
.*      THE ONLY REGISTERS THE MACRO MAY ALTER ARE 0,1,14,15.           01410003
.*      A CHANGE TO SVC99'S CSECT NAME MEANS A CHANGE TO GSPACE@YM05157 01440003
.*                                                                      01500002
.*   RESTRICTIONS                                                       01550002
.*      NONE.                                                           01600002
.*   REGISTER CONVENTIONS -                                             01650002
.*      MAY ONLY USE 14 THRU 1                                          01700002
.*                                                                      01750002
.*   PATCH LABEL - N/A                                                  01800002
.*                                                                      01850002
.* MODULE TYPE - MACRO                                                  01900002
.*                                                                      01950002
.*   PROCESSER - ASSEM                                                  02000002
.*   MODULE SIZE - N/A                                                  02050002
.*   ATTRIBUTES - EXECUTABLE MACRO                                      02100002
.*                                                                      02150002
.* ENTRY POINT - N/A                                                    02200002
.*                                                                      02250002
.* EXIT -                                                               02300002
.*   R0- UNPREDICTABLE                                                  02350002
.*   R1- ADDRESS RETURNED FROM GSPACE ROUTINE OR FROM GETMAIN           02400002
.*   R2-R13 NOT CHANGED                                                 02450002
.*   R14 - UNPREDICTABLE                                                02500002
.*   R15 - UNPREDICTABLE                                                02550002
.*                                                                      02600002
.* EXTERNAL REFERENCES - NONE                                           02650002
.*                                                                      02700002
.* TABLES - NONE                                                        02750002
.* MACROS - NONE                                                        02800002
.*                                                                      02850002
.* CHANGE ACTIVITY - Y02670                                             02900002
.*                 - OZ28413                                  @ZA28413  02920003
.*                                                                      02950002
.* MESSAGES - SEE MNOTE IN MACRO CODE.                                  03000002
.*                                                                      06000002
.* ABEND CODES - NONE                                                   09000002
.*                                                                      12000002
.*****************************************************************      15000002
.* GSPACE - C - MERGED BACK TO REL 3.7                         @ZA28413 15050003
             AIF   ('&R' EQ 'R' AND '&LV' EQ '(0)').OK                  18000002
             MNOTE 4,'GSPACE PARAMETERS INVALID'                        21000002
.OK          ANOP                                                       24000002
             AIF   ('&SYSECT' NE 'IEFDB400' AND '&SYSECT' NE 'IEFBB401'*24050003
                AND '&SYSECT' NE 'IEFBB410').OK1              @ZM41392  24100003
.* CSECTS IEFBB401, IEFBB410 HAVE UNPREDICTABLE REG 13.       @ZM41392  24150003
.* CSECT     IEFDB400(SVC99)  HAS AN UNPREDICTABLE REG 13     @YM05157  25000002
             SLR   1,1                                        @YM05157  25500002
             AGO   .OK2                                       @YM05157  26000002
.OK1         ANOP                                             @YM05157  26500002
             LR    1,13                SET ADDRESS IN REG 1             27000002
.OK2         ANOP                                             @YM05157  28000002
&NAME        L     15,GS&SYSNDX.C      SET GSPACE EP IN REG 15          30000002
             CNOP  2,4                 *                                33000002
GS&SYSNDX.L  BALR  14,15               CALL GSPACE                      36000002
             B     GS&SYSNDX.E         +0 RETURN IS NORMAL RETURN       39000002
             B     GS&SYSNDX.D         +4 RETURN REQUIRES GETMAIN       42000002
GS&SYSNDX.C  DC    V(GSPACE)           GSPACE PRIMARY ENTRY POINT       45000002
GS&SYSNDX.V  DC    V(GSPACE1)          GSPACE SECONDARY ENTRY POINT     48000002
GS&SYSNDX.D  SVC   10                  GETMAIN                          51000002
             LTR   0,14                Q. IS RETURN TO GSPACE NECESSARY 54000002
             L     15,GS&SYSNDX.V      GET SECONDARY ENTRY POINT        57000002
             BNZ   GS&SYSNDX.L         A. YES. RETURN TO GSPACE         60000002
GS&SYSNDX.E  EQU   *                   *                                63000002
             MEND                                                       66000002
./ ENDUP
/*
//*
//U41S03  EXEC PGM=IFOX00,PARM='OBJECT,NODECK,NOTERM,XREF(SHORT),RENT'
//SYSPRINT DD  SYSOUT=*
//SYSUT1   DD  UNIT=VIO,SPACE=(CYL,10)
//SYSUT2   DD  UNIT=VIO,SPACE=(CYL,10)
//SYSUT3   DD  UNIT=VIO,SPACE=(CYL,10)
//SYSLIB   DD  DSN=SYS1.MACLIB,DISP=SHR
//         DD  DSN=SYS1.SMPMTS,DISP=SHR
//         DD  DSN=SYS1.AMODGEN,DISP=SHR
//         DD  DSN=SYSGEN.RAKF.V1R2M6.MACLIB,DISP=SHR
//         DD  DSN=&&PVTMACS,DISP=(OLD,PASS)
//SYSGO    DD  DSN=&&SMPMCS,DISP=(MOD,PASS)
//SYSIN    DD  *
         TITLE 'IEFAB464- VOLUME/UNIT TABLE COMPLETION                 *00001000
                        '                                               00002000
IEFAB464 CSECT ,                                                01S0001 00003000
@MAINENT DS    0H                                               01S0001 00004000
         USING *,R15                                            01S0001 00005000
         B     @PROLOG                                          01S0001 00006000
         DC    AL1(30)                                             @41C 00007000
         DC    C'IEFAB464 86051 UZ50553'                        01S0001 00008000
         DC    C' ZP60041 '            SUPPORT VOL=SER=******      @41A 00008501
         DROP  R15                                                      00009000
@PROLOG  STM   R14,R12,12(R13)                                  01S0001 00010000
         BALR  R12,0                                            01S0001 00011000
@PSTART  DS    0H                                               01S0001 00012000
         USING @PSTART,R12                                      01S0001 00013000
         L     R0,@SIZDATD                                      01S0001 00014000
         GSPACE   R,LV=(0)                                              00015000
         LR    R11,R1                                           01S0001 00016000
         USING @DATD,R11                                        01S0001 00017000
         ST    R13,@SA00001+4                                   01S0001 00018000
         LM    R0,R1,20(R13)                                    01S0001 00019000
         ST    R11,8(,R13)                                      01S0001 00020000
         LR    R13,R11                                          01S0001 00021000
         MVC   @PC00001(28),0(R1)                               01S0001 00022000
*                                      # OF BYTES AND IS GIVEN IN HDR   00023000
*                                      OF THIS SECTION               */ 00024000
*   CSIOTP=CSIOTPTR;                /* GET POINTER TO CURRENT SIOT.  */ 00025000
         L     R10,@PC00001+12                                  01S0107 00026000
         L     R6,CSIOTPTR(,R10)                                01S0107 00027000
         USING MYSIOT,R6                                                00027501
*   CJFCBP=CJFCBPTR;                /* GET POINTER TO CURRENT JFCB.  */ 00028000
         L     R10,@PC00001+16                                  01S0108 00029000
         L     R7,CJFCBPTR(,R10)                                01S0108 00030000
         USING MYJFCB,R7                                                00030501
*   RSIOTP=RSIOTPTR;                /* GET POINTER TO REFERENCED SIOT*/ 00031000
         L     R10,@PC00001+24                                  01S0109 00032000
         L     R8,RSIOTPTR(,R10)                                01S0109 00033000
*   ZEROUCB=0;                      /* SETUP FOR RETRIEVED DEVICE       00034000
*                                      TYPE.                         */ 00035000
         SLR   R10,R10                                          01S0110 00036000
         ST    R10,ZEROUCB                                      01S0110 00037000
*   IF HWGEPACP=0 THEN              /* IF NO SPECIAL                 */ 00038000
         L     R9,@PC00001+4                                    01S0111 00039000
         L     R9,HWDATAP(,R9)                                  01S0111 00040000
         C     R10,HWGEPACP(,R9)                                01S0111 00041000
         BNE   @RF00111                                         01S0111 00042000
*     EPAPTR=HWLEPAP;               /* EPA CHAIN USE NORMAL CHAIN,   */ 00043000
         L     R10,HWLEPAP(,R9)                                 01S0112 00044000
         ST    R10,EPAPTR                                       01S0112 00045000
*   ELSE                            /* OTHERWISE USE SPECIAL CHAIN   */ 00046000
*     EPAPTR=HWGEPACP;              /* FOR ASSIGNED JFCBX(S).        */ 00047000
         B     @RC00111                                         01S0113 00048000
@RF00111 L     R10,@PC00001+4                                   01S0113 00049000
         L     R10,HWDATAP(,R10)                                01S0113 00050000
         L     R10,HWGEPACP(,R10)                               01S0113 00051000
         ST    R10,EPAPTR                                       01S0113 00052000
*   IF HWDSNCAT=YES³HWRESIOT=YES³   /* IF THERE IS AN        @YM06136*/ 00053000
*       HWVUREC=YES THEN            /* EXTERNAL (NON-JCL)    @YM06136*/ 00054000
@RC00111 L     R10,@PC00001                                     01S0114 00055000
         L     R10,HWCNTRLP(,R10)                               01S0114 00056000
         TM    HWDSNCAT(R10),B'01001100'                        01S0114 00057000
         BZ    @RF00114                                         01S0114 00058000
*     DO;                           /* SOURCE FOR VOLUME     @YM06136*/ 00059000
*       SCTVOLCT=0;                 /* AND UNIT INFORMATION  @YM06136*/ 00060000
         MVI   SCTVOLCT,X'00'                                   01S0116 00061000
*       JFCBNVOL=0;                 /* CLEAR # VOLUMES       @YM06136*/ 00062000
         MVI   JFCBNVOL,X'00'                                   01S0117 00063000
*     END;                          /* FIELDS                @YM06136*/ 00064000
*   IF HWDSNCAT=YES³HWVUREC=YES THEN/* VOLUME/UNIT INFORMATION       */ 00065000
@RF00114 L     R10,@PC00001                                     01S0119 00066000
         L     R10,HWCNTRLP(,R10)                               01S0119 00067000
         TM    HWDSNCAT(R10),B'01000100'                        01S0119 00068000
         BZ    @RF00119                                         01S0119 00069000
*     DO;                           /* FOUND IN CRI ?                */ 00070000
*                                                               02S0121 00071000
*/********************************************************************/ 00072000
*/*                                                                  */ 00073000
*/* SEGMENT NAME - CRIRFCMP                                          */ 00074000
*/*                                                                  */ 00075000
*/* DESCRIPTIVE NAME - CRI REFERENCE VOLUME/UNIT  COMPLETION         */ 00076000
*/*                                                                  */ 00077000
*/* FUNCTION - SETUP ROUTINES HAVE ESTABLISHED THE SOURCE OF         */ 00078000
*/*            IMPLICIT(DD HAS VOL=REF OR DOES NOT HAVE VOLUME       */ 00079000
*/*            SERIALS) VOLUME/UNIT INFORMATION. IF THAT INFORMATION */ 00080000
*/*            IS IN THE CATALOG THEN THIS ROUTINE COPIES IT FROM    */ 00081000
*/*            THE CRI(CATALOG RETURN INFORMATION) TO THE CURRENT    */ 00082000
*/*            REQUEST (SIOT,JFCB AND JFCBX(S)).                     */ 00083000
*/* ENTRY -                                                          */ 00084000
*/*   PURPOSE - SEE FUNCTION.                                        */ 00085000
*/*                                                                  */ 00086000
*/*   INPUT DATA - HSKPWA (CONTROLS,DATA AND RETURN INFO), CURRENT   */ 00087000
*/*                SIOT,JFCB,JFCBX AND CRI.                          */ 00088000
*/* EXITS -                                                          */ 00089000
*/*   CONDITION- WHEN INFORMATION IS COPIED.                         */ 00090000
*/*                                                                  */ 00091000
*/*   OUTPUT DATA- UPDATED SIOT AND JFCB. UPDATED/CREATED JFCBX.     */ 00092000
*/*                                                                  */ 00093000
*/*   RETURN CODE-NONE.                                              */ 00094000
*/*                                                                  */ 00095000
*/********************************************************************/ 00096000
*                                                               02S0121 00097000
*       IF SCTVOLAF=NO THEN         /* INDICATE A CATALOGED.         */ 00098000
         TM    SCTSBYT2,SCTVOLAF                                02S0121 00099000
         BNZ   @RF00121                                         02S0121 00100000
*         JFCCAT=YES;               /* DATA SET IF NOT VOL=REF.      */ 00101000
         OI    JFCBTSDM,JFCCAT                                  02S0122 00102000
*       IF HWVUREC=YES THEN         /* GET NTH UNIQUE DEVICE TYPE FOR*/ 00103000
@RF00121 L     R10,@PC00001                                     02S0123 00104000
         L     R10,HWCNTRLP(,R10)                               02S0123 00105000
         TM    HWVUREC(R10),B'01000000'                         02S0123 00106000
         BNO   @RF00123                                         02S0123 00107000
*         DO;                       /* VOL/UNIT RECURSION(N=DD  02S0124 00108000
*                                      COUNTER)                      */ 00109000
*           CALL IEFAB463           /* SCAN CRI FOR NTH DEVICE TYPE     00110000
*                                      AS IN DD CTR                  */ 00111000
*               (FUNC2,CRIP,HWDDCTR,DEVTYPE,DEVSFND,VLPTR);     02S0125 00112000
         LA    R9,HW2                                           02S0125 00113000
         ST    R9,@AL00001                                      02S0125 00114000
         L     R9,@PC00001+20                                   02S0125 00115000
         ST    R9,@AL00001+4                                    02S0125 00116000
         LA    R10,HWDDCTR(,R10)                                02S0125 00117000
         ST    R10,@AL00001+8                                   02S0125 00118000
         LA    R10,DEVTYPE                                      02S0125 00119000
         ST    R10,@AL00001+12                                  02S0125 00120000
         LA    R10,DEVSFND                                      02S0125 00121000
         ST    R10,@AL00001+16                                  02S0125 00122000
         LA    R10,VLPTR                                        02S0125 00123000
         ST    R10,@AL00001+20                                  02S0125 00124000
         L     R15,IEFAB463                                     02S0125 00125000
         LA    R1,@AL00001                                      02S0125 00126000
         BALR  R14,R15                                          02S0125 00127000
*           SCTNMBUT=0;             /* CTLG. MGMNT HAS PASSED UNIT      00128000
*                                      CNT.                          */ 00129000
         MVI   SCTNMBUT,X'00'                                   02S0126 00130000
*           JFCORGAM=YES;           /* SET TO VSAM           @YA00068*/ 00131000
         OI    JFCDSRG2,JFCORGAM                                02S0127 00132000
*         END;                                                  02S0128 00133000
*       ELSE                        /* IF NOT VOL/UNIT RECURSION THEN*/ 00134000
*         DO;                       /* GET THE DEVICE TYPE IN 1ST    */ 00135000
         B     @RC00123                                         02S0129 00136000
@RF00123 DS    0H                                               02S0130 00137000
*           DEVTYPE=CTGVLDEV(1);    /* VOLUME LIST ENTRY AND SET PTR */ 00138000
         L     R10,@PC00001+20                                  02S0130 00139000
         L     R10,CRIP(,R10)                                   02S0130 00140000
         L     R10,CTGWKA(,R10)                                 02S0130 00141000
         L     R10,CTGWAVL(,R10)                                02S0130 00142000
         CLC   ASTERS,CTGVLVOL(R10)    VOL=SER=****** ?            @41A 00142100
         BNE   NOTSTARS                NO                          @41A 00142200
         L     R2,CVTPTR(,0)           YES, POINT TO THE CVT       @41A 00142300
         L     R2,CVTSYSAD-CVT(,R2)    POINT TO UCB OF SYSRES      @41A 00142400
**       ST    R2,SIOUCNVT             SAVE UCB ADDRESS IN SIOT    @41A 00142500
         MVC   CTGVLVOL(6,R10),28(R2)  LOAD VOLUME SERIAL          @41A 00142600
         MVC   CTGVLDEV(4,R10),16(R2)  LOAD DEVICE TYPE            @41A 00142700
         MVI   JFCBVOLS+6,C'*'         FLAG INDIRECTLY CATALOGED   @41A 00142800
NOTSTARS DS    0H                                                  @41A 00142900
         MVC   DEVTYPE(4),CTGVLDEV(R10)                         02S0130 00143000
*           DEVTPTR=ADDR(DEVTYPE);  /* SET DEVICE TYPE PTR TO DEVTYPE   00144000
*                                      FOR DEVTPROC          @ZA12414*/ 00145000
         LA    R2,DEVTYPE                                       02S0131 00146000
*           IF DEVTBYT4^=0 THEN     /* DEVICE TYPE IS NOT THE RESULT    00147000
*                                      OF GROUP NAME SPECIFIED  02S0132 00148000
*                                                            @ZA16380*/ 00149000
         CLI   DEVTBYT4(R2),0                                   02S0132 00150000
         BE    @RF00132                                         02S0132 00151000
*             CALL DEVTPROC;        /* TURN OFF DEVTYPE BITS @ZA12414*/ 00152000
         BAL   R14,DEVTPROC                                     02S0133 00153000
*           VLPTR=CTGWAVL;          /* TO 1ST VOLIST ENTRY.          */ 00154000
@RF00132 L     R10,@PC00001+20                                  02S0134 00155000
         L     R10,CRIP(,R10)                                   02S0134 00156000
         L     R10,CTGWKA(,R10)                                 02S0134 00157000
         L     R9,CTGWAVL(,R10)                                 02S0134 00158000
         ST    R9,VLPTR                                         02S0134 00159000
*           RFY                                                 02S0135 00160000
*             CTGVL BASED(VLPTR);   /* VOLIST ADDRESSIBILTY.         */ 00161000
*           RFY                                                 02S0136 00162000
*             HWDEV BASED(ADDR(DEVTYPE));/* SET BASE FOR DEVTYPE        00163000
*                                      COMPARE.                      */ 00164000
*           IF CTGWAVCT=1&SCTVOLAF=NO&HWDA=YES/* DSCB TTR FOR SINGLE */ 00165000
*               &JFCORGAM=NO THEN   /* VOLUME, NON-VOLREF, DA,  02S0137 00166000
*                                      NON-VSAM                      */ 00167000
         CLC   CTGWAVCT(2,R10),HW1                              02S0137 00168000
         BNE   @RF00137                                         02S0137 00169000
         TM    SCTSBYT2,SCTVOLAF                                02S0137 00170000
         BNZ   @RF00137                                         02S0137 00171000
         LA    R10,DEVTYPE                                      02S0137 00172000
         TM    HWCTBYT(R10),HWDA                                02S0137 00173000
         BNO   @RF00137                                         02S0137 00174000
         TM    JFCDSRG2,JFCORGAM                                02S0137 00175000
         BNZ   @RF00137                                         02S0137 00176000
*             JFCBDSCB=CTGVLTTR;    /* DATA SETS.                    */ 00177000
         MVC   JFCBDSCB(3),CTGVLTTR(R9)                         02S0138 00178000
*           IF SIOTGALL=YES³JFCBFLSQ=0 THEN/* USE FILE SEQUENCE NO.     00179000
*                                      IN                            */ 00180000
@RF00137 TM    SIOTBYT2,SIOTGALL                                02S0139 00181000
         BO    @RT00139                                         02S0139 00182000
         LH    R10,JFCBFLSQ                                     02S0139 00183000
         LTR   R10,R10                                          02S0139 00184000
         BNZ   @RF00139                                         02S0139 00185000
@RT00139 DS    0H                                               02S0140 00186000
*             JFCBFLSQ=CTGVLSEQ(1); /* CRI IF GDG ALL OR IF NOT 02S0140 00187000
*                                      CODED.                        */ 00188000
         L     R10,VLPTR                                        02S0140 00189000
         LH    R10,CTGVLSEQ(,R10)                               02S0140 00190000
         STH   R10,JFCBFLSQ                                     02S0140 00191000
*           IF JFCORGAM=YES&SCTPARLM=NO THEN/* VSAM DATA SET, NO        00192000
*                                                            @YM06579*/ 00193000
@RF00139 TM    JFCDSRG2,JFCORGAM                                02S0141 00194000
         BNO   @RF00141                                         02S0141 00195000
         TM    SCTSBYT1,SCTPARLM                                02S0141 00196000
         BNZ   @RF00141                                         02S0141 00197000
*             SCTNMBUT=CTGWAUCT;    /* PARALLEL MNT, GET UNIT COUNT     00198000
*                                      FROM CATALOG          @YM06579*/ 00199000
         L     R10,@PC00001+20                                  02S0142 00200000
         L     R10,CRIP(,R10)                                   02S0142 00201000
         L     R10,CTGWKA(,R10)                                 02S0142 00202000
         LH    R10,CTGWAUCT(,R10)                               02S0142 00203000
         STC   R10,SCTNMBUT                                     02S0142 00204000
*         END;                      /* END NON RECURSIVE ONLY.       */ 00205000
@RF00141 DS    0H                                               02S0144 00206000
*       JFCMSVGP=BLANKS;            /* CLEAR MSVG NAME FIELD @ZA08174*/ 00207000
@RC00123 MVC   JFCMSVGP(8),BLANKS                               02S0144 00208000
*       JFCBMSGP=NO;                /* TURN MSVGP BIT OFF    @ZA08174*/ 00209000
         NI    JFCBCTRI,255-JFCBMSGP                            02S0145 00210000
*       JVOLPTR=ADDR(JFCBVOLS)-VOLSERLN;/* ADJUSTED 1ST VOLSER  02S0146 00211000
*                                      POSITION                      */ 00212000
         LA    R4,JFCBVOLS                                      02S0146 00213000
         SL    R4,FW6                                           02S0146 00214000
*       DO VLPTR=VLPTR TO CTGWAVL+(CTGWAVCT-1)*VLEN BY VLEN;/* GET      00215000
*                                      ALL VOLSERS FOR THIS DEVTYPE. */ 00216000
         L     R10,VLPTR                                        02S0147 00217000
         B     @DE00147                                         02S0147 00218000
@DL00147 DS    0H                                               02S0148 00219000
*         CDEVPTR=ADDR(CTGVLDEV);   /* PTR TO DEVTYPE IN CRI.        */ 00220000
         LA    R5,CTGVLDEV(,R10)                                02S0148 00221000
*         DEVTPTR=CDEVPTR;          /* SET DEVICE TYPE PTR TO   02S0149 00222000
*                                      CTGVLDEV FOR DEVTPROC @ZA12414*/ 00223000
         LR    R2,R5                                            02S0149 00224000
*         IF DEVTBYT4^=0 THEN       /* DEVICE TYPE IS NOT THE RESULT    00225000
*                                      OF GROUP NAME SPECIFIED  02S0150 00226000
*                                                            @ZA16380*/ 00227000
         CLI   DEVTBYT4(R2),0                                   02S0150 00228000
         BE    @RF00150                                         02S0150 00229000
*           CALL DEVTPROC;          /* TURN OFF CTGVLDEV BITS   02S0151 00230000
*                                                            @ZA12414*/ 00231000
         BAL   R14,DEVTPROC                                     02S0151 00232000
*         IF HWDEV^=CDEVPTR->HWDEV THEN/* IF DEVICE TYPES NOT THE       00233000
*                                      SAME THEN UPDATE UNIT COUNT      00234000
*                                                            @Y30LPPE*/ 00235000
@RF00150 LA    R10,DEVTYPE                                      02S0152 00236000
         CLC   HWDEV(4,R10),HWDEV(R5)                           02S0152 00237000
         BE    @RF00152                                         02S0152 00238000
*           IF SCTNMBUT=0&HWVUREC=YES&SCTPARLM=NO THEN/* COUNT,IF NOT   00239000
*                                      DONE.                         */ 00240000
         CLI   SCTNMBUT,0                                       02S0153 00241000
         BNE   @RF00153                                         02S0153 00242000
         L     R10,@PC00001                                     02S0153 00243000
         L     R10,HWCNTRLP(,R10)                               02S0153 00244000
         TM    HWVUREC(R10),B'01000000'                         02S0153 00245000
         BNO   @RF00153                                         02S0153 00246000
         TM    SCTSBYT1,SCTPARLM                                02S0153 00247000
         BNZ   @RF00153                                         02S0153 00248000
*             DO;                   /* USE VOLCOUNT OR CRI UNIT COUNT*/ 00249000
*               SCTNMBUT=MIN(CTGWAUCT,SCTVOLCT);/* USE SMALLER UNIT     00250000
*                                      COUNT                         */ 00251000
         L     R10,@PC00001+20                                  02S0155 00252000
         L     R10,CRIP(,R10)                                   02S0155 00253000
         L     R10,CTGWKA(,R10)                                 02S0155 00254000
         LH    R9,CTGWAUCT(,R10)                                02S0155 00255000
         SLR   R5,R5                                            02S0155 00256000
         IC    R5,SCTVOLCT                                      02S0155 00257000
         CR    R5,R9                                            02S0155 00258000
         BNH   *+6                                                      00259000
         LR    R5,R9                                            02S0155 00260000
         STC   R5,SCTNMBUT                                      02S0155 00261000
*               CTGWAUCT=CTGWAUCT-SCTNMBUT;/* UPDATE MIN UNIT COUNT     00262000
*                                      IN                            */ 00263000
         SLR   R9,R5                                            02S0156 00264000
         STH   R9,CTGWAUCT(,R10)                                02S0156 00265000
*             END;                  /* CRI BY THIS DEVTYP'S UNIT        00266000
*                                      COUNT.                        */ 00267000
*           ELSE                                                02S0158 00268000
*             ;                     /* NULL...                       */ 00269000
@RF00153 DS    0H                                               02S0159 00270000
*         ELSE                      /* DEVTYPES ARE THE SAME,ITS NOT */ 00271000
*           IF HWTAPE=NO³SCTVOLAF=NO THEN/* VOLREF TO A TAPE DATA       00272000
*                                      SET,COPY                      */ 00273000
         B     @RC00152                                         02S0159 00274000
@RF00152 LA    R10,DEVTYPE                                      02S0159 00275000
         TM    HWCTBYT(R10),HWTAPE                              02S0159 00276000
         BZ    @RT00159                                         02S0159 00277000
         TM    SCTSBYT2,SCTVOLAF                                UZ50553 00278001
         BZ    @RT00159                                         UZ50553 00279001
         TM    SCTSBYT2,SCTVOLAF                                UZ50553 00279101
         BNO   @RF00159                                         UZ50553 00279201
         TM    SCTSBYT4,SCTSGDGS                                UZ50553 00279301
         BNO   @RF00159                                         UZ50553 00279401
@RT00159 DS    0H                                               02S0160 00280000
*             DO;                   /* VOLSER FROM VOLIST TO JFCB(X).*/ 00281000
*               CALL JFCBXGEN;      /* GET NEXT VOLSER LOCATION      */ 00282000
         BAL   R14,JFCBXGEN                                     02S0161 00283000
*               NEXTSER=CTGVLVOL(1);/* PUT VOLSER IN JFCB(X)         */ 00284000
         L     R10,VLPTR                                        02S0162 00285000
         MVC   NEXTSER(6,R4),CTGVLVOL(R10)                      02S0162 00286000
*               SCTVOLCT=SCTVOLCT+1;/* INCREMENT NUMBER VOLSERS 02S0163 00287000
*                                      COPIED.                       */ 00288000
         LA    R10,1                                            02S0163 00289000
         SLR   R9,R9                                            02S0163 00290000
         IC    R9,SCTVOLCT                                      02S0163 00291000
         ALR   R10,R9                                           02S0163 00292000
         STC   R10,SCTVOLCT                                     02S0163 00293000
*             END;                                              02S0164 00294000
*           ELSE                    /* VOLREF TO TAPE,GET LAST VOLSER*/ 00295000
*             JFCBVOLS(1:VOLSERLN)=CTGVLVOL(1);/* BY ALWAYS COPYING     00296000
*                                      TO 1ST SLOT                   */ 00297000
         B     @RC00159                                         02S0165 00298000
@RF00159 L     R10,VLPTR                                        02S0165 00299000
         MVC   JFCBVOLS(6),CTGVLVOL(R10)                        02S0165 00300000
*       END;                        /* END FOR CRI. VOLUME LIST SCAN.*/ 00301000
@RC00159 DS    0H                                               02S0166 00302000
@RC00152 LH    R10,VLEN                                         02S0166 00303000
         AL    R10,VLPTR                                        02S0166 00304000
         ST    R10,VLPTR                                        02S0166 00305000
@DE00147 L     R9,@PC00001+20                                   02S0166 00306000
         L     R9,CRIP(,R9)                                     02S0166 00307000
         L     R9,CTGWKA(,R9)                                   02S0166 00308000
         L     R5,@PC00001+20                                   02S0166 00309000
         L     R5,CRIP(,R5)                                     02S0166 00310000
         L     R5,CTGWKA(,R5)                                   02S0166 00311000
         LH    R1,CTGWAVCT(,R5)                                 02S0166 00312000
         BCTR  R1,0                                             02S0166 00313000
         MH    R1,VLEN                                          02S0166 00314000
         AL    R1,CTGWAVL(,R9)                                  02S0166 00315000
         CR    R10,R1                                           02S0166 00316000
         BNH   @DL00147                                         02S0166 00317000
*       IF HWTAPE=YES&SCTVOLAF=YES THEN/* IF VOLREF TO A TAPE DATA      00318000
*                                      SET                           */ 00319000
         LA    R10,DEVTYPE                                      02S0167 00320000
         TM    HWCTBYT(R10),HWTAPE                              02S0167 00321000
         BNO   @RF00167                                         02S0167 00322000
         TM    SCTSBYT2,SCTVOLAF                                02S0167 00323000
         BNO   @RF00167                                         02S0167 00324000
         TM    SCTSBYT4,SCTSGDGS                                UZ50553 00324300
         BNZ   @RF00167                                         UZ50553 00324400
*         SCTVOLCT=1;               /* INDICATE 1 SPECIFIC VOLSER    */ 00325000
         MVI   SCTVOLCT,X'01'                                   02S0168 00326000
*       JFCBNVOL=SCTVOLCT;          /* TELL DATA MGMNT. NUMBER OF       00327000
*                                      VOLS.                         */ 00328000
@RF00167 IC    R10,SCTVOLCT                                     02S0169 00329000
         STC   R10,JFCBNVOL                                     02S0169 00330000
*       IF HWVUREC=YES THEN         /* IF VOL/UNIT RECURSION THEN    */ 00331000
         L     R10,@PC00001                                     02S0170 00332000
         L     R10,HWCNTRLP(,R10)                               02S0170 00333000
         TM    HWVUREC(R10),B'01000000'                         02S0170 00334000
         BNO   @RF00170                                         02S0170 00335000
*         DO;                       /* UPDATE FOR NEXT CRI SCAN      */ 00336000
*           IF HWDDCTR=HWDDSTEP THEN/* LAST DD FOR VOL/UNIT     02S0172 00337000
*                                      RECURSION,                    */ 00338000
         CLC   HWDDCTR(2,R10),HWDDSTEP(R10)                     02S0172 00339000
         BNE   @RF00172                                         02S0172 00340000
*             IF SCTPARLM=NO THEN   /* IF NOT PARALLEL MOUNT THEN ADD*/ 00341000
         TM    SCTSBYT1,SCTPARLM                                02S0173 00342000
         BNZ   @RF00173                                         02S0173 00343000
*               SCTNMBUT=SCTNMBUT+CTGWAUCT;/* RESIDUAL UNIT COUNT IN    00344000
*                                      CRI.                          */ 00345000
         L     R10,@PC00001+20                                  02S0174 00346000
         L     R10,CRIP(,R10)                                   02S0174 00347000
         L     R10,CTGWKA(,R10)                                 02S0174 00348000
         SLR   R9,R9                                            02S0174 00349000
         IC    R9,SCTNMBUT                                      02S0174 00350000
         AH    R9,CTGWAUCT(,R10)                                02S0174 00351000
         STC   R9,SCTNMBUT                                      02S0174 00352000
*           HWDDCTR=HWDDCTR+1;      /* UPDATE COUNTER FOR NEXT  02S0175 00353000
*                                      DEVTYPE                       */ 00354000
@RF00173 DS    0H                                               02S0175 00355000
@RF00172 L     R10,@PC00001                                     02S0175 00356000
         L     R10,HWCNTRLP(,R10)                               02S0175 00357000
         LA    R9,1                                             02S0175 00358000
         AH    R9,HWDDCTR(,R10)                                 02S0175 00359000
         STH   R9,HWDDCTR(,R10)                                 02S0175 00360000
*           IF SCTNMBUT=0 THEN      /* IF THERE WAS NO UNIT COUNT       00361000
*                                      FROM                          */ 00362000
         CLI   SCTNMBUT,0                                       02S0176 00363000
         BNE   @RF00176                                         02S0176 00364000
*             SCTNMBUT=1;           /* CRI, INSURE AT LEAST 1.       */ 00365000
         MVI   SCTNMBUT,X'01'                                   02S0177 00366000
*         END;                                                  02S0178 00367000
*     END;                          /* END VOL/UNIT REC./DSN IN CTLG */ 00368000
*   ELSE                            /* IF NO CRI AND REF. SIOT IS    */ 00369000
*     IF HWRESIOT=YES THEN          /* PRESENT THEN VOL/UNIT INFO IS */ 00370000
         B     @RC00119                                         01S0180 00371000
@RF00119 L     R10,@PC00001                                     01S0180 00372000
         L     R10,HWCNTRLP(,R10)                               01S0180 00373000
         TM    HWRESIOT(R10),B'00001000'                        01S0180 00374000
         BNO   @RF00180                                         01S0180 00375000
*       DO;                         /* COMPLETED FROM PREVIOUS DD .  */ 00376000
*                                                               02S0182 00377000
*/********************************************************************/ 00378000
*/*                                                                  */ 00379000
*/* SEGMENT NAME - DDREFCMP                                          */ 00380000
*/*                                                                  */ 00381000
*/* DESCRIPTIVE NAME - DD REFERENCE VOLUME/UNIT COMPLETION           */ 00382000
*/*                                                                  */ 00383000
*/* FUNCTION - SETUP ROUTINES HAVE ESTABLISHED THE SOURCE OF IMPLICIT*/ 00384000
*/*            VOLUME/UNIT INFORMATION. IF THE SOURCE IS A PREVIOUS  */ 00385000
*/*            REQUEST (VIA PDI OR VOL=REF) THEN THIS ROUTINE COPIES */ 00386000
*/*            VOLUME/UNIT INFORMATION FROM THE REFERENCED DD TO THE */ 00387000
*/*            CURRENT DD(SIOT,JFCB AND/OR JFCBX).                   */ 00388000
*/* ENTRY -                                                          */ 00389000
*/*   PURPOSE - OBTAIN VOLUME/UNIT(NO DEVICE TYPE IS COPIED IF UNIT  */ 00390000
*/*             OVERRIDDEN) INFORMATION.                             */ 00391000
*/*                                                                  */ 00392000
*/*   INPUT DATA - HSKPWA(CONTROLS,DATA AND RETURN),CURRENT SIOT,    */ 00393000
*/*                JFCB,JFCBX AND REFERENCED SIOT, JFCB AND JFCBX.   */ 00394000
*/* EXITS -                                                          */ 00395000
*/*   CONDITION- WHEN VOLUME/UNIT INFORMATION IS COPIED.             */ 00396000
*/*                                                                  */ 00397000
*/*   OUTPUT DATA- UPDATED SIOT,JFCB AND JFCBX.                      */ 00398000
*/*                                                                  */ 00399000
*/*   RETURN CODE-NONE.                                              */ 00400000
*/*                                                                  */ 00401000
*/********************************************************************/ 00402000
*                                                               02S0182 00403000
*         RJFCBP=RSIOTP->SJFCBPTR;  /* GET PTR TO REFERENCED JFCB.   */ 00404000
         L     R3,SJFCBPTR-INDMSIOT(,R8)                        02S0182 00405000
*         IF SCTVOLAF=NO THEN       /* RETRIEVED SOURCE NOT VOLREF      00406000
*                                      GET                           */ 00407000
         TM    SCTSBYT2,SCTVOLAF                                02S0183 00408000
         BNZ   @RF00183                                         02S0183 00409000
*           JFCBTSDM=JFCBTSDM³RJFCBP->JFCBTSDM;/* JOB/DATA MGMNT.       00410000
*                                      INTERFACE.                    */ 00411000
         OC    JFCBTSDM(1),JFCBTSDM-INFMJFCB(R3)                02S0184 00412000
*         RTVDUNIT=RSIOTP->SCTUTYPE;/* DEVICE TYPE AND UCB POINTER.  */ 00413000
         NI    JFCBTSDM,255-JFCPAT                                      00413501
@RF00183 MVC   RTVDUNIT(8),SCTUTYPE-INDMSIOT(R8)                02S0185 00414000
*         RFY                                                   02S0186 00415000
*           HWDEV BASED(ADDR(DEVTYPE));/* BASE DEVICE TYPE MAP       */ 00416000
*         IF SCTVREF=YES&RSIOTP->SCTUNAFF=YES THEN/* IF THIS IS INTRA   00417000
*                                      STEP                          */ 00418000
         TM    SCTSBYT3,SCTVREF                                 02S0187 00419000
         BNO   @RF00187                                         02S0187 00420000
         TM    SCTSBYT1-INDMSIOT(R8),SCTUNAFF                   02S0187 00421000
         BNO   @RF00187                                         02S0187 00422000
*           DO;                     /* VOLREF TO A DD WITH UNIT=AFF  */ 00423000
*             SCTUNAFF=YES;         /* THEN MAKE THIS DD HAVE THE       00424000
*                                      SAME                          */ 00425000
         OI    SCTSBYT1,SCTUNAFF                                02S0189 00426000
*             SIOTUNAF=RSIOTP->SIOTUNAF;/* UNIT=AFF.                 */ 00427000
         LH    R10,SIOTUNAF-INDMSIOT(,R8)                       02S0190 00428000
         STH   R10,SIOTUNAF                                     02S0190 00429000
*           END;                                                02S0191 00430000
*         IF HWTAPE=YES THEN        /* IF RETRIEVED DEVICE TYPE IS      00431000
*                                      TAPE                          */ 00432000
@RF00187 LA    R10,DEVTYPE                                      02S0192 00433000
         TM    HWCTBYT(R10),HWTAPE                              02S0192 00434000
         BNO   @RF00192                                         02S0192 00435000
*           DO;                     /* PROCESS UNIQUE TAPE      02S0193 00436000
*                                      INFORMATION.                  */ 00437000
*                                                               03S0194 00438000
*/********************************************************************/ 00439000
*/*                                                                  */ 00440000
*/* SEGMENT NAME - TAPEONLY                                          */ 00441000
*/*                                                                  */ 00442000
*/* DESCRIPTIVE NAME - TAPE ONLY PROCESSING FOR REFERENCED DD.       */ 00443000
*/*                                                                  */ 00444000
*/* FUNCTION -TO PROVIDE THE MAXIMUM POSSIBLE RANGE OF ELIGIBILITY IF*/ 00445000
*/*           REFERENCE (VIA INTER STEP VOL=REF OR DSN FOUND         */ 00446000
*/*           IN PDI) SOURCE IS NOT A 7 TRACK TAPE DATA SET.         */ 00447000
*/*           GET TAPE ONLY INFORMATION FROM A RETRIEVED DD.         */ 00448000
*/*                                                                  */ 00449000
*/*                                                                  */ 00450000
*/* ENTRY - FROM DD REFERENCE COMPLETION.                            */ 00451000
*/*                                                                  */ 00452000
*/*   PURPOSE - SEE FUNCTION.                                        */ 00453000
*/*   INPUT DATA - DENSITY,LABEL INFORMATION AND UNIT INFORMATION    */ 00454000
*/*                IN A REFERENCED DD.                               */ 00455000
*/*                                                                  */ 00456000
*/* EXIT -                                                           */ 00457000
*/*   CONDITION - ALL                                                */ 00458000
*/*                                                                  */ 00459000
*/*   OUTPUT DATA - A UNIT TYPE THAT WILL ENCOMPASS THE GREATEST     */ 00460000
*/*                 RANGE OF ELIGIBILTY.                             */ 00461000
*/*                 DENSITY (IF NOT CODED) AND FILE SEQUENCE         */ 00462000
*/*                 INFORMATION IS COPIED FROM SOURCE TO CURRENT DD. */ 00463000
*/*                                                                  */ 00464000
*/*   RETURN CODE - NONE                                             */ 00465000
*/*                                                                  */ 00466000
*/********************************************************************/ 00467000
*                                                               03S0194 00468000
*             RFY                                               03S0194 00469000
*               INFMJFCB BASED(RJFCBP);                         03S0194 00470000
*             IF HW7TRK=NO&SCTVREF=NO&JFCDEN^=0 THEN/* GET MAX. 03S0195 00471000
*                                      ELIGIBILITY IF NOT 7 TRACK AND   00472000
*                                      NOT                   @YM07531*/ 00473000
         TM    HW7TRK(R10),B'10000000'                          03S0195 00474000
         BNZ   @RF00195                                         03S0195 00475000
         TM    SCTSBYT3,SCTVREF                                 03S0195 00476000
         BNZ   @RF00195                                         03S0195 00477000
         CLI   JFCDEN-INFMJFCB(R3),0                            03S0195 00478000
         BE    @RF00195                                         03S0195 00479000
*               DO;                 /* INTRA-STEP VOL=REF. REF. 03S0196 00480000
*                                      SOURCE MUST HAVE A DENSITY.   */ 00481000
*                 HWOBYTE=0;        /* CLEAR OPTION BYTE.            */ 00482000
         MVI   HWOBYTE(R10),X'00'                               03S0197 00483000
*                 IF RSIOTP->S3400DSP=NO THEN/* IF REFERENCED ISN'T     00484000
*                                      3400 ONLY                     */ 00485000
         TM    SCTSDISP-INDMSIOT(R8),S3400DSP                   03S0198 00486000
         BNZ   @RF00198                                         03S0198 00487000
*                   HWTYPE=T2400;   /* MAKE THIS 2400 SERIES TAPE.   */ 00488000
         MVI   HWTYPE(R10),X'01'                                03S0199 00489000
*                 IF JFCDEN=DEN6250 THEN/* IF IT IS 6250 BPI GIVE    */ 00490000
@RF00198 CLI   JFCDEN-INFMJFCB(R3),X'D3'                        03S0200 00491000
         BNE   @RF00200                                         03S0200 00492000
*                   DO;                                         03S0201 00493000
*                     HWMBYTE=TBPI6250;/* 3400 SERIES 6250 BPI TAPE. */ 00494000
         LA    R10,DEVTYPE                                      03S0202 00495000
         MVI   HWMBYTE(R10),X'32'                               03S0202 00496000
*                     HWTYPE=T3400;                             03S0203 00497000
         MVI   HWTYPE(R10),X'03'                                03S0203 00498000
*                   END;                                        03S0204 00499000
*                 ELSE              /* NOT 6250                      */ 00500000
*                   IF JFCDEN=DEN1600 THEN/* IF 1600 BPI THEN GIVE   */ 00501000
         B     @RC00200                                         03S0205 00502000
@RF00200 CLI   JFCDEN-INFMJFCB(R3),X'C3'                        03S0205 00503000
         BNE   @RF00205                                         03S0205 00504000
*                     HWMBYTE=TBPI1600;/* 1600 BPI MAX. ELIGIBILITY. */ 00505000
         LA    R10,DEVTYPE                                      03S0206 00506000
         MVI   HWMBYTE(R10),X'34'                               03S0206 00507000
*                   ELSE            /* NOT 1600                      */ 00508000
*                     IF JFCDEN=DEN800 THEN/* IF 800 BPI AND         */ 00509000
         B     @RC00205                                         03S0207 00510000
@RF00205 CLI   JFCDEN-INFMJFCB(R3),X'83'                        03S0207 00511000
         BNE   @RF00207                                         03S0207 00512000
*                       IF RSIOTP->S3400DSP=NO THEN/* ELIGIBLE FOR      00513000
*                                      2400 THEN                     */ 00514000
         TM    SCTSDISP-INDMSIOT(R8),S3400DSP                   03S0208 00515000
         BNZ   @RF00208                                         03S0208 00516000
*                         HWMBYTE=TBPI800;/* GIVE MAX. 800 BPI  03S0209 00517000
*                                      ELIGIBILITY.                  */ 00518000
         LA    R10,DEVTYPE                                      03S0209 00519000
         MVI   HWMBYTE(R10),X'30'                               03S0209 00520000
*                       ELSE        /* 3400 ONLY AND 800 BPI         */ 00521000
*                         DO;       /* NEEDS 3400 SERIES DUAL   03S0210 00522000
*                                      DENSITY.                      */ 00523000
         B     @RC00208                                         03S0210 00524000
@RF00208 DS    0H                                               03S0211 00525000
*                           HWMBYTE=TBPI1600;/* MAKE IT 3400 SERIES     00526000
*                                      800/1600                      */ 00527000
         LA    R10,DEVTYPE                                      03S0211 00528000
         MVI   HWMBYTE(R10),X'34'                               03S0211 00529000
*                           HWOBYTE=DUALDEN;/* BPI DUAL DENSITY.     */ 00530000
         MVI   HWOBYTE(R10),X'20'                               03S0212 00531000
*                         END;                                  03S0213 00532000
*               END;                                            03S0214 00533000
@RC00208 DS    0H                                               03S0214 00534000
@RF00207 DS    0H                                               03S0214 00535000
@RC00205 DS    0H                                               03S0214 00536000
@RC00200 DS    0H                                               03S0215 00537000
*             RFY                                               03S0215 00538000
*               INFMJFCB BASED(CJFCBP);                         03S0215 00539000
@RF00195 DS    0H                                               03S0216 00540000
*             IF JFCDEN=0 THEN      /* IF NO DENSITY WAS CODED THEN  */ 00541000
         CLI   JFCDEN,0                                         03S0216 00542000
         BNE   @RF00216                                         03S0216 00543000
*               JFCDEN=RJFCBP->JFCDEN;/* GET IT FROM SOURCE DD.      */ 00544000
         MVC   JFCDEN(1),JFCDEN-INFMJFCB(R3)                    03S0217 00545000
*             IF SCTVOLAF=NO THEN   /* IF NOT VOLUME REFERENCE       */ 00546000
@RF00216 TM    SCTSBYT2,SCTVOLAF                                03S0218 00547000
         BNZ   @RF00218                                         03S0218 00548000
*               JFCBFLSQ=RJFCBP->JFCBFLSQ;/* COPY FILE SEQUENCE.     */ 00549000
         LH    R10,JFCBFLSQ-INFMJFCB(,R3)                       03S0219 00550000
         STH   R10,JFCBFLSQ                                     03S0219 00551000
*           END;                    /* END DD REFERENCE TAPE ONLY.   */ 00552000
@RF00218 DS    0H                                               02S0221 00553000
*         IF RSIOTP->SCTUNLBD=YES THEN/* IF SOURCE DD IS UNLABELLED     00554000
*                                      THEN                          */ 00555000
@RF00192 TM    SCTSBYT2-INDMSIOT(R8),SCTUNLBD                   02S0221 00556000
         BNO   @RF00221                                         02S0221 00557000
*           SCTUNLBD=YES;           /* MAKE CURRENT UNLABELLED       */ 00558000
         OI    SCTSBYT2,SCTUNLBD                                02S0222 00559000
*         IF HWDA=NO³JFCSUL=NO&JFCSL=NO THEN/* IF THIS ISN'T A SUL DA   00560000
*                                      DEVICE,                       */ 00561000
@RF00221 LA    R10,DEVTYPE                                      02S0223 00562000
         TM    HWCTBYT(R10),HWDA                                02S0223 00563000
         BZ    @RT00223                                         02S0223 00564000
         TM    JFCBLTYP,JFCSUL                                  02S0223 00565000
         BNZ   @RF00223                                         02S0223 00566000
@RT00223 DS    0H                                               02S0224 00567000
*           JFCBLTYP=RJFCBP->JFCBLTYP;/* COPY LABEL INFORMATION.     */ 00568000
         MVC   JFCBLTYP(1),JFCBLTYP-INFMJFCB(R3)                02S0224 00569000
*         IF RSIOTP->SIOTPRIV=YES THEN/* IF SOURCE DD IS PRIVATE THEN*/ 00570000
@RF00223 TM    SCTSDISP-INDMSIOT(R8),PRIVATE                    02S0225 00571000
         BNO   @RF00225                                         02S0225 00572000
*           SIOTPRIV=YES;           /* MAKE CURRENT PRIVATE.         */ 00573000
         OI    SCTSDISP,PRIVATE                                 02S0226 00574000
*         IF HWDA=YES&SCTRECVD=YES THEN/* COPY DSN'S DSCB TTR FOR DA */ 00575000
@RF00225 LA    R10,DEVTYPE                                      02S0227 00576000
         TM    HWCTBYT(R10),HWDA                                02S0227 00577000
         BNO   @RF00227                                         02S0227 00578000
         TM    SCTSBYT2,SCTRECVD                                02S0227 00579000
         BNO   @RF00227                                         02S0227 00580000
*           JFCBDSCB=RJFCBP->JFCBDSCB;/* IF RECEIVED DATA SET.       */ 00581000
         MVC   JFCBDSCB(3),JFCBDSCB-INFMJFCB(R3)                02S0228 00582000
*         IF JFCBNVOL^=0 THEN       /* IF A SPECIFIC REQUEST @ZA15749*/ 00583000
@RF00227 CLI   JFCBNVOL,0                                       02S0229 00584000
         BE    @RF00229                                         02S0229 00585000
*           DO;                     /* CLEAR MSVGP INFO      @ZA15749*/ 00586000
*             JFCMSVGP=BLANKS;      /* CLEAR MSVG NAME FIELD @ZA15749*/ 00587000
         MVC   JFCMSVGP(8),BLANKS                               02S0231 00588000
*           END;                                                02S0232 00589000
*         JVOLPTR=ADDR(JFCBVOLS);   /* WHERE TO COPY VOLSERS.        */ 00590000
@RF00229 LA    R4,JFCBVOLS                                      02S0233 00591000
*         RFY                                                   02S0234 00592000
*           INFMJFCB BASED(RJFCBP);                             02S0234 00593000
*         RVOLPTR=ADDR(JFCBVOLS);   /* 1ST SOURCE VOLSER PTR.        */ 00594000
         LA    R2,JFCBVOLS-INFMJFCB(,R3)                        02S0235 00595000
*         RFY                                                   02S0236 00596000
*           INFMJFCB BASED(CJFCBP);                             02S0236 00597000
*         VOLSDONE=NO;              /* INDICATE VOLSERS NOT YET 02S0237 00598000
*                                      COPIED.                       */ 00599000
         NI    VOLSDONE,B'01111111'                             02S0237 00600000
*                                                               03S0238 00601000
*/********************************************************************/ 00602000
*/*                                                                  */ 00603000
*/* SEGMENT NAME - DDVLCOPY                                          */ 00604000
*/*                                                                  */ 00605000
*/* DESCRIPTIVE NAME - DD REFERENCE VOLUME SERIAL COPY.              */ 00606000
*/*                                                                  */ 00607000
*/* FUNCTION - COPY VOLUME SERIAL NUMBERS FROM THE REFERENCED        */ 00608000
*/*            JFCB(X) TO THE CURRENT JFCB(X).                       */ 00609000
*/*            IF COPY IS FOR VOL=REF TO TAPE ONLY THE LAST VOLUME   */ 00610000
*/*            SERIAL IS COPIED.                                     */ 00611000
*/*            JFCBXGEN IS USED TO DETERMINE IF JFCBX(S) ARE         */ 00612000
*/*            REQUIRED FOR NON VOL=REF TO TAPE SITUATIONS.          */ 00613000
*/*                                                                  */ 00614000
*/* ENTRY -                                                          */ 00615000
*/*   PURPOSE - SEE FUNCTION.                                        */ 00616000
*/*                                                                  */ 00617000
*/*   INPUT DATA - CURRENT SIOT,JFCB ,JFCBX(S) AND REFERENCED SIOT,  */ 00618000
*/*                JFCB,JFCBX(S).                                    */ 00619000
*/*                                                                  */ 00620000
*/* EXITS -                                                          */ 00621000
*/*   CONDITIONS - N/A                                               */ 00622000
*/*                                                                  */ 00623000
*/*   OUTPUT DATA - UPDATED SIOT,UPDATED JFCB, UPDATED/CREATED JFCBX.*/ 00624000
*/*                                                                  */ 00625000
*/*   RETURN CODE - NONE.                                            */ 00626000
*/*                                                                  */ 00627000
*/********************************************************************/ 00628000
*                                                               03S0238 00629000
*         DO WHILE(RVOLPTR->VSER^=BLANK/* COPY ALL VOLUME SERIALS.   */ 00630000
*               &VOLSDONE=NO);                                  03S0238 00631000
         B     @DE00238                                         03S0238 00632000
@DL00238 DS    0H                                               03S0239 00633000
*           VSER=RVOLPTR->VSER;     /* COPY VOLSER TO CURRENT DD     */ 00634000
         MVC   VSER(6,R4),VSER(R2)                              03S0239 00635000
*           SCTVOLCT=SCTVOLCT+1;    /* UPDATE THE NUMBER OF VOLSERS. */ 00636000
         LA    R10,1                                            03S0240 00637000
         SLR   R9,R9                                            03S0240 00638000
         IC    R9,SCTVOLCT                                      03S0240 00639000
         ALR   R10,R9                                           03S0240 00640000
         STC   R10,SCTVOLCT                                     03S0240 00641000
*           IF SCTVOLCT//JFXVLNO-JFBVLNO=0 THEN/* SEE IF A JFCBX IS     00642000
*                                      THE                           */ 00643000
         SLR   R9,R9                                            03S0241 00644000
         LR    R0,R10                                           03S0241 00645000
         SRDA  R0,32                                            03S0241 00646000
         D     R0,FW15                                          03S0241 00647000
         SL    R0,FW5                                           03S0241 00648000
         CR    R0,R9                                            03S0241 00649000
         BNE   @RF00241                                         03S0241 00650000
*             DO;                   /* SOURCE FOR NEXT VOLSER.       */ 00651000
*               IF SCTVOLCT=JFBVLNO THEN/* NO. OF VOLUMES IN A  03S0243 00652000
*                                      JFCB,SO                       */ 00653000
         CLI   SCTVOLCT,5                                       03S0243 00654000
         BNE   @RF00243                                         03S0243 00655000
*                 IF RSIOTP->SIOTJFX^=0 THEN/* IF JFCBX(S) EXIST THEN*/ 00656000
         L     R10,SIOTJFX-INDMSIOT(,R8)                        03S0244 00657000
         CR    R10,R9                                           03S0244 00658000
         BE    @RF00244                                         03S0244 00659000
*                   RJFCBXP=RSIOTP->SIOTJFX;/* GET FIRST JFCBX.      */ 00660000
         LR    R5,R10                                           03S0245 00661000
*                 ELSE              /* NO JFCBX SO                   */ 00662000
*                   VOLSDONE=YES;   /* INDICATE ALL VOLSERS COPIED.  */ 00663000
         B     @RC00244                                         03S0246 00664000
@RF00244 OI    VOLSDONE,B'10000000'                             03S0246 00665000
*               ELSE                /* NOT FIRST JFCBX,GET A PTR NEXT*/ 00666000
*                 IF RJFCBXP->JFCBXNXT^=0 THEN/* JFCBX ON CHAIN,IF      00667000
*                                      ANY.                          */ 00668000
         B     @RC00243                                         03S0247 00669000
@RF00243 L     R10,JFCBXNXT-JFCBX(,R5)                          03S0247 00670000
         LTR   R10,R10                                          03S0247 00671000
         BZ    @RF00247                                         03S0247 00672000
*                   RJFCBXP=RJFCBXP->JFCBXNXT;/* NEXT JFCBX ON THE      00673000
*                                      CHAIN.                        */ 00674000
         LR    R5,R10                                           03S0248 00675000
*                 ELSE              /* NO JFCBX SO                   */ 00676000
*                   VOLSDONE=YES;   /* INDICATE ALL VOLSERS COPIED.  */ 00677000
         B     @RC00247                                         03S0249 00678000
@RF00247 OI    VOLSDONE,B'10000000'                             03S0249 00679000
*               RVOLPTR=ADDR(RJFCBXP->JFCBXVOL);/* PTR TO SOURCE        00680000
*                                      VOLSER.                       */ 00681000
@RC00247 DS    0H                                               03S0250 00682000
@RC00243 LA    R2,JFCBXVOL-JFCBX(,R5)                           03S0250 00683000
*               IF RVOLPTR->VSER=BLANK THEN/* IF 1ST VOLSER IS BLANK,*/ 00684000
         CLC   VSER(6,R2),BLANK                                 03S0251 00685000
         BNE   @RF00251                                         03S0251 00686000
*                 VOLSDONE=YES;     /* DON'T CREATE A NEW JFCBX.     */ 00687000
         OI    VOLSDONE,B'10000000'                             03S0252 00688000
*             END;                                              03S0253 00689000
*           ELSE                    /* IF NO NEW JFCBX THEN          */ 00690000
*             RVOLPTR=RVOLPTR+VOLSERLN;/* UPDATE PTR IN THIS JFCBX.  */ 00691000
         B     @RC00241                                         03S0254 00692000
@RF00241 AL    R2,FW6                                           03S0254 00693000
*           IF(HWTAPE=NO³SCTVOLAF=NO)/* IF NOT VOLREF TO TAPE DATA      00694000
*                                      SET                           */ 00695000
*               &VOLSDONE=NO THEN   /* AND ALL VOLSERS ARE NOT COPIED*/ 00696000
@RC00241 LA    R10,DEVTYPE                                      03S0255 00697000
         TM    HWCTBYT(R10),HWTAPE                              03S0255 00698000
         BZ    @GL00015                                         03S0255 00699000
         TM    SCTSBYT2,SCTVOLAF                                03S0255 00700000
         BNZ   @RF00255                                         03S0255 00701000
@GL00015 TM    VOLSDONE,B'10000000'                             03S0255 00702000
         BNZ   @RF00255                                         03S0255 00703000
*             CALL JFCBXGEN;        /* GET NEXT VOLSER SLOT          */ 00704000
         BAL   R14,JFCBXGEN                                     03S0256 00705000
*         END;                      /* END DD REFERENCE VOLSER COPY. */ 00706000
@RF00255 DS    0H                                               03S0257 00707000
@DE00238 CLC   VSER(6,R2),BLANK                                 03S0257 00708000
         BE    @DC00238                                         03S0257 00709000
         TM    VOLSDONE,B'10000000'                             03S0257 00710000
         BZ    @DL00238                                         03S0257 00711000
@DC00238 DS    0H                                               03S0258 00712000
*         IF HWTAPE=YES&SCTVOLAF=YES&SCTVOLCT^=0 THEN/* IF COPY WAS     00713000
*                                      FOR A VOLREF TO TAPE THEN ONLY   00714000
*                                      LAST                          */ 00715000
         LA    R10,DEVTYPE                                      02S0258 00716000
         TM    HWCTBYT(R10),HWTAPE                              02S0258 00717000
         BNO   @RF00258                                         02S0258 00718000
         TM    SCTSBYT2,SCTVOLAF                                02S0258 00719000
         BNO   @RF00258                                         02S0258 00720000
         CLI   SCTVOLCT,0                                       02S0258 00721000
         BE    @RF00258                                         02S0258 00722000
*           DO;                     /* SPECIFIC VOLSER IS USED.      */ 00723000
*                                                               03S0260 00724000
*/********************************************************************/ 00725000
*/*                                                                  */ 00726000
*/* SEGMENT NAME - TAPEVREF.                                         */ 00727000
*/*                                                                  */ 00728000
*/* DESCRIPTIVE NAME - DD REFERENCE/VOLUME REFERENCE FOR TAPE.       */ 00729000
*/*                                                                  */ 00730000
*/* FUNCTION - TO OBTAIN THE PROPER VOLUME SERIAL WHEN VOLUME        */ 00731000
*/*            REFERENCE IS TO A TAPE VOLUME IN A PREVIOUS DD.       */ 00732000
*/*            IF THE VOLUME REFERENCE IS TO A DD WITH A GENERATED   */ 00733000
*/*            VOLUME SERIAL NUMBER AND THAT DD DID NOT GENERATE THAT*/ 00734000
*/*            VOLUME SERIAL NUMBER THEN THE GENERATING DD IS READ.  */ 00735000
*/*            THE LAST VOLUME SERIAL IS THEN OBTAINED FROM THE      */ 00736000
*/*            ORIGINAL DD.                                          */ 00737000
*/*                                                                  */ 00738000
*/* ENTRY -                                                          */ 00739000
*/*   PURPOSE - SEE FUNCTION.                                        */ 00740000
*/*                                                                  */ 00741000
*/*   INPUT DATA - VOLUME SERIAL(ORIGINAL JFCB SVA IN VIRTUAL VOLSER)*/ 00742000
*/*                                                                  */ 00743000
*/* EXITS -                                                          */ 00744000
*/*  CONDITION - N/A                                                 */ 00745000
*/*                                                                  */ 00746000
*/*  OUTPUT DATA - JFCB CONTAINS LAST VOLUME SERIAL IN REFERENCED DD.*/ 00747000
*/*                                                                  */ 00748000
*/*  RETURN CODE - NONE.                                             */ 00749000
*/*                                                                  */ 00750000
*/********************************************************************/ 00751000
*                                                               03S0260 00752000
*             SCTVOLCT=1;           /* 1 VOLSER WAS ACTUALLY COPIED. */ 00753000
         MVI   SCTVOLCT,X'01'                                   03S0260 00754000
*             IF JFCBVOLS(1)=VIRTUAL/* IF THIS IS A GENERATED VOLSER */ 00755000
*                 &JFCBVOLS(2:4)^=RSIOTP->SCTPJFCB THEN/* BUT NOT BY    00756000
*                                      THE                           */ 00757000
         CLI   JFCBVOLS,X'FF'                                   03S0261 00758000
         BNE   @RF00261                                         03S0261 00759000
         CLC   JFCBVOLS+1(3),SCTPJFCB-INDMSIOT(R8)              03S0261 00760000
         BE    @RF00261                                         03S0261 00761000
*               DO;                 /* SOURCE,THEN GET ORIGINAL DD   */ 00762000
*                 SWACTLS=0;        /* CLEAR SWA FUNCTION MAP.       */ 00763000
         SLR   R10,R10                                          03S0263 00764000
         STH   R10,SWACTLS                                      03S0263 00765000
*                 SWREAD=YES;       /* INDICATE READ.                */ 00766000
         OI    SWACTLS,SWREAD                                   03S0264 00767000
*                 IF HWLEPARP=0 THEN/* IF NO EPA EXISTS THEN         */ 00768000
         L     R9,@PC00001+4                                    03S0265 00769000
         L     R9,HWDATAP(,R9)                                  03S0265 00770000
         C     R10,HWLEPARP(,R9)                                03S0265 00771000
         BNE   @RF00265                                         03S0265 00772000
*                   SWNEW=YES;      /* TELL SWA INTERFACE TO CREATE     00773000
*                                      ONE                           */ 00774000
         OI    SWACTLS,SWNEW                                    03S0266 00775000
*                 ELSE              /* OTHERWISE TELL SWA INTERFACE  */ 00776000
*                   SWMOD=YES;      /* TO USE EXISTING EPA.          */ 00777000
         B     @RC00265                                         03S0267 00778000
@RF00265 OI    SWACTLS,SWMOD                                    03S0267 00779000
*                 CALL IEFAB4F7(SWACTLS,HWLEPARP,0,/* READ           */ 00780000
*                     ADDR(JFCBVOLS(2)),ADDR(ORGJFBP),0,1);/* ORIGIN    00781000
*                                      JFCB                          */ 00782000
@RC00265 LA    R10,SWACTLS                                      03S0268 00783000
         ST    R10,@AL00001                                     03S0268 00784000
         L     R10,@PC00001+4                                   03S0268 00785000
         L     R10,HWDATAP(,R10)                                03S0268 00786000
         LA    R10,HWLEPARP(,R10)                               03S0268 00787000
         ST    R10,@AL00001+4                                   03S0268 00788000
         LA    R10,FW0                                          03S0268 00789000
         ST    R10,@AL00001+8                                   03S0268 00790000
         LA    R10,JFCBVOLS+1                                   03S0268 00791000
         ST    R10,@TF00001                                     03S0268 00792000
         LA    R10,@TF00001                                     03S0268 00793000
         ST    R10,@AL00001+12                                  03S0268 00794000
         LA    R10,ORGJFBP                                      03S0268 00795000
         ST    R10,@TF00002                                     03S0268 00796000
         LA    R10,@TF00002                                     03S0268 00797000
         ST    R10,@AL00001+16                                  03S0268 00798000
         LA    R10,FW0                                          03S0268 00799000
         ST    R10,@AL00001+20                                  03S0268 00800000
         LA    R10,FW1                                          03S0268 00801000
         ST    R10,@AL00001+24                                  03S0268 00802000
         L     R15,IEFAB4F7                                     03S0268 00803000
         LA    R1,@AL00001                                      03S0268 00804000
         BALR  R14,R15                                          03S0268 00805000
*                 VOLSDONE=NO;      /* INDICATE VOLSERS NOT COPIED      00806000
*                                      YET.                          */ 00807000
         NI    VOLSDONE,B'01111111'                             03S0269 00808000
*                 JVOLPTR=ADDR(ORGJFBP->JFCBVOLS);/* PTR TO 1ST 03S0270 00809000
*                                      VOLSER.                       */ 00810000
         L     R4,ORGJFBP                                       03S0270 00811000
         LA    R4,JFCBVOLS-INFMJFCB(,R4)                        03S0270 00812000
*                 DO VOLCOPY=1 TO JFBVLNO/* SCAN THE JFCB FOR        */ 00813000
*                       WHILE(VOLSDONE=NO);/* FOR THE LAST VOLUME       00814000
*                                      SERIAL.                       */ 00815000
         LA    R2,1                                             03S0271 00816000
@DL00271 TM    VOLSDONE,B'10000000'                             03S0271 00817000
         BNZ   @DC00271                                         03S0271 00818000
*                   IF VSER^=BLANK THEN/* IF THIS VOLSER IS NOT BLANK*/ 00819000
         CLC   VSER(6,R4),BLANK                                 03S0272 00820000
         BE    @RF00272                                         03S0272 00821000
*                     DO;           /* COPY IT TO CURRENT JFCB.      */ 00822000
*                       JFCBVOLS(1:VOLSERLN)=VSER;/* COPY VOLUME        00823000
*                                      SERIAL.                       */ 00824000
         MVC   JFCBVOLS(6),VSER(R4)                             03S0274 00825000
*                       JVOLPTR=JVOLPTR+VOLSERLN;/* POINT TO NEXT       00826000
*                                      VOLSER                        */ 00827000
         AL    R4,FW6                                           03S0275 00828000
*                     END;                                      03S0276 00829000
*                   ELSE            /* IF THIS VOLSER IS BLANK THEN     00830000
*                                      THE                           */ 00831000
*                     VOLSDONE=YES; /* LAST VOLSER HAS BEEN COPIED.  */ 00832000
         B     @RC00272                                         03S0277 00833000
@RF00272 OI    VOLSDONE,B'10000000'                             03S0277 00834000
*                 END;              /* END ORIGINAL JFCB SCAN.       */ 00835000
@RC00272 AL    R2,FW1                                           03S0278 00836000
         C     R2,FW5                                           03S0278 00837000
         BNH   @DL00271                                         03S0278 00838000
@DC00271 DS    0H                                               03S0279 00839000
*                 JSVAP=ADDR(ORGJFBP->JFCBEXAD);/* SET SVA TO READ      00840000
*                                      FOR 1ST JFCBX.                */ 00841000
         L     R10,ORGJFBP                                      03S0279 00842000
         LA    R10,JFCBEXAD-INFMJFCB(,R10)                      03S0279 00843000
         ST    R10,JSVAP                                        03S0279 00844000
*                 SWNEW=NO;         /* TURN OFF NEW EPA INDICATOR.   */ 00845000
*                 SWMOD=YES;        /* USE EPA IN HWLEPARP.          */ 00846000
         OI    SWACTLS,SWMOD                                    03S0281 00847000
         NI    SWACTLS,255-SWNEW                                03S0281 00848000
*                 DO WHILE(VOLSDONE=NO/* SCAN IT FOR LAST VOLSER,    */ 00849000
*                       &JSVA^=0);  /* IF A JFCBX SVA EXISTS.        */ 00850000
         B     @DE00282                                         03S0282 00851000
@DL00282 DS    0H                                               03S0283 00852000
*                   CALL IEFAB4F7   /* READ A JFCBX.                 */ 00853000
*                       (SWACTLS,HWLEPARP,0,JSVAP,ADDR(JFCBXPTR),0,1);  00854000
         LA    R10,SWACTLS                                      03S0283 00855000
         ST    R10,@AL00001                                     03S0283 00856000
         L     R10,@PC00001+4                                   03S0283 00857000
         L     R10,HWDATAP(,R10)                                03S0283 00858000
         LA    R10,HWLEPARP(,R10)                               03S0283 00859000
         ST    R10,@AL00001+4                                   03S0283 00860000
         LA    R10,FW0                                          03S0283 00861000
         ST    R10,@AL00001+8                                   03S0283 00862000
         LA    R10,JSVAP                                        03S0283 00863000
         ST    R10,@AL00001+12                                  03S0283 00864000
         LA    R10,JFCBXPTR                                     03S0283 00865000
         ST    R10,@TF00001                                     03S0283 00866000
         LA    R10,@TF00001                                     03S0283 00867000
         ST    R10,@AL00001+16                                  03S0283 00868000
         LA    R10,FW0                                          03S0283 00869000
         ST    R10,@AL00001+20                                  03S0283 00870000
         LA    R10,FW1                                          03S0283 00871000
         ST    R10,@AL00001+24                                  03S0283 00872000
         L     R15,IEFAB4F7                                     03S0283 00873000
         LA    R1,@AL00001                                      03S0283 00874000
         BALR  R14,R15                                          03S0283 00875000
*                   DO VOLCOPY=1 TO JFXVLNO/* SCAN THE JFCBX         */ 00876000
*                         WHILE(VOLSDONE=NO);/* FOR LAST VOLUME 03S0284 00877000
*                                      SERIAL.                       */ 00878000
         LA    R2,1                                             03S0284 00879000
@DL00284 TM    VOLSDONE,B'10000000'                             03S0284 00880000
         BNZ   @DC00284                                         03S0284 00881000
*                     IF JFCBXVOL(VOLCOPY)^=BLANK THEN/* VOLSER NOT     00882000
*                                      BLANK                         */ 00883000
         L     R10,JFCBXPTR                                     03S0285 00884000
         LR    R9,R2                                            03S0285 00885000
         MH    R9,HW6                                           03S0285 00886000
         ST    R9,@TF00001                                      03S0285 00887000
         ALR   R9,R10                                           03S0285 00888000
         BCTR  R9,0                                             03S0285 00889000
         BCTR  R9,0                                             03S0285 00890000
         CLC   JFCBXVOL-4-JFCBX(6,R9),BLANK                     03S0285 00891000
         BE    @RF00285                                         03S0285 00892000
*                       JFCBVOLS(1:VOLSERLN)=JFCBXVOL(VOLCOPY);/*       00893000
*                                      COPY IT                       */ 00894000
         AL    R10,@TF00001                                     03S0286 00895000
         BCTR  R10,0                                            03S0286 00896000
         BCTR  R10,0                                            03S0286 00897000
         MVC   JFCBVOLS(6),JFCBXVOL-4-JFCBX(R10)                03S0286 00898000
*                     ELSE          /* IF THIS VOLSER IS BLANK THEN     00899000
*                                      THE                           */ 00900000
*                       VOLSDONE=YES;/* LAST VOLSER HAS BEEN COPIED. */ 00901000
         B     @RC00285                                         03S0287 00902000
@RF00285 OI    VOLSDONE,B'10000000'                             03S0287 00903000
*                   END;            /* END JFCBX SCAN.               */ 00904000
@RC00285 AL    R2,FW1                                           03S0288 00905000
         C     R2,FW15                                          03S0288 00906000
         BNH   @DL00284                                         03S0288 00907000
@DC00284 DS    0H                                               03S0289 00908000
*                   JSVAP=ADDR(JFCBXTTR);/* SET SVA TO READ NEXT        00909000
*                                      JFCBX.                        */ 00910000
         L     R10,JFCBXPTR                                     03S0289 00911000
         ST    R10,JSVAP                                        03S0289 00912000
*                 END;              /* END LAST ORIGINAL VOLSER SCAN.*/ 00913000
@DE00282 TM    VOLSDONE,B'10000000'                             03S0290 00914000
         BNZ   @DC00282                                         03S0290 00915000
         L     R10,JSVAP                                        03S0290 00916000
         BCTR  R10,0                                            03S0290 00917000
         L     R10,JSVA(,R10)                                   03S0290 00918000
         LA    R10,0(,R10)                                      03S0290 00919000
         LTR   R10,R10                                          03S0290 00920000
         BNZ   @DL00282                                         03S0290 00921000
@DC00282 DS    0H                                               03S0291 00922000
*               END;                                            03S0291 00923000
*           END;                    /* END FOR VOL=REF TO TAPE DATA     00924000
*                                      SET                           */ 00925000
@RF00261 DS    0H                                               02S0293 00926000
*         JFCBNVOL=SCTVOLCT;        /* TELL DATA MGMNT NUMBER OF        00927000
*                                      VOLS.                         */ 00928000
@RF00258 IC    R10,SCTVOLCT                                     02S0293 00929000
         STC   R10,JFCBNVOL                                     02S0293 00930000
*         IF SCTVREF=YES THEN       /* IF REF. SIOT WAS FOR          */ 00931000
         TM    SCTSBYT3,SCTVREF                                 02S0294 00932000
         BNO   @RF00294                                         02S0294 00933000
*           DO;                     /* INTRA-STEP VOL=REF THEN       */ 00934000
*             SCTVREF=NO;           /* TURN OFF VOLUME REFERENCE.    */ 00935000
         NI    SCTSBYT3,255-SCTVREF                             02S0296 00936000
*             SIOTVAFF=YES;         /* TURN ON VOLUME AFFINITY.      */ 00937000
         OI    SCTSBYT4,SIOTVAFF                                02S0297 00938000
*             IF RSIOTP->SIOTDMND=YES THEN/* IF REFERENCED REQUEST      00939000
*                                      IS,                           */ 00940000
         TM    SIOTBYT2-INDMSIOT(R8),SIOTDMND                   02S0298 00941000
         BNO   @RF00298                                         02S0298 00942000
*               SIOTDMND=YES;       /* MAKE THIS A, DEMAND REQUEST.  */ 00943000
         OI    SIOTBYT2,SIOTDMND                                02S0299 00944000
*             IF RSIOTP->SIOTSSDS=YES/* REFERENCE IS SUBSYSTEM OR       00945000
*                                      DUMMY                         */ 00946000
*                 ³RSIOTP->SCTDUMMY=YES THEN/* DATA SET INDICATE     */ 00947000
@RF00298 TM    SIOTBYT0-INDMSIOT(R8),SIOTSSDS                   02S0300 00948000
         BO    @RT00300                                         02S0300 00949000
         TM    SCTSBYT1-INDMSIOT(R8),SCTDUMMY                   02S0300 00950000
         BNO   @RF00300                                         02S0300 00951000
@RT00300 DS    0H                                               02S0301 00952000
*               SIOTREFN=0;         /* NO VOLUME AFFINITY.           */ 00953000
         SLR   R10,R10                                          02S0301 00954000
         STH   R10,SIOTREFN                                     02S0301 00955000
*             ELSE                  /* NOT SUB OR DUMMY              */ 00956000
*               SIOTREFN=RSIOTP->SCTDDINO;/* PASS AFFINITY DD NO.    */ 00957000
         B     @RC00300                                         02S0302 00958000
@RF00300 LH    R10,SCTDDINO-INDMSIOT(,R8)                       02S0302 00959000
         STH   R10,SIOTREFN                                     02S0302 00960000
*             IF RJFCBP->JFCBVOLS(1:6)=BLANK&/* REFD REQUEST IS 02S0303 00961000
*                                      NON-SPECIFIC          @ZA08546*/ 00962000
*                 SCTSMOD=YES&      /* MOD SPECIFIED         @ZA08546*/ 00963000
*                 (JFCBDSNM^=RJFCBP->JFCBDSNM³/* NOT THE SAME DATA      00964000
*                                      SET                   @ZA08546*/ 00965000
*                 (JFCORGIS=YES&    /* ISAM REQUEST          @ZA08546*/ 00966000
*                 JFCBELNM^=RJFCBP->JFCBELNM)) THEN/* DIFFERENT 02S0303 00967000
*                                      ELEMENTS OF ISAM DS   @ZA08546*/ 00968000
@RC00300 CLC   JFCBVOLS-INFMJFCB(6,R3),BLANK                    02S0303 00969000
         BNE   @RF00303                                         02S0303 00970000
         TM    SCTSBYT3,SCTSMOD                                 02S0303 00971000
         BNO   @RF00303                                         02S0303 00972000
         CLC   JFCBDSNM(44),JFCBDSNM-INFMJFCB(R3)               02S0303 00973000
         BNE   @RT00303                                         02S0303 00974000
         TM    JFCDSORG,JFCORGIS                                02S0303 00975000
         BNO   @RF00303                                         02S0303 00976000
         CLC   JFCBELNM(8),JFCBELNM-INFMJFCB(R3)                02S0303 00977000
         BE    @RF00303                                         02S0303 00978000
@RT00303 DS    0H                                               02S0304 00979000
*               DO;                                             02S0304 00980000
*                 SCTSMOD=NO;       /* RESET DISP OF MOD     @ZA08546*/ 00981000
*                 SCTSNEW=YES;      /* DISP IS NOW NEW       @ZA08546*/ 00982000
         OI    SCTSBYT3,SCTSNEW                                 02S0306 00983000
         NI    SCTSBYT3,255-SCTSMOD                             02S0306 00984000
*                 JFCMODNW=YES;     /* MOD CHANGED TO NEW    @ZA08546*/ 00985000
         OI    JFCBFLG2,JFCMODNW                                02S0307 00986000
*                 JFCDISP='11'B;    /* DISP OF NEW IN JFCB   @ZA08546*/ 00987000
         OI    JFCBIND2,JFCDISP = JFCNEW                        02S0308 00988000
*               END;                /* END CHANGE MOD        @ZA08546*/ 00989000
*           END;                    /* END INTRA STEP VOL=REF.       */ 00990000
@RF00303 DS    0H                                               02S0311 00991000
*         IF SCTVOLAF=YES&RSIOTP->SIOTSSDS=YES THEN/* IF THIS IS A   */ 00992000
@RF00294 TM    SCTSBYT2,SCTVOLAF                                02S0311 00993000
         BNO   @RF00311                                         02S0311 00994000
         TM    SIOTBYT0-INDMSIOT(R8),SIOTSSDS                   02S0311 00995000
         BNO   @RF00311                                         02S0311 00996000
*           DO;                     /* VOL=REF TO A SUBSYSTEM DATA      00997000
*                                      SET                           */ 00998000
*             HWOVRDN=YES;          /* OVERRIDE RETRIEVED DEVICE TYPE*/ 00999000
         L     R10,@PC00001                                     02S0313 01000000
         L     R9,HWCNTRLP(,R10)                                02S0313 01001000
         OI    HWOVRDN(R9),B'00100000'                          02S0313 01002000
*             CALL IEFAB470         /* CALL IEFAB470                 */ 01003000
*                 (HWCNTRLP,HWDATAP,HWRTNP,HWIOSLTP,ALLDA);     02S0314 01004000
         ST    R10,@AL00001                                     02S0314 01005000
         L     R10,@PC00001+4                                   02S0314 01006000
         ST    R10,@AL00001+4                                   02S0314 01007000
         L     R9,@PC00001+8                                    02S0314 01008000
         ST    R9,@AL00001+8                                    02S0314 01009000
         L     R10,HWDATAP(,R10)                                02S0314 01010000
         LA    R10,HWIOSLTP(,R10)                               02S0314 01011000
         ST    R10,@AL00001+12                                  02S0314 01012000
         LA    R10,ALLDA                                        02S0314 01013000
         ST    R10,@AL00001+16                                  02S0314 01014000
         L     R15,IEFAB470                                     02S0314 01015000
         LA    R1,@AL00001                                      02S0314 01016000
         BALR  R14,R15                                          02S0314 01017000
*           END;                    /* WITH ESOTERIC FOR ALL DA 02S0315 01018000
*                                      DEVICES.                      */ 01019000
*       END;                        /* END DD REFERENCE.             */ 01020000
@RF00311 DS    0H                                               01S0317 01021000
*   IF HWRTCD=0 THEN                /* IF RETURN CODE = 0            */ 01022000
@RF00180 DS    0H                                               01S0317 01023000
@RC00119 L     R10,@PC00001+8                                   01S0317 01024000
         L     R10,HWRTNP(,R10)                                 01S0317 01025000
         LH    R10,HWRTCD(,R10)                                 01S0317 01026000
         LTR   R10,R10                                          01S0317 01027000
         BNZ   @RF00317                                         01S0317 01028000
*     DO;                                                       01S0318 01029000
*                                                               02S0319 01030000
*/********************************************************************/ 01031000
*/*                                                                  */ 01032000
*/* SEGMENT NAME - VIOCOMP                                           */ 01033000
*/*                                                                  */ 01034000
*/* DESCRIPTIVE NAME - VIRTUAL I/O SIOT COMPLETION.                  */ 01035000
*/*                                                                  */ 01036000
*/* FUNCTION - MARK THE REQUEST, IF IT IS NOT A DD DUMMY,            */ 01037000
*/*            VIO(VAM) FOR SUBSEQUENT DADSM.                        */ 01038000
*/*            A REQUEST IS MARKED VIO IF THE UNIT CODED IS VIO      */ 01039000
*/*            (VAM) ELIGIBLE, DISP=NEW, NON-SPECIFIC (NO            */ 01040000
*/*            VOLUME SERIALS CODED), NON-ISAM AND HAS A SYSTEM      */ 01041000
*/*            GENERATED NAME (&DSN OR NO DSNAME).                   */ 01042000
*/*            A REQUEST MAY ALSO BE VIO IF IT HAS A GENERATED       */ 01043000
*/*            DSNAME AND UNIT=AFF TO A VIO REQUEST                  */ 01044000
*/*            OR                                                    */ 01045000
*/*            HAS A STATUS OF NEW AND VOL=REF TO A VIO REQUEST      */ 01046000
*/*            OR                                                    */ 01047000
*/*            HAS A STATUS OF OLD AND VOL=REF TO A VIO REQUEST WITH */ 01048000
*/*            THE SAME DATA SET NAME                                */ 01049000
*/*            OR                                                    */ 01050000
*/*            IS A RECEIVED VIO DATA SET.                           */ 01051000
*/*            IF THIS REQUEST IS NOT VIO ELIGIBLE           @ZA05349*/ 01052000
*/*            AND HAS VOL=REF TO A VIO ELIGIBLE DD,         @ZA05349*/ 01053000
*/*            VOL=REF IS IGNORED (SIOTREFN=0).              @ZA05349*/ 01054000
*/*            IF THIS REQUEST IS NOT VIO ELIGIBLE AND       @ZA05349*/ 01055000
*/*            HAS UNIT AFFINITY TO A VIO ELIGIBLE DD,       @ZA05349*/ 01056000
*/*            UNIT AFFINITY IS IGNORED (SCTUNAFF IS         @ZA05349*/ 01057000
*/*            SET OFF AND SIOTUNAF=0).                      @ZA05349*/ 01058000
*/*                                                                  */ 01059000
*/* ENTRY - INCLUDED SEGMENT.                                        */ 01060000
*/*   PURPOSE - SEE FUNCTION.                                        */ 01061000
*/*                                                                  */ 01062000
*/*   INPUT DATA -                                                   */ 01063000
*/*           REFERENCED SIOT INDICATOR.                             */ 01064000
*/*           VIO BIT IN REFERENCED SIOT.                            */ 01065000
*/*           CURRENT AND REFERENCED DATA SET NAMES.                 */ 01066000
*/*           DATA SET STATUS.                                       */ 01067000
*/*                                                                  */ 01068000
*/* EXIT -                                                           */ 01069000
*/*   CONDITION - ALL.                                               */ 01070000
*/*                                                                  */ 01071000
*/*   OUPUT DATA -                                                   */ 01072000
*/*              VIO BIT IN CURRENT SIOT.                            */ 01073000
*/*              VOLUME AFFINITY BIT AND NUMBER IN CURRENT SIOT.     */ 01074000
*/*                                                                  */ 01075000
*/*   RETURN CODE - NONE                                             */ 01076000
*/********************************************************************/ 01077000
*                                                               02S0319 01078000
*       IF SIOTGDSN=YES             /* SYSTEM GENERATED DSNAME,      */ 01079000
*           &SCTDUMMY=NO            /* NOT DD DUMMY AND,     @YM08288*/ 01080000
*           &JFCORGIS=NO THEN       /* NOT ISAM. INITIAL VIO         */ 01081000
         TM    SCTSBYT1,SIOTGDSN                                02S0319 01082000
         BNO   @RF00319                                         02S0319 01083000
         TM    SCTSBYT1,SCTDUMMY                                02S0319 01084000
         BNZ   @RF00319                                         02S0319 01085000
         TM    JFCDSORG,JFCORGIS                                02S0319 01086000
         BNZ   @RF00319                                         02S0319 01087000
*         DO;                       /* REQUIREMENTS MET.             */ 01088000
*           IF HWRESIOT=YES THEN    /* IF THERE IS A REF. SIOT       */ 01089000
         L     R10,@PC00001                                     02S0321 01090000
         L     R10,HWCNTRLP(,R10)                               02S0321 01091000
         TM    HWRESIOT(R10),B'00001000'                        02S0321 01092000
         BNO   @RF00321                                         02S0321 01093000
*             DO;                   /* AND THE REF. REQUEST IS VIO,  */ 01094000
*               IF RSIOTP->SIOVAMDS=YES THEN/* MAKE THIS A VIO DATA     01095000
*                                      SET IF                        */ 01096000
         TM    SIOTBYT1-INDMSIOT(R8),SIOVAMDS                   02S0323 01097000
         BNO   @RF00323                                         02S0323 01098000
*                 IF SCTSNEW=NO THEN/* IT IS OLD/MOD AND EITHER      */ 01099000
         TM    SCTSBYT3,SCTSNEW                                 02S0324 01100000
         BNZ   @RF00324                                         02S0324 01101000
*                   DO;             /* VOL=REF TO A DD WITH THE      */ 01102000
*                     IF JFCBDSNM=RJFCBP->JFCBDSNM THEN/* SAME DATA     01103000
*                                      SET NAME OR                   */ 01104000
         CLC   JFCBDSNM(44),JFCBDSNM-INFMJFCB(R3)               02S0326 01105000
         BNE   @RF00326                                         02S0326 01106000
*                       SIOVAMDS=YES;/* A RECEIVED VIO DATA SET.     */ 01107000
         OI    SIOTBYT1,SIOVAMDS                                02S0327 01108000
*                     ELSE          /* OLD DSN WITH VOL=REF TO DIFF. */ 01109000
*                       SIOTREFN=0; /* DATA SET, TURN OFF VOL-AFF    */ 01110000
         B     @RC00326                                         02S0328 01111000
@RF00326 SLR   R10,R10                                          02S0328 01112000
         STH   R10,SIOTREFN                                     02S0328 01113000
*                   END;                                        02S0329 01114000
*                 ELSE              /* ITS A NEW DATA SET WITH       */ 01115000
*                   DO;             /* VOL=REF TO VIO, MAKE THIS VIO */ 01116000
         B     @RC00324                                         02S0330 01117000
@RF00324 DS    0H                                               02S0331 01118000
*                     SIOVAMDS=YES; /* MARK REQUEST VIO.             */ 01119000
         OI    SIOTBYT1,SIOVAMDS                                02S0331 01120000
*                     SIOTREFN=0;   /* DATA SETS ARE DIFF. SO VIO    */ 01121000
         SLR   R10,R10                                          02S0332 01122000
         STH   R10,SIOTREFN                                     02S0332 01123000
*                   END;            /* VOL-AFF NOT POSSIBLE.         */ 01124000
*             END;                                              02S0334 01125000
*           ELSE                    /* NO REFERENCED DD AND THE      */ 01126000
*             IF HWVAME=YES&        /* UNIT CONVERTED IS VIO    02S0335 01127000
*                                      ELIBIBLE,                     */ 01128000
*                 HWDSNCAT=NO       /* NO RETRIEVED SOURCE           */ 01129000
*                 &SCTVOLCT=0       /* NO VOLUMES SPECIFIED,         */ 01130000
*                 &SCTSNEW=YES THEN /* NEW DATA SET,                 */ 01131000
         B     @RC00321                                         02S0335 01132000
@RF00321 L     R10,@PC00001                                     02S0335 01133000
         L     R10,HWCNTRLP(,R10)                               02S0335 01134000
         TM    HWVAME(R10),B'01000000'                          02S0335 01135000
         BNO   @RF00335                                         02S0335 01136000
         TM    HWDSNCAT(R10),B'00000100'                        02S0335 01137000
         BNZ   @RF00335                                         02S0335 01138000
         CLI   SCTVOLCT,0                                       02S0335 01139000
         BNE   @RF00335                                         02S0335 01140000
         TM    SCTSBYT3,SCTSNEW                                 02S0335 01141000
         BNO   @RF00335                                         02S0335 01142000
*               SIOVAMDS=YES;       /* SO MARK REQUEST VIO.          */ 01143000
         OI    SIOTBYT1,SIOVAMDS                                02S0336 01144000
*           IF SIOVAMDS=YES THEN    /* DATA SET IS VIO.              */ 01145000
@RF00335 DS    0H                                               02S0337 01146000
@RC00321 TM    SIOTBYT1,SIOVAMDS                                02S0337 01147000
         BNO   @RF00337                                         02S0337 01148000
*             DO;                                               02S0338 01149000
*               JFCVRDS=YES;        /* TELL DATA MANAGEMENT ITS VIO. */ 01150000
         OI    JFCFLGS1,JFCVRDS                                 02S0339 01151000
*               SCTVOLCT=1;         /* UNALLOCATION REQUIRES 1 VOLUME*/ 01152000
         MVI   SCTVOLCT,X'01'                                   02S0340 01153000
*               JFCBNVOL=1;         /* FOR SCRATCH AND MESSAGES.     */ 01154000
         MVI   JFCBNVOL,X'01'                                   02S0341 01155000
*             END;                                              02S0342 01156000
*         END;                                                  02S0343 01157000
@RF00337 DS    0H                                               02S0344 01158000
*       IF(SIOTGDSN=NO              /* NOT GEN'D DSN OR      @ZA05349*/ 01159000
*           ³JFCORGIS=YES)          /* ISAM AND              @ZA05349*/ 01160000
*           &HWRESIOT=YES           /* THERE IS REF. SIOT    @ZA05349*/ 01161000
*           &RSIOTP->SIOVAMDS=YES THEN/* AND IT IS VIO, THEN @ZA05349*/ 01162000
@RF00319 TM    SCTSBYT1,SIOTGDSN                                02S0344 01163000
         BZ    @GL00033                                         02S0344 01164000
         TM    JFCDSORG,JFCORGIS                                02S0344 01165000
         BNO   @RF00344                                         02S0344 01166000
@GL00033 L     R10,@PC00001                                     02S0344 01167000
         L     R10,HWCNTRLP(,R10)                               02S0344 01168000
         TM    HWRESIOT(R10),B'00001000'                        02S0344 01169000
         BNO   @RF00344                                         02S0344 01170000
         TM    SIOTBYT1-INDMSIOT(R8),SIOVAMDS                   02S0344 01171000
         BNO   @RF00344                                         02S0344 01172000
*         SIOTREFN=0;               /* IGNORE VOL REF        @ZA05349*/ 01173000
         SLR   R10,R10                                          02S0345 01174000
         STH   R10,SIOTREFN                                     02S0345 01175000
*       IF SCTUNAFF=YES&HWVAME=YES  /* THIS IS UNIT=AFF TO A VIO        01176000
*                                      REQUEST                       */ 01177000
*           &SIOVAMDS=NO THEN       /* BUT THIS IS NOT A VIO DATASET */ 01178000
@RF00344 TM    SCTSBYT1,SCTUNAFF                                02S0346 01179000
         BNO   @RF00346                                         02S0346 01180000
         L     R10,@PC00001                                     02S0346 01181000
         L     R10,HWCNTRLP(,R10)                               02S0346 01182000
         TM    HWVAME(R10),B'01000000'                          02S0346 01183000
         BNO   @RF00346                                         02S0346 01184000
         TM    SIOTBYT1,SIOVAMDS                                02S0346 01185000
         BNZ   @RF00346                                         02S0346 01186000
*         DO;                       /* SO TURN OFF UNIT=AFF.         */ 01187000
*           SCTUNAFF=NO;            /* TURN OFF AFF INDICATOR.       */ 01188000
         NI    SCTSBYT1,255-SCTUNAFF                            02S0348 01189000
*           SIOTUNAF=0;             /* ZERO DD NUMBER THAT THIS DD      01190000
*                                      HAD                           */ 01191000
         SLR   R10,R10                                          02S0349 01192000
         STH   R10,SIOTUNAF                                     02S0349 01193000
*         END;                      /* AFFINITY TO.                  */ 01194000
*       HWVAME=NO;                  /* NEXT DD DOESN'T LOOK VIO 02S0351 01195000
*                                      ELIGIBLE.                     */ 01196000
@RF00346 L     R10,@PC00001                                     02S0351 01197000
         L     R10,HWCNTRLP(,R10)                               02S0351 01198000
         NI    HWVAME(R10),B'10111111'                          02S0351 01199000
*                                                               02S0352 01200000
*/********************************************************************/ 01201000
*/*                                                                  */ 01202000
*/* SEGMENT NAME - UNOVERID                                          */ 01203000
*/*                                                                  */ 01204000
*/* DESCRIPTIVE NAME - UNIT OVERRIDE DETERMINATION.                  */ 01205000
*/*                                                                  */ 01206000
*/*            UPDATE HSKPWA CONTROL INDICATOR IF UNIT IS OVERRIDDEN.*/ 01207000
*/*              UNIT OVERRIDE IS THAT SITUATION WHERE NO EXPLICIT   */ 01208000
*/*              VOLUME INFORMATION IS CODED AND THE UNIT CODED IS A */ 01209000
*/*              SUBSET OF THE UNIT INFORMATION RETRIEVED FROM THE   */ 01210000
*/*              PDI,INTER-STEP VOL=REF OR CATALOG.                  */ 01211000
*/*                                                                  */ 01212000
*/* ENTRY - UNOVERID                                                 */ 01213000
*/*   PURPOSE - SEE FUNCTION.                                        */ 01214000
*/*                                                                  */ 01215000
*/*   INPUT DATA - POINTERS TO THE FOLLOWING                         */ 01216000
*/*                  HSKPWA CONTROLS                                 */ 01217000
*/*                  CRI                                             */ 01218000
*/*                  REFERENCED SIOT                                 */ 01219000
*/*                                                                  */ 01220000
*/* EXITS -  TO CALLER                                               */ 01221000
*/*   CONDITIONS - UNDER ALL CONDITIONS                              */ 01222000
*/*                                                                  */ 01223000
*/*   OUTPUT DATA - HSKPWA CONTROLS UPDATED                          */ 01224000
*/*                                                                  */ 01225000
*/*   RETURN CODES - NONE                                            */ 01226000
*/*                                                                  */ 01227000
*/********************************************************************/ 01228000
*                                                               02S0352 01229000
*       IF HWOVCAND=YES&HWRTCD=0 THEN/* UNIT CODED IS OVERRIDE SEE   */ 01230000
         TM    HWOVCAND(R10),B'00000010'                        02S0352 01231000
         BNO   @RF00352                                         02S0352 01232000
         L     R9,@PC00001+8                                    02S0352 01233000
         L     R9,HWRTNP(,R9)                                   02S0352 01234000
         LH    R9,HWRTCD(,R9)                                   02S0352 01235000
         LTR   R9,R9                                            02S0352 01236000
         BNZ   @RF00352                                         02S0352 01237000
*         DO;                       /* IF ANYTHING TO OVERRIDE.      */ 01238000
*           HWOVCAND=NO;            /* TURN OFF OVERRIDE INDICATOR   */ 01239000
         NI    HWOVCAND(R10),B'11111101'                        02S0354 01240000
*           IF SIOTVAFF=NO          /* CAN'T BE INTRA-STEP VOLREF    */ 01241000
*               &(HWDSNCAT=YES³HWRESIOT=YES³HWVUREC=YES) THEN/* BUT     01242000
*                                      NEED A RETRIEVED              */ 01243000
         TM    SCTSBYT4,SIOTVAFF                                02S0355 01244000
         BNZ   @RF00355                                         02S0355 01245000
         TM    HWDSNCAT(R10),B'01001100'                        02S0355 01246000
         BZ    @RF00355                                         02S0355 01247000
*             DO;                   /* SOURCE FOR UNIT OVERRIDE.     */ 01248000
*               RFY                                             02S0357 01249000
*                 INDMSIOT BASED(RSIOTP);/* BASE REFERENCED SIOT.    */ 01250000
*               DEVPTR=ADDR(HWDEVTYP);/* POINTER TO CODED DEVICE        01251000
*                                      TYPE.                         */ 01252000
         L     R9,@PC00001+4                                    02S0358 01253000
         L     R9,HWDATAP(,R9)                                  02S0358 01254000
         L     R2,HWUCLPTR(,R9)                                 02S0358 01255000
         LA    R2,HWDEVTYP(,R2)                                 02S0358 01256000
*               IF HWRESIOT=YES     /* IF SOURCE IS REF. SIOT,IT     */ 01257000
*                   &SIOVAMDS=NO&SCTDUMMY=NO/* CAN'T BE A VIO,DUMMY     01258000
*                                      OR                            */ 01259000
*                   &SIOTSSDS=NO    /* SUBSYSTEM DATA SET-OR-        */ 01260000
*                   ³(HWDSNCAT=YES³HWVUREC=YES) THEN/* SOURCE CAN BE    01261000
*                                      CRI,                          */ 01262000
         TM    HWRESIOT(R10),B'00001000'                        02S0359 01263000
         BNO   @GL00039                                         02S0359 01264000
         TM    SIOTBYT1-INDMSIOT(R8),SIOVAMDS                   02S0359 01265000
         BNZ   @GL00039                                         02S0359 01266000
         TM    SCTSBYT1-INDMSIOT(R8),SCTDUMMY                   02S0359 01267000
         BNZ   @GL00039                                         02S0359 01268000
         TM    SIOTBYT0-INDMSIOT(R8),SIOTSSDS                   02S0359 01269000
         BZ    @RT00359                                         02S0359 01270000
@GL00039 L     R10,@PC00001                                     02S0359 01271000
         L     R10,HWCNTRLP(,R10)                               02S0359 01272000
         TM    HWDSNCAT(R10),B'01000100'                        02S0359 01273000
         BZ    @RF00359                                         02S0359 01274000
@RT00359 DS    0H                                               02S0360 01275000
*                 IF HWTAPE=YES THEN/* FOR OVERRIDE REQUIREMENTS.    */ 01276000
         LA    R10,DEVTYPE                                      02S0360 01277000
         TM    HWCTBYT(R10),HWTAPE                              02S0360 01278000
         BNO   @RF00360                                         02S0360 01279000
*                   DO;             /* IF TAPE CHECK ENTIRE DEVTYPE. */ 01280000
*                     IF HWDEVTYP=DEVTYPE THEN/* DEVICE TYPES ARE    */ 01281000
         L     R10,@PC00001+4                                   02S0362 01282000
         L     R10,HWDATAP(,R10)                                02S0362 01283000
         L     R10,HWUCLPTR(,R10)                               02S0362 01284000
         CLC   HWDEVTYP(4,R10),DEVTYPE                          02S0362 01285000
         BNE   @RF00362                                         02S0362 01286000
*                       HWOVRDN=YES;/* THE SAME SO OVERRIDE.         */ 01287000
         L     R10,@PC00001                                     02S0363 01288000
         L     R10,HWCNTRLP(,R10)                               02S0363 01289000
         OI    HWOVRDN(R10),B'00100000'                         02S0363 01290000
*                     ELSE          /* NOT THE SAME,IS THE DEVICE    */ 01291000
*                       DO;         /* A GENERIC SUBSET OF RETRIEVED.*/ 01292000
         B     @RC00362                                         02S0364 01293000
@RF00362 DS    0H                                               02S0365 01294000
*                         EDTPTR=ADDR(EDTTAB);/* GET EDT POINTER.    */ 01295000
         L     R10,CVTPTR(,0)                                   UZ50553 01296001
         L     R10,CVTJESCT-CVT(,R10)                           UZ50553 01296101
         L     R3,JESEDT-JESCT(,R10)                            UZ50553 01296201
*                         SCANEND=NO;/* SCAN EDT FOR RETRIEVED  02S0366 01297000
*                                      LUVALUE                       */ 01298000
         NI    SCANEND,B'01111111'                              02S0366 01299000
*                         LUVPTR=EDTLUVSP+LENGTH(LUVHDR);/* BEGINNING   01300000
*                                      OF LOOK-UP-ENTRIES.           */ 01301000
         LA    R2,8                                             02S0367 01302000
         AL    R2,EDTLUVSP(,R3)                                 02S0367 01303000
*                         DO LUVCTR=1 TO LUVENTNO WHILE(SCANEND=NO);    01304000
         LA    R9,1                                             02S0368 01305000
         B     @DE00368                                         02S0368 01306000
@DL00368 TM    SCANEND,B'10000000'                              02S0368 01307000
         BNZ   @DC00368                                         02S0368 01308000
*                                   /* SCAN EDT FOR RETRIEVED        */ 01309000
*                           IF DEVTYPE=LUVALUE THEN/* LOOK-UP-VALUE.    01310000
*                                      FOUND,SEARCH                  */ 01311000
         CLC   DEVTYPE(4),LUVALUE(R2)                           02S0369 01312000
         BNE   @RF00369                                         02S0369 01313000
*                             DO;   /* LUV'S GENERIC'S FOR ONE THAT     01314000
*                                      MATCHES DEVTYPE CODED.        */ 01315000
*                               SCANEND=YES;/* LUV FOUND, EDT SCAN      01316000
*                                      ENDED.                        */ 01317000
         OI    SCANEND,B'10000000'                              02S0371 01318000
*                               GENPTR=LUVGENP;/* PTR TO 1ST GENERIC.*/ 01319000
         L     R4,LUVGENP(,R2)                                  02S0372 01320000
*                               DO GENCTR=1 TO LUVGENNO WHILE(HWOVRDN=  01321000
*                                     NO);                      02S0373 01322000
         LA    R5,1                                             02S0373 01323000
         B     @DE00373                                         02S0373 01324000
@DL00373 L     R10,@PC00001                                     02S0373 01325000
         L     R10,HWCNTRLP(,R10)                               02S0373 01326000
         TM    HWOVRDN(R10),B'00100000'                         02S0373 01327000
         BNZ   @DC00373                                         02S0373 01328000
*                                 IF GENDEVT=HWDEVTYP THEN/* IF THE     01329000
*                                      GENERIC IS THE SAME AS        */ 01330000
         L     R15,@PC00001+4                                   02S0374 01331000
         L     R1,HWDATAP(,R15)                                 02S0374 01332000
         L     R1,HWUCLPTR(,R1)                                 02S0374 01333000
         CLC   GENDEVT(4,R4),HWDEVTYP(R1)                       02S0374 01334000
         BNE   @RF00374                                         02S0374 01335000
*                                   HWOVRDN=YES;/* THE ONE CODED THEN   01336000
*                                      OVERRIDE.                     */ 01337000
         OI    HWOVRDN(R10),B'00100000'                         02S0375 01338000
*                                 ELSE/* GENERICS DON'T MATCH.       */ 01339000
*                                   GENPTR=GENPTR+GENENTLN;/* GET       01340000
*                                      PTR. TO NEXT GENERIC ENTRY    */ 01341000
         B     @RC00374                                         02S0376 01342000
@RF00374 L     R10,EDTGENSP(,R3)                                02S0376 01343000
         AL    R4,GENENTLN(,R10)                                02S0376 01344000
*                               END;                            02S0377 01345000
@RC00374 AL    R5,FW1                                           02S0377 01346000
@DE00373 C     R5,LUVGENNO(,R2)                                 02S0377 01347000
         BNH   @DL00373                                         02S0377 01348000
@DC00373 DS    0H                                               02S0378 01349000
*                             END;                              02S0378 01350000
*                           LUVPTR=LUVPTR+LUVENTLN;/* GET NEXT  02S0379 01351000
*                                      LOOK-UP-SECTION.              */ 01352000
@RF00369 L     R10,EDTLUVSP(,R3)                                02S0379 01353000
         AL    R2,LUVENTLN(,R10)                                02S0379 01354000
*                         END;                                  02S0380 01355000
         AL    R9,FW1                                           02S0380 01356000
@DE00368 L     R10,EDTLUVSP(,R3)                                02S0380 01357000
         C     R9,LUVENTNO(,R10)                                02S0380 01358000
         BNH   @DL00368                                         02S0380 01359000
@DC00368 DS    0H                                               02S0381 01360000
*                       END;                                    02S0381 01361000
*                   END;                                        02S0382 01362000
*                 ELSE              /* NON TAPE.                     */ 01363000
*                   IF HWCTBYT=DEVPTR->HWCTBYT THEN/* NON-TAPE,CLASS */ 01364000
         B     @RC00360                                         02S0383 01365000
@RF00360 LA    R10,DEVTYPE                                      02S0383 01366000
         CLC   HWCTBYT(2,R10),HWCTBYT(R2)                       02S0383 01367000
         BNE   @RF00383                                         02S0383 01368000
*                     HWOVRDN=YES;  /* AND TYPE DETERMINE OVERRIDE.  */ 01369000
         L     R10,@PC00001                                     02S0384 01370000
         L     R10,HWCNTRLP(,R10)                               02S0384 01371000
         OI    HWOVRDN(R10),B'00100000'                         02S0384 01372000
*             END;                                              02S0385 01373000
@RF00383 DS    0H                                               02S0385 01374000
@RC00360 DS    0H                                               02S0385 01375000
@RF00359 DS    0H                                               02S0386 01376000
*         END;                                                  02S0386 01377000
@RF00355 DS    0H                                               02S0387 01378000
*       RFY                                                     02S0387 01379000
*         INDMSIOT BASED(CSIOTP);   /* BASE CURRENT SIOT.            */ 01380000
@RF00352 DS    0H                                               02S0388 01381000
*                                                               02S0388 01382000
*/********************************************************************/ 01383000
*/*                                                                  */ 01384000
*/* SEGMENT NAME - NOREFCMP                                          */ 01385000
*/*                                                                  */ 01386000
*/* DESCRIPTIVE NAME - NON-REFERENCE VOLUME/UNIT  COMPLETION         */ 01387000
*/*                                                                  */ 01388000
*/* FUNCTION - COMPLETE THE DD'S UNIT PARAMETER BY COPYING THE       */ 01389000
*/*            DEVICE TYPE INTO THE CURRENT SIOT USING EITHER THE    */ 01390000
*/*            DEVICE TYPE RETRIEVED FROM THE CRI OR REFERENCED DD   */ 01391000
*/*            OR                                                    */ 01392000
*/*            THE UNIT CONVERSION LIST IF THERE IS NO               */ 01393000
*/*            REFERENCED SOURCE OR THE REFERENCED SOURCE HAS        */ 01394000
*/*            BEEN OVERRIDDEN.                                      */ 01395000
*/*                                                                  */ 01396000
*/*            IF MSS SELECTED VOLUME SERIALS FOR THIS       @G24LPSJ*/ 01397000
*/*            REQUEST, THEY ARE INSERTED IN THE JFCB        @G24LPSJ*/ 01398000
*/*            AND/OR JFCBX.                                 @G24LPSJ*/ 01399000
*/*                                                                  */ 01400000
*/* ENTRY -                                                          */ 01401000
*/*   PURPOSE - MOVE UNIT INFO TO DD LIST,                           */ 01402000
*/*             COPY MSS VOLUME SERIALS IF SPECIFIED AND     @G24LPSJ*/ 01403000
*/*             INSURE UNIT HAS BEEN PROPERLY INITIALIZED.           */ 01404000
*/*                                                                  */ 01405000
*/*   INPUT DATA - CURRENT SIOT,RETRIEVED DEVICE TYPE AND UNIT       */ 01406000
*/*                CONVERSION LIST.                                  */ 01407000
*/*                                                                  */ 01408000
*/* EXITS -                                                          */ 01409000
*/*   CONDITION-AFTER COPYING UNIT INFO                              */ 01410000
*/*                                                                  */ 01411000
*/*   OUTPUT DATA- UPDATED SIOT                                      */ 01412000
*/*                                                                  */ 01413000
*/*   RETURN CODE -0-NORMAL, 4-UNIT INCORRECTLY SPECIFIED.           */ 01414000
*/*                8-REASON CODE FOR INVALID UNIT SPECIFACATION.     */ 01415000
*/*                                                                  */ 01416000
*/********************************************************************/ 01417000
*                                                               02S0388 01418000
*       IF(HWRESIOT=YES³HWDSNCAT=YES/* IF VOLUME SERIALS WERE        */ 01419000
*           ³HWVUREC=YES)           /* OBTAINED FROM CATALOG OR 02S0388 01420000
*                                      PREVIOUS                      */ 01421000
*           &HWOVRDN=NO THEN        /* SIOT THEN GET DEVTYPE FROM       01422000
*                                      SAME.                         */ 01423000
         L     R10,@PC00001                                     02S0388 01424000
         L     R10,HWCNTRLP(,R10)                               02S0388 01425000
         TM    HWRESIOT(R10),B'01001100'                        02S0388 01426000
         BZ    @RF00388                                         02S0388 01427000
         TM    HWOVRDN(R10),B'00100000'                         02S0388 01428000
         BNZ   @RF00388                                         02S0388 01429000
*         DO;                                                   02S0389 01430000
*           IF HWRESIOT=YES&SIOTVAFF=NO/* REFERENCED SIOT FROM       */ 01431000
*               &SIOVAMDS=NO THEN   /* PREVIOUS STEP AND NOT VIO,    */ 01432000
         TM    HWRESIOT(R10),B'00001000'                        02S0390 01433000
         BNO   @RF00390                                         02S0390 01434000
         TM    SCTSBYT4,SIOTVAFF                                02S0390 01435000
         BNZ   @RF00390                                         02S0390 01436000
         TM    SIOTBYT1,SIOVAMDS                                02S0390 01437000
         BNZ   @RF00390                                         02S0390 01438000
*             ZEROUCB=0;            /* RESET THE UCB PTR (RTVDUNIT)  */ 01439000
         SLR   R10,R10                                          02S0391 01440000
         ST    R10,ZEROUCB                                      02S0391 01441000
*           SCTUTYPE=RTVDUNIT;      /* DEVTYP FROM CRI OR RETRIEVED     01442000
*                                      DD.                           */ 01443000
@RF00390 MVC   SCTUTYPE(8),RTVDUNIT                             02S0392 01444000
*           HWAVSRCH=NO;            /* TURN OFF SEARCH DONE  @G24LPSJ*/ 01445000
         L     R10,@PC00001                                     02S0393 01446000
         L     R10,HWCNTRLP(,R10)                               02S0393 01447000
         NI    HWAVSRCH(R10),B'10111111'                        02S0393 01448000
*           HWAVUNIT=NO;            /* INDICATE NO VIRT UNIT @G24LPSJ*/ 01449000
         NI    HWAVUNIT(R10),B'11111110'                        02S0394 01450000
*         END;                                                  02S0395 01451000
*       ELSE                        /* UNIT NOT COMPLETED VIA   02S0396 01452000
*                                      REFERENCE                     */ 01453000
*         IF HWOVRDN=YES³           /* IF DEVTYPE WAS OVERRIDDEN OR     01454000
*                                      NO                            */ 01455000
*             (HWDSNCAT=NO&HWRESIOT=NO&HWVUREC=NO)/* REFERENCE SOURCE*/ 01456000
*             &(HWEDT=YES³HWUCB=YES) THEN/* AND UNIT PARM. CONVERTED */ 01457000
         B     @RC00388                                         02S0396 01458000
@RF00388 L     R10,@PC00001                                     02S0396 01459000
         L     R10,HWCNTRLP(,R10)                               02S0396 01460000
         TM    HWOVRDN(R10),B'00100000'                         02S0396 01461000
         BO    @RT00396                                         02S0396 01462000
         TM    HWDSNCAT(R10),B'01001100'                        02S0396 01463000
         BNZ   @RF00396                                         02S0396 01464000
         TM    HWEDT(R10),B'10000000'                           02S0396 01465000
         BO    @RT00396                                         02S0396 01466000
         TM    HWUCB(R10),B'00000001'                           02S0396 01467000
         BNO   @RF00396                                         02S0396 01468000
@RT00396 DS    0H                                               02S0397 01469000
*           DO;                     /* THEN USE EDT OR UCB DEVTYPE.  */ 01470000
*             SCTUTYPE=SCTUTYPE&&SCTUTYPE;/* 0 PARTS NOT FILLED IN.  */ 01471000
         XC    SCTUTYPE(8),SCTUTYPE                             02S0398 01472000
*             IF HWEDT=YES THEN     /* USE THE LOOK-UP-VALUE FOR        01473000
*                                      UNITS                         */ 01474000
         L     R10,@PC00001                                     02S0399 01475000
         L     R10,HWCNTRLP(,R10)                               02S0399 01476000
         TM    HWEDT(R10),B'10000000'                           02S0399 01477000
         BNO   @RF00399                                         02S0399 01478000
*               SIOTDEVT=HWEDTLUV;  /* CONVERTED FROM THE EDT.       */ 01479000
         L     R10,@PC00001+4                                   02S0400 01480000
         L     R10,HWDATAP(,R10)                                02S0400 01481000
         L     R10,HWUCLPTR(,R10)                               02S0400 01482000
         L     R10,HWEDTLUV(,R10)                               02S0400 01483000
         ST    R10,SIOTDEVT                                     02S0400 01484000
*             ELSE                  /* OTHERWISE USE THE DEVICE TYPE */ 01485000
*               DO;                 /* FROM A UCB AND PTR TO THAT       01486000
*                                      UCB.                          */ 01487000
         B     @RC00399                                         02S0401 01488000
@RF00399 DS    0H                                               02S0402 01489000
*                 SIOTDEVT=HWDEVTYP;/* DEVICE TYPE FROM UCB.         */ 01490000
         L     R10,@PC00001+4                                   02S0402 01491000
         L     R10,HWDATAP(,R10)                                02S0402 01492000
         L     R10,HWUCLPTR(,R10)                               02S0402 01493000
         MVC   SIOTDEVT(4),HWDEVTYP(R10)                        02S0402 01494000
*                 SIOUCBAD=HWUCBP;  /* PTR TO UCB USED FOR CONVERSION*/ 01495000
         MVC   SIOUCBAD(3),HWUCBP(R10)                          02S0403 01496000
*                 SIOTDMND=YES;     /* DEMAND REQUEST. UNIT=SPECIFIC    01497000
*                                      DEVICE ADDRESS OR UNIT=AFF TO    01498000
*                                      A DEMAND REQUEST.             */ 01499000
         OI    SIOTBYT2,SIOTDMND                                02S0404 01500000
*               END;                                            02S0405 01501000
*             IF HWVLSELF=YES THEN  /* IF MSS SELECTED       @G24LPSJ*/ 01502000
@RC00399 L     R10,@PC00001                                     02S0406 01503000
         L     R10,HWCNTRLP(,R10)                               02S0406 01504000
         TM    HWVLSELF(R10),B'10000000'                        02S0406 01505000
         BNO   @RF00406                                         02S0406 01506000
*               DO;                 /* VOLUMES THEN DO       @G24LPSJ*/ 01507000
*                 JFCMSVGP=BLANKS;  /* CLEAR MSVG NAME FIELD @G24LPSJ*/ 01508000
         MVC   JFCMSVGP(8),BLANKS                               02S0408 01509000
*                 JVOLPTR=ADDR(JFCBVOLS)-VOLSERLN;/* SET POINTER TO     01510000
*                                      VOL SER SLOT          @G24LPSJ*/ 01511000
         LA    R4,JFCBVOLS                                      02S0409 01512000
         SL    R4,FW6                                           02S0409 01513000
*                 JFCBNVOL=HWVLSLCT;/* INSERT VOL SER CNT    @G24LPSJ*/ 01514000
         L     R10,@PC00001+4                                   02S0410 01515000
         L     R10,HWDATAP(,R10)                                02S0410 01516000
         L     R10,HWVLSELP(,R10)                               02S0410 01517000
         LH    R10,HWVLSLCT(,R10)                               02S0410 01518000
         STC   R10,JFCBNVOL                                     02S0410 01519000
*                 DO VOLCOPY=1 TO HWVLSLCT;/* COPY VOLUMES SELECTED     01520000
*                                      BY MSS                @G24LPSJ*/ 01521000
         LA    R2,1                                             02S0411 01522000
         B     @DE00411                                         02S0411 01523000
@DL00411 DS    0H                                               02S0412 01524000
*                   CALL JFCBXGEN;  /* GET NEXT VOL SER SLOT @G24LPSJ*/ 01525000
         BAL   R14,JFCBXGEN                                     02S0412 01526000
*                   SCTVOLCT=SCTVOLCT+1;/* INCREMENT COUNT   @G24LPSJ*/ 01527000
         LA    R10,1                                            02S0413 01528000
         SLR   R9,R9                                            02S0413 01529000
         IC    R9,SCTVOLCT                                      02S0413 01530000
         ALR   R10,R9                                           02S0413 01531000
         STC   R10,SCTVOLCT                                     02S0413 01532000
*                   VSER=HWVLSERS(VOLCOPY);/* COPY VOL SER   @G24LPSJ*/ 01533000
         LR    R10,R2                                           02S0414 01534000
         MH    R10,HW6                                          02S0414 01535000
         L     R9,@PC00001+4                                    02S0414 01536000
         L     R9,HWDATAP(,R9)                                  02S0414 01537000
         L     R9,HWVLSELP(,R9)                                 02S0414 01538000
         ALR   R9,R10                                           02S0414 01539000
         BCTR  R9,0                                             02S0414 01540000
         BCTR  R9,0                                             02S0414 01541000
         MVC   VSER(6,R4),HWVLSERS-4(R9)                        02S0414 01542000
*                 END;              /*                       @G24LPSJ*/ 01543000
         AL    R2,FW1                                           02S0415 01544000
@DE00411 L     R10,@PC00001+4                                   02S0415 01545000
         L     R10,HWDATAP(,R10)                                02S0415 01546000
         L     R10,HWVLSELP(,R10)                               02S0415 01547000
         CH    R2,HWVLSLCT(,R10)                                02S0415 01548000
         BNH   @DL00411                                         02S0415 01549000
*               END;                /*                       @G24LPSJ*/ 01550000
*           END;                                                02S0417 01551000
@RF00406 DS    0H                                               02S0418 01552000
*       IF SIOTDMND=YES THEN        /* IF UCB TYPE IN SIOT   @ZA12414*/ 01553000
@RF00396 DS    0H                                               02S0418 01554000
@RC00388 TM    SIOTBYT2,SIOTDMND                                02S0418 01555000
         BNO   @RF00418                                         02S0418 01556000
*         DO;                       /* THEN                  @ZA12414*/ 01557000
*           DEVTPTR=ADDR(SIOTDEVT); /* SET PTR TO SIOT DEVTYPE  02S0420 01558000
*                                                            @ZA12414*/ 01559000
         LA    R2,SIOTDEVT                                      02S0420 01560000
*           CALL DEVTPROC;          /* TURN OFF DEVTYPE BITS @ZA12414*/ 01561000
         BAL   R14,DEVTPROC                                     02S0421 01562000
*         END;                      /*                       @ZA12414*/ 01563000
*       IF HWRESIOT=YES&SIOTREFN=0 THEN/* INTRA-STEP VOL=REF TURNED     01564000
*                                      OFF,                          */ 01565000
@RF00418 L     R10,@PC00001                                     02S0423 01566000
         L     R10,HWCNTRLP(,R10)                               02S0423 01567000
         TM    HWRESIOT(R10),B'00001000'                        02S0423 01568000
         BNO   @RF00423                                         02S0423 01569000
         LH    R10,SIOTREFN                                     02S0423 01570000
         LTR   R10,R10                                          02S0423 01571000
         BNZ   @RF00423                                         02S0423 01572000
*         SIOTVAFF=NO;              /* SO TURN OFF VOL-AFF IND.      */ 01573000
         NI    SCTSBYT4,255-SIOTVAFF                            02S0424 01574000
*                                                               03S0425 01575000
*/********************************************************************/ 01576000
*/*                                                                  */ 01577000
*/* SEGMENT NAME - CATDEVT                                           */ 01578000
*/*                                                                  */ 01579000
*/* DESCRIPTIVE NAME - CATALOG DEVICE TYPE FOR RE-CATALOG.           */ 01580000
*/*                                                                  */ 01581000
*/* FUNCTION - GENERATE/UPDATE THE JFCBX WITH THE DEVICE TYPE        */ 01582000
*/*            RETRIEVED FROM THE CATALOG. THIS WILL ENABLE          */ 01583000
*/*            RE-CATALOG (IN UNALLOCATION) WITH THE ORIGINAL DEVICE */ 01584000
*/*            TYPE, THEREFORE ALLOWING ESOTERICS TO REMAIN IN THE   */ 01585000
*/*            CATALOG.                                              */ 01586000
*/*   OPERATION- 1.CHECK DD TO SEE IF DEVICE TYPE IN SIOT IS FROM    */ 01587000
*/*                THE CATALOG.                                      */ 01588000
*/*                    NOTE:THE DEVICE TYPE MAY HAVE BEEN COPIED     */ 01589000
*/*                         FROM A DD THAT HAD A DISP OF PASS AND    */ 01590000
*/*                         ITSELF OBTAINED THE DEVICE TYPE FROM THE */ 01591000
*/*                         CATALOG. IN THIS CASE THE DEVICE TYPE    */ 01592000
*/*                         MUST BE OBTAINED FROM THE JFCB EXTENSION.*/ 01593000
*/*                    NOTE:IF JFCCAT IS ON BUT NEITHER      @ZA00897*/ 01594000
*/*                         HWRESIOT NOR HWDSNCAT NOR HWVUREC@ZA00897*/ 01595000
*/*                         IS ON, THE DATA SET WAS NOT FOUND@ZA00897*/ 01596000
*/*                         IN THE CATALOG BY HOUSEKEEPING,  @ZA00897*/ 01597000
*/*                         SO DOESN'T NEED A JFCBX.         @ZA00897*/ 01598000
*/*                                                                  */ 01599000
*/*              2.CREATE A JFCB EXTENSION IF NONE EXIST.            */ 01600000
*/*                                                                  */ 01601000
*/*              3.PUT DEVICE TYPE IN JFCBX IF THIS IS NOT A RESTART.*/ 01602000
*/*                    NOTE-IF NO HSKWA FUNCTION BITS ARE ON         */ 01603000
*/*                         INDICATING FOUND IN CATALOG, PDI OR      */ 01604000
*/*                         VOL/UNIT RECURSION THEN THIS IS A        */ 01605000
*/*                         RESTART AND THE JFCBX ALREADY CONTAINS   */ 01606000
*/*                         THE DEVICE TYPE.                         */ 01607000
*/*                                                                  */ 01608000
*/* ENTRY - FROM NON REFERNECE COMPETION.                            */ 01609000
*/*                                                                  */ 01610000
*/*   PURPOSE - PROVIDE DEVICE TYPE FOR RE-CATALOGING OF A DATA      */ 01611000
*/*             SET WITH THE ORIGINAL DEVICE TYPE RETRIEVED FROM     */ 01612000
*/*             THE CATALOG.                                         */ 01613000
*/*   INPUT DATA - CATALOGED DATA SET INDICATOR                      */ 01614000
*/*                JFCBX PTR IN SIOT                                 */ 01615000
*/*                DEVTYPE IN SIOT                                   */ 01616000
*/*                DEVTYPE IN REFERENCED JFCBX                       */ 01617000
*/*                                                                  */ 01618000
*/* EXIT -                                                           */ 01619000
*/*   OUTPUT DATA - JFCBX GENERATED/UPDATED WITH DEVICE TYPE FROM    */ 01620000
*/*                 CATALOG.                                         */ 01621000
*/*                 INDICATOR FOR PRESENTS OF THAT DEVICE TYPE.      */ 01622000
*/*                                                                  */ 01623000
*/********************************************************************/ 01624000
*                                                               03S0425 01625000
*       IF JFCCAT=YES&              /* DSN FOUND IN CATLG    @ZA00897*/ 01626000
*           (HWRESIOT=YES³          /* DATA SET RECEIVED - THIS STEP    01627000
*                                                            @ZA00897*/ 01628000
*           HWDSNCAT=YES³           /* FOUND IN CATLG THIS STEP 03S0425 01629000
*                                                            @ZA00897*/ 01630000
*           HWVUREC=YES) THEN       /* VOL/UNIT RECURSION    @ZA00897*/ 01631000
@RF00423 TM    JFCBTSDM,JFCCAT                                  03S0425 01632000
         BNO   @RF00425                                         03S0425 01633000
         L     R10,@PC00001                                     03S0425 01634000
         L     R10,HWCNTRLP(,R10)                               03S0425 01635000
         TM    HWRESIOT(R10),B'01001100'                        03S0425 01636000
         BZ    @RF00425                                         03S0425 01637000
         CLI   JFCBVOLS+6,C'*'         INDIRECTLY CATALOGED?       @41A 01637100
         BNE   DIRCTCAT                NO                          @41A 01637200
         NI    JFCBTSDM,255-JFCCAT     YES, RESET CATALOGED FLAG   @41A 01637300
         MVI   JFCBVOLS+6,C' '         CLEAR TEMPORARY FLAG        @41A 01637400
         B     @RF00425                NO NEED TO SAVE DEVTYPE     @41A 01637500
DIRCTCAT EQU   *                       SAVE DEVTYPE IN JFCBX       @41A 01637600
*         DO;                       /* CREATE, FILL IN JFCBX         */ 01638000
*           IF SIOTJFX=0 THEN       /* CREATE A JFCB                 */ 01639000
         SLR   R10,R10                                          03S0427 01640000
         C     R10,SIOTJFX                                      03S0427 01641000
         BNE   @RF00427                                         03S0427 01642000
*             DO;                   /* EXTENSION IF NONE EXISTS.     */ 01643000
*               SWACTLS=0;          /* CLEAR SWA INTERFACE CONTROLS. */ 01644000
         STH   R10,SWACTLS                                      03S0429 01645000
*               SWNEW=YES;          /* NEW EPA.                      */ 01646000
         OI    SWACTLS,SWNEW                                    03S0430 01647000
*               SWCHN=YES;          /* CHAIN EPA TO EPA IN EPAPTR.   */ 01648000
         OI    SWACTLS2,SWCHN                                   03S0431 01649000
*               SWASN=YES;          /* ASSIGN THIS NEW JFCBX         */ 01650000
         OI    SWACTLS,SWASN                                    03S0432 01651000
*               BLKID=JFXID;        /* SAY JFCBX FOR LATER WRITE.    */ 01652000
         MVI   BLKID,X'1D'                                      03S0433 01653000
*               CALL IEFAB4F7(SWACTLS,0,EPAPTR,ADDR(SVAPRM),/* ASSIGN   01654000
*                                      THE                           */ 01655000
*                   ADDR(SIOTJFX),JFXLEN,1);/* JFCB EXTENSION.       */ 01656000
         LA    R10,SWACTLS                                      03S0434 01657000
         ST    R10,@AL00001                                     03S0434 01658000
         LA    R10,FW0                                          03S0434 01659000
         ST    R10,@AL00001+4                                   03S0434 01660000
         LA    R10,EPAPTR                                       03S0434 01661000
         ST    R10,@AL00001+8                                   03S0434 01662000
         LA    R10,SVAPRM                                       03S0434 01663000
         ST    R10,@TF00001                                     03S0434 01664000
         LA    R10,@TF00001                                     03S0434 01665000
         ST    R10,@AL00001+12                                  03S0434 01666000
         LA    R10,SIOTJFX                                      03S0434 01667000
         ST    R10,@TF00002                                     03S0434 01668000
         LA    R10,@TF00002                                     03S0434 01669000
         ST    R10,@AL00001+16                                  03S0434 01670000
         LA    R10,FW176                                        03S0434 01671000
         ST    R10,@AL00001+20                                  03S0434 01672000
         LA    R10,FW1                                          03S0434 01673000
         ST    R10,@AL00001+24                                  03S0434 01674000
         L     R15,IEFAB4F7                                     03S0434 01675000
         LA    R1,@AL00001                                      03S0434 01676000
         BALR  R14,R15                                          03S0434 01677000
*               JFCBEXAD=SVA;       /* GET SVA FROM SVAPRM.          */ 01678000
         MVC   JFCBEXAD(3),SVA                                  03S0435 01679000
*               JFCBXPTR=SIOTJFX;   /* GET PTR TO JFCBX GEN'D.       */ 01680000
         L     R10,SIOTJFX                                      03S0436 01681000
         ST    R10,JFCBXPTR                                     03S0436 01682000
*               NEWSERS=BLANKOUT;   /* MAKE VOLSERS BLANK IN JFCBX.  */ 01683000
* @41D   MVC   JFCBXVOL-JFCBX(90,R10),BLANKOUT                  03S0437 01684000
         MVI   JFCBXVOL-JFCBX(R10),C' '                            @41A 01684101
         MVC   JFCBXVOL-JFCBX+1(89,R10),JFCBXVOL-JFCBX(R10)        @41A 01684201
*             END;                  /* END JFCBX ASSIGN.             */ 01685000
*           IF HWRESIOT=YES THEN    /* RECEIVED DATA SET FOUND IN    */ 01686000
@RF00427 L     R10,@PC00001                                     03S0439 01687000
         L     R10,HWCNTRLP(,R10)                               03S0439 01688000
         TM    HWRESIOT(R10),B'00001000'                        03S0439 01689000
         BNO   @RF00439                                         03S0439 01690000
*             SIOTJFX->JFCBXDEV     /* CATALOG ORIGINALY. GET DEVICE */ 01691000
*                 =HWRSIOTP->SIOTJFX->JFCBXDEV;/* TYPE FROM PASSING     01692000
*                                      DD.                           */ 01693000
         L     R10,SIOTJFX                                      03S0440 01694000
         L     R9,@PC00001+4                                    03S0440 01695000
         L     R9,HWDATAP(,R9)                                  03S0440 01696000
         L     R9,HWRSIOTP(,R9)                                 03S0440 01697000
         L     R9,SIOTJFX-INDMSIOT(,R9)                         03S0440 01698000
         MVC   JFCBXDEV-JFCBX(4,R10),JFCBXDEV-JFCBX(R9)         03S0440 01699000
*           ELSE                    /* NOT RECEIVED AND NOT A RESTART*/ 01700000
*             IF HWDSNCAT=YES³HWVUREC=YES THEN/* SO GET DEVICE TYPE     01701000
*                                      AS FOUND                      */ 01702000
         B     @RC00439                                         03S0441 01703000
@RF00439 L     R10,@PC00001                                     03S0441 01704000
         L     R10,HWCNTRLP(,R10)                               03S0441 01705000
         TM    HWDSNCAT(R10),B'01000100'                        03S0441 01706000
         BZ    @RF00441                                         03S0441 01707000
*               SIOTJFX->JFCBXDEV=DEVTYPE;/* IN THE CATALOG. @YM08304*/ 01708000
         L     R10,SIOTJFX                                      03S0442 01709000
         MVC   JFCBXDEV-JFCBX(4,R10),DEVTYPE                    03S0442 01710000
*           SIOCDEVT=YES;           /* INDICATE CATALOG DEVTYPE      */ 01711000
@RF00441 DS    0H                                               03S0443 01712000
@RC00439 OI    SIOTBYT3,SIOCDEVT                                03S0443 01713000
*         END;                      /* END DEVTYPE FOR RE-CATALOG.   */ 01714000
*       HWDSNCAT=NO;                /* CLEAN UP HSKPWA CONTROLS FOR     01715000
*                                      THE                           */ 01716000
@RF00425 DS    0H                                               02S0446 01717000
*       HWRESIOT=NO;                /* PROCESSING OF THE NEXT DD BY  */ 01718000
         L     R10,@PC00001                                     02S0446 01719000
         L     R10,HWCNTRLP(,R10)                               02S0446 01720000
         NI    HWDSNCAT(R10),B'11110011'                        02S0446 01721000
*       HWOVRDN=NO;                 /* HOUSEKEEPING.                 */ 01722000
         NI    HWOVRDN(R10),B'11011111'                         02S0447 01723000
*       IF HWVUREC=YES&HWDDCTR=HWDDSTEP+1 THEN/* IF LAST DD WAS      */ 01724000
         TM    HWVUREC(R10),B'01000000'                         02S0448 01725000
         BNO   @RF00448                                         02S0448 01726000
         LH    R9,HWDDCTR(,R10)                                 02S0448 01727000
         LA    R15,1                                            02S0448 01728000
         AH    R15,HWDDSTEP(,R10)                               02S0448 01729000
         CR    R9,R15                                           02S0448 01730000
         BNE   @RF00448                                         02S0448 01731000
*         IF HWDDCTR=HWDDSTEP+1 THEN/* IF LAST DD WAS                */ 01732000
         CR    R9,R15                                           02S0449 01733000
         BNE   @RF00449                                         02S0449 01734000
*           DO;                     /* PROCESSED FOR VOL/UNIT   02S0450 01735000
*                                      RECURSION                     */ 01736000
*             HWVUREC=NO;           /* TURN OFF VOL/UNIT RECURSION      01737000
*                                      FLAG                          */ 01738000
         NI    HWVUREC(R10),B'10111111'                         02S0451 01739000
*             HWDDCTR=0;            /* CLEAR DD COUNTER.             */ 01740000
         SLR   R9,R9                                            02S0452 01741000
         STH   R9,HWDDCTR(,R10)                                 02S0452 01742000
*             HWDDSTEP=0;           /* RESET NO. OF DDS GENERATED.   */ 01743000
         STH   R9,HWDDSTEP(,R10)                                02S0453 01744000
*           END;                                                02S0454 01745000
*       IF SIOVAMDS=NO&SCTDUMMY=NO  /* IF ITS NOT A VIO,DUMMY OR     */ 01746000
*           &SIOTSSDS=NO THEN       /* SUBSYSTEM DATA SET AND THE    */ 01747000
@RF00449 DS    0H                                               02S0455 01748000
@RF00448 TM    SIOTBYT1,SIOVAMDS                                02S0455 01749000
         BNZ   @RF00455                                         02S0455 01750000
         TM    SCTSBYT1,SCTDUMMY                                02S0455 01751000
         BNZ   @RF00455                                         02S0455 01752000
         TM    SIOTBYT0,SIOTSSDS                                02S0455 01753000
         BNZ   @RF00455                                         02S0455 01754000
*         IF SIOUCNVT^=0 THEN       /* UNIT WAS NOT PROPERLY    02S0456 01755000
*                                      CONVERTED.                    */ 01756000
         CLI   SIOUCNVT,0                                       02S0456 01757000
         BE    @RF00456                                         02S0456 01758000
*           DO;                     /* PROCESSING                    */ 01759000
*             HWRSNCD=UNITBAD;      /* CAN'T CONTINUE. FAIL THE JOB  */ 01760000
         L     R10,@PC00001+8                                   02S0458 01761000
         L     R10,HWRTNP(,R10)                                 02S0458 01762000
         MVC   HWRSNCD(2,R10),HW8                               02S0458 01763000
*             HWRTCD=DDERROR;       /* DUE TO INVALID UNIT PARAMETER.*/ 01764000
         MVC   HWRTCD(2,R10),HW4                                02S0459 01765000
*           END;                                                02S0460 01766000
*     END;                                                      01S0461 01767000
@RF00456 DS    0H                                               01S0461 01768000
@RF00455 DS    0H                                               01S0462 01769000
*   IF HWGEPACP=0 THEN              /* REPLACE THE OLD               */ 01770000
@RF00317 L     R10,@PC00001+4                                   01S0462 01771000
         L     R10,HWDATAP(,R10)                                01S0462 01772000
         L     R9,HWGEPACP(,R10)                                01S0462 01773000
         LTR   R9,R9                                            01S0462 01774000
         BNZ   @RF00462                                         01S0462 01775000
*     HWLEPAP=EPAPTR;               /* LAST EPA POINTER              */ 01776000
         L     R9,EPAPTR                                        01S0463 01777000
         ST    R9,HWLEPAP(,R10)                                 01S0463 01778000
*   ELSE                            /* BY THE EPA POINTER            */ 01779000
*     HWGEPACP=EPAPTR;              /* UPDATED BY ASSIGN.            */ 01780000
         B     @RC00462                                         01S0464 01781000
@RF00462 L     R10,@PC00001+4                                   01S0464 01782000
         L     R10,HWDATAP(,R10)                                01S0464 01783000
         L     R9,EPAPTR                                        01S0464 01784000
         ST    R9,HWGEPACP(,R10)                                01S0464 01785000
*   RETURN;                         /* RETURN TO CALLER              */ 01786000
@EL00001 L     R13,4(,R13)                                      01S0465 01787000
@EF00001 L     R0,@SIZDATD                                      01S0465 01788000
         LR    R1,R11                                           01S0465 01789000
         FSPACE   R,LV=(0),A=(1)                                        01790000
@ER00001 LM    R14,R12,12(R13)                                  01S0465 01791000
         BR    R14                                              01S0465 01792000
*JFCBXGEN:                                                      01S0466 01793000
*   PROC;                           /* GENERATE JFCBX PROC           */ 01794000
         B     @EL00001                                         01S0466 01795000
JFCBXGEN STM   R14,R3,@SA00002                                  01S0466 01796000
         STM   R5,R12,@SA00002+24                               01S0466 01797000
*/********************************************************************/ 01798000
*/*                                                                  */ 01799000
*/* SEGMENT NAME - JFCBXGEN                                          */ 01800000
*/*                                                                  */ 01801000
*/* DESCRIPTIVE NAME - JFCBX GENERATE                                */ 01802000
*/*                                                                  */ 01803000
*/* FUNCTION - GENERATE,VIA SWA ASSIGN A JFCBX WHEN THE VOLUME       */ 01804000
*/*            SERIAL NUMBERS,TO BE COPIED,WILL NOT FIT IN THE       */ 01805000
*/*            EXISTING JFCB OR JFCBX.                               */ 01806000
*/*   OPERATION - 1. THE RESULTS OF -(N//JX-J) WHERE N= NUMBER OF    */ 01807000
*/*                  VOLSERS ALREADY COPIED, JX= NUMBER OF VOLSERS IN*/ 01808000
*/*                  A JFCBX,AND J= NUMBER OF VOLSERS IN A JFCB - IS */ 01809000
*/*                  EXAMINED AS FOLLOWS:                            */ 01810000
*/*                                  A- IF NON-ZERO THE NEXT VOLSER  */ 01811000
*/*                                     WILL FIT IN THIS BLOCK AND   */ 01812000
*/*                                     NO JFCBX IS GENERATED        */ 01813000
*/*                                  B- IF ZERO A JFCBX IS REQUIRED  */ 01814000
*/*               2. IF A JFCBX IS REQUIRED AND NONE ALREADY EXIST   */ 01815000
*/*                  THEN A JFCBX IS ASSIGNED AND CHAINED TO EITHER A*/ 01816000
*/*                  JFCB OR JFCBX.                                  */ 01817000
*/*               3. PTR INITIALIZED TO NEXT SLOT TO CONTAIN A       */ 01818000
*/*                  VOLSER                                          */ 01819000
*/* ENTRY - FROM CRI OR DD REFERNECE COMPETION.                      */ 01820000
*/*                                                                  */ 01821000
*/*   PURPOSE - TO OBTAIN A PTR TO THE NEXT VOLSER SLOT,GENERATING   */ 01822000
*/*             A JFCBX IF NONE EXIST(S), WHEN VOLSERS ARE COPIED.   */ 01823000
*/*   INPUT DATA - SCTVOLCT- NUMBER OF VOLSERS COPIED THUS FAR       */ 01824000
*/*                PTR TO LAST VOLSER COPIED.                        */ 01825000
*/*                                                                  */ 01826000
*/* EXIT -                                                           */ 01827000
*/*   CONDITION - ALL                                                */ 01828000
*/*                                                                  */ 01829000
*/*   OUTPUT DATA - AN ASSIGNED JFCBX IF NONE EXISTED WITH,          */ 01830000
*/*                   1. SVA OF JFCBX IN JFCB AND SVAB OF JFCBX IN   */ 01831000
*/*                      SIOT FOR FIRST JFCBX                        */ 01832000
*/*                   2. JFCBXS CHAINED VIA SVAS AND SVABS IN THE    */ 01833000
*/*                      PREVIOUS JFCBX.                             */ 01834000
*/*                   OR                                             */ 01835000
*/*                 THE ADDRESS(IN JVOLPTR) OF WHERE TO MOVE NEXT    */ 01836000
*/*                 VOLSER.                                          */ 01837000
*/*                                                                  */ 01838000
*/*   RETURN CODE - NONE.                                            */ 01839000
*/*                                                                  */ 01840000
*/********************************************************************/ 01841000
*                                                               01S0467 01842000
*   IF SCTVOLCT//JFXVLNO-JFBVLNO=0 THEN/* IF A JFCBX TO RECEIVE THE  */ 01843000
         SLR   R10,R10                                          01S0467 01844000
         SLR   R0,R0                                            01S0467 01845000
         IC    R0,SCTVOLCT                                      01S0467 01846000
         SRDA  R0,32                                            01S0467 01847000
         D     R0,FW15                                          01S0467 01848000
         SL    R0,FW5                                           01S0467 01849000
         CR    R0,R10                                           01S0467 01850000
         BNE   @RF00467                                         01S0467 01851000
*     DO;                           /* VOLUME SERIAL NUMBER,         */ 01852000
*       SWACTLS=0;                  /* CLEAR SWA INTERFACE CONTROLS, */ 01853000
         STH   R10,SWACTLS                                      01S0469 01854000
*       SWNEW=YES;                  /* INDICATE NEW EPA              */ 01855000
         OI    SWACTLS,SWNEW                                    01S0470 01856000
*       SWCHN=YES;                  /* CHAIN EPA FOR WRITE           */ 01857000
         OI    SWACTLS2,SWCHN                                   01S0471 01858000
*       SWASN=YES;                  /* INDICATE ASSIGN OPERATION,    */ 01859000
         OI    SWACTLS,SWASN                                    01S0472 01860000
*       BLKID=JFXID;                /* INDICATE JFCBX FOR LATER 01S0473 01861000
*                                      WRITE.                        */ 01862000
         MVI   BLKID,X'1D'                                      01S0473 01863000
*       IF SCTVOLCT=JFBVLNO THEN    /* IF NUMBER OF VOLSERS COPIED IS*/ 01864000
         CLI   SCTVOLCT,5                                       01S0474 01865000
         BNE   @RF00474                                         01S0474 01866000
*         DO;                       /* JFCB NO. THEN THIS IS 1ST        01867000
*                                      JFCBX                         */ 01868000
*           IF SIOTJFX=0 THEN       /* IF NO POINTER TO 1ST JFCBX       01869000
*                                      THEN                          */ 01870000
         C     R10,SIOTJFX                                      01S0476 01871000
         BNE   @RF00476                                         01S0476 01872000
*             DO;                   /* IT MUST BE ASSIGNED           */ 01873000
*               CALL IEFAB4F7       /* CALL IEFAB4F7 TO ASSIGN       */ 01874000
*                   (SWACTLS,0,EPAPTR,ADDR(SVAPRM),ADDR(SIOTJFX),JFXLEN 01875000
*                   ,1);                                        01S0478 01876000
         LA    R10,SWACTLS                                      01S0478 01877000
         ST    R10,@AL00001                                     01S0478 01878000
         LA    R10,FW0                                          01S0478 01879000
         ST    R10,@AL00001+4                                   01S0478 01880000
         LA    R10,EPAPTR                                       01S0478 01881000
         ST    R10,@AL00001+8                                   01S0478 01882000
         LA    R10,SVAPRM                                       01S0478 01883000
         ST    R10,@TF00001                                     01S0478 01884000
         LA    R10,@TF00001                                     01S0478 01885000
         ST    R10,@AL00001+12                                  01S0478 01886000
         LA    R10,SIOTJFX                                      01S0478 01887000
         ST    R10,@TF00002                                     01S0478 01888000
         LA    R10,@TF00002                                     01S0478 01889000
         ST    R10,@AL00001+16                                  01S0478 01890000
         LA    R10,FW176                                        01S0478 01891000
         ST    R10,@AL00001+20                                  01S0478 01892000
         LA    R10,FW1                                          01S0478 01893000
         ST    R10,@AL00001+24                                  01S0478 01894000
         L     R15,IEFAB4F7                                     01S0478 01895000
         LA    R1,@AL00001                                      01S0478 01896000
         BALR  R14,R15                                          01S0478 01897000
*               JFCBEXAD=SVA;       /* PUT 1ST JFCBX SVA INTO JFCB   */ 01898000
         MVC   JFCBEXAD(3),SVA                                  01S0479 01899000
*             END;                                              01S0480 01900000
*           JFCBXPTR=SIOTJFX;       /* 1ST JFCBX POINTER FROM SIOT   */ 01901000
@RF00476 L     R10,SIOTJFX                                      01S0481 01902000
         ST    R10,JFCBXPTR                                     01S0481 01903000
*           NEWSERS=BLANKOUT;       /* BLANK OUT VOLSERS IN NEW 01S0482 01904000
*                                      JFCBX.                        */ 01905000
* @41D   MVC   JFCBXVOL-JFCBX(90,R10),BLANKOUT                  01S0482 01906000
         MVI   JFCBXVOL-JFCBX(R10),C' '                            @41A 01906101
         MVC   JFCBXVOL-JFCBX+1(89,R10),JFCBXVOL-JFCBX(R10)        @41A 01906201
*         END;                                                  01S0483 01907000
*       ELSE                        /* NOT 1ST JFCBX SO ASSIGN NEW   */ 01908000
*         DO;                       /* JFCBX,IF NONE EXIST           */ 01909000
         B     @RC00474                                         01S0484 01910000
@RF00474 DS    0H                                               01S0485 01911000
*           IF JFCBXNXT=0 THEN      /* IF NO POINTER TO NEXT JFCBX   */ 01912000
         L     R10,JFCBXPTR                                     01S0485 01913000
         L     R9,JFCBXNXT-JFCBX(,R10)                          01S0485 01914000
         LTR   R9,R9                                            01S0485 01915000
         BNZ   @RF00485                                         01S0485 01916000
*             DO;                   /* THEN ONE MUST BE ASSIGNED     */ 01917000
*               CALL IEFAB4F7       /* CALL IEFAB4F7 TO ASSIGN       */ 01918000
*                   (SWACTLS,0,EPAPTR,ADDR(SVAPRM),ADDR(JFCBXNXT),      01919000
*                   JFXLEN,1);                                  01S0487 01920000
         LA    R9,SWACTLS                                       01S0487 01921000
         ST    R9,@AL00001                                      01S0487 01922000
         LA    R9,FW0                                           01S0487 01923000
         ST    R9,@AL00001+4                                    01S0487 01924000
         LA    R9,EPAPTR                                        01S0487 01925000
         ST    R9,@AL00001+8                                    01S0487 01926000
         LA    R9,SVAPRM                                        01S0487 01927000
         ST    R9,@TF00001                                      01S0487 01928000
         LA    R9,@TF00001                                      01S0487 01929000
         ST    R9,@AL00001+12                                   01S0487 01930000
         LA    R10,JFCBXNXT-JFCBX(,R10)                         01S0487 01931000
         ST    R10,@TF00002                                     01S0487 01932000
         LA    R10,@TF00002                                     01S0487 01933000
         ST    R10,@AL00001+16                                  01S0487 01934000
         LA    R10,FW176                                        01S0487 01935000
         ST    R10,@AL00001+20                                  01S0487 01936000
         LA    R10,FW1                                          01S0487 01937000
         ST    R10,@AL00001+24                                  01S0487 01938000
         L     R15,IEFAB4F7                                     01S0487 01939000
         LA    R1,@AL00001                                      01S0487 01940000
         BALR  R14,R15                                          01S0487 01941000
*               JFCBXTTR=SVA;       /* CHAIN JFCBX'S VIA SVA'S       */ 01942000
         L     R10,JFCBXPTR                                     01S0488 01943000
         MVC   JFCBXTTR-JFCBX(3,R10),SVA                        01S0488 01944000
*             END;                                              01S0489 01945000
*           JFCBXPTR=JFCBXNXT;      /* BASE NEW JFCBX                */ 01946000
@RF00485 L     R10,JFCBXPTR                                     01S0490 01947000
         L     R10,JFCBXNXT-JFCBX(,R10)                         01S0490 01948000
         ST    R10,JFCBXPTR                                     01S0490 01949000
*           NEWSERS=BLANKOUT;       /* BLANK OUT VOLSERS IN NEW 01S0491 01950000
*                                      JFCBX.                        */ 01951000
* @41D   MVC   JFCBXVOL-JFCBX(90,R10),BLANKOUT                  01S0491 01952000
         MVI   JFCBXVOL-JFCBX(R10),C' '                            @41A 01952101
         MVC   JFCBXVOL-JFCBX+1(89,R10),JFCBXVOL-JFCBX(R10)        @41A 01952201
*         END;                                                  01S0492 01953000
*       JVOLPTR=ADDR(JFCBXVOL);     /* VOLUME SERIAL LOCATION IN        01954000
*                                      JFCBX                         */ 01955000
@RC00474 L     R4,JFCBXPTR                                      01S0493 01956000
         LA    R4,JFCBXVOL-JFCBX(,R4)                           01S0493 01957000
*     END;                                                      01S0494 01958000
*   ELSE                            /* THERE IS NO NEW JFCBX    01S0495 01959000
*                                      GENERATED,                    */ 01960000
*     JVOLPTR=JVOLPTR+VOLSERLN;     /* SO JUST UPDATE TO NEXT VOLSER.*/ 01961000
         B     @RC00467                                         01S0495 01962000
@RF00467 AL    R4,FW6                                           01S0495 01963000
*   END JFCBXGEN;                                               01S0496 01964000
@EL00002 DS    0H                                               01S0496 01965000
@EF00002 DS    0H                                               01S0496 01966000
@ER00002 LM    R14,R3,@SA00002                                  01S0496 01967000
         LM    R5,R12,@SA00002+24                               01S0496 01968000
         BR    R14                                              01S0496 01969000
*DEVTPROC:                                                      02S0497 01970000
*   PROC;                           /* PROCESS DEVICE TYPES  @ZA12414*/ 01971000
DEVTPROC STM   R14,R12,12(R13)                                  02S0497 01972000
*/********************************************************************/ 01973000
*/*                                                          @ZA12414*/ 01974000
*/* SEGMENT NAME - DEVTPROC                                  @ZA12414*/ 01975000
*/*                                                          @ZA12414*/ 01976000
*/* DESCRIPTIVE NAME - DEVICE TYPE PROCESSING                @ZA12414*/ 01977000
*/*                                                          @ZA12414*/ 01978000
*/* FUNCTION - TURN OFF BITS IN THE DEVICE TYPE WORD AFTER   @ZA12414*/ 01979000
*/*            RETRIEVAL FROM THE CATALOG RETURN INFORMATION.@ZA12414*/ 01980000
*/*            THIS IS REQUIRED BECAUSE SOME SYSTEMS, AT     @ZA12414*/ 01981000
*/*            LEAST VS1, LEAVES SOME OF THE BITS ON WHEN    @ZA12414*/ 01982000
*/*            CATALOGING DATA SETS. THE BITS BEING TURNED   @ZA12414*/ 01983000
*/*            OFF DO NOT EFFECT DEVICE ELLIGIBILITY.        @ZA12414*/ 01984000
*/*                                                          @ZA12414*/ 01985000
*/* ENTRY                                                    @ZA12414*/ 01986000
*/*   PURPOSE - SEE FUNCTION                                 @ZA12414*/ 01987000
*/*                                                          @ZA12414*/ 01988000
*/*   INPUT DATA - DEVTYPE WORD AS IT CAME FROM THE CRI.     @ZA12414*/ 01989000
*/*                                                          @ZA12414*/ 01990000
*/* EXITS -                                                  @ZA12414*/ 01991000
*/*   CONDITION - WHEN DEVTYPE HAS BEEN EXAMINED AND THE     @ZA12414*/ 01992000
*/*               APPROPRIATE OPTION BITS TURNED OFF.        @ZA12414*/ 01993000
*/*                                                          @ZA12414*/ 01994000
*/*   OUTPUT DATA - DEVTYPE WORD UPDATED AS INDICATED IN THE @ZA12414*/ 01995000
*/*                 CODE.                                    @ZA12414*/ 01996000
*/*                                                          @ZA12414*/ 01997000
*/*   RETURN CODE - NONE                                     @ZA12414*/ 01998000
*/*                                                          @ZA12414*/ 01999000
*/********************************************************************/ 02000000
*                                                               02S0498 02001000
*   IF DEVDACC=YES THEN             /* CHECK FOR DA DEVICE   @ZA12414*/ 02002000
         TM    DEVDACC(R2),B'00100000'                          02S0498 02003000
         BNO   @RF00498                                         02S0498 02004000
*     DO;                           /* IT IS DIRECT ACCESS   @ZA12414*/ 02005000
*       DEVTBYT2=DEVTBYT2&SHPOWOFF; /* TURN OFF SHR & PWR    @ZA12414*/ 02006000
         NI    DEVTBYT2(R2),X'DC'                               02S0500 02007000
*       IF DEVTBYT4=DA3340 THEN     /* CHECK FOR 3340 DEV    @ZA12414*/ 02008000
         CLI   DEVTBYT4(R2),X'0A'                               02S0501 02009000
         BNE   @RF00501                                         02S0501 02010000
*         DEVTBYT2=DEVTBYT2&RPSMASK;/* 3340 DEV-RPS OFF      @ZA12414*/ 02011000
         NI    DEVTBYT2(R2),X'EF'                               02S0502 02012000
*     END;                          /* END DIRECT ACCESS     @ZA12414*/ 02013000
@RF00501 DS    0H                                               02S0504 02014000
*   IF DEVTAPE=YES THEN             /* CHECK FOR TAPE DEV    @ZA12414*/ 02015000
@RF00498 TM    DEVTAPE(R2),B'10000000'                          02S0504 02016000
         BNO   @RF00504                                         02S0504 02017000
*     DEVTBYT2=DEVTBYT2&POWEROFF;   /* TURN POWER BITS OFF   @ZA12414*/ 02018000
         NI    DEVTBYT2(R2),X'F4'                               02S0505 02019000
*   IF DEVUREC=YES THEN             /* CHECK FOR UNIT REC    @ZA12414*/ 02020000
@RF00504 TM    DEVUREC(R2),B'00001000'                          02S0506 02021000
         BNO   @RF00506                                         02S0506 02022000
*     IF DEVTBYT4^=UR3211 THEN      /* CHECK FOR 3211 DEV    @ZA12414*/ 02023000
         CLI   DEVTBYT4(R2),X'09'                               02S0507 02024000
         BE    @RF00507                                         02S0507 02025000
*       DEVTBYT2=OPTSOFF;           /* NO TURN OPTIONS OFF   @ZA12414*/ 02026000
         MVI   DEVTBYT2(R2),X'00'                               02S0508 02027000
*     ELSE                          /* IT IS A 3211 DEVICE   @ZA12414*/ 02028000
*       DEVTBYT2=DEVTBYT2&UCSOPMSK; /* LEAVE UCS BIT ON      @ZA12414*/ 02029000
         B     @RC00507                                         02S0509 02030000
@RF00507 NI    DEVTBYT2(R2),X'80'                               02S0509 02031000
*   IF DEVDISP=YES THEN             /* CHECK FOR DISPLAY     @ZA12414*/ 02032000
@RC00507 DS    0H                                               02S0510 02033000
@RF00506 TM    DEVDISP(R2),B'00010000'                          02S0510 02034000
         BNO   @RF00510                                         02S0510 02035000
*     DEVTBYT2=OPTSOFF;             /* YES TURN OPTS OFF     @ZA12414*/ 02036000
         MVI   DEVTBYT2(R2),X'00'                               02S0511 02037000
*   END DEVTPROC;                   /*                       @ZA12414*/ 02038000
@EL00003 DS    0H                                               02S0512 02039000
@EF00003 DS    0H                                               02S0512 02040000
@ER00003 LM    R14,R12,12(R13)                                  02S0512 02041000
         BR    R14                                              02S0512 02042000
*   END IEFAB464                                                01S0513 02043000
*                                                               01S0513 02044000
*/* THE FOLLOWING INCLUDE STATEMENTS WERE FOUND IN THIS PROGRAM.     */ 02045000
*/*%INCLUDE SYSUT5  (PRLG464 )                                       */ 02046000
*/*%INCLUDE SYSUT5  (DCL464  )                                       */ 02047000
*/*%INCLUDE SYSUT5  (CRIRFDCL)                                       */ 02048000
*/*%INCLUDE SYSUT5  (DDRFDCL )                                       */ 02049000
*/*%INCLUDE SYSUT5  (TPRFDCLS)                                       */ 02050000
*/*%INCLUDE SYSUT5  (TPONDCL )                                       */ 02051000
*/*%INCLUDE SYSUT5  (JFXGNDCL)                                       */ 02052000
*/*%INCLUDE SYSUT5  (DCLOVD  )                                       */ 02053000
*/*%INCLUDE SYSLIB  (IEFZB436)                                       */ 02054000
*/*%INCLUDE SYSLIB  (IEFASIOT)                                       */ 02055000
*/*%INCLUDE SYSLIB  (IEFJFCBN)                                       */ 02056000
*/*%INCLUDE SYSLIB  (IEFJFCBX)                                       */ 02057000
*/*%INCLUDE SYSLIB  (IEFZB437)                                       */ 02058000
*/*%INCLUDE SYSLIB  (IEZCTGPL)                                       */ 02059000
*/*%INCLUDE SYSLIB  (IEZCTGWA)                                       */ 02060000
*/*%INCLUDE SYSLIB  (IEZCTGVL)                                       */ 02061000
*/*%INCLUDE SYSLIB  (IEFZB421)                                       */ 02062000
*/*%INCLUDE SYSUT5  (CRIRFCMP)                                       */ 02063000
*/*%INCLUDE SYSUT5  (CRIPLG  )                                       */ 02064000
*/*%INCLUDE SYSUT5  (DDREFCMP)                                       */ 02065000
*/*%INCLUDE SYSUT5  (DDPRLG  )                                       */ 02066000
*/*%INCLUDE SYSUT5  (TAPEONLY)                                       */ 02067000
*/*%INCLUDE SYSUT5  (TPONSPEC)                                       */ 02068000
*/*%INCLUDE SYSUT5  (DDVLCOPY)                                       */ 02069000
*/*%INCLUDE SYSUT5  (DDVLSPEC)                                       */ 02070000
*/*%INCLUDE SYSUT5  (TAPEVREF)                                       */ 02071000
*/*%INCLUDE SYSUT5  (TVRFSPEC)                                       */ 02072000
*/*%INCLUDE SYSUT5  (VIOCOMP )                                       */ 02073000
*/*%INCLUDE SYSUT5  (VIOCMPSP)                                       */ 02074000
*/*%INCLUDE SYSUT5  (UNOVERID)                                       */ 02075000
*/*%INCLUDE SYSUT5  (OVRIDSPC)                                       */ 02076000
*/*%INCLUDE SYSUT5  (NOREFCMP)                                       */ 02077000
*/*%INCLUDE SYSUT5  (NRPRLG  )                                       */ 02078000
*/*%INCLUDE SYSUT5  (CATDEVT )                                       */ 02079000
*/*%INCLUDE SYSUT5  (JFXGSPEC)                                       */ 02080000
*/*%INCLUDE SYSUT5  (DEVTPROC)                                       */ 02081000
*/*%INCLUDE SYSUT5  (DEVTPRLG)                                       */ 02082000
*                                                               01S0513 02083000
*       ;                                                       01S0513 02084000
@DATA    DS    0H                                                       02085000
HW2      DC    H'2'                                                     02086000
HW4      DC    H'4'                                                     02087000
HW8      DC    H'8'                                                     02088000
@DATD    DSECT                                                          02089000
         DS    0F                                                       02090000
@SA00001 DS    18F                                                      02091000
@PC00001 DS    7F                                                       02092000
@SA00002 DS    0F                                                       02093000
         DS    14F                                                      02094000
@AL00001 DS    7A                                                       02095000
@TF00001 DS    F                                                        02096000
@TF00002 DS    F                                                        02097000
IEFAB464 CSECT                                                          02098000
         DS    0F                                                       02099000
FW0      DC    F'0'                                                     02100000
FW1      DC    F'1'                                                     02101000
HW1      EQU   FW1+2                                                    02102000
FW5      DC    F'5'                                                     02103000
FW6      DC    F'6'                                                     02104000
HW6      EQU   FW6+2                                                    02105000
FW15     DC    F'15'                                                    02106000
FW176    DC    F'176'                                                   02107000
@DATD    DSECT                                                          02108000
         DS    0D                                                       02109000
VLPTR    DS    A                                                        02110000
GRPPTR   DS    A                                                        02111000
GRPTABP  DS    A                                                        02112000
EPAPTR   DS    A                                                        02113000
ORGJFBP  DS    A                                                        02114000
JSVAP    DS    A                                                        02115000
JFCBXPTR DS    A                                                        02116000
RDEVPTR  DS    A                                                        02117000
DEVSFND  DS    H                                                        02118000
SWACTLS  DS    0FL2                                                     02119000
SWACTLS1 DS    BL1                                                      02120000
SWASN    EQU   X'80'                                                    02121000
SWDEL    EQU   X'40'                                                    02122000
SWREAD   EQU   X'20'                                                    02123000
SWWRT    EQU   X'10'                                                    02124000
SWNEW    EQU   X'08'                                                    02125000
SWFREE   EQU   X'04'                                                    02126000
SWMOD    EQU   X'02'                                                    02127000
SWOLD    EQU   X'01'                                                    02128000
SWACTLS2 DS    BL1                                                      02128100
SWCHN    EQU   X'80'                                                    02129000
RTVDUNIT DS    0CL8                                                     02132000
DEVTYPE  DS    CL4                                                      02134000
ZEROUCB  DS    FL4                                                      02135000
VOLSDONE DS    BL1                                                      02137000
SVAPRM   DS    0CL4                                                     02138000
SVA      DS    CL3                                                      02140000
BLKID    DS    CL1                                                      02141000
SCANEND  DS    BL1                                                      02143000
IEFAB464 CSECT                                                          02144000
         DS    0F                                                       02145000
@SIZDATD DC    AL1(230)                                                 02146000
         DC    AL3(@ENDDATD-@DATD)                                      02147000
IEFAB463 DC    V(IEFAB463)                                              02149000
IEFAB470 DC    V(IEFAB470)                                              02150000
IEFAB4F7 DC    V(IEFAB4F7)                                              02151000
         DS    0D                                                       02152000
VLEN     DC    AL2(12)                                                  02153000
BLANK    EQU   *,6                     WAS: CL6' '                 @41C 02154000
BLANKS   DC    CL8' '                                                   02155000
ALLDA    DC    CL8'SYSALLDA'                                            02156000
*BLANKOUT DC    CL90' '                                            @41D 02157000
ASTERS   DC    CL6'******'                                         @41A 02157101
IEFAB464 CSECT                                                          02158000
         DS    0H                                                       02159000
PATCHLOC DC    ((@DATA-@PSTART)/20)X'00'                                02160000
         DS    0D                      END OF CSECT                     02160501
@DATD    DSECT                                                          02161000
         ORG   *+1-(*-@DATD)/(*-@DATD) INSURE DSECT DATA                02162000
@ENDDATD EQU   *                                                        02163000
IEFAB464 CSECT                                                          02164000
R0       EQU   00                      EQUATES FOR REGISTERS 0-15       02165000
R1       EQU   01                                                       02166000
R2       EQU   02                                                       02167000
R3       EQU   03                                                       02168000
R4       EQU   04                                                       02169000
R5       EQU   05                                                       02170000
R6       EQU   06                                                       02171000
R7       EQU   07                                                       02172000
R8       EQU   08                                                       02173000
R9       EQU   09                                                       02174000
R10      EQU   10                                                       02175000
R11      EQU   11                                                       02176000
R12      EQU   12                                                       02177000
R13      EQU   13                                                       02178000
R14      EQU   14                                                       02179000
R15      EQU   15                                                       02180000
*LUVPTR  EQU   R2                                                       02181000
*GENPTR  EQU   R4                                                       02182000
*EDTPTR  EQU   R3                                                       02183000
*LUVCTR  EQU   R9                                                       02184000
*GENCTR  EQU   R5                                                       02185000
*VOLCOPY EQU   R2                                                       02186000
*JVOLPTR EQU   R4                                                       02187000
*RVOLPTR EQU   R2                                                       02188000
*RJFCBXP EQU   R5                                                       02189000
*RJFCBP  EQU   R3                                                       02190000
*DEVPTR  EQU   R2                                                       02191000
*CDEVPTR EQU   R5                                                       02192000
*DEVTPTR EQU   R2                                                       02193000
*CSIOTP  EQU   R6                                                       02194000
*CJFCBP  EQU   R7                                                       02195000
*RSIOTP  EQU   R8                                                       02196000
DEVWORD  EQU   0                                                        02198000
DEVTBYT2 EQU   DEVWORD+1                                                02199000
DEVTAPE  EQU   DEVWORD+2                                                02201000
DEVDACC  EQU   DEVWORD+2                                                02202000
DEVDISP  EQU   DEVWORD+2                                                02203000
DEVUREC  EQU   DEVWORD+2                                                02204000
DEVTBYT4 EQU   DEVWORD+3                                                02205000
VSER     EQU   0                                                        02206000
JSVA     EQU   0                                                        02207000
CTGVL    EQU   0                                                        02208000
CTGVLVOL EQU   CTGVL                                                    02209000
CTGVLDEV EQU   CTGVL+6                                                  02210000
CTGVLSEQ EQU   CTGVL+10                                                 02211000
NEXTSER  EQU   0                                                        02212000
HWUCLST  EQU   0                                                        02213000
HWEDTLUV EQU   HWUCLST                                                  02214000
HWDEVTYP EQU   HWUCLST+4                                                02215000
HWUCBP   EQU   HWUCLST+8                                                02216000
SCTPARLM EQU   4                                                        02238000
SCTSNEW  EQU   4                                                        02246000
SCTSMOD  EQU   2                                                        02247000
HWCNTRL  EQU   0                                                        02301000
HWVUREC  EQU   HWCNTRL+2   X'40'  VOLUME/UNIT RECURSION                 02302000
HWRESIOT EQU   HWCNTRL+2   X'08'  REFERENCED SIOT                       02303000
HWDSNCAT EQU   HWCNTRL+2   X'04'  USING CATALOG ENTRY DATA              02304000
HWOVCAND EQU   HWCNTRL+2   X'02'  OVERRIDE CANDIDATE                    02305000
HWUCB    EQU   HWCNTRL+2   X'01'  GET DEVICE TYPE FROM UCB              02306000
HWEDT    EQU   HWCNTRL+3   X'80'  GET DEVICE TYPE FROM EDT              02307000
HWVAME   EQU   HWCNTRL+3   X'40'  UNIT TYPE IS VIO ELIGIBLE             02308000
HWOVRDN  EQU   HWCNTRL+3   X'20'                                        02309000
HWMSSCTL EQU   HWCNTRL+3                                                02310000
HWAVUNIT EQU   HWMSSCTL    X'01'                                        02311000
HWVLSELF EQU   HWMSSCTL+1  X'80'                                        02312000
HWAVSRCH EQU   HWMSSCTL+1  X'40'                                        02313000
HWTBLCTL EQU   HWCNTRL+6                                                02314000
HWJLCTLS EQU   HWCNTRL+7                                                02315000
HWDDSTEP EQU   HWCNTRL+10                                               02316000
HWDDCTR  EQU   HWCNTRL+12                                               02317000
HWDATA   EQU   0                                                        02318000
HWLEPAP  EQU   HWDATA+12                                                02319000
HWGEPACP EQU   HWDATA+16                                                02320000
HWIOSLTP EQU   HWDATA+32                                                02321000
HWRSIOTP EQU   HWDATA+40                                                02322000
HWUCLPTR EQU   HWDATA+56                                                02323000
HWLEPARP EQU   HWDATA+60                                                02324000
HWVLSELP EQU   HWDATA+80                                                02325000
HWSTPNBR EQU   HWDATA+172                                               02326000
HWDEV    EQU   0                                                        02327000
HWMBYTE  EQU   HWDEV                                                    02328000
HWOBYTE  EQU   HWDEV+1                                                  02329000
HW7TRK   EQU   HWOBYTE                                                  02330000
HWCTBYT  EQU   HWDEV+2                                                  02331000
HWTAPE   EQU   X'80'                                                    02332000
HWDA     EQU   X'20'                                                    02333000
HWTYPE   EQU   HWCTBYT+1                                                02334000
HWRETURN EQU   0                                                        02335000
HWRTCD   EQU   HWRETURN                                                 02336000
HWRSNCD  EQU   HWRETURN+2                                               02337000
HWVLSELB EQU   0                                                        02338000
HWSELHDR EQU   HWVLSELB                                                 02339000
HWVLSLCT EQU   HWSELHDR+2                                               02340000
HWVLSERS EQU   HWVLSELB+4                                               02341000
CTGPL    EQU   0                                                        02342000
CTGOPTN1 EQU   CTGPL                                                    02343000
CTGOPTN2 EQU   CTGPL+1                                                  02344000
CTGEXT   EQU   CTGOPTN2                                                 02345000
CTGERASE EQU   CTGOPTN2                                                 02346000
CTGSMF   EQU   CTGERASE                                                 02347000
CTGREL   EQU   CTGSMF                                                   02348000
CTGPURG  EQU   CTGOPTN2                                                 02349000
CTGVMNT  EQU   CTGPURG                                                  02350000
CTGOPTN3 EQU   CTGPL+2                                                  02351000
CTGOPTN4 EQU   CTGPL+3                                                  02352000
CTGENT   EQU   CTGPL+4                                                  02353000
CTGCAT   EQU   CTGPL+8                                                  02354000
CTGWKA   EQU   CTGPL+12                                                 02355000
CTGDSORG EQU   CTGPL+16                                                 02356000
CTGDDNM  EQU   CTGPL+20                                                 02357000
CTGNEWNM EQU   CTGDDNM                                                  02358000
CTGFBFLG EQU   CTGNEWNM+2                                               02359000
CTGJSCB  EQU   CTGPL+24                                                 02360000
CTGWA    EQU   0                                                        02361000
CTGWAVL  EQU   CTGWA                                                    02362000
CTGWAVCT EQU   CTGWA+6                                                  02363000
CTGWAUCT EQU   CTGWA+8                                                  02364000
CTGVLX   EQU   0                                                        02365000
CTGVLTTR EQU   CTGVLX+12                                                02366000
EDTHDR   EQU   0                                                        02367000
EDTLUVSP EQU   EDTHDR                                                   02368000
EDTGENSP EQU   EDTHDR+4                                                 02369000
EDTGRPSP EQU   EDTHDR+8                                                 02370000
EDTUCBSP EQU   EDTHDR+12                                                02371000
EDTMSKTP EQU   EDTHDR+16                                                02372000
LUVSECT  EQU   0                                                        02373000
LUVHDR   EQU   LUVSECT                                                  02374000
LUVENTNO EQU   LUVHDR                                                   02375000
LUVENTLN EQU   LUVHDR+4                                                 02376000
LUVENTRY EQU   0                                                        02377000
LUVALUE  EQU   LUVENTRY+8                                               02378000
LUVGMTP  EQU   LUVENTRY+12                                              02379000
LUVGENNO EQU   LUVENTRY+16                                              02380000
LUVGENP  EQU   LUVENTRY+20                                              02381000
LUVFLAGS EQU   LUVENTRY+24                                              02382000
GENSECT  EQU   0                                                        02383000
GENHDR   EQU   GENSECT                                                  02384000
GENENTLN EQU   GENHDR+4                                                 02385000
GENENTRY EQU   0                                                        02386000
GENDEVT  EQU   GENENTRY                                                 02387000
GRPTRTAB EQU   0                                                        02388000
GRPSECT  EQU   0                                                        02389000
GRPHDR   EQU   GRPSECT                                                  02390000
GRPENTRY EQU   0                                                        02391000
GRPUCBP  EQU   GRPENTRY+8                                               02392000
EUCBSECT EQU   0                                                        02393000
EUCBHDR  EQU   EUCBSECT                                                 02394000
EUCBENTY EQU   0                                                        02395000
GRMSKTAB EQU   0                                                        02396000
GMTHDR   EQU   GRMSKTAB                                                 02397000
GMTENTRY EQU   0                                                        02398000
HWCNTRLP EQU   0                                                        02399000
HWDATAP  EQU   0                                                        02400000
HWRTNP   EQU   0                                                        02401000
CSIOTPTR EQU   0                                                        02402000
CJFCBPTR EQU   0                                                        02403000
CRIP     EQU   0                                                        02404000
RSIOTPTR EQU   0                                                        02405000
CTGPROB  EQU   CTGDDNM                                                  02470000
CTGREASN EQU   CTGPROB+2                                                02472000
@RF00170 EQU   @RC00119                                                 02938000
@RF00176 EQU   @RC00119                                                 02939000
@RC00244 EQU   @RC00243                                                 02940000
@RF00251 EQU   @RC00241                                                 02941000
@RC00324 EQU   @RC00321                                                 02942000
@RF00323 EQU   @RC00321                                                 02943000
@RC00362 EQU   @RC00360                                                 02944000
@RC00462 EQU   @EL00001                                                 02945000
@RC00467 EQU   @EL00002                                                 02946000
@RF00510 EQU   @EL00003                                                 02947000
@RC00326 EQU   @RC00324                                                 02948000
@ENDDATA EQU   *                                                        02949000
         PRINT NOGEN                                                    02950001
         CVT   DSECT=YES                                                02951001
         IEFJESCT                                                       02952001
MYSIOT   DSECT                                                          02953001
         IEFASIOT                                                       02954001
MYJFCB   DSECT                                                          02955001
         IEFJFCBN                                                       02956001
JFCBX    DSECT                                                          02957001
         IEFJFCBX                                                       02958001
         PRINT GEN                                                      02959001
         END   IEFAB464,(C'PLS1341',0802,86051)                         02960000
/*
//*
//U41S04  EXEC PGM=IEBGENER
//SYSPRINT DD  SYSOUT=*
//SYSUT1   DD  *
  IDENTIFY IEFAB464('ZP60041')
++MOD(IEAVAP00) DISTLIB(AOSC5).
/*
//SYSUT2   DD  DSN=&&SMPMCS,DISP=(MOD,PASS)
//SYSIN    DD  DUMMY
//*
//U41S05  EXEC PGM=IFOX00,PARM='OBJECT,NODECK,NOTERM,XREF(SHORT)'
//SYSPRINT DD  SYSOUT=*
//SYSUT1   DD  UNIT=VIO,SPACE=(CYL,10)
//SYSUT2   DD  UNIT=VIO,SPACE=(CYL,10)
//SYSUT3   DD  UNIT=VIO,SPACE=(CYL,10)
//SYSLIB   DD  DSN=SYS1.MACLIB,DISP=SHR
//         DD  DSN=SYS1.SMPMTS,DISP=SHR
//         DD  DSN=SYS1.AMODGEN,DISP=SHR
//         DD  DSN=SYSGEN.RAKF.V1R2M6.MACLIB,DISP=SHR
//         DD  DSN=&&PVTMACS,DISP=(OLD,DELETE)
//SYSGO    DD  DSN=&&SMPMCS,DISP=(MOD,PASS)
//SYSIN    DD  *
         TITLE 'IEAVAP00 - VOLUME ATTRIBUTE PROCESSING'                 00000100
*                                                                       00000200
IEAVAP00 CSECT                                                          00000300
*                                                                       00000400
*        STATUS -                                                       00000500
*        LASTUPD         = JCLIN    TYPE=UPD                            00000600
*        LIBRARIES       = DISTLIB=AOSC5                                00000700
*        FMID            = FBB1221                                      00000800
*        RMID            = UZ56782                                      00000900
*        LMOD            = IEAVNP15                                     00001000
*        SYSMOD HISTORY  = SYSMOD   TYPE       DATE   MCS  STATUS       00001100
*                          EBB1102  FUNCTION  00.000  MOD      ACC RGN  00001200
*                          FBB1221  FUNCTION  00.000  MOD      ACC RGN  00001300
*                                                                       00001400
*        SOURCE WAS UPDATED BY DISASSEMBLY TO MATCH THE                 00001500
*        LOAD MODULE AT THE UZ56782 LEVEL. UZ56782 IMPLEMENTED          00001600
*        A MAJOR CHANGE IN INTERNAL PROCESSING. A LARGE                 00001700
*        TABLE, INTERNAL TO THE MODULE, WAS REPLACED WITH A             00001800
*        GETMAINED AREA WITH USE OF POINTERS TO THIS AREA. THE PL/S     00001900
*        CODE, IN THE COMMENTS, WAS NOT UPDATED TO REFLECT THIS CHANGE  00002000
*                                                                       00002100
*        CHANGE ACTIVITY -                                              00002200
*               ZP60041  - 1. SUPPORT FOR THE CURRENT IPLED SYSRES      00002300
*                             VOLUME IDENTIFIED WITH ****** IN THE      00002400
*                             VATLSTXX TO SET THE SPECIFIED ATTRIBUTES  00002500
*                          2. SUPPORT WILD CARD PROCESSING WHEN         00002600
*                             GENERIC VOLUMES ARE PROVIDED IN           00002700
*                             VATLST ENTRIES                            00002800
*                             % TO MASK ONE CHARACTER                   00002900
*                             * TO MASK NONE OR MANY CHARACTERS         00003000
*                          3. NEW MESSAGE IEA166I GENERATED WHEN        00003100
*                             A GENERIC VATLST ENTRY DOES NOT MATCH     00003200
*                             ANY ONLINE VOLUMES                        00003300
*                          4. SUPPORT * AS A GENERIC DEVICE TYPE        00003400
*                             SPECIFICATION FOR VATLST ENTRIES          00003500
*                          5. LOCALIZED CODE OPTIMZATION                00003600
*                                                                       00003700
         SAVE  (14,12),,'IEAVAP00 ZP60041 &SYSDATE &SYSTIME'            00003800
*                                                                       00003900
         LA    R12,0(,R15)                                              00004000
         LA    R11,2048(,R12)                                           00004100
         LA    R11,2048(,R11)                                           00004200
         LA    R9,2048(,R11)                                            00004300
         LA    R9,2048(,R9)                                             00004400
*                                                                       00004500
         USING IEAVAP00,R12,R11,R9                                      00004600
*                                                                       00004700
         ST    R13,@SA00001+4                                           00004800
         LA    R14,@SA00001                                             00004900
         ST    R14,8(,R13)                                              00005000
         LR    R13,R14                                                  00005100
*SWITCHES = ZERO;                      /* INIT ALL SWITCHES TO OFF   */ 00005200
         XC    SWITCHES,SWITCHES                                        00005300
*BADADDR = ZEROADDR;                   /* INIT INVALID DEVICE PTR    */ 00005400
         MVC   BADADDR,ZEROADDR                                         00005500
*MTLSTCT = ZERO;                       /* INIT MNTLIST ENTRY COUNTER */ 00005600
         XC    MTLSTCT,MTLSTCT                                          00005700
*FINDADDR = ZERO;                      /* INIT PTR TO UCB (EBCDIC)   */ 00005800
         XC    FINDADDR,FINDADDR                                        00005900
*DO;                                   /* INITIALIZE                    00006000
*/********************************************************************/ 00006100
*/*                                                                  */ 00006200
*/* SEGMENT NAME - DATABLES                                          */ 00006300
*/*                                                                  */ 00006400
*/* DESCRIPTIVE NAME - DA TABLE BUILD ROUTINE                        */ 00006500
*/*                                                                  */ 00006600
*/* FUNCTION -                                                       */ 00006700
*/*     THIS ROUTINE LOADS THE ELIGIBLE DEVICE TABLE (EDT).          */ 00006800
*/*     IT BUILDS A LIST OF DIRECT ACCESS (DA) GENERIC               */ 00006900
*/*     NAMES AND CORRESPONDING DEVICE IDS. IT ALSO                  */ 00007000
*/*     OBTAINS TWO HALFWORD COUNTERS PER DA TYPE.                   */ 00007100
*/*                                                                  */ 00007200
*/* ENTRY - IN-LINE SEGMENT                                          */ 00007300
*/*                                                                  */ 00007400
*/*     PURPOSE - SEE FUNCTION                                       */ 00007500
*/*                                                                  */ 00007600
*/*     INPUT DATA -                                                 */ 00007700
*/*                                                                  */ 00007800
*/*         ELIGIBLE DEVICE TABLE (EDT)                   @ZP60041@  */ 00007900
*/*                                                                  */ 00008000
*/*     +NMTAB    DC    A(NRNAMES)   HEADER                          */ 00008100
*/*     +         DC    A(NMTBLEN)   SEGMENT                         */ 00008200
*/*     +*******  BEGIN TABLE BODY                                   */ 00008300
*/*     +NMTBSTRT DS    0A                                           */ 00008400
*/*     +*-------------------------------------------------------    */ 00008500
*/*     + DC   CL8'3350'     LOOKUP NAME FOR THIS ENTRY              */ 00008600
*/*     + DC   F'810557451' INTERNAL CODE FOR THIS ENTRY             */ 00008700
*/*     ETC                                                          */ 00008800
*/*     ETC                                                          */ 00008900
*/*     FOR EACH DEVICE NAME                                         */ 00009000
*/*                                                                  */ 00009100
*/* EXITS -                                                          */ 00009200
*/*                                                                  */ 00009300
*/*     CONDITION - NORMAL - DA TABLE BUILT                          */ 00009400
*/*                                                                  */ 00009500
*/*     OUTPUT DATA -                                                */ 00009600
*/*                                                                  */ 00009700
*/*         DA TABLE BUILT CONSISTING OF DA GENERIC TYPE,            */ 00009800
*/*         GENERIC ID AND TWO HALFWORD COUNTER FIELDS.              */ 00009900
*/*                                                                  */ 00010000
*/*     RETURN CODE - NONE                                           */ 00010100
*/*                                                                  */ 00010200
*/********************************************************************/ 00010300
*                                                                       00010400
* R0=ADDR(IEFEDTTB);       /*LOAD ENTRY POINT NAME ADDRESS*/            00010500
         LA    R0,IEFEDTTB                                              00010600
* R1=0;                    /*JOBLIB OR LINKLIB DCB*/                    00010700
         SLR   R1,R1                                                    00010800
*                                                                       00010900
         SVC   8                       /*ISSUE LOAD SVC                 00011000
*                                                                       00011100
*EDTPTR = R0;                          /* SAVE IEFEDTTB EP ADDR      */ 00011200
         ST    R0,EDTPTR                  -> EDTTAB CSECT               00011300
*LUVPTR = EDTLUVSP + LENGTH(LUVHDR);   /* GET FIRST LUV ADDR         */ 00011400
         LR    R5,R0                      R5 -> EDTTAB CSECT            00011500
         L     R5,0(,R5)                  R5 -> NMTAB                   00011600
         LA    R5,8(,R5)                  R5 -> NMTBSTRT (FIRST ENTRY)  00011700
*DO I=ONE TO LUVENTNO;                 /* SCAN LUV ENTRIES              00011800
*                                              FOR DA TYPES          */ 00011900
         LA    R10,1                                                    00012000
         B     @DE00295                                                 00012100
*                                                                       00012200
*   IF (LUVALUE(3:3) = UCB3DACC  &     /* IF DIRECT                  */ 00012300
*      (LUVALUE(1:1) ¬= ZERO           /*      ACCESS                */ 00012400
*       LUVALUE(4:4) ¬= ZERO)) THEN    /*        NAME THEN           */ 00012500
@DL00295 CLI   10(R5),UCB3DACC            DASD DEVICE ENTRY ?           00012600
         BNE   @RF00296                   NO, BRANCH                    00012700
         XR    R10,R10                    YES                           00012800
         MVC   @ZT00003+3(1),8(R5)        MOVE FIRST BYTE OF INTERNAL   00012900
*                                         CODE                          00013000
         C     R10,@ZT00003                                             00013100
         BNE   @RT00296                                                 00013200
         MVC   @ZT00003+3(1),11(R5)       MOVE DASD DEV TYPE            00013300
         C     R10,@ZT00003                                             00013400
         BE    @RF00296                                                 00013500
*     NUMSUPTD = NUMSUPTD + ONE;       /*   INCREMENT DA CNT         */ 00013600
@RT00296 L     R10,NUMSUPTD                                             00013700
         LA    R10,1(,R10)                                              00013800
         ST    R10,NUMSUPTD                                             00013900
*   LUVPTR = LUVPTR + LUVENTLN;        /* UPDATE TO NEXT NMTAB ENTRY */ 00014000
@RF00296 L     R10,EDTPTR              R10 -> EDTTAB CSECT              00014100
         L     R10,0(,R10)             R10 -> NMTAB                     00014200
         AL    R5,4(,R10)              INCR R5 TO NEXT ENTRY IN NMTAB   00014300
*                                      USING INCR VALUE IN NMTBLEN      00014400
         LA    R10,1                   INCR I COUNTER                   00014500
         AH    R10,I                                                    00014600
*END;                                  /* END DA COUNT LOOP          */ 00014700
@DE00295 STH   R10,I                                                    00014800
         L     R8,EDTPTR               R8 -> EDTTAB CSECT               00014900
         L     R8,0(,R8)               R8 -> NMTAB                      00015000
         C     R10,0(,R8)              I > NRNAMES IN NMTAB ?           00015100
         BNH   @DL00295                NO, RE DRIVE LOOP                00015200
*DATABLEN = NUMSUPTD*(LENGTH(ETYPE) + LENGTH(UCBTYPE) +                 00015300
*      LENGTH(DEVCT) + LENGTH(AUXCT)); /* CALCULATE LENGTH           */ 00015400
         L     R0,NUMSUPTD                                              00015500
         MH    R0,KH13                                                  00015600
         ST    R0,DATABLEN                                              00015700
* DO;                                                                   00015800
         XR    R1,R1                                                    00015900
* R15 = 2; /* RU-TYPE GETMAIN */                                        00016000
         LA    R15,2                                                    00016100
* R0 = DATABLEN; /* LENGTH REQUESTED*/                                  00016200
         SVC   120                                                      00016300
* END;                                                                  00016400
*DEVTYPAD = R1;                        /* SAVE WORK AREA             */ 00016500
         ST    R1,DEVTYPAD                                              00016600
*UCBTYPAD = DEVTYPAD + NUMSUPTD*LENGTH(ETYPE);                          00016700
         LR    R10,R1                                                   00016800
         L     R8,NUMSUPTD                                              00016900
         LR    R4,R8                                                    00017000
         SLA   R4,3                                                     00017100
         ALR   R10,R4                                                   00017200
         ST    R10,UCBTYPAD                                             00017300
*                                      /* CALCULATE ID ADDR          */ 00017400
*DEVCTAD = UCBTYPAD + NUMSUPTD*LENGTH(UCBTYPE);                         00017500
         ALR   R10,R8                                                   00017600
         ST    R10,DEVCTAD                                              00017700
*                                      /* CALCULATE DEVCT ADDR          00017800
*AUXCTAD = DEVCTAD + NUMSUPTD*LENGTH(DEVCT);                            00017900
         ALR   R8,R8                                                    00018000
         ALR   R10,R8                                                   00018100
         ST    R10,AUXCTAD                                              00018200
*                                      /* CALCULATE AUXCT ADDR       */ 00018300
*LUVPTR = EDTLUVSP + LENGTH(LUVHDR);   /* GET FIRST LUV ADDR         */ 00018400
         L     R5,EDTPTR               R5 -> EDTTAB CSECT               00018500
         L     R5,0(,R5)               R5 -> NMTAB                      00018600
         LA    R5,8(,R5)               R5 -> NMTBSTRT (FIRST ENTRY)     00018700
*J = ONE;                              /* INITIALIZE COUNTER         */ 00018800
         LA    R10,1                                                    00018900
         STH   R10,J                                                    00019000
*DO I=ONE TO LUVENTNO WHILE(J <= NUMSUPTD); /* SCAN LUV              */ 00019100
         B     @DE00318                                                 00019200
*                                                                       00019300
@DL00318 LH    R10,J                                                    00019400
         C     R10,NUMSUPTD                                             00019500
         BH    @DC00318                                                 00019600
*  IF (LUVALUE(3:3) = UCB3DACC  &      /* IF DIRECT                  */ 00019700
*     (LUVALUE(1:1) ¬= ZERO            /*      ACCESS                */ 00019800
*      LUVALUE(4:4) ¬= ZERO)) THEN     /*        NAME THEN           */ 00019900
         CLI   10(R5),UCB3DACC                                          00020000
         BNE   @RF00319                                                 00020100
         SLR   R10,R10                                                  00020200
         MVC   @ZT00003+3(1),8(R5)        MOVE FIRST BYTE OF INTERNAL   00020300
         C     R10,@ZT00003                                             00020400
         BNE   @RT00319                                                 00020500
         MVC   @ZT00003+3(1),11(R5)       MOVE DASD DEV TYPE            00020600
         C     R10,@ZT00003                                             00020700
         BE    @RF00319                                                 00020800
*    DO;                               /*    DO FOLLOWING            */ 00020900
*      ETYPE(J) = UNITNAME;            /* STORE GENERIC DA NAME      */ 00021000
@RT00319 LH    R10,J                                                    00021100
         LR    R8,R10                                                   00021200
         SLA   R8,3                                                     00021300
         L     R4,DEVTYPAD                                              00021400
         ALR   R4,R8                                                    00021500
         AL    R4,KFM8                                                  00021600
         MVC   0(8,R4),0(R5)                                            00021700
*      UCBTYPE(J) = LUVALUE(4:4);      /* STORE GENERIC DA ID        */ 00021800
         SLR   R8,R8                                                    00021900
         IC    R8,11(,R5)                                               00022000
         L     R4,UCBTYPAD                                              00022100
         BCTR  R4,0                                                     00022200
         STC   R8,0(R10,R4)                                             00022300
*      DEVCT(J) = ZERO;                /* ZERO COUNTER               */ 00022400
         SLR   R8,R8                                                    00022500
         LR    R4,R10                                                   00022600
         ALR   R4,R4                                                    00022700
         L     R1,DEVCTAD                                               00022800
         BCTR  R1,0                                                     00022900
         BCTR  R1,0                                                     00023000
         STH   R8,0(R4,R1)                                              00023100
*      AUXCT(J) = ZERO;                /* ZERO COUNTER               */ 00023200
         L     R1,AUXCTAD                                               00023300
         BCTR  R1,0                                                     00023400
         BCTR  R1,0                                                     00023500
         STH   R8,0(R4,R1)                                              00023600
*      J = J + ONE;                    /* INCREMENT TABLE INDEX      */ 00023700
         LA    R10,1(,R10)                                              00023800
         STH   R10,J                                                    00023900
*    END;                                                               00024000
*  LUVPTR = LUVPTR + LUVENTLN;         /* UPDATE LUV POINTER         */ 00024100
@RF00319 L     R10,EDTPTR              R10 -> EDTTAB CSECT              00024200
         L     R10,0(,R10)             R10 -> NMTAB                     00024300
         AL    R5,4(,R10)              INCR R5 TO NEXT ENTRY IN NMTAB   00024400
*                                      USING INCR VALUE IN NMTBLEN      00024500
*END;                                  /* END LUV SCAN LOOP          */ 00024600
         LA    R10,1                                                    00024700
         AH    R10,I                                                    00024800
@DE00318 STH   R10,I                                                    00024900
         L     R8,EDTPTR                                                00025000
         L     R8,0(,R8)                                                00025100
         C     R10,0(,R8)                                               00025200
         BNH   @DL00318                                                 00025300
*                                                                       00025400
*        FINISHED WITH IEFEDTTB - DELETE MODULE                         00025500
*                                                                       00025600
@DC00318 LA    R0,IEFEDTTB                                              00025700
         SVC   9                                                        00025800
*                                                                       00025900
         LH    R0,KH9216                                                00026000
         ST    R0,GETSIZE                                               00026100
         SLR   R1,R1                                                    00026200
         LA    R15,2                                                    00026300
         SVC   120                                                      00026400
         ST    R1,GETADDR                                               00026500
*DO;                                   /* INITIALIZE DA UCB'S        */ 00026600
*/********************************************************************/ 00026700
*/*                                                                  */ 00026800
*/* SEGMENT NAME - INITUCBS                                          */ 00026900
*/*                                                                  */ 00027000
*/* DESCRIPTIVE NAME - INITIALIZE P/R AND NOT-READY DIRECT           */ 00027100
*/*                    ACCESS UCB'S                                  */ 00027200
*/*                                                                  */ 00027300
*/* FUNCTION -                                                       */ 00027400
*/*     SCAN LOOK-UP TABLE FOR UCB POINTERS.  IF                     */ 00027500
*/*     UCB ADDRESS IS ZERO, OBTAIN NEXT ENTRY.  IF UCB              */ 00027600
*/*     ADDRESS IS NOT ZERO, SEE IF THE UCB IS FOR DA.  IF UCB IS    */ 00027700
*/*     FOR DA AND IS PERMANENTLY RESIDENT, SET USE STATUS TO PUBLIC.*/ 00027800
*/*     IF UCB IS FOR DA AND THERE IS NO VOLUME SERIAL NUMBER, TURN  */ 00027900
*/*     ON THE NOT-READY BIT.                                        */ 00028000
*/*                                                                  */ 00028100
*/* ENTRY - IN-LINE SEGMENT                                          */ 00028200
*/*                                                                  */ 00028300
*/*     PURPOSE -                                                    */ 00028400
*/*         SET UCB USE STATUS OF ALL VOLUMES THAT HAVE BEEN MARKED  */ 00028500
*/*         PERMANENTLY RESIDENT BY PREVIOUS NIP PROCESSING TO       */ 00028600
*/*         PUBLIC; SET A NOT-READY DEVICE STATUS IN ALL DIRECT      */ 00028700
*/*         ACCESS UCB'S THAT DO NOT CONTAIN VOLUME SERIAL NUMBERS.  */ 00028800
*/*                                                                  */ 00028900
*/*     INPUT DATA -                                                 */ 00029000
*/*                                                                  */ 00029100
*/*         CVTILK2 TO OBTAIN ADDRESS OF LUT                         */ 00029200
*/*                                                                  */ 00029300
*/* EXITS -                                                          */ 00029400
*/*                                                                  */ 00029500
*/*     CONDITION - ALL UCB'S SCANNED                                */ 00029600
*/*                                                                  */ 00029700
*/*     OUTPUT DATA -                                                */ 00029800
*/*                                                                  */ 00029900
*/*         UCB'S - MODIFIED                                         */ 00030000
*/*                                                                  */ 00030100
*/*     RETURN CODE - NONE                                           */ 00030200
*/*                                                                  */ 00030300
*/********************************************************************/ 00030400
*                                                                       00030500
*DO UCINDXP = CVTILK2 BY 2 WHILE (HFUCBPTR ¬= LISTEND);                 00030600
         L     R10,CVTPTR                                               00030700
         MVC   UCINDXP,CVTILK2-CVT(R10)                                 00030800
         B     @DE00337                                                 00030900
*                                      /* SCAN ALL UCBS IN LOOK UP      00031000
*                                         TABLE                      */ 00031100
*  IF HFUCBPTR ¬= ZERO THEN            /* IF UCB PTR NOT ZERO THEN   */ 00031200
@DL00337 L     R10,UCINDXP                                              00031300
         XR    R5,R5                                                    00031400
         ICM   R5,B'0011',0(R10)                                        00031500
         BZ    @RF00338                                                 00031600
         CLM   R5,B'0011',KXFFFF          END OF UCB CHAIN ?            00031700
         BE    @DE00337                   YES, BRANCH                   00031800
*    DO;                               /* DO                         */ 00031900
*      UCBPTR = HFUCBPTR;              /* OBTAIN UCB ADDR            */ 00032000
*      IF UCB3DACC = YES               /*IS UCB DIRECT ACCESS?       */ 00032100
*        THEN DO;                                                       00032200
         TM    UCBTBYT3-UCB(R5),UCB3DACC                                00032300
         BNO   @RF00338                                                 00032400
*          IF UCBPRES = YES            /*IS IT PERMANENTLY RESIDENT? */ 00032500
*            THEN DO;                                                   00032600
         TM    UCBSTAT-UCB(R5),UCBPRES                                  00032700
         BNO   @RF00343                                                 00032800
*              UCBBPUB = YES;          /*TURN ON PUBLIC BIT          */ 00032900
         OI    UCBSTAB-UCB(R5),UCBBPUB                                  00033000
*            END;                                                       00033100
*          IF UCBVOLI = ZEROVOLI       /*IF NO VOL SER IN THIS UCB,  */ 00033200
*            THEN DO;                  /*AND IT IS MULTIPLE          */ 00033300
@RF00343 CLC   UCBVOLI-UCB(,R5),ZEROVOLI                                00033400
         BNE   @RF00338                                                 00033500
*              IF UCBMTPXP = YES       /*EXPOSURE DEVICE,            */ 00033600
*                THEN DO;              /*SET NOT-READY IN            */ 00033700
         TM    UCBWGT-UCB(R5),UCBMTPXP                                  00033800
         BNO   @RF00349                                                 00033900
*                  IF (UCBBASE + ADJBASE) = UCBPTR                      00034000
*                    THEN UCBNOTRD = YES; /*BASE EXPOSURE;           */ 00034100
         LA    R10,512                                                  00034200
         AL    R10,UCBBASE-UCB(,R5)                                     00034300
         CR    R10,R5                                                   00034400
         BNE   @RF00338                                                 00034500
         OI    UCBFLA-UCB(R5),UCBNOTRD                                  00034600
         B     @RF00338                                                 00034700
*                                                                       00034800
*                END;                                                   00034900
*                ELSE DO;                                               00035000
*                  UCBNOTRD = YES;     /*TURN ON NOT RDY BIT         */ 00035100
@RF00349 OI    UCBFLA-UCB(R5),UCBNOTRD                                  00035200
*                END;                  /*FOR OTHER DA DEVICES        */ 00035300
*            END;                                                       00035400
*        END;                                                           00035500
*    END;                                                               00035600
*END;                                  /*RETURN TO TOP SEGMENT       */ 00035700
@RF00338 L     R10,UCINDXP                                              00035800
         LA    R10,2(,R10)              INCR UCB TABLE ->               00035900
         ST    R10,UCINDXP                                              00036000
         B     @DL00337                 RE DRIVE LOOP                   00036100
*END;                                                                   00036200
*DO;                                   /* PROCESS SYSTEM PARAMETERS  */ 00036300
*/********************************************************************/ 00036400
*/*                                                                  */ 00036500
*/* SEGMENT NAME - CKPARMS                                           */ 00036600
*/*                                                                  */ 00036700
*/* DESCRIPTIVE NAME - VALIDITY CHECK VAL PARAMETER LIST             */ 00036800
*/*                                                                  */ 00036900
*/* FUNCTION -                                                       */ 00037000
*/*                                                                  */ 00037100
*/*     SET 'PEND' SWITCH EQUAL TO NO, TO INDICATE PARAMETERS EXIST. */ 00037200
*/*     IF 'PARMPTR' IS ZERO, THEN SET 'DEFAULT' SWITCH TO YES.      */ 00037300
*/*     OTHERWISE, REMOVE PARENTHESIS IF NECESSARY AND CHECK PARA-   */ 00037400
*/*     METER LIST FOR TWO DIGITS SEPARATED BY COMMAS.  IF NOT VALID,*/ 00037500
*/*     ISSUE NIP PROMPT MACRO FOR VAL.  VALIDITY CHECK REPLY.       */ 00037600
*/*                                                                  */ 00037700
*/* ENTRY - IN-LINE SEGMENT                                          */ 00037800
*/*                                                                  */ 00037900
*/*     PURPOSE -                                                    */ 00038000
*/*                                                                  */ 00038100
*/*         VALIDITY CHECK VAL PARAMETER LIST FOR TWO DIGITS SEPARAT-*/ 00038200
*/*         ED BY COMMAS.  IF NO PARAMETERS, SET 'DEFAULT' SWITCH.   */ 00038300
*/*                                                                  */ 00038400
*/*     INPUT DATA -                                                 */ 00038500
*/*                                                                  */ 00038600
*/*         VAL - ADDRESS OF VAL PARAMETERS                          */ 00038700
*/*                                                                  */ 00038800
*/* EXITS -                                                          */ 00038900
*/*                                                                  */ 00039000
*/*     CONDITION - VALID PARAMETER LIST                             */ 00039100
*/*                                                                  */ 00039200
*/*     OUTPUT DATA -                                                */ 00039300
*/*                                                                  */ 00039400
*/*         PEND - SET TO NO                                         */ 00039500
*/*                                                                  */ 00039600
*/*     CONDITION - NO PARAMETER LIST SPECIFIED                      */ 00039700
*/*                                                                  */ 00039800
*/*     OUTPUT DATA -                                                */ 00039900
*/*                                                                  */ 00040000
*/*         DEFAULT - SET TO YES                                     */ 00040100
*/*         PEND - SET TO NO                                         */ 00040200
*/*                                                                  */ 00040300
*/*     RETURN CODE - NONE                                           */ 00040400
*/*                                                                  */ 00040500
*/********************************************************************/ 00040600
*                                                                       00040700
*PLIBMEM = READVAT;                    /*MOVE 'VATLST' INTO READ AREA*/ 00040800
@DE00337 L     R10,NVTPAREA(,R2)                                        00040900
         MVC   PLIBMEM(6,R10),KCVATLST                                  00041000
*                                      /*INDICATE PARAMETERS EXIST   */ 00041100
*                                      /*SET ADDR OF VAL PARAMETERS  */ 00041200
*BADVAL = YES;                         /*INCORRECT VAL FORMAT FOR    */ 00041300
         OI    SWITCH1,BADVAL                                           00041400
         NI    SWITCH1,255-PEND                                         00041500
*                                      /*LOOP ENTRY.                 */ 00041600
*DO WHILE (BADVAL = YES);              /*VALIDITY CHECK VAL PARAMETERS  00041700
*                                        IF FORMAT IS WRONG, OBTAIN     00041800
*                                        NEW VAL FROM OPERATOR AND      00041900
*                                        CHECK FORMAT OF THESE       */ 00042000
         B     @DE00367                                                 00042100
*                                                                       00042200
*BADVAL = NO;                          /*RESET SWITCH -CORRECT FORMAT*/ 00042300
@DL00367 NI    SWITCH1,255-BADVAL                                       00042400
*PARMPTR = VAL;                        /*OBTAIN VAL PARAMETER ADDRESS*/ 00042500
*                                                                       00042600
         L     R10,NVTPTAB(,R2)                                         00042700
         L     R10,VAL(,R10)                                            00042800
         ST    R10,PARMPTR                                              00042900
*IF PARMPTR = ZERO                     /*IF NO, CHECK VAL PARM ADDR  */ 00043000
*  THEN DEFAULT = YES;                 /*SET SWITCH FOR DEFAULT         00043100
*                                        VATLST                      */ 00043200
         LTR   R10,R10                                                  00043300
         BNZ   @RF00370                                                 00043400
         OI    SWITCH1,DEFAULT                                          00043500
         B     @DE00367                                                 00043600
*                                                                       00043700
*  ELSE DO;                            /*VAL PARAMETER EXISTS        */ 00043800
*    J = 0;                                                             00043900
@RF00370 XR    R10,R10                                                  00044000
         STH   R10,J                                                    00044100
*    LOOPSW = NO;                                                       00044200
         NI    SWITCH3,255-LOOPSW                                       00044300
*    DO WHILE LOOPSW = NO;            /*LOCATE END OF PARAMETERS -      00044400
*                                        INDICATED BY A QUOTE        */ 00044500
         B     @DE00375                                                 00044600
*                                                                       00044700
*      J = J + 1;                                                       00044800
@DL00375 LH    R10,J                                                    00044900
         LA    R10,1(,R10)                                              00045000
         STH   R10,J                                                    00045100
*      IF VATPARMS(J) = QUOTE                                           00045200
*        THEN LOOPSW = YES;                                             00045300
         L     R8,PARMPTR                                               00045400
         ALR   R8,R10                                                   00045500
         BCTR  R8,0                                                     00045600
         CLI   0(R8),C''''                                              00045700
         BNE   @DE00375                                                 00045800
         OI    SWITCH3,LOOPSW                                           00045900
*    END;                                                               00046000
@DE00375 TM    SWITCH3,LOOPSW                                           00046100
         BZ    @DL00375                                                 00046200
*    IF VATPARMS(ONE) = LFTPAREN       /*REMOVE PARENTHESIS          */ 00046300
*      THEN DO;                                                         00046400
         L     R10,PARMPTR                                              00046500
         CLI   0(R10),C'('                                              00046600
         BNE   @RF00380                                                 00046700
*        VATPARMS(J-1) = QUOTE;                                         00046800
         LH    R8,J                                                     00046900
         ALR   R8,R10                                                   00047000
         BCTR  R8,0                                                     00047100
         BCTR  R8,0                                                     00047200
         MVI   0(R8),C''''                                              00047300
*        J = J - TWO;                                                   00047400
         LH    R8,J                                                     00047500
         BCTR  R8,0                                                     00047600
         BCTR  R8,0                                                     00047700
         STH   R8,J                                                     00047800
*        PARMPTR = PARMPTR + ONE;                                       00047900
         AH    R10,KH1                                                  00048000
         ST    R10,PARMPTR                                              00048100
*      END;                                                             00048200
*    IF J // 3 ¬= ZERO                 /*QUOTE IN WRONG POSITION     */ 00048300
*      THEN BADVAL=YES;                                                 00048400
@RF00380 LH    R0,J                                                     00048500
         SRDA  R0,32                                                    00048600
         D     R0,KF3                                                   00048700
         LTR   R0,R0                                                    00048800
         BZ    @RF00386                                                 00048900
         OI    SWITCH1,BADVAL                                           00049000
*    DO K = THREE TO J BY THREE        /*SCAN REPLY                  */ 00049100
*       WHILE (BADVAL=NO);                                              00049200
@RF00386 LA    R10,3                                                    00049300
         STH   R10,K                                                    00049400
         B     @DE00388                                                 00049500
*                                                                       00049600
@DL00388 TM    SWITCH1,BADVAL                                           00049700
         BNZ   @DC00388                                                 00049800
*      IF VATPARMS(K) ¬= COMMA         /*CHECK FOR ,                 */ 00049900
*        & VATPARMS(K) ¬= QUOTE        /*  OR '                      */ 00050000
*        THEN BADVAL=YES;              /*INDICATE ERROR              */ 00050100
         L     R8,PARMPTR                                               00050200
         ALR   R10,R8                                                   00050300
         BCTR  R10,0                                                    00050400
         CLI   0(R10),C','                                              00050500
         BE    @RF00389                                                 00050600
         LH    R10,K                                                    00050700
         ALR   R8,R10                                                   00050800
         BCTR  R8,0                                                     00050900
         CLI   0(R8),C''''                                              00051000
         BE    @RF00389                                                 00051100
         OI    SWITCH1,BADVAL                                           00051200
*    END;                                                               00051300
@RF00389 LH    R10,K                                                    00051400
         LA    R10,3(,R10)                                              00051500
         STH   R10,K                                                    00051600
@DE00388 CH    R10,J                                                    00051700
         BNH   @DL00388                                                 00051800
*    IF BADVAL = YES                   /*INCORRECT PARAMETER FORMAT  */ 00051900
*      THEN DO;                                                         00052000
@DC00388 TM    SWITCH1,BADVAL                                           00052100
         BNO   @DE00367                                                 00052200
*                                     /*PROMPT OP FOR CORRECT PARAMS */ 00052300
         IEAPMNIP TYPE=PRMPT,PARAM=PROMPT,OPT=ERROR                     00052400
*                                                                       00052500
*      END;                                                             00052600
*  END;                                                                 00052700
*END;                                 /*RETURN TO TOP SEGMENT.       */ 00052800
@DE00367 TM    SWITCH1,BADVAL                                           00052900
         BO    @DL00367                                                 00053000
*END;                                                                   00053100
*NIPPAFL1 = YES;                       /* SUPPRESS 'MEMBER NOT FOUND'*/ 00053200
         L     R10,NVTPTAB(,R2)                                         00053300
         OI    NIPPAFL1(R10),B'10000000'                                00053400
         B     @DE00400                                                 00053500
*                                      /* MESSAGE FROM READ          */ 00053600
*DO WHILE PEND = NO;                   /* PROCESS VATLST ENTRIES.    */ 00053700
*/********************************************************************/ 00053800
*/*                                                                  */ 00053900
*/* SEGMENT NAME - SYSPARMS                                          */ 00054000
*/*                                                                  */ 00054100
*/* DESCRIPTIVE NAME - OBTAIN VATLST MEMBER NUMBER                   */ 00054200
*/*                                                                  */ 00054300
*/* FUNCTION -                                                       */ 00054400
*/*                                                                  */ 00054500
*/*     SET 'READ' SWITCH EQUAL TO YES, TO INDICATE THIS VATLST      */ 00054600
*/*     MEMBER HAS NOT BEEN READ YET.                                */ 00054700
*/*                                                                  */ 00054800
*/*     IF 'DEFAULT' SWITCH EQUALS YES, THEN SET 'PEND' SWITCH TO    */ 00054900
*/*     YES, AND MOVE '00' INTO NIPPANAM+6.  OTHERWISE, 'PARMPTR'    */ 00055000
*/*     CONTAINS ADDRESS OF FIRST VATLST MEMBER NUMBER IN            */ 00055100
*/*     SYSTEM PARAMETER AREA.  MOVE TWO DIGITS INTO NIPPANAM+6.     */ 00055200
*/*                                                                  */ 00055300
*/*     SEE IF CHARACTER FOLLOWING MEMBER NUMBER IS A COMMA.         */ 00055400
*/*     IF IT IS, THEN THERE  IS MORE THAN ONE VATLST; UPDATE        */ 00055500
*/*     'PARMPTR' TO POINT TO NEXT PARAMETER. IF CHARACTER IS NOT    */ 00055600
*/*     A COMMA, THEN THE END OF THE PARAMETER LIST HAS BEEN         */ 00055700
*/*     REACHED; SET 'PEND' EQUAL TO YES.                            */ 00055800
*/*                                                                  */ 00055900
*/* ENTRY - IN-LINE SEGMENT                                          */ 00056000
*/*                                                                  */ 00056100
*/*     PURPOSE -                                                    */ 00056200
*/*                                                                  */ 00056300
*/*         PREPARE READ PARAMETER                                   */ 00056400
*/*                                                                  */ 00056500
*/*     INPUT DATA -                                                 */ 00056600
*/*                                                                  */ 00056700
*/*         PARMPTR - ADDRESS OF VAL SYSTEM PARAMETERS               */ 00056800
*/*         DEFAULT - SWITCH TO INDICATE DEFAULT LIST                */ 00056900
*/*                                                                  */ 00057000
*/* EXITS -                                                          */ 00057100
*/*                                                                  */ 00057200
*/*     CONDITION - NOT ALL VATLSTS HAVE BEEN READ                   */ 00057300
*/*                                                                  */ 00057400
*/*     OUTPUT DATA -                                                */ 00057500
*/*                                                                  */ 00057600
*/*         NAME OF VATLST TO BE READ                                */ 00057700
*/*                                                                  */ 00057800
*/*     CONDITION - END OF PARAMETER LISTS                           */ 00057900
*/*                                                                  */ 00058000
*/*     OUTPUT DATA -                                                */ 00058100
*/*                                                                  */ 00058200
*/*         NAME OF VATLST TO BE READ                                */ 00058300
*/*         PEND - SET TO YES                                        */ 00058400
*/*                                                                  */ 00058500
*/*     RETURN CODE - NONE                                           */ 00058600
*/*                                                                  */ 00058700
*/********************************************************************/ 00058800
*                                                                       00058900
*READ = YES;                           /*INDICATE THERE IS A VATLST     00059000
*                                        TO BE READ                  */ 00059100
@DL00400 OI    SWITCH1,READ                                             00059200
*IF DEFAULT = YES                      /*USE PARMS OR DEFAULT?       */ 00059300
*  THEN DO;                                                             00059400
         TM    SWITCH1,DEFAULT                                          00059500
         BNO   @RF00402                                                 00059600
*    PEND = YES;                       /*NO MORE PARMS AFTER THIS ONE*/ 00059700
         OI    SWITCH1,PEND                                             00059800
*    SUFFIX = DEFLTVAT;                /*MOVE '00' INTO READ AREA    */ 00059900
         L     R10,NVTPAREA(,R2)                                        00060000
         MVC   SUFFIX(2,R10),KC00                                       00060100
         B     @RC00402                                                 00060200
*                                                                       00060300
*  END;                                                                 00060400
*  ELSE DO;                                                             00060500
*    SUFFIX = VATPARMS(ONE:TWO);       /*MOVE VATLST NUMBER INTO        00060600
*                                        READ AREA                   */ 00060700
@RF00402 L     R10,NVTPAREA(,R2)                                        00060800
         L     R8,PARMPTR                                               00060900
         MVC   SUFFIX(2,R10),0(R8)                                      00061000
*    IF VATPARMS(THREE) = COMMA        /*CHECK FOR MORE PARAMTERS    */ 00061100
*      THEN DO;                                                         00061200
         CLI   2(R8),C','                                               00061300
         BNE   @RF00409                                                 00061400
*        PARMPTR = PARMPTR+THREE;      /*POINT TO NEXT PARAMETER     */ 00061500
         LA    R8,3(,R8)                                                00061600
         ST    R8,PARMPTR                                               00061700
         B     @RC00402                                                 00061800
*                                                                       00061900
*      END;                                                             00062000
*      ELSE PEND = YES;                /*END OF PARAMETERS           */ 00062100
@RF00409 OI    SWITCH1,PEND                                             00062200
@RC00402 B     @DE00415                                                 00062300
*                                                                       00062400
*  END;                                                                 00062500
*DO WHILE (READ = YES);                /*READ VATLST                 */ 00062600
*/********************************************************************/ 00062700
*/*                                                                  */ 00062800
*/* SEGMENT NAME - RDENTRY                                           */ 00062900
*/*                                                                  */ 00063000
*/* DESCRIPTIVE NAME - READ AN ENTRY FROM VATLST                     */ 00063100
*/*                                                                  */ 00063200
*/* FUNCTION -                                                       */ 00063300
*/*                                                                  */ 00063400
*/*     READ AN ENTRY FROM VATLSTXX.  CHECK READ RETURN.  IF READ    */ 00063500
*/*     WAS GOOD, EXECUTE SEGMENT 'CKENTRY'.  IF EOF, SET 'READ'     */ 00063600
*/*     SWITCH TO OFF.  IF A LIST WAS NOT FOUND, EXECUTE SEGMENT     */ 00063700
*/*     'NOLIST'.  IF AN  I/O ERROR OCCURRED, EXECUTE SEGMENT        */ 00063800
*/*     'RDERR'.                                                     */ 00063900
*/*                                                                  */ 00064000
*/* ENTRY - IN-LINE SEGMENT                                          */ 00064100
*/*                                                                  */ 00064200
*/*     PURPOSE - SEE FUNCTION                                       */ 00064300
*/*                                                                  */ 00064400
*/*     INPUT DATA -                                                 */ 00064500
*/*                                                                  */ 00064600
*/*         NIPPANAM - PARMLIB MEMBER NAME                           */ 00064700
*/*                                                                  */ 00064800
*/* EXITS -                                                          */ 00064900
*/*                                                                  */ 00065000
*/*     CONDITION - NORMAL                                           */ 00065100
*/*                                                                  */ 00065200
*/*     OUTPUT DATA -                                                */ 00065300
*/*                                                                  */ 00065400
*/*         A VATLST ENTRY                                           */ 00065500
*/*                                                                  */ 00065600
*/*     CONDITION - EOF OR ERROR                                     */ 00065700
*/*                                                                  */ 00065800
*/*     OUTPUT DATA -                                                */ 00065900
*/*                                                                  */ 00066000
*/*         READ - SET TO OFF                                        */ 00066100
*/*                                                                  */ 00066200
*/*     CONDITION - NOT FOUND                                        */ 00066300
*/*                                                                  */ 00066400
*/*     OUTPUT DATA -                                                */ 00066500
*/*                                                                  */ 00066600
*/*         READ - SET TO OFF IF OPERATOR DID NOT SUPPLY AN          */ 00066700
*/*                ALTERNATE LIST                                    */ 00066800
*/*                                                                  */ 00066900
*/*     RETURN CODE - NONE                                           */ 00067000
*/*                                                                  */ 00067100
*/********************************************************************/ 00067200
*                                                                       00067300
*CALL NIPPMMEM;                        /* READ RECORD FROM VATLST    */ 00067400
@DL00415 BAS   R14,NIPPMMEM                                             00067500
*IF R1 ¬< ZERO                         /* IF NOT NEGATIVE, READ WAS  */ 00067600
*  THEN DO;                            /* GOOD.                      */ 00067700
         LTR   R1,R1                                                    00067800
         BM    @RF00418                                                 00067900
*    MAPAD = R1;                       /* MAP VATLST ENTRY           */ 00068000
         ST    R1,MAPAD                                                 00068100
*                                      /* CHECK FORMAT OF ENTRY      */ 00068200
*/********************************************************************/ 00068300
*/*                                                                  */ 00068400
*/* SEGMENT NAME - CKENTRY                                           */ 00068500
*/*                                                                  */ 00068600
*/* DESCRIPTIVE NAME - CHECK FORMAT OF VATLST ENTRY                  */ 00068700
*/*                    IMPLEMENT GENERIC VOLUME PROCESSING           */ 00068800
*/*                                                                  */ 00068900
*/* FUNCTION -                                                       */ 00069000
*/*                                                                  */ 00069100
*/*     THE 'WTO' MESSAGE SWITCH IS SET ON IN CASE OF ERROR.  THE    */ 00069200
*/*     FORMAT OF THE VATLST ENTRY IS CHECKED FOR:                   */ 00069300
*/*         1. AN ABSENCE OF COMMAS IN THE VOLUME SERIAL AND DEVICE  */ 00069400
*/*            TYPE FIELDS.                                          */ 00069500
*/*         2. DELIMITERS (COMMAS) IN COLUMNS 7, 9, AND 11.          */ 00069600
*/*         3. A COMMA OR BLANK IN COLUMN 20.                        */ 00069700
*/*                                                                  */ 00069800
*/*     IF NONE OF THE ABOVE TESTS FAIL, THE SWITCH 'WTO' IS SET     */ 00069900
*/*     OFF.                                                         */ 00070000
*/*                                                                  */ 00070100
*/*     IF THE FORMAT IS VALID, CONTROL GOES TO THE SEGMENT THAT     */ 00070200
*/*     DETERMINES IF THE ENTRY WILL BE PLACED IN THE MOUNT LIST.    */ 00070300
*/*                                                                  */ 00070400
*/*         NOTE: THE 'WTO' SWITCH IS ALSO SET BY SEGMENT 'MNTLSTCK' */ 00070500
*/*               IF THE DEVICE TYPE IS INVALID.                     */ 00070600
*/*                                                                  */ 00070700
*/* ENTRY - IN-LINE SEGMENT                                          */ 00070800
*/*                                                                  */ 00070900
*/*     PURPOSE - SEE FUNCTION                                       */ 00071000
*/*                                                                  */ 00071100
*/*     INPUT DATA -                                                 */ 00071200
*/*                                                                  */ 00071300
*/*         AN 80-BYTE VATLSTXX ENTRY FROM SYS1.PARMLIB:             */ 00071400
*/*           COL 1-6   VOLUME SERIAL                                */ 00071500
*/*           COL 7     COMMA OR S                          @ZP60041@*/ 00071600
*/*           COL 8     MOUNT CHARACTERISTIC                         */ 00071700
*/*           COL 9     COMMA                                        */ 00071800
*/*           COL 10    ALLOCATION CHARACTERISTIC                    */ 00071900
*/*           COL 11    COMMA                                        */ 00072000
*/*           COL 12-19 DEVICE TYPE OR *                    @ZP60041@*/ 00072100
*/*           COL 20    COMMA OR BLANK                               */ 00072200
*/*           COL 21    MOUNT PRIORITY                               */ 00072300
*/*           COL 22    BLANK                                        */ 00072400
*/*           COL 23-80 OPTIONAL INFORMATION                         */ 00072500
*/*                                                                  */ 00072600
*/* EXITS -                                                          */ 00072700
*/*                                                                  */ 00072800
*/*     CONDITION - VATLST ENTRY VALIDATED                           */ 00072900
*/*                                                                  */ 00073000
*/*     OUTPUT DATA -                                                */ 00073100
*/*                                                                  */ 00073200
*/*         WTO - SET TO OFF                                         */ 00073300
*/*                                                                  */ 00073400
*/*     CONDITION - ERROR IN ENTRY                                   */ 00073500
*/*                                                                  */ 00073600
*/*     OUTPUT DATA -                                                */ 00073700
*/*                                                                  */ 00073800
*/*         WTO - SET ON                                             */ 00073900
*/*         MESSAGE(S) IEA855I                                       */ 00074000
*/*                                                                  */ 00074100
*/*     RETURN CODE - NONE                                           */ 00074200
*/*                                                                  */ 00074300
*/********************************************************************/ 00074400
*                                                                       00074500
         USING UCB,R1                                                   00074600
*                                                                       00074700
         LR    R10,R1                  R10 -> VATLST RECORD   @ZP60041@ 00074800
         USING VATREC,R10                                     @ZP60041@ 00074900
*                                                             @ZP60041@ 00075000
         CLI   VATVOL,C' '             FIRST BYTE OF VOL BLANK@ZP60041@ 00075100
         BE    @DL00415                YES, BRANCH TO DISCARD @ZP60041@ 00075200
*                                      VATLST COMMENT RECORD  @ZP60041@ 00075300
         CLC   VATVOL,SIXASTER         SPECIAL SYSRES ID ?    @ZP60041@ 00075400
         BE    SPECRES                 YES, BRANCH            @ZP60041@ 00075500
*        CHECK FIELDS REQUIRING 'S', COMMA OR OPTIONAL BLANK  @ZP60041@ 00075600
         CLI   VATSPECV,C'S'           STANDARD VOL ?         @ZP60041@ 00075700
         BE    VATGENA                 YES, BRANCH            @ZP60041@ 00075800
         CLI   VATSPECV,C','           VALID COMMA ?          @ZP60041@ 00075900
         BNE   VATFMTE                 NO, VATLST FORMAT ENTRY@ZP60041@ 00076000
VATGENA  CLI   VATCOM1,C','            VALID COMMA ?          @ZP60041@ 00076100
         BNE   VATFMTE                 NO, VATLST FORMAT ENTRY@ZP60041@ 00076200
         CLI   VATCOM2,C','            VALID COMMA ?          @ZP60041@ 00076300
         BNE   VATFMTE                 NO, VATLST FORMAT ENTRY@ZP60041@ 00076400
         CLI   VATCOM3,C','            VALID COMMA ?          @ZP60041@ 00076500
         BE    VATGENAA                YES, BRANCH            @ZP60041@ 00076600
         CLI   VATCOM3,C' '            OPTIONAL BLANK ?       @ZP60041@ 00076700
         BE    VATGENAA                NO, VATLST FORMAT ENTRY@ZP60041@ 00076800
*        SYNTAX ERROR FOUND                                   @ZP60041@ 00076900
*        GENERATE ERROR MESSAGE WITH RECORD INFO              @ZP60041@ 00077000
VATFMTE  L     R15,NVTPAREA(,R2)                              @ZP60041@ 00077100
         MVC   NN855(2),SUFFIX(R15)    VATLSTXX               @ZP60041@ 00077200
         MVC   REC855,VATVOL           MOVE 21 BYTES OF VATRCD@ZP60041@ 00077300
*                                      INTO IEA855 MSG        @ZP60041@ 00077400
         IEAPMNIP TYPE=WTO,PARAM=IEA855I                      @ZP60041@ 00077500
*                                                             @ZP60041@ 00077600
         MVI   REC855,C' '             BLANK RECORD AREA      @ZP60041@ 00077700
         MVC   REC855+1(L'REC855-1),REC855                    @ZP60041@ 00077800
         B     @DL00415                READ ANOTHER RECORD    @ZP60041@ 00077900
*        SYNTAX CHECK COMPLETE                                @ZP60041@ 00078000
VATGENAA CLI   VATSPECV,C'S'           SPECIFIC VOL ?         @ZP60041@ 00078100
*                                      (NEW WITH Z/OS)        @ZP60041@ 00078200
         BE    VATGENS                 YES, DO NOT TEST FOR   @ZP60041@ 00078300
*                                      MASKING CHARS          @ZP60041@ 00078400
         L     R15,ATESTMAS            R15 -> TESTMASK TABLE  @ZP60041@ 00078500
         LR    R14,R2            *     SAVE NIP REG ACROSS TRT@ZP60041@ 00078600
         TRT   VATVOL,0(R15)     ¦     SCAN FOR MASKING CHARS @ZP60041@ 00078700
*                                ¦     * AND %                @ZP60041@ 00078800
         LR    R2,R14            ¦     RESTORE R2 NIP REG     @ZP60041@ 00078900
         BNZ   VATGENB           V     FOUND, BRANCH          @ZP60041@ 00079000
*        STANDARD VOL NOT GENERIC                             @ZP60041@ 00079100
VATGENS  CLI   VATDEV,C'*'             GENERIC DEV TYPE ?     @ZP60041@ 00079200
         BNE   MNTLSTA                 NO, STANDARD VATLST RCD@ZP60041@ 00079300
*                                                             @ZP60041@ 00079400
*        SPECIFIC VOL WITH GENERIC UNIT TYPE                  @ZP60041@ 00079500
*                                                             @ZP60041@ 00079600
         BAS   R14,FINDVOL             LOCATE UCB             @ZP60041@ 00079700
         LTR   R1,R1                   VOL FOUND ?            @ZP60041@ 00079800
         BZ    MNTLSTA                 NO, LEAVE * IN PLACE   @ZP60041@ 00079900
*                                                             @ZP60041@ 00080000
*        SUBSTITUTE DASD DEVTYPE FROM UCB                     @ZP60041@ 00080100
*                                                             @ZP60041@ 00080200
         XR    R15,R15                                        @ZP60041@ 00080300
         IC    R15,UCBTBYT4            R15 = DASD DEVTYPE     @ZP60041@ 00080400
         BCTR  R15,0                                          @ZP60041@ 00080500
         SLL   R15,3                   MULT BY 8 FOR TABLE    @ZP60041@ 00080600
*                                      OFFSET                 @ZP60041@ 00080700
         A     R15,ADASDTAB            ADD -> DASDTAB         @ZP60041@ 00080800
         MVC   VATDEV,0(R15)           MOVE IN DASDTAB ENTRY  @ZP60041@ 00080900
         B     MNTLSTA                 GOTO STD PROCESSING    @ZP60041@ 00081000
*                                                             @ZP60041@ 00081100
*        GENERIC VOLUME AND OPTIONAL GENERIC UNIT TYPE        @ZP60041@ 00081200
*                                                             @ZP60041@ 00081300
VATGENB  XR    R14,R14                 SET DEFAULT FOR *      @ZP60041@ 00081400
         CLI   VATDEV,C'*'             * ?                    @ZP60041@ 00081500
         BE    VATGENC                 YES, DEFAULT VALUE SET @ZP60041@ 00081600
         L     R15,ADASDTAB            R15 -> DEVICE NAME TAB @ZP60041@ 00081700
         LA    R14,1                   INITIAL UCBTBYT4 VALUE @ZP60041@ 00081800
VATGEND  CLC   VATDEV,0(R15)           VATDEV MATCH DASD      @ZP60041@ 00081900
*                                      TABLE ENTRY ?          @ZP60041@ 00082000
         BE    VATGENC                 YES, BRANCH            @ZP60041@ 00082100
         LA    R15,8(,R15)             INCR TABLE PTR         @ZP60041@ 00082200
         LA    R14,1(,R14)             INCR UCBTBYT4 VALUE    @ZP60041@ 00082300
         C     R14,KF16                TABLE ALL SCANNED ?    @ZP60041@ 00082400
         BL    VATGEND                 NO, REDRIVE LOOP       @ZP60041@ 00082500
*        NO ENTRY IN DASDTAB MATCHED VATDEV                   @ZP60041@ 00082600
         B     VATLOPF                 GOTO ERROR MSG IEA166  @ZP60041@ 00082700
*                                                             @ZP60041@ 00082800
VATGENC  STC   R14,VATUNIT             UNIT TYPE FOR UCB TEST @ZP60041@ 00082900
*                                                             @ZP60041@ 00083000
*        PREPROCESS VATVOL AS PATTERN STRING FOR UCB VOL MATCH@ZP60041@ 00083100
*                                                             @ZP60041@ 00083200
         LA    R14,WILDPARM                                   @ZP60041@ 00083300
         USING WPPPARM,R14                                    @ZP60041@ 00083400
         MVC   WPPRELT,ARESULT         -> RESULT AREA         @ZP60041@ 00083500
         LA    R0,VATVOL                                      @ZP60041@ 00083600
         ST    R0,WPPPSTA              -> VOL PATTERN STRING  @ZP60041@ 00083700
         MVC   WPPPSTL,=A(L'VATVOL)    L'PATTERN STRING       @ZP60041@ 00083800
         L     R15,VWILDPP             R15 -> PREPROCESS EP   @ZP60041@ 00083900
         LR    R1,R14                  R1 -> WILDPP PAR LIST  @ZP60041@ 00084000
         L     R0,AWORKA               PROVIDE 256 BYTE WA    @ZP60041@ 00084100
         BASR  R14,R15                 PREPROC GENERIC PATT   @ZP60041@ 00084200
         DROP  R14                                            @ZP60041@ 00084300
*                                                             @ZP60041@ 00084400
*        SCAN ALL UCB VOLS FOR MATCH WITH GENERIC PATTERN     @ZP60041@ 00084500
*        AND                                                  @ZP60041@ 00084600
*        MATCH THE DASD DEVTYPE                               @ZP60041@ 00084700
*                                                             @ZP60041@ 00084800
         XR    R1,R1                   SET START OF UCB CHAIN @ZP60041@ 00084900
         NI    SWITCH3,255-MATCHGEN    OFF MATCHGEN           @ZP60041@ 00085000
VATLOPA  BAS   R14,GETUCB              ON RETURN R1 -> UCB    @ZP60041@ 00085100
         LTR   R1,R1                   END OF UCB CHAIN ?     @ZP60041@ 00085200
         BZ    VATLOPX                 YES, EXIT LOOP         @ZP60041@ 00085300
         LR    R5,R1                   SAVE UCB ADDR          @ZP60041@ 00085400
*        CALL WILDPS TO DETERMINE IF UCBVOLI MATCHES          @ZP60041@ 00085500
*        GENERIC PATTERN                                      @ZP60041@ 00085600
         LA    R14,WILDPARM                                   @ZP60041@ 00085700
         USING WPSPARM,R14                                    @ZP60041@ 00085800
         MVC   WPSRELT,ARESULT         -> PREPROCESSED PATT   @ZP60041@ 00085900
         LA    R0,UCBVOLI              -> INPUT STRING        @ZP60041@ 00086000
         ST    R0,WPSISTA                                     @ZP60041@ 00086100
         MVC   WPSISTL,=A(L'UCBVOLI)   PROVIDE L'INPUT STRING @ZP60041@ 00086200
         L     R15,VWILDPS             R15 -> PROCESS EP      @ZP60041@ 00086300
         LR    R1,R14                  R1 -> WILDPS PARM LIST @ZP60041@ 00086400
         L     R0,AWORKA               PROVIDE 256 BYTE WA    @ZP60041@ 00086500
         BASR  R14,R15                 PREPROC VATVOL PATT    @ZP60041@ 00086600
         DROP  R14                                            @ZP60041@ 00086700
         LTR   R15,R15                 TEST RETURN CODE       @ZP60041@ 00086800
         BNZ   VATLOPA                 FAILED PATTERN TEST    @ZP60041@ 00086900
*        PASSED PATTERN TEST                                  @ZP60041@ 00087000
         LR    R1,R5                   RESTORE UCB ADDR       @ZP60041@ 00087100
*        UCB DASD TYPE MATCH VATDEV ?                         @ZP60041@ 00087200
         CLI   VATUNIT,X'00'           VATDEV = * ?           @ZP60041@ 00087300
         BE    VATLOPB                 YES, ANY DEVTYPE OK    @ZP60041@ 00087400
         CLC   VATUNIT,UCBTBYT4        NO, VATDEV = UCBTBYT4 ?@ZP60041@ 00087500
         BNE   VATLOPA                 NO, DISCARD THIS UCB   @ZP60041@ 00087600
*                                                             @ZP60041@ 00087700
*        UCB MATCHES GENERIC PATTERN AND DEV TYPE             @ZP60041@ 00087800
*                                                             @ZP60041@ 00087900
*        PROCESS VATLST MOUNT AND ALLOCATION SETTINGS USING   @ZP60041@ 00088000
*        THE SAME LOGIC AS IMPLEMENTED BY THE SETSTAT ROUTINE @ZP60041@ 00088100
*                                                             @ZP60041@ 00088200
VATLOPB  OI    SWITCH3,MATCHGEN        AT LEAST ONE UCB MATCH @ZP60041@ 00088300
         TM    UCBSTAT,UCBPRES         ALREADY RESERVED ?     @ZP60041@ 00088400
         BO    VATLOPG                 YES, BRANCH            @ZP60041@ 00088500
         CLI   VATMNT,C'1'             VATLST REQ RESERVED ?  @ZP60041@ 00088600
         BNE   VATLOPC                 NO, BRANCH             @ZP60041@ 00088700
         OI    UCBSTAT,UCBRESV         YES, SET RESERVED      @ZP60041@ 00088800
         NI    UCBSTAT,255-UCBPRES     OFF PERMANENTLY RES    @ZP60041@ 00088900
         B     VATLOPG                                        @ZP60041@ 00089000
*        PERMANENTLY RESIDENT REQUESTED                       @ZP60041@ 00089100
VATLOPC  OI    UCBSTAT,UCBPRES         ON PERMANENTLY RES     @ZP60041@ 00089200
         NI    UCBSTAT,255-UCBRESV     OFF RESERVED           @ZP60041@ 00089300
*        PROCESS USE ATTRIBUTES                               @ZP60041@ 00089400
*        RESET ALL                                            @ZP60041@ 00089500
VATLOPG  NI    UCBSTAB,255-UCBBSTR-UCBBPRV-UCBBPUB            @ZP60041@ 00089600
         CLI   VATUSE,C'0'             STORAGE VOL ?          @ZP60041@ 00089700
         BNE   VATLOPD                 NO, BRANCH             @ZP60041@ 00089800
         OI    UCBSTAB,UCBBSTR         YES, SET STORAGE       @ZP60041@ 00089900
         B     VATLOPA                 GO TEST ANOTHER UCB    @ZP60041@ 00090000
VATLOPD  CLI   VATUSE,C'2'             PRIVATE VOL ?          @ZP60041@ 00090100
         BNE   VATLOPE                                        @ZP60041@ 00090200
         OI    UCBSTAB,UCBBPRV         YES, SET PRIVATE       @ZP60041@ 00090300
         B     VATLOPA                 GO TEST ANOTHER UCB    @ZP60041@ 00090400
VATLOPE  OI    UCBSTAB,UCBBPUB         SET DEFAULT PUBLIC     @ZP60041@ 00090500
         B     VATLOPA                 GO TEST ANOTHER UCB    @ZP60041@ 00090600
*        ALL UCBS SCANNED                                     @ZP60041@ 00090700
VATLOPX  TM    SWITCH3,MATCHGEN        AT LEAST ONE UCB MATCH @ZP60041@ 00090800
*                                      THE GENERIC PATTERN ?  @ZP60041@ 00090900
         BO    @DL00415                YES, GO READ NEXT RCD  @ZP60041@ 00091000
*        GENERATE ERROR MESSSAGE IEA166I                      @ZP60041@ 00091100
VATLOPF  MVC   VOL166,VATVOL                                  @ZP60041@ 00091200
         MVC   DEV166,VATDEV                                  @ZP60041@ 00091300
         L     R15,NVTPAREA(,R2)                              @ZP60041@ 00091400
         MVC   NN166,SUFFIX(R15)                              @ZP60041@ 00091500
*                                                             @ZP60041@ 00091600
         IEAPMNIP TYPE=WTO,PARAM=IEA166I                      @ZP60041@ 00091700
*                                                             @ZP60041@ 00091800
         B     @DL00415                   GO READ NEXT RECORD @ZP60041@ 00091900
*                                                             @ZP60041@ 00092000
*        IMPLEMENT ******* FOR SYSRES VOLUME                  @ZP60041@ 00092100
*                                                             @ZP60041@ 00092200
SPECRES  L     R1,CVTPTR                                      @ZP60041@ 00092300
         L     R1,CVTSYSAD-CVT(,R1)       R1 -> SYSRES UCB    @ZP60041@ 00092400
         MVC   VATVOL,UCBVOLI             MOVE SYSRES VOLSER  @ZP60041@ 00092500
*                                         INTO VATLST ENTRY   @ZP60041@ 00092600
         SLR   R8,R8                                          @ZP60041@ 00092700
         IC    R8,UCBTBYT4                GET DASD DEVICE TYPE@ZP60041@ 00092800
         BCTR  R8,0                                           @ZP60041@ 00092900
         SLL   R8,3                       OFFSET IN TAB       @ZP60041@ 00093000
         A     R8,ADASDTAB                R8 -> DASD DEV TYPE @ZP60041@ 00093100
*                                         TABLE               @ZP60041@ 00093200
         MVC   VATDEV,0(R8)               MOVE DASD DEV TYPE  @ZP60041@ 00093300
*                                         INTO VATLST ENTRY   @ZP60041@ 00093400
*                                                                       00093500
         DROP R10                                                       00093600
*                                                                       00093700
*      DO;                             /* MESSAGE SWITCH.            */ 00093800
*                                      /* PUT ENTRY IN LIST.         */ 00093900
*/********************************************************************/ 00094000
*/*                                                                  */ 00094100
*/* SEGMENT NAME - MNTLSTCK                                          */ 00094200
*/*                                                                  */ 00094300
*/* DESCRIPTIVE NAME - DETERMINE IF ENTRY SHOULD BE ADDED TO MOUNT   */ 00094400
*/*                    LIST                                          */ 00094500
*/*                                                                  */ 00094600
*/* FUNCTION -                                                       */ 00094700
*/*                                                                  */ 00094800
*/*     THE DEVICE TYPE IN THE VATLST ENTRY IS COMPARED              */ 00094900
*/*     AGAINST A TABLE OF VALID REAL DEVICE TYPES. IF THE           */ 00095000
*/*     ENTRY DEVICE TYPE MATCHES ONE IN THE TABLE, THE              */ 00095100
*/*     'FOUND' SWITCH IS SET ON TO TERMINATE THE SEARCH.            */ 00095200
*/*     IF THE DEVICE TYPE WASN'T FOUND IN THE TABLE, AND IF         */ 00095300
*/*     THE FIRST CHARACTER IS 'V' THEN SERVICE ROUTINE UCBFN        */ 00095400
*/*     IS CALLED FOR CHARACTERS 2  THRU 4. IF THE RETURN IS         */ 00095500
*/*     SUCCESSFUL AND IF THE UCB RETURNED IS VIRTUAL THEN           */ 00095600
*/*     'FOUND' IS SET ON TO INDICATE A VALID DEVICE TYPE.           */ 00095700
*/*     FOR REAL VOLUMES, I IS THE INDEX INTO THE TABLE OF           */ 00095800
*/*     VALID REAL DEVICE TYPES. FOR MSS VOLUMES, I IS SET           */ 00095900
*/*     TO ONE GREATER THAN THE NUMBER OF VALID REAL DEVICE          */ 00096000
*/*     TYPES.                                                       */ 00096100
*/*     MSS ENTRIES ARE SUPPRESSED IF MSS IS NOT                     */ 00096200
*/*     INITIALIZED.                                                 */ 00096300
*/*                                                                  */ 00096400
*/*     IF THE DEVICE TYPE IS VALID AND THE MOUNT LIST IS FULL       */ 00096500
*/*     (300 ENTRIES EXIST), NO MORE PROCESSING IS DONE FOR THE      */ 00096600
*/*     ENTRY. IF THE MOUNT LIST IS NOT FULL, THE SEGMENT THAT       */ 00096700
*/*     BUILDS THE MOUNT LIST IS EXECUTED.                           */ 00096800
*/*                                                                  */ 00096900
*/*     IF THE DEVICE TYPE IS INVALID (THE FOUND SWITCH IS NOT ON),  */ 00097000
*/*     THE 'WTO' SWITCH IS SET ON SO THAT THE MESSAGE 'IEA855I-     */ 00097100
*/*     INVALID VATLSTXX ENTRY' WILL BE ISSUED.                      */ 00097200
*/*                                                                  */ 00097300
*/* ENTRY - IN-LINE SEGMENT                                          */ 00097400
*/*                                                                  */ 00097500
*/*     PURPOSE - SEE FUNCTION                                       */ 00097600
*/*                                                                  */ 00097700
*/*     INPUT DATA -                                                 */ 00097800
*/*                                                                  */ 00097900
*/*         A VATLST ENTRY                                           */ 00098000
*/*         MTLSTCT - THE NUMBER OF ENTRIES IN THE MOUNT LIST        */ 00098100
*/*         DUPSER - SET ON IF MULTIPLE ENTRIES FOR VOLUME           */ 00098200
*/*                  ARE ENCOUNTERED                                 */ 00098300
*/*                                                                  */ 00098400
*/* EXITS -                                                          */ 00098500
*/*                                                                  */ 00098600
*/*     CONDITION - DEVICE TYPE IN ENTRY IS VALID                    */ 00098700
*/*                                                                  */ 00098800
*/*     OUTPUT DATA -                                                */ 00098900
*/*                                                                  */ 00099000
*/*         DEVCT - DEVICE TYPE COUNTER UPDATED IF FIRST VOLUME      */ 00099100
*/*                 ENTRY                                            */ 00099200
*/*         FOUND - SET ON                                           */ 00099300
*/*                                                                  */ 00099400
*/*     CONDITION - INVALID DEVICE TYPE ENTRY                        */ 00099500
*/*                                                                  */ 00099600
*/*     OUTPUT DATA -                                                */ 00099700
*/*                                                                  */ 00099800
*/*         WTO - SET ON                                             */ 00099900
*/*         FOUND - SET OFF                                          */ 00100000
*/*                                                                  */ 00100100
*/*     RETURN CODE - NONE                                           */ 00100200
*/*                                                                  */ 00100300
*/********************************************************************/ 00100400
*                                                                       00100500
*FOUND = NO;                           /* INITIALIZE FOUND SWITCH.   */ 00100600
MNTLSTA  NI    SWITCH1,255-FOUND                                        00100700
*SUPPRESS = OFF;                       /* INITIALIZE SUPPRESS SWITCH    00100800
*                                         OFF                           00100900
         NI    SWITCH3,255-SUPPRESS                                     00101000
*DO IND = NUMSUPTD TO ONE BY - ONE     /* IS ENTRY DEVICE            */ 00101100
*  WHILE FOUND = NO;                   /* TYPE SUPPORTED?            */ 00101200
         L     R5,NUMSUPTD                                              00101300
         B     @DE00464                                                 00101400
*                                                                       00101500
@DL00464 TM    SWITCH1,FOUND                                            00101600
         BNZ   @DC00464                                                 00101700
*  IF ETYPE(IND) = EDEVTYPE                                             00101800
*    THEN DO;                          /* IF TYPE IS VALID, SET      */ 00101900
         LR    R10,R5                                                   00102000
         SLA   R10,3                                                    00102100
         L     R8,DEVTYPAD                                              00102200
         ALR   R8,R10                                                   00102300
         AL    R8,KFM8                                                  00102400
         L     R10,MAPAD                                                00102500
         CLC   0(8,R8),EDEVTYPE(R10)                                    00102600
         BNE   @RF00465                                                 00102700
*      FOUND = YES;                    /* FOUND SWITCH ON.           */ 00102800
         OI    SWITCH1,FOUND                                            00102900
*      I = IND;                        /* SAVE INDEX                 */ 00103000
         STH   R5,I                                                     00103100
*    END;                                                               00103200
*END;                                                                   00103300
@RF00465 BCTR  R5,0                                                     00103400
@DE00464 LTR   R5,R5                                                    00103500
         BP    @DL00464                                                 00103600
*IF FOUND = NO                         /* IF DEVICE TYPE NOT            00103700
*                                         FOUND IN TABLE             */ 00103800
*  THEN IF EDEVTYPE(ONE) = VIRT        /* CHECK FOR VXXX             */ 00103900
@DC00464 TM    SWITCH1,FOUND                                            00104000
         BNZ   @RC00471                                                 00104100
*    THEN DO;                          /* VIRTUAL SPECIFIED          */ 00104200
         L     R10,MAPAD                                                00104300
         CLI   EDEVTYPE(R10),C'V'                                       00104400
         BNE   @RC00471                                                 00104500
*      FINDDEV = EDEVTYPE(2:4);        /* MOVE VUA TO PARM           */ 00104600
         MVC   FINDDEV(3),EDEVTYPE+1(R10)                               00104700
*      R1 = FINDADDR;                  /* SET UP PARAMETER           */ 00104800
         L     R1,FINDADDR                                              00104900
*                                         /*  LOCATE UCB             */ 00105000
         IEAPMNIP TYPE=UCBFN,PARAM=RPARM                                00105100
*      IF R1 ¬= ZERO                   /* UCB FOUND?                 */ 00105200
*        THEN DO;                      /* YES                        */ 00105300
         SLR   R10,R10                                                  00105400
         CR    R1,R10                                                   00105500
         BE    @RC00471                                                 00105600
*          UCBPTR = R1;                /* ADDRESS UCB                */ 00105700
*          IF UCBRVDEV = YES &         /* IS UCB VIRTUAL?            */ 00105800
*             UCBTYP(3:4) = COMP3330   /* IS UCB 3330?               */ 00105900
*            THEN DO;                  /* YES                        */ 00106000
         LR    R5,R1                                                    00106100
         TM    UCBTBYT2-UCB(R5),UCBRVDEV                                00106200
         BNO   @RC00471                                                 00106300
         CLC   UCBTBYT3-UCB(2,R5),DEV3330                               00106400
         BNE   @RC00471                                                 00106500
*              FOUND = YES;            /* VALID DEVICE TYPE          */ 00106600
         OI    SWITCH1,FOUND                                            00106700
*              I = NUMSUPTD + ONE;     /* INDICATE 3330V             */ 00106800
         L     R8,NUMSUPTD                                              00106900
         LA    R8,1(,R8)                                                00107000
         STH   R8,I                                                     00107100
*              IF CVTICB ¬= ZERO&      /* IF ICB EXISTS AND          */ 00107200
*                 ICBI = OFF THEN      /* MSS NOT INIT. THEN         */ 00107300
         L     R8,CVTPTR                                                00107400
         L     R8,CVTEXT2-CVT(,R8)                                      00107500
         L     R8,CVTICB-CVTXTNT2(,R8)                                  00107600
         CR    R8,R10                                                   00107700
         BE    @RC00471                                                 00107800
         TM    ICBI(R8),B'10000000'                                     00107900
         BNZ   @RC00471                                                 00108000
*                SUPPRESS = ON;        /* SUPPRESS MSS REQUESTS      */ 00108100
         OI    SWITCH3,SUPPRESS                                         00108200
*            END;                                                       00108300
*            ELSE;                                                      00108400
*        END;                                                           00108500
*        ELSE;                                                          00108600
*    END;                                                               00108700
*    ELSE;                                                              00108800
*  ELSE;                                                                00108900
*IF FOUND = NO                         /* IF THE DEV TYPE IS INVALID,*/ 00109000
*  THEN WTO = YES;                     /* SET ERR MSG SWITCH ON.     */ 00109100
@RC00471 TM    SWITCH1,FOUND                                            00109200
         BNZ   @RF00495                                                 00109300
         OI    SWITCH1,WTO                                              00109400
         B     @RF00457                                                 00109500
*                                                                       00109600
*  ELSE IF MTLSTCT ¬= MNTMAX&          /* IF MOUNT LIST IS           */ 00109700
*                                      /* NOT FULL AND               */ 00109800
*          SUPPRESS = OFF THEN         /* SUPPRESS IS NOT ON         */ 00109900
@RF00495 LH    R10,MTLSTCT                                              00110000
         CH    R10,KH512                                                00110100
         BE    @RF00457                                                 00110200
         TM    SWITCH3,SUPPRESS                                         00110300
         BNZ   @RF00457                                                 00110400
*    DO;                               /* THEN ADD                   */ 00110500
*/********************************************************************/ 00110600
*/*                                                                  */ 00110700
*/* SEGMENT NAME - MOUNTLST                                          */ 00110800
*/*                                                                  */ 00110900
*/* DESCRIPTIVE NAME - BUILD MOUNT LIST                              */ 00111000
*/*                                                                  */ 00111100
*/* FUNCTION -                                                       */ 00111200
*/*                                                                  */ 00111300
*/*     THE VOLUME SERIAL IN THE VATLST ENTRY IS COMPARED WITH ANY   */ 00111400
*/*     VOLUME SERIALS THAT ARE ALREADY IN THE MOUNT LIST.  IF A     */ 00111500
*/*     DUPLICATE IS FOUND, THE EXISTING MOUNT LIST ENTRY IS OVER-   */ 00111600
*/*     LAID WITH THE CURRENT ENTRY. IF A DUPLICATE VOLSER IS        */ 00111700
*/*     NOT FOUND AND I INDICATES THAT THE DEVICE TYPE IS            */ 00111800
*/*     VIRTUAL, THEN THE DEVICE TYPE OF THE VATLST ENTRY IS         */ 00111900
*/*     COMPARED AGAINST THOSE IN THE MOUNT LIST. THIS IS            */ 00112000
*/*     BECAUSE, FOR MSS VOLUMES, THE ACTUAL DEVICE ADDRESS          */ 00112100
*/*     IS SPECIFIED IN THE ENTRY; TWO ENTRIES WITH                  */ 00112200
*/*     VOLUME SERIALS CAN NOT BE ENTERED IN THE MOUNT LIST          */ 00112300
*/*     FOR THE SAME DEVICE ADDRESS. IF A DUPLICATE                  */ 00112400
*/*     IS FOUND, THE EXISTING MOUNT LIST ENTRY IS OVER-             */ 00112500
*/*     LAID WITH THE CURRENT VATLST ENTRY, SO THAT THE MOUNT AND    */ 00112600
*/*     USE STATUS SET IN THE UCB WILL BE THAT OF THE LAST VATLST    */ 00112700
*/*     ENTRY SPECIFIED BY THE USER.  IF NO DUPLICATE IS FOUND, THE  */ 00112800
*/*     VATLST ENTRY IS ADDED TO THE END OF THE MOUNT LIST (MNTLIST).*/ 00112900
*/*     THE INDEX OF THE UCB UNIT TYPE IN THE DEVTYPES TABLE IS      */ 00113000
*/*     ADDED TO THE MNTLIST ALSO.                                   */ 00113100
*/*                                                                  */ 00113200
*/* ENTRY - IN-LINE SEGMENT                                          */ 00113300
*/*                                                                  */ 00113400
*/*     PURPOSE - SEE FUNCTION                                       */ 00113500
*/*                                                                  */ 00113600
*/*     INPUT DATA -                                                 */ 00113700
*/*                                                                  */ 00113800
*/*         A VATLST ENTRY                                           */ 00113900
*/*         MTLSTCT - NUMBER OF ENTRIES IN THE MOUNT LIST            */ 00114000
*/*                                                                  */ 00114100
*/* EXITS -                                                          */ 00114200
*/*                                                                  */ 00114300
*/*     CONDITION - NORMAL                                           */ 00114400
*/*                                                                  */ 00114500
*/*     OUTPUT DATA -                                                */ 00114600
*/*                                                                  */ 00114700
*/*         MNTLIST - UPDATED                                        */ 00114800
*/*         MTLSTCT - UPDATED                                        */ 00114900
*/*                                                                  */ 00115000
*/*     RETURN CODE - NONE                                           */ 00115100
*/*                                                                  */ 00115200
*/********************************************************************/ 00115300
*                                                                       00115400
*/********************************************************************/ 00115500
*/*                                                                  */ 00115600
*/* NOTE: IN THE FOLLOWING CODE, INSTRUCTION DEVENT(J) =I MUST       */ 00115700
*/*       FOLLOW MNTLIST(J) = MNTENTRY, AND INSTRUCTION              */ 00115800
*/*       DEVENT(MTLSTCT) = I MUST FOLLOW MNTLIST(MTLSTCT) =         */ 00115900
*/*       MNTENTRY.                                                  */ 00116000
*/********************************************************************/ 00116100
*DUPSER = NO;                          /* INITIALIZE DUPSER SWITCH   */ 00116200
*DUPADDR = NO;                         /*INIT DUPADDR SWITCH         */ 00116300
         NI    SWITCH2,255-DUPSER-DUPADDR                               00116400
*IF MTLSTCT ¬= ZERO                    /* FIRST ENTRY?               */ 00116500
*  THEN DO;                            /* NO                         */ 00116600
         LTR   R10,R10                                                  00116700
         BZ    @RF00501                                                 00116800
*    DO J = ONE TO MTLSTCT             /* SCAN FOR DUPLICATE         */ 00116900
*      WHILE DUPSER = NO;              /* VOLUME SERIALS             */ 00117000
         LA    R10,1                                                    00117100
         B     @DE00503                                                 00117200
*                                                                       00117300
@DL00503 TM    SWITCH2,DUPSER                                           00117400
         BNZ   @DC00503                                                 00117500
*      IF EVOLSER = MVOLSER(J)         /* COMPARE VOLSERS            */ 00117600
*        THEN DO;                                                       00117700
         L     R8,MAPAD                                                 00117800
         L     R15,GETADDR                                              00117900
         MH    R10,KH18                                                 00118000
         ST    R10,@TF00001                                             00118100
         ALR   R10,R15                                                  00118200
         AL    R10,KFM18                                                00118300
         CLC   0(6,R8),0(R10)                                           00118400
         BNE   @RF00504                                                 00118500
         LR    R10,R15                                                  00118600
         AL    R10,@TF00001                                             00118700
         AL    R10,KFM10                                                00118800
         MVC   0(8,R10),11(R8)                                          00118900
         LR    R10,R15                                                  00119000
         AL    R10,@TF00001                                             00119100
         AL    R10,KFM12                                                00119200
         MVC   0(1,R10),7(R8)                                           00119300
         LR    R10,R15                                                  00119400
         AL    R10,@TF00001                                             00119500
         AL    R10,KFM11                                                00119600
         MVC   0(1,R10),9(R8)                                           00119700
         LR    R10,R15                                                  00119800
         AL    R10,@TF00001                                             00119900
         BCTR  R10,R0                                                   00120000
         BCTR  R10,R0                                                   00120100
*          MNTLIST(J) = MNTENTRY;      /* IF DUPLICATE IS FOUND,     */ 00120200
         MVC   0(1,R10),20(R8)                                          00120300
*          DEVENT(J) = I;              /* COVER THE OLD ENTRY,       */ 00120400
         LH    R10,I                                                    00120500
         L     R8,@TF00001                                              00120600
         BCTR  R15,R0                                                   00120700
         STC   R10,0(R8,R15)                                            00120800
*          DUPSER = YES;               /* SET UNIT TYPE INDEX AND    */ 00120900
         OI    SWITCH2,DUPSER                                           00121000
*        END;                          /* SET DUPSER SWITCH ON.      */ 00121100
*    END;                              /* END SCAN                   */ 00121200
@RF00504 LH    R10,J                                                    00121300
         LA    R10,1(,R10)                                              00121400
@DE00503 STH   R10,J                                                    00121500
         CH    R10,MTLSTCT                                              00121600
         BNH   @DL00503                                                 00121700
*    IF DUPSER = NO &                  /* IF NO DUP VOLSERS          */ 00121800
*       I > NUMSUPTD                   /* AND ENTRY IS VIRT,         */ 00121900
*      THEN DO J = ONE TO MTLSTCT      /* SCAN FOR DUPLICATE         */ 00122000
@DC00503 TM    SWITCH2,DUPSER                                           00122100
         BNZ   @RF00501                                                 00122200
         LH    R10,I                                                    00122300
         C     R10,NUMSUPTD                                             00122400
         BNH   @RF00501                                                 00122500
*        WHILE DUPADDR = NO;           /* DEVICE ADDRESSES           */ 00122600
         LA    R10,1                                                    00122700
         B     @DE00512                                                 00122800
*                                                                       00122900
@DL00512 TM    SWITCH2,DUPADDR                                          00123000
         BNZ   @RF00501                                                 00123100
*        IF EDEVTYPE = MDEVTYPE(J)     /* COMPARE DEV ADDRS          */ 00123200
*          THEN DO;                    /* MATCH -                    */ 00123300
         L     R8,MAPAD                                                 00123400
         L     R15,GETADDR                                              00123500
         MH    R10,KH18                                                 00123600
         ST    R10,@TF00001                                             00123700
         ALR   R10,R15                                                  00123800
         AL    R10,KFM10                                                00123900
         CLC   11(8,R8),0(R10)                                          00124000
         BNE   @RF00513                                                 00124100
         LR    R10,R15                                                  00124200
         AL    R10,@TF00001                                             00124300
         AL    R10,KFM18                                                00124400
         MVC   0(6,R10),0(R8)                                           00124500
         LR    R10,R15                                                  00124600
         AL    R10,@TF00001                                             00124700
         AL    R10,KFM12                                                00124800
         MVC   0(1,R10),7(R8)                                           00124900
         LR    R10,R15                                                  00125000
         AL    R10,@TF00001                                             00125100
         AL    R10,KFM11                                                00125200
         MVC   0(1,R10),9(R8)                                           00125300
         LR    R10,R15                                                  00125400
         AL    R10,@TF00001                                             00125500
         BCTR  R10,R0                                                   00125600
         BCTR  R10,R0                                                   00125700
         MVC   0(1,R10),20(R8)                                          00125800
*            DEVENT(J) = I;            /* SET UNIT TYPE INDEX        */ 00125900
         LH    R10,I                                                    00126000
         L     R8,@TF00001                                              00126100
         BCTR  R15,0                                                    00126200
         STC   R10,0(R8,R15)                                            00126300
*            DUPADDR = YES;            /* IND DUPLICATE ADDR         */ 00126400
         OI    SWITCH2,DUPADDR                                          00126500
*          END;                                                         00126600
*      END;                                                             00126700
@RF00513 LA    R10,1                                                    00126800
         AH    R10,J                                                    00126900
@DE00512 STH   R10,J                                                    00127000
         CH    R10,MTLSTCT                                              00127100
         BNH   @DL00512                                                 00127200
*  END;                                                                 00127300
*IF (DUPSER = NO) &                    /* DUPLICATE VOLSER?          */ 00127400
*   (DUPADDR = NO)                     /* DUPLICATE DEV ADDR?        */ 00127500
*  THEN DO;                            /* NO -                       */ 00127600
@RF00501 TM    SWITCH2,DUPSER+DUPADDR                                   00127700
         BNZ   @RF00457                                                 00127800
*    MTLSTCT = (MTLSTCT + ONE);        /* INCREMENT THE NUMBER OF    */ 00127900
         LA    R10,1                                                    00128000
         AH    R10,MTLSTCT                                              00128100
         STH   R10,MTLSTCT                                              00128200
         L     R8,GETADDR                                               00128300
         MH    R10,KH18                                                 00128400
         ST    R10,@TF00001                                             00128500
         ALR   R10,R8                                                   00128600
         AL    R10,KFM18                                                00128700
         L     R15,MAPAD                                                00128800
         MVC   0(6,R10),0(R15)                                          00128900
         LR    R10,R8                                                   00129000
         AL    R10,@TF00001                                             00129100
         AL    R10,KFM10                                                00129200
         MVC   0(8,R10),11(R15)                                         00129300
         LR    R10,R8                                                   00129400
         AL    R10,@TF00001                                             00129500
         AL    R10,KFM12                                                00129600
         MVC   0(1,R10),7(R15)                                          00129700
         LR    R10,R8                                                   00129800
         AL    R10,@TF00001                                             00129900
         AL    R10,KFM11                                                00130000
         MVC   0(1,R10),9(R15)                                          00130100
         LR    R10,R8                                                   00130200
         AL    R10,@TF00001                                             00130300
         BCTR  R10,R0                                                   00130400
         BCTR  R10,R0                                                   00130500
         MVC   0(1,R10),20(R15)                                         00130600
         LH    R10,I                                                    00130700
         L     R1,@TF00001                                              00130800
         BCTR  R8,R0                                                    00130900
         STC   R10,0(R1,R8)                                             00131000
*  END;                                /* ADD THIS ENTRY TO THE END. */ 00131100
*                                      /* RETURN TO MNTLSTCK.        */ 00131200
*    END;                                                               00131300
*                                      /* RETURN TO CKENTRY.         */ 00131400
*      END;                                                             00131500
*    END;                                                               00131600
*IF WTO = YES                          /* IF FORMAT WAS INVALID, OR  */ 00131700
*  THEN DO;                            /* DEVICE TYPE WAS INVALID,   */ 00131800
@RF00457 TM    SWITCH1,WTO                                              00131900
         BNO   @DE00415                                                 00132000
*    NN855 = SUFFIX;                   /* SET UP AND ISSUE ERROR     */ 00132100
         L     R10,NVTPAREA(,R2)                                        00132200
         MVC   NN855(2),SUFFIX(R10)                                     00132300
*                                                                       00132400
         IEAPMNIP TYPE=WTO,PARAM=IEA855I                                00132500
*                                                                       00132600
         B     @DE00415                                                 00132700
*                                                                       00132800
*  END;                                                                 00132900
*                                      /* RETURN TO RDENTRY          */ 00133000
*  END;                                                                 00133100
*  ELSE IF NIPPARC = SIXTEEN           /* IF EOF WAS RETURNED, THEN  */ 00133200
*    THEN READ = NO;                   /* SET READ SWITCH TO OFF.    */ 00133300
@RF00418 L     R10,NVTPAREA(,R2)                                        00133400
         CLC   NIPPARC(4,R10),KF16                                      00133500
         BNE   @RF00536                                                 00133600
         NI    SWITCH1,255-READ                                         00133700
         B     @DE00415                                                 00133800
*                                                                       00133900
*    ELSE IF NIPPARC = FOUR            /* IF MEMBER WAS NOT FOUND,   */ 00134000
*      THEN DO;                        /* THEN ASK OPERATOR TO RE-   */ 00134100
*                                      /* SPECIFY.                   */ 00134200
@RF00536 L     R10,NVTPAREA(,R2)                                        00134300
         CLC   NIPPARC(4,R10),KF4                                       00134400
         BNE   @RF00538                                                 00134500
*/********************************************************************/ 00134600
*/*                                                                  */ 00134700
*/* SEGMENT NAME - NOLIST                                            */ 00134800
*/*                                                                  */ 00134900
*/* DESCRIPTIVE NAME - NO VATLST WITH SPECIFIED SUFFIX FOUND IN      */ 00135000
*/*                    SYS1.PARMLIB                                  */ 00135100
*/*                                                                  */ 00135200
*/* FUNCTION -                                                       */ 00135300
*/*                                                                  */ 00135400
*/*     IF 'DEFAULT' SWITCH IS ON, THEN NO MESSAGE SHOULD BE ISSUED; */ 00135500
*/*     SET 'READ' SWITCH TO NO IN ORDER TO FALL THROUGH AND EXIT.   */ 00135600
*/*                                                                  */ 00135700
*/*     IF 'DEFAULT' SWITCH IS NOT ON, THEN MOVE VATLST SUFFIX INTO  */ 00135800
*/*     MESSAGE 'IEA861A-VAL=NN NOT FOUND.  REPLY U OR CORRECT       */ 00135900
*/*     VALUE'.  ISSUE WTOR.  WAIT FOR REPLY.  IF REPLY IS EOB OR    */ 00136000
*/*     'U', THEN SET 'READ' EQUAL TO NO IN ORDER TO IGNORE THIS     */ 00136100
*/*     VATLST.  IF REPLY IS A VALUE AA, MOVE AA INTO NIPPANAM+6     */ 00136200
*/*     AND SET 'READ' EQUAL TO YES SO THAT THIS VATLST WILL BE      */ 00136300
*/*     READ.  IF REPLY IS INVALID, REISSUE WTOR.                    */ 00136400
*/*                                                                  */ 00136500
*/* ENTRY - IN-LINE SEGMENT                                          */ 00136600
*/*                                                                  */ 00136700
*/*     PURPOSE -                                                    */ 00136800
*/*                                                                  */ 00136900
*/*         ISSUE WTOR TO NOTIFY OPERATOR OF NOT-FOUND CONDITION     */ 00137000
*/*         AND OBTAIN REPLY FOR FURTHER ACTION.                     */ 00137100
*/*                                                                  */ 00137200
*/*     INPUT DATA -                                                 */ 00137300
*/*                                                                  */ 00137400
*/*         NIPPANAM+6 - CONTAINS VATLST SUFFIX                      */ 00137500
*/*                                                                  */ 00137600
*/* EXITS -                                                          */ 00137700
*/*                                                                  */ 00137800
*/*     CONDITION - LIST NOT FOUND IS THE DEFAULT LIST               */ 00137900
*/*                                                                  */ 00138000
*/*     OUTPUT DATA -                                                */ 00138100
*/*                                                                  */ 00138200
*/*         READ - SET TO OFF                                        */ 00138300
*/*                                                                  */ 00138400
*/*     CONDITION - LIST NOT FOUND WAS SPECIFIED                     */ 00138500
*/*                                                                  */ 00138600
*/*     OUTPUT DATA -                                                */ 00138700
*/*                                                                  */ 00138800
*/*         MESSAGE IEA861A IS ISSUED                                */ 00138900
*/*                                                                  */ 00139000
*/*     CONDITION - REPLY TO IEA861A IS EOB OR 'U'                   */ 00139100
*/*                                                                  */ 00139200
*/*     OUTPUT DATA -                                                */ 00139300
*/*                                                                  */ 00139400
*/*         READ - SET TO OFF                                        */ 00139500
*/*                                                                  */ 00139600
*/*     CONDITION - REPLY TO IEA861A IS VALUE                        */ 00139700
*/*                                                                  */ 00139800
*/*     OUTPUT DATA -                                                */ 00139900
*/*                                                                  */ 00140000
*/*         NIPPANAM+6 - UPDATED TO A NEW VALUE                      */ 00140100
*/*         READ - SET TO ON                                         */ 00140200
*/*                                                                  */ 00140300
*/*     RETURN CODE - NONE                                           */ 00140400
*/*                                                                  */ 00140500
*/********************************************************************/ 00140600
*                                                                       00140700
*IF DEFAULT = YES                      /*IF LIST NOT FOUND IS DEFAULT   00140800
*                                        VATLST, THEN VOLUME ATTRIBUTE  00140900
*                                        PROCESSOR NOT DESIRED.      */ 00141000
*  THEN READ = NO;                                                      00141100
         TM    SWITCH1,DEFAULT                                          00141200
         BNO   @RF00540                                                 00141300
         NI    SWITCH1,255-READ                                         00141400
         B     @DE00415                                                 00141500
*                                                                       00141600
*  ELSE DO;                                                             00141700
*    NN861 = SUFFIX;                   /*OBTAIN VATLST NUMBER FOR MSG*/ 00141800
@RF00540 L     R10,NVTPAREA(,R2)                                        00141900
         MVC   NN861(2),SUFFIX(R10)                                     00142000
*    BADREPLY = YES;                                                    00142100
         OI    SWITCH2,BADREPLY                                         00142200
         B     @DE00545                                                 00142300
*                                                                       00142400
*    DO WHILE BADREPLY = YES;                                           00142500
*      BADREPLY = NO;                                                   00142600
@DL00545 NI    SWITCH2,255-BADREPLY                                     00142700
*      WTORBUF = BLANK;                /*BLANK OUT REPLY AREA        */ 00142800
         MVI   WTORBUF,C' '                                             00142900
         MVC   WTORBUF+1(L'WTORBUF-1),WTORBUF                           00143000
*                                      /*ISSUE WTOR FOR MSG IEA861A  */ 00143100
*        IEA861A VAL=NN NOT FOUND. REPLY U OR CORRECT VALUE             00143200
*                                                                       00143300
         IEAPMNIP TYPE=WTOR,PARAM=IEA861A                               00143400
*                                                                       00143500
*      IF WTORBUF = REPLYU             /*CHECK FOR REPLY OF U OR EOB */ 00143600
*          WTORBUF = REPLYEOB                                           00143700
*        THEN READ = NO;               /*NOTHING TO READ             */ 00143800
         CLC   WTORBUF(2),KCU                                           00143900
         BE    @RT00549                                                 00144000
         CLC   WTORBUF(2),@CC00169                                      00144100
         BNE   @RF00549                                                 00144200
@RT00549 NI    SWITCH1,255-READ                                         00144300
         B     @DE00545                                                 00144400
*                                                                       00144500
*        ELSE IF WTORBUF+2 = QUOTE     /*REPLY IS TWO CHARACTERS     */ 00144600
*          THEN DO;                                                     00144700
@RF00549 CLI   WTORBUF+2,C''''                                          00144800
         BNE   @RF00551                                                 00144900
*            SUFFIX = WTORBUF;         /*MOVE VATLST NUMBER INTO        00145000
*                                        READ AREA.                  */ 00145100
         L     R10,NVTPAREA(,R2)                                        00145200
         MVC   SUFFIX(2,R10),WTORBUF                                    00145300
*            READ = YES;               /*READ THIS VATLST            */ 00145400
         OI    SWITCH1,READ                                             00145500
         B     @DE00545                                                 00145600
*                                                                       00145700
*          END;                                                         00145800
*          ELSE BADREPLY = YES;        /*REISSUE WTOR                */ 00145900
@RF00551 OI    SWITCH2,BADREPLY                                         00146000
*    END;                                                               00146100
@DE00545 TM    SWITCH2,BADREPLY                                         00146200
         BO    @DL00545                                                 00146300
         B     @DE00415                                                 00146400
*  END;                                                                 00146500
*                                      /* RETURN TO RDENTRY.         */ 00146600
*      END;                                                             00146700
*      ELSE DO;                        /* IF I/O ERROR, GET INSTRUCT-*/ 00146800
*                                      /* IONS FROM OPERATOR.        */ 00146900
*/********************************************************************/ 00147000
*/*                                                                  */ 00147100
*/* SEGMENT NAME - RDERR                                             */ 00147200
*/*                                                                  */ 00147300
*/* DESCRIPTIVE NAME - I/O ERROR READING VATLST ENTRY                */ 00147400
*/*                                                                  */ 00147500
*/* FUNCTION -                                                       */ 00147600
*/*                                                                  */ 00147700
*/*     MOVE VATLST SUFFIX INTO MESSAGE 'IEA949A-I/O ERROR READING   */ 00147800
*/*     VATLSTNN.  REPLY YES FOR LIST OF ENTRIES THAT WILL BE        */ 00147900
*/*     PROCESSED, OR U FOR NO LIST.  IF REPLY IS 'YES', THEN        */ 00148000
*/*     EXECUTE SEGMENT THAT PUTS OUT INFORMATIONAL MESSAGE.  IF     */ 00148100
*/*     REPLY IS NOT 'YES' OR 'U', REISSUE MESSAGE IEA949A.          */ 00148200
*/*                                                                  */ 00148300
*/*     ISSUE MESSAGE 'IEA853A-REPLY CONT, END, OR RESPECIFY'.       */ 00148400
*/*     WAIT FOR REPLY.  IF REPLY IS CONT OR END, SET 'READ' EQUAL   */ 00148500
*/*     TO NO, TO INDICATE NO MORE ENTRIES SHOULD BE READ FROM THE   */ 00148600
*/*     CURRENT VATLST.                                              */ 00148700
*/*                                                                  */ 00148800
*/*     IF REPLY IS END, THEN SET 'PEND' EQUAL TO YES TO TERMINATE   */ 00148900
*/*     VATLST PROCESSING.  IF REPLY IS CONT, THEN GO ON TO PROCESS  */ 00149000
*/*     ANY OTHER VATLSTS.  IF REPLY IS A NEW LIST, MOVE NUMBER      */ 00149100
*/*     INTO NIPPANAM+6 AND SET 'READ' EQUAL TO YES.  IF REPLY IS    */ 00149200
*/*     INVALID, REISSUE MESSAGE IEA853A AND PROCESS AS ABOVE.       */ 00149300
*/*                                                                  */ 00149400
*/* ENTRY - IN-LINE SEGMENT                                          */ 00149500
*/*                                                                  */ 00149600
*/*     PURPOSE -                                                    */ 00149700
*/*                                                                  */ 00149800
*/*         ISSUE MESSAGE TO INFORM OPERATOR OF I/O ERROR AND        */ 00149900
*/*         PROCESS REPLY.                                           */ 00150000
*/*                                                                  */ 00150100
*/*     INPUT DATA -                                                 */ 00150200
*/*                                                                  */ 00150300
*/*         NIPPANAM+6 - CONTAINS VATLST SUFFIX                      */ 00150400
*/*                                                                  */ 00150500
*/* EXITS -                                                          */ 00150600
*/*                                                                  */ 00150700
*/*     CONDITION - NORMAL                                           */ 00150800
*/*                                                                  */ 00150900
*/*     OUTPUT DATA -                                                */ 00151000
*/*                                                                  */ 00151100
*/*         MESSAGE IEA949A IS ISSUED                                */ 00151200
*/*         MESSAGE IEA853A IS ISSUED                                */ 00151300
*/*         READ - SET TO OFF IF REPLY TO IEA853A IS CONT OR END     */ 00151400
*/*                SET TO ON IF REPLY IS A NEW LIST                  */ 00151500
*/*         PEND - SET TO ON IF REPLY TO IEA853A IS END              */ 00151600
*/*         NIPPANAM+6 - CONTAINS NEW LIST NUMBER FOR EXCP IF        */ 00151700
*/*                      REPLY TO IEA853A IS A NEW LIST              */ 00151800
*/*                                                                  */ 00151900
*/*     RETURN CODE - NONE                                           */ 00152000
*/*                                                                  */ 00152100
*/********************************************************************/ 00152200
*                                                                       00152300
*NN949 = SUFFIX;                       /*MOVE VATLST NUMBER          */ 00152400
@RF00538 L     R10,NVTPAREA(,R2)                                        00152500
         MVC   NN949(2),SUFFIX(R10)    /*INTO MSG                    */ 00152600
*                                                                       00152700
*                                      /*ISSUE MSG IEA949I           */ 00152800
*        IEA949I I/O ERROR READING VATLSTXX                             00152900
*                                                                       00153000
         IEAPMNIP TYPE=WTO,PARAM=IEA949I                                00153100
*                                                                       00153200
*IF MTLSTCT > 0                        /*MOUNT LIST CONTAINS         */ 00153300
*  THEN DO;                            /*SOME ENTRIES                */ 00153400
         LH    R10,MTLSTCT                                              00153500
         LTR   R10,R10                                                  00153600
         BNP   @RF00563                                                 00153700
*    BADREPLY = YES;                   /*INCORRECT FORMAT            */ 00153800
         OI    SWITCH2,BADREPLY                                         00153900
         B     @DE00566                                         04S0566 00154000
*                                                                       00154100
*    DO WHILE (BADREPLY = YES);                                         00154200
*      BADREPLY = NO;                                                   00154300
@DL00566 NI    SWITCH2,255-BADREPLY                                     00154400
*                                      /*ISSUE MSG IEA949A           */ 00154500
*                                                                       00154600
*        IEA949A REPLY YES FOR LIST OF ENTRIES THAT WILL BE             00154700
*        PROCESSED, OR U FOR NO LIST.                                   00154800
*                                                                       00154900
         IEAPMNIP TYPE=WTOR,PARAM=IEA949A                               00155000
*                                                                       00155100
*      IF WTORBUF = COMPYES            /*CHECK FOR  'YES'            */ 00155200
*        THEN DO;                      /*ISSUE INFO LIST             */ 00155300
         CLC   WTORBUF(3),KCYES                                         00155400
         BNE   @RF00569                                                 00155500
*/********************************************************************/ 00155600
*/*                                                                  */ 00155700
*/* SEGMENT NAME - INFOLIST                                          */ 00155800
*/*                                                                  */ 00155900
*/* DESCRIPTIVE NAME - INFORMATIONAL LISTING OF VOLUMES TO BE        */ 00156000
*/*                    PROCESSED                                     */ 00156100
*/*                                                                  */ 00156200
*/* FUNCTION -                                                       */ 00156300
*/*                                                                  */ 00156400
*/*     ISSUE WTO FOR HEADER MESSAGE 'IEA850I-FOLLOWING WILL         */ 00156500
*/*     BE PROCESSED.                                                */ 00156600
*/*                                                                  */ 00156700
*/*     FOR EACH ENTRY IN LIST, FILL IN MESSAGE TEXT WITH            */ 00156800
*/*     VOLUME SERIAL, DEVICE TYPE AND ATTRIBUTES.  ISSUE            */ 00156900
*/*     WTO 'SER ON UUUUUUUU CCC-CCC'.                               */ 00157000
*/*                                                                  */ 00157100
*/* ENTRY - IN-LINE SEGMENT                                          */ 00157200
*/*                                                                  */ 00157300
*/*     PURPOSE -                                                    */ 00157400
*/*                                                                  */ 00157500
*/*         LIST VOLUME ENTRIES IN MOUNT LIST BEFORE ERROR           */ 00157600
*/*         OCCURRED.                                                */ 00157700
*/*                                                                  */ 00157800
*/*     INPUT DATA -                                                 */ 00157900
*/*                                                                  */ 00158000
*/*         MNTLIST - MOUNT LIST                                     */ 00158100
*/*         MTLSTCT - NUMBER OF ENTRIES IN MOUNT LIST                */ 00158200
*/*                                                                  */ 00158300
*/* EXITS -                                                          */ 00158400
*/*                                                                  */ 00158500
*/*     CONDITION - NORMAL                                           */ 00158600
*/*                                                                  */ 00158700
*/*     OUTPUT DATA -                                                */ 00158800
*/*                                                                  */ 00158900
*/*         MESSAGE IEA850I AND SECONDARY MESSAGES ISSUED            */ 00159000
*/*                                                                  */ 00159100
*/*     RETURN CODE - NONE                                           */ 00159200
*/*                                                                  */ 00159300
*/********************************************************************/ 00159400
*                                                                       00159500
*                                      /*ISSUE HEADER MESSAGE IEA850I*/ 00159600
*        IEA850I FOLLOWING WILL BE PROCESSED                            00159700
*                                                                       00159800
         IEAPMNIP TYPE=WTO,PARAM=IEA850I                                00159900
*                                                                       00160000
*DO I = ONE TO MTLSTCT;                /*LOOP THROUGH LIST           */ 00160100
         LA    R10,1                                                    00160200
         B     @DE00572                                                 00160300
*                                                                       00160400
*  MAPAD = ADDR(MNTLIST(I));                                            00160500
@DL00572 L     R8,GETADDR                                               00160600
         MH    R10,KH18                                                 00160700
         ST    R10,@TF00001                                             00160800
         ALR   R10,R8                                                   00160900
         AL    R10,KFM18                                                00161000
         MVC   SER850(6),0(R10)                                         00161100
         LR    R10,R8                                                   00161200
         AL    R10,@TF00001                                             00161300
         AL    R10,KFM10                                                00161400
         MVC   DEV850(8),0(R10)                                         00161500
         AL    R8,@TF00001                                              00161600
         AL    R8,KFM12                                                 00161700
         CLI   0(R8),C'1'                                               00161800
         BNE   @RF00576                                                 00161900
         MVC   MT850(3),KCRSV                                           00162000
         B     @RC00576                                                 00162100
*                                                                       00162200
*    ELSE MT850 = MSGPR;               /*OTHERWISE MOVE 'P/R'        */ 00162300
@RF00576 MVC   MT850(3),KCPR                                            00162400
*  IF EUSEATTR = STR                   /*DETERMINE USE ATTR          */ 00162500
*    THEN USE850 = MSGSTR;             /*MOVE 'STR' INTO MSG         */ 00162600
@RC00576 LH    R10,I                                                    00162700
         MH    R10,KH18                                                 00162800
         L     R8,GETADDR                                               00162900
         ALR   R8,R10                                                   00163000
         AL    R8,KFM11                                                 00163100
         CLI   0(R8),C'0'                                               00163200
         BNE   @RF00579                                                 00163300
         MVC   USE850(3),KCSTR                                          00163400
         B     @RC00579                                                 00163500
*                                                                       00163600
*    ELSE IF EUSEATTR = PRIV                                            00163700
*      THEN USE850 = MSGPRV;           /*MOVE 'PRV' INTO MSG         */ 00163800
@RF00579 LH    R10,I                                                    00163900
         MH    R10,KH18                                                 00164000
         L     R8,GETADDR                                               00164100
         ALR   R8,R10                                                   00164200
         AL    R8,KFM11                                                 00164300
         CLI   0(R8),C'2'                                               00164400
         BNE   @RF00581                                                 00164500
         MVC   USE850(3),KCPRV                                          00164600
         B     @RC00579                                                 00164700
*                                                                       00164800
*      ELSE USE850 = MSGPUB;           /*MOVE 'PUB' INTO MSG         */ 00164900
@RF00581 MVC   USE850(3),KCPUB                                          00165000
@RC00579 DS    0H                                                       00165100
*                                                                       00165200
*        SER ON UUUUUUUU CCC-CCC                                        00165300
*                                                                       00165400
         IEAPMNIP TYPE=WTO,PARAM=IEA850I2                               00165500
*END;                                                                   00165600
         LH    R10,I                                                    00165700
         LA    R10,1(,R10)                                              00165800
@DE00572 STH   R10,I                                                    00165900
         CH    R10,MTLSTCT                                              00166000
         BNH   @DL00572                                                 00166100
         B     @DE00566                                                 00166200
*                                                                       00166300
*        END;                                                           00166400
*        ELSE IF WTORBUF ¬= REPLYU     /*BAD REPLY                   */ 00166500
*          & WTORBUF ¬= REPLYEOB                                        00166600
*          THEN BADREPLY = YES;        /*NOT 'YES', 'U', EOB         */ 00166700
@RF00569 CLC   WTORBUF(2),KCU                                           00166800
         BE    @DE00566                                                 00166900
         CLC   WTORBUF(2),@CC00169                                      00167000
         BE    @DE00566                                                 00167100
         OI    SWITCH2,BADREPLY                                         00167200
*    END;                                                               00167300
@DE00566 TM    SWITCH2,BADREPLY                                         00167400
         BO    @DL00566                                                 00167500
*  END;                                                                 00167600
*BADREPLY = YES;                       /*INCORRECT FORMAT IN REPLY   */ 00167700
@RF00563 OI    SWITCH2,BADREPLY                                         00167800
         B     @DE00592                                                 00167900
*                                                                       00168000
*DO WHILE (BADREPLY = YES);                                             00168100
*BADREPLY = NO;                                                         00168200
@DL00592 NI    SWITCH2,255-BADREPLY                                     00168300
*WTORBUF = BLANK;                      /*BLANK OUT REPLY AREA        */ 00168400
         MVI   WTORBUF,C' '                                             00168500
         MVC   WTORBUF+1(L'WTORBUF-1),WTORBUF                           00168600
*                                      /*ISSUE MESSSAGE IEA853A      */ 00168700
*        IEA853A REPLY CONT, END, OR RESPECIFY.                         00168800
*                                                                       00168900
         IEAPMNIP TYPE=WTOR,PARAM=IEA853A                               00169000
*                                                                       00169100
*IF WTORBUF = COMPCONT                 /*CHECK FOR REPLY OF 'CONT'   */ 00169200
*  THEN READ = NO;                     /*DON'T READ ANY MORE ENTRIES    00169300
*                                        FROM THIS VATLST            */ 00169400
         CLC   WTORBUF(4),KCCONT                                        00169500
         BNE   @RF00596                                                 00169600
         NI    SWITCH1,255-READ                                         00169700
         B     @DE00592                                                 00169800
*                                                                       00169900
*  ELSE IF WTORBUF = COMPEND           /*CHECK FOR REPLY OF 'END'    */ 00170000
*    THEN DO;                                                           00170100
@RF00596 CLC   WTORBUF(3),KCEND                                         00170200
         BNE   @RF00598                                                 00170300
*      READ = NO;                      /*DON'T READ ANY MORE ENTRIES */ 00170400
*      PEND = YES;                     /*DON'T READ ANY MORE VATLSTS */ 00170500
         OI    SWITCH1,PEND                                             00170600
         NI    SWITCH1,255-READ                                         00170700
         B     @DE00592                                                 00170800
*                                                                       00170900
*    END;                                                               00171000
*    ELSE IF WTORBUF+2 = QUOTE         /*CHECK VALIDITY OF REPLY     */ 00171100
*      THEN DO;                        /*GOOD REPLY                  */ 00171200
@RF00598 CLI   WTORBUF+2,C''''                                          00171300
         BNE   @RF00603                                                 00171400
*        SUFFIX = WTORBUF;             /*MOVE REPLY TO READ AREA     */ 00171500
         L     R10,NVTPAREA(,R2)                                        00171600
         MVC   SUFFIX(2,R10),WTORBUF                                    00171700
*        READ = YES;                   /*READ THIS VATLST            */ 00171800
         OI    SWITCH1,READ                                             00171900
         B     @DE00592                                                 00172000
*                                                                       00172100
*      END;                                                             00172200
*      ELSE DO;                        /*INCORRECT REPLY             */ 00172300
*        BADREPLY = YES;               /*REPEAT MESSAGE              */ 00172400
@RF00603 OI    SWITCH2,BADREPLY                                         00172500
*      END;                                                             00172600
*END;                                  /*RETURN TO RDENTRY           */ 00172700
@DE00592 TM    SWITCH2,BADREPLY                                         00172800
         BO    @DL00592                                                 00172900
*      END;                                                             00173000
*                                      /* RETURN TO SYSPARMS         */ 00173100
*END;                                  /* RETURN TO TOP SEGMENT      */ 00173200
*                                                                       00173300
@DE00415 TM    SWITCH1,READ                                             00173400
         BO    @DL00415                                                 00173500
*END;                                                                   00173600
@DE00400 TM    SWITCH1,PEND                                             00173700
         BZ    @DL00400                                                 00173800
*DPLOADED = YES;                       /* INIT DP SWITCH             */ 00173900
         OI    SWITCH2,DPLOADED                                         00174000
*DATAPATH = ZERO;                      /* POINTER TO DP RTN          */ 00174100
         XC    DATAPATH,DATAPATH                                        00174200
*  R0=ADDR(IEEVDEV);        /*LOAD ENTRY POINT NAME ADDRESS*/           00174300
         LA    R0,IEEVDEV                                               00174400
*  R1=0;         /*JOBLIB OR LINKLIB DCB*/                              00174500
         SLR   R1,R1                                                    00174600
*  R1=R1 '80000000'X; /*ERROR RETURN LABEL SPECIFIED*/                  00174700
         O     R1,@CF02592                                              00174800
*                                                                       00174900
         SVC   8                                                        00175000
*  IF R15 ¬= 0 THEN      /*LOAD WAS UNSUCCESSFUL*/                      00175100
         LTR   R15,R15                                                  00175200
         BNZ   ERR                                                      00175300
*    GOTO ERR;   /*BRANCH TO ERROR LOCATION*/                           00175400
*DATAPATH = R0;                        /* SAVE IN CORE ADDR          */ 00175500
         ST    R0,DATAPATH                                              00175600
*ERR:IF DATAPATH = ZERO                /* WAS VDEV LOADED?           */ 00175700
*      THEN DPLOADED = NO;             /* NO SET SWITCH OFF          */ 00175800
ERR      ICM   R10,B'1111',DATAPATH                                     00175900
         BNZ   @RF00630                                                 00176000
         NI    SWITCH2,255-DPLOADED                                     00176100
*DO;                                   /* PROC. VALID ENT            */ 00176200
*/********************************************************************/ 00176300
*/*                                                                  */ 00176400
*/* SEGMENT NAME - LISTPROC                                          */ 00176500
*/*                                                                  */ 00176600
*/* DESCRIPTIVE NAME - PROCESS COMPILED VATLST ENTRIES               */ 00176700
*/*                                                                  */ 00176800
*/* FUNCTION -                                                       */ 00176900
*/*     FOR EACH ENTRY IN THE LIST, EXECUTE THE SEGMENT 'FINDVOL' TO */ 00177000
*/*     DETERMINE IF A VOLUME IS MOUNTED WITH THAT VOLSER. IF IT IS, */ 00177100
*/*     AND IF THE ENTRY IS REAL AND THE DEVICE TYPES MATCH,         */ 00177200
*/*     OR THE ENTRY IS VIRTUAL AND THE VUA'S MATCH, THEN            */ 00177300
*/*     CALL ROUTINE 'SETSTAT' AND REMOVE THE ENTRY FROM             */ 00177400
*/*     THE LIST. IF THE DEVTYPES OR VUA'S DON'T MATCH, GO TO        */ 00177500
*/*     SEGMENT 'WRONGVOL' TO PUT OUT ERROR MESSAGES.                */ 00177600
*/*                                                                  */ 00177700
*/*     IF THE VOLUME IS NOT MOUNTED AND THE ENTRY SPECIFIES         */ 00177800
*/*     AN MSS VOLUME, EXECUTE THE SEGMENT VIRTMONT TO MOUNT         */ 00177900
*/*     IT. IF THE ENTRY IS NOT FOR AN MSS VOLUME AND IF             */ 00178000
*/*     THE MOUNT PRIORITY INDICATES THAT THE MOUNT MESSAGE IS TO BE */ 00178100
*/*     SUPPRESSED, REMOVE THE ENTRY FROM THE LIST. OTHERWISE,       */ 00178200
*/*     INCREASE THE DEVICE TYPE COUNT FOR THIS ENTRY'S DEVICE TYPE. */ 00178300
*/*                                                                  */ 00178400
*/* OPERATION -                                                      */ 00178500
*/*                                                                  */ 00178600
*/*     ENTRIES ARE REMOVED FROM THE MOUNTLIST BY COVERING           */ 00178700
*/*     THE CURRENT ENTRY WITH THE LAST ENTRY. THEN THE              */ 00178800
*/*     NUMBER OF ENTRIES IS DECREASED.                              */ 00178900
*/*                                                                  */ 00179000
*/* ENTRY - IN-LINE SEGMENT                                          */ 00179100
*/*                                                                  */ 00179200
*/*     PURPOSE - SEE FUNCTION                                       */ 00179300
*/*                                                                  */ 00179400
*/*     INPUT DATA -                                                 */ 00179500
*/*                                                                  */ 00179600
*/*         MNTLIST - COMPOSITE LIST OF VATLST ENTRIES               */ 00179700
*/*         MTLSTCT - NUMBER OF ENTRIES IN MNTLIST                   */ 00179800
*/*                                                                  */ 00179900
*/* EXITS -                                                          */ 00180000
*/*                                                                  */ 00180100
*/*     CONDITION - NORMAL                                           */ 00180200
*/*                                                                  */ 00180300
*/*     OUTPUT DATA -                                                */ 00180400
*/*                                                                  */ 00180500
*/*         MNTLIST - CONTAINS ONLY NON-MOUNTED VOLUME ENTRIES       */ 00180600
*/*                                                                  */ 00180700
*/*     CONDITION - INCONSISTENT DEVICE TYPE ON P/R VOLUME           */ 00180800
*/*                                                                  */ 00180900
*/*     OUTPUT DATA -                                                */ 00181000
*/*         MESSAGE IEA866I                                          */ 00181100
*/*         MESSAGE IEA947A                                          */ 00181200
*/*         MNTLIST - MODIFIED                                       */ 00181300
*/*         MTLSTCT - MODIFIED                                       */ 00181400
*/*                                                                  */ 00181500
*/*     CONDITION - INCONSISTENT DEVICE TYPE ON NON-P/R VOLUME       */ 00181600
*/*                                                                  */ 00181700
*/*     OUTPUT DATA -                                                */ 00181800
*/*                                                                  */ 00181900
*/*         MESSAGE IEA866I                                          */ 00182000
*/*         MESSAGE IEA948I                                          */ 00182100
*/*                                                                  */ 00182200
*/*     CONDITION - INCONSISTENT VUA FOR VIRTUAL VOLUME,             */ 00182300
*/*                 DEMOUNT FAILS.                                   */ 00182400
*/*                                                                  */ 00182500
*/*     OUTPUT DATA -                                                */ 00182600
*/*         MESSAGE IEA985I                                          */ 00182700
*/*         MESSAGE IEA866I                                          */ 00182800
*/*                                                                  */ 00182900
*/*     RETURN CODE - NONE                                           */ 00183000
*/*                                                                  */ 00183100
*/********************************************************************/ 00183200
*                                                                       00183300
*I = ONE;                                                               00183400
*                                                                       00183500
@RF00630 MVC   I(2),KH1                                                 00183600
         B     @DE00634                                                 00183700
*                                                                       00183800
*DO WHILE (I <= MTLSTCT);              /*SCAN LIST & PROCESS ENTRIES */ 00183900
*                                                                       00184000
*  MAPAD = ADDR(MNTLIST(I));           /*ADDRESS ENTRY MAPPING       */ 00184100
@DL00634 LA    R10,NIPMNT                                               00184200
         LH    R8,I                                                     00184300
         MH    R8,KH18                                                  00184400
         L     R4,GETADDR                                               00184500
         ALR   R4,R8                                                    00184600
         AL    R4,KFM18                                                 00184700
*  DO;                                 /*LOCATE UCB WITH THIS VOLSER */ 00184800
*/********************************************************************/ 00184900
*/*                                                                  */ 00185000
*/* SEGMENT NAME - FINDVOL                                           */ 00185100
*/*                                                                  */ 00185200
*/* DESCRIPTIVE NAME - FIND THE UCB CONTAINING THE VOLUME SERIAL     */ 00185300
*/*                    NUMBER                                        */ 00185400
*/*                                                                  */ 00185500
*/* FUNCTION -                                                       */ 00185600
*/*                                                                  */ 00185700
*/*     FILL IN 'NMNTVS' (IN NIP MOUNT PARAMETER AREA) WITH THE      */ 00185800
*/*     VOLUME SERIAL NUMBER OBTAINED FROM THE CURRENT VATLST ENTRY. */ 00185900
*/*     ISSUE MACRO (IEAPMNIP TYPE=MOUNT, PARAM=LABEL,OPT=(,,,US))   */ 00186000
*/*     TO OBTAIN UCB ADDRESS.  UCBPTR WILL CONTAIN THE UCB ADDRESS. */ 00186100
*/*     (IF NOT FOUND, UCBPTR WILL BE ZERO.)                         */ 00186200
*/*                                                                  */ 00186300
*/* ENTRY - IN-LINE SEGMENT                                          */ 00186400
*/*                                                                  */ 00186500
*/*     PURPOSE -                                                    */ 00186600
*/*                                                                  */ 00186700
*/*         TO OBTAIN THE ADDRESS OF THE UCB CONTAINING THE VOLUME   */ 00186800
*/*         SERIAL NUMBER IN THE CURRENT VATLST ENTRY.               */ 00186900
*/*                                                                  */ 00187000
*/*     INPUT DATA -                                                 */ 00187100
*/*                                                                  */ 00187200
*/*         CURRENT VATLST ENTRY                                     */ 00187300
*/*                                                                  */ 00187400
*/* EXITS -                                                          */ 00187500
*/*                                                                  */ 00187600
*/*     CONDITION - NORMAL                                           */ 00187700
*/*                                                                  */ 00187800
*/*     OUTPUT DATA -                                                */ 00187900
*/*                                                                  */ 00188000
*/*         UCBPTR - CONTAINS UCB ADDRESS OR ZERO                    */ 00188100
*/*                                                                  */ 00188200
*/*     RETURN CODE - NONE                                           */ 00188300
*/*                                                                  */ 00188400
*/********************************************************************/ 00188500
*                                                                       00188600
*NMNTVS = EVOLSER;                     /*MOVE VOL SER INTO PARAMETER    00188700
*                                        LIST FOR UCB FIND           */ 00188800
         MVC   NMNTVS(6,R10),0(R4)                                      00188900
*                                                                       00189000
         IEAPMNIP TYPE=MOUNT,PARAM=NIPMNT,OPT=(,,,US)                   00189100
*                                                                       00189200
*UCBPTR = R1;                          /*SAVE UCB ADDRESS            */ 00189300
         LR    R5,R1                                                    00189400
*                                      /* RETURN TO LISTPROC.        */ 00189500
*  END;                                                                 00189600
*  J = DEVENT(I);                      /*OBTAIN UNIT TYPE INDEX      */ 00189700
         LH    R10,I                                                    00189800
         MH    R10,KH18                                                 00189900
         L     R8,GETADDR                                               00190000
         BCTR  R8,0                                                     00190100
         SLR   R4,R4                                                    00190200
         IC    R4,0(R10,R8)                                             00190300
         STH   R4,J                                                     00190400
*  IF UCBPTR ¬= ZERO                   /*VOLUME IS MOUNTED           */ 00190500
*    THEN IF ((J <= NUMSUPTD) &        /*IS ENTRY FOR REAL &         */ 00190600
         LTR   R5,R5                                                    00190700
         BZ    @RF00646                                                 00190800
*            (UCBRVDEV = OFF) &        /*UCB FOR REAL &              */ 00190900
*            (UCBTYPE(J) = UCBTBYT4))   /*DEVICE TYPES MATCH?        */ 00191000
*            ((J > NUMSUPTD) &         /*OR IS DEVICE VIRTUAL        */ 00191100
*            (EDEVTYPE(2:4) = UCBNAME)) /*AND VUA'S MATCH?           */ 00191200
*      THEN DO;                        /*YES-                        */ 00191300
         C     R4,NUMSUPTD                                              00191400
         BH    @GL00013                                                 00191500
         TM    UCBTBYT2-UCB(R5),UCBRVDEV                                00191600
         BNZ   @GL00013                                                 00191700
         L     R10,UCBTYPAD                                             00191800
         BCTR  R10,0                                                    00191900
         SLR   R8,R8                                                    00192000
         IC    R8,0(R4,R10)                                             00192100
         MVC   @ZT00003+3(1),UCBTBYT4-UCB(R5)                           00192200
         C     R8,@ZT00003                                              00192300
         BE    @RT00647                                                 00192400
@GL00013 LH    R10,J                                                    00192500
         C     R10,NUMSUPTD                                             00192600
         BNH   @RF00647                                                 00192700
         LH    R10,I                                                    00192800
         MH    R10,KH18                                                 00192900
         L     R8,GETADDR                                               00193000
         ALR   R8,R10                                                   00193100
         AL    R8,KFM9                                                  00193200
         CLC   0(3,R8),UCBNAME-UCB(R5)                                  00193300
         BNE   @RF00647                                                 00193400
*        CALL SETSTAT;                 /*SET VOL ATTRIBUTES          */ 00193500
@RT00647 BAS   R14,SETSTAT                                              00193600
*        MNTLIST(I) =MNTLIST(MTLSTCT); /*REMOVE ENTRY FROM LIST      */ 00193700
         L     R10,GETADDR                                              00193800
         LA    R8,18                                                    00193900
         LR    R15,R8                                                   00194000
         MH    R15,I                                                    00194100
         ALR   R15,R10                                                  00194200
         AL    R15,KFM18                                                00194300
         LH    R14,MTLSTCT                                              00194400
         LR    R1,R8                                                    00194500
         MR    R0,R14                                                   00194600
         ALR   R10,R1                                                   00194700
         AL    R10,KFM18                                                00194800
         MVC   0(18,R15),0(R10)                                         00194900
*        MTLSTCT = MTLSTCT - ONE;      /*DECREMENT LIST COUNT        */ 00195000
         BCTR  R14,0                                                    00195100
         STH   R14,MTLSTCT                                              00195200
         B     @DE00634                                                 00195300
*                                                                       00195400
*      END;                                                             00195500
*      ELSE DO;                        /*DEVTYPES DON'T MATCH        */ 00195600
*/********************************************************************/ 00195700
*/*                                                                  */ 00195800
*/* SEGMENT NAME - WRONGVOL                                          */ 00195900
*/*                                                                  */ 00196000
*/* DESCRIPTIVE NAME - HANDLE ERROR OF VOLUME MOUNTED                */ 00196100
*/*                    ON WRONG DEVICE TYPE                          */ 00196200
*/*                                                                  */ 00196300
*/* FUNCTION -                                                       */ 00196400
*/*     ISSUE MESSAGE 'IEA866I VOLUME AAAAAA ON DDD REQUIRED         */ 00196500
*/*     ON A UUUUUUUU.'                                              */ 00196600
*/*                                                                  */ 00196700
*/*     IF THE MOUNT LIST ENTRY IS FOR A VIRTUAL VOLUME,             */ 00196800
*/*     ISSUE A DEMOUNT FOR THE VOLUME. IF THE DEMOUNT FAILS,        */ 00196900
*/*     ISSUE MESSAGE 'IEA985I UNABLE TO UNLOAD MSS VOLUME           */ 00197000
*/*     AAAAAA FROM DDD - RC=RET.'                                   */ 00197100
*/*                                                                  */ 00197200
*/*     IF THE VOLUME IS P/R, REMOVE THE ENTRY FROM THE              */ 00197300
*/*     LIST AND ISSUE MESSAGE 'IEA947A REPLY U TO                   */ 00197400
*/*     CONTINUE OR RE-IPL.' IF THE OPERATOR REPLIES 'U'             */ 00197500
*/*     VAP WILL CONTINUE PROCESSING WITHOUT THE ENTRY. IF           */ 00197600
*/*     THE VOLUME IS NOT P/R AND THE DEMOUNT, IF DONE, WAS          */ 00197700
*/*     SUCCESSFUL, UNLOAD THE VOLUME AND ISSUE MESSAGE              */ 00197800
*/*     'IEA948I DDD NOW UNLOADED.'. IF DEMOUNT NOT SUCCESS-         */ 00197900
*/*     FUL, THE VOLUME IS NOT UNLOADED.                             */ 00198000
*/*                                                                  */ 00198100
*/* ENTRY - IN-LINE SEGMENT                                          */ 00198200
*/*     PURPOSE - SEE FUNCTION                                       */ 00198300
*/*                                                                  */ 00198400
*/*     INPUT DATA -                                                 */ 00198500
*/*         MOUNT LIST ENTRY                                         */ 00198600
*/*         UCB ADDRESS                                              */ 00198700
*/*                                                                  */ 00198800
*/* EXITS -                                                          */ 00198900
*/*                                                                  */ 00199000
*/*    CONDITION - NORMAL, VOLUME IS NOT P/R                         */ 00199100
*/*                                                                  */ 00199200
*/*    OUTPUT DATA -                                                 */ 00199300
*/*                                                                  */ 00199400
*/*        MESSAGE IEA866I                                           */ 00199500
*/*        MESSAGE IEA948I                                           */ 00199600
*/*                                                                  */ 00199700
*/*    CONDITION - DEMOUNT FAILS FOR VIRTUAL VOLUME                  */ 00199800
*/*                                                                  */ 00199900
*/*    OUTPUT DATA -                                                 */ 00200000
*/*        MESSAGE IEA866I                                           */ 00200100
*/*        MESSAGE IEA985I                                           */ 00200200
*/*                                                                  */ 00200300
*/*    CONDITION - VOLUME IS P/R                                     */ 00200400
*/*                                                                  */ 00200500
*/*    OUTPUT DATA -                                                 */ 00200600
*/*                                                                  */ 00200700
*/*        MESSAGE IEA866I                                           */ 00200800
*/*        MESSAGE IEA947A                                           */ 00200900
*/*                                                                  */ 00201000
*/*    RETURN CODE - NONE                                            */ 00201100
*/*                                                                  */ 00201200
*/********************************************************************/ 00201300
*MSGSW = OFF;                          /*INIT FAILURE SWITCH         */ 00201400
@RF00647 NI    SWITCH3,255-MSGSW                                        00201500
*SER866 = MVOLSER(I);                  /*MOVE VOLSER INTO MSG        */ 00201600
         L     R10,GETADDR                                              00201700
         LH    R8,I                                                     00201800
         MH    R8,KH18                                                  00201900
         ST    R8,@TF00001                                              00202000
         ALR   R8,R10                                                   00202100
         AL    R8,KFM18                                                 00202200
         MVC   SER866(6),0(R8)                                          00202300
*DEV866 = UCBNAME;                     /*MOVE UNIT ADDR TO MSG       */ 00202400
         MVC   DEV866(3),UCBNAME-UCB(R5)                                00202500
*DT866 = MDEVTYPE(I);                  /*MOVE DEVTYPE TO MSG         */ 00202600
         AL    R10,@TF00001                                             00202700
         AL    R10,KFM10                                                00202800
         MVC   DT866(8),0(R10)                                          00202900
*IF UCBRVDEV = ON &                    /*3330V DEVICE?               */ 00203000
*   UCBTYP(3:4) = COMP3330                                              00203100
*  THEN V866 = VIRT;                   /*YES - MOVE IN V             */ 00203200
         TM    UCBTBYT2-UCB(R5),UCBRVDEV                                00203300
         BNO   @RF00658                                                 00203400
         CLC   UCBTBYT3-UCB(2,R5),DEV3330                               00203500
         BNE   @RF00658                                                 00203600
         MVI   V866,C'V'                                                00203700
         B     @RC00658                                                 00203800
*                                                                       00203900
*  ELSE V866 = BLANK;                  /*NO - MOVE IN BLANK          */ 00204000
@RF00658 MVI   V866,C' '                                                00204100
@RC00658 DS    0H                                                       00204200
*                                                                       00204300
         IEAPMNIP TYPE=WTO,PARAM=IEA866I                                00204400
*                                                                       00204500
*/* IEA866I VOLUME AAAAAA  ON DDD REQUIRED ON A UUUUUUU.             */ 00204600
*IF UCBRVDEV = ON &                    /*3330V DEVICE?               */ 00204700
*  UCBTYP(3:4) = COMP3330              /*                            */ 00204800
*  THEN DO;                            /*YES -                       */ 00204900
*                                                                       00205000
         TM    UCBTBYT2-UCB(R5),UCBRVDEV                                00205100
         BNO   @RF00662                                                 00205200
         CLC   UCBTBYT3-UCB(2,R5),DEV3330                               00205300
         BNE   @RF00662                                                 00205400
*     R1=ADDR(DMLEN);/*R1 PTR TO LIST             */                    00205500
         LA    R1,DMLEN                                                 00205600
*     DCL 1 ICBDMLST  STATIC LOCAL, /*DEMOUNT REQUEST BLOCK         */  00205700
*         2 DMLEN  FIXED(31)INIT('1C'X),/*LENGTH OF DEMOUNT BLOCK       00205800
*         2 DMOPCD FIXED(8)INIT('06'X),/*DEMOUNT OPCODE         */      00205900
*         2  DMNTRES1  CHAR(1)INIT('00'X),/*INIT RESERVED AREA TO ZERO  00206000
*         2  DMNTFLAG BIT(16)INIT('0000000000000000'B), /*FLAGS AREA    00206100
*         3  DMBITRE1 BIT(1), /*ONE RESERVED BIT         */             00206200
*         3  DMDELRSP BIT(1), /*DEMOUNT DELAYED RESPONSE ATTRIBUTE      00206300
*         3  DMVUAVAL BIT(1), /*DEMOUNT VUA VALID ATTRIBUTE         */  00206400
*         3  DMBITRES BIT(13), /*THIRTEEN RESERVED BITS         */      00206500
*         2  DMVOL CHAR(6) INIT(''B), /*INIT VOLID TO ZERO         */   00206600
*         2  DMNTASID  CHAR(2)INIT(''B),/*INIT ASID AREA TO ZERO        00206700
*         2  DMNTECB  FIXED(31)INIT(0), /*DEMOUNT EVENT CONTROL BLOCK   00206800
*         2  DMHOST CHAR(5) INIT(''B),/*INIT HOSTID AREA          */    00206900
*         2  DMNTRES2  CHAR(1)INIT(''B),/*INIT RESERVED AREA TO ZERO    00207000
*         2  DMNTVUA   FIXED(15)INIT(0); /*VIRTUAL UNIT ADDRESS         00207100
*     DMVOL=(UCBVOLI); /*VALUE OF VOLID         */                      00207200
         MVC   DMVOL(6),UCBVOLI-UCB(R5)                                 00207300
*     DMNTVUA=(UCBCHAN); /*FILL VALUE OF VUA         */                 00207400
         MVC   DMNTVUA(2),UCBCHAN-UCB(R5)                               00207500
*     DMVUAVAL='1'B;/* OR ON THE VUA VALID ATTRIBUTE FLAG         */    00207600
         OI    DMVUAVAL,B'00100000'                                     00207700
*                                                                       00207800
         SVC   126                                                      00207900
*                                                  /* VUA FOR DEMOUNT   00208000
*    IF R15 ¬= ZERO                    /*WAS DEMOUNT SUCCESS         */ 00208100
*      THEN DO;                        /*NO- ISSUE MESSAGE           */ 00208200
         LTR   R15,R15                                                  00208300
         BZ    @RF00662                                                 00208400
*        MSGSW = ON;                   /*INDICATE FAILURE            */ 00208500
         OI    SWITCH3,MSGSW                                            00208600
*        RSNCDE = R0;                  /*MOVE REASON CODE            */ 00208700
         ST    R0,RSNCDE                                                00208800
*                                      /*UNPK REASON CODE            */ 00208900
         UNPK  UNPKAR(5),RSNAREA+2(3)                                   00209000
*        TR (UNPKAR(1:4),TRANSTAB);    /*TRANSLATE CODE              */ 00209100
         LA    R10,HEXTRAN                                              00209200
         AL    R10,KFM240                                               00209300
         TR    UNPKAR(4),0(R10)                                         00209400
*        VOL985 = UCBVOLI;             /*PUT VOLSER IN MSG           */ 00209500
         MVC   VOL985(6),UCBVOLI-UCB(R5)                                00209600
*        DEV985 = UCBNAME;             /*PUT VUA IN MSG              */ 00209700
         MVC   DEV985(3),UCBNAME-UCB(R5)                                00209800
*        RET985 = UNPKAR(2:4);         /*INSERT REASON CODE          */ 00209900
         MVC   RET985(3),UNPKAR+1                                       00210000
*        /*IEA985I UNABLE TO UNLOAD VIRTUAL VOLUME AAAAAA            */ 00210100
*        /*FROM VXXX - RC=RET                                        */ 00210200
*                                                                       00210300
         IEAPMNIP TYPE=WTO,PARAM=IEA985I                                00210400
*                                                                       00210500
*        MNTLIST(I) = MNTLIST(MTLSTCT);/*REMOVE MNTLIST ENTRY        */ 00210600
         L     R10,GETADDR                                              00210700
         LA    R8,18                                                    00210800
         LR    R4,R8                                                    00210900
         MH    R4,I                                                     00211000
         ALR   R4,R10                                                   00211100
         AL    R4,KFM18                                                 00211200
         LH    R15,MTLSTCT                                              00211300
         LR    R1,R8                                                    00211400
         MR    R0,R15                                                   00211500
         ALR   R10,R1                                                   00211600
         AL    R10,KFM18                                                00211700
         MVC   0(18,R4),0(R10)                                          00211800
*        MTLSTCT = MTLSTCT - ONE;      /*DECREASE LIST COUNT         */ 00211900
         BCTR  R15,0                                                    00212000
         STH   R15,MTLSTCT                                              00212100
*      END;                                                             00212200
*  END;                                                                 00212300
*IF UCBPRES = YES                      /*IF  P/R VOLUME              */ 00212400
*  THEN DO;                                                             00212500
@RF00662 TM    UCBSTAT-UCB(R5),UCBPRES                                  00212600
         BNO   @RF00690                                                 00212700
*    LOOPSW = NO;                      /*INIT LOOP CONTROL           */ 00212800
         NI    SWITCH3,255-LOOPSW                                       00212900
*    MNTLIST(I) =MNTLIST(MTLSTCT);     /*REMOVE ENT FROM LIST        */ 00213000
         L     R10,GETADDR                                              00213100
         LA    R8,18                                                    00213200
         LR    R15,R8                                                   00213300
         MH    R15,I                                                    00213400
         ALR   R15,R10                                                  00213500
         AL    R15,KFM18                                                00213600
         LH    R14,MTLSTCT                                              00213700
         LR    R1,R8                                                    00213800
         MR    R0,R14                                                   00213900
         ALR   R10,R1                                                   00214000
         AL    R10,KFM18                                                00214100
         MVC   0(18,R15),0(R10)                                         00214200
*    MTLSTCT = MTLSTCT - ONE;          /*DECREMENT LIST COUNT        */ 00214300
         BCTR  R14,0                                                    00214400
         STH   R14,MTLSTCT                                              00214500
         B     @DE00695                                                 00214600
*                                                                       00214700
*    DO WHILE (LOOPSW = NO);                                            00214800
@DL00695 DS    0H                                                       00214900
*      /* IEA947A REPLY U TO CONTINUE OR RE-IPL.                     */ 00215000
*                                                                       00215100
         IEAPMNIP TYPE=WTOR,PARAM=IEA947A                               00215200
*                                                                       00215300
*      IF WTORBUF = REPLYU             /*CHK FOR VALID REPLY         */ 00215400
*           WTORBUF = REPLYEOB         /*OF U OR EOB                 */ 00215500
*        THEN LOOPSW = YES;            /*VALID REPLY RECEIVED        */ 00215600
         CLC   WTORBUF(2),KCU                                           00215700
         BE    @RT00697                                                 00215800
         CLC   WTORBUF(2),@CC00169                                      00215900
         BNE   @DE00695                                                 00216000
@RT00697 OI    SWITCH3,LOOPSW                                           00216100
*    END;                                                               00216200
@DE00695 TM    SWITCH3,LOOPSW                                           00216300
         BZ    @DL00695                                                 00216400
         B     @DE00634                                                 00216500
*                                                                       00216600
*  END;                                                                 00216700
*  ELSE IF MSGSW = OFF                 /*IF NOT SYSTEM P/R VOLUME, AND  00216800
*                                      DEMOUNT OK OR NOT DONE        */ 00216900
*    THEN DO;                                                           00217000
@RF00690 TM    SWITCH3,MSGSW                                            00217100
         BNZ   @RF00701                                                 00217200
*      UCBVOLI = ZEROVOLI;             /*ZERO THE VOLSER             */ 00217300
         MVC   UCBVOLI-UCB(,R5),ZEROVOLI                                00217400
*      UCBVTOC = ZEROVTOC;             /*ZERO VTOC TTR               */ 00217500
         MVC   UCBVTOC-UCB(,R5),ZEROVTOC                                00217600
*      UCBNOTRD = YES;                 /*UNLOAD THE VOLUME           */ 00217700
         OI    UCBFLA-UCB(R5),UCBNOTRD                                  00217800
*      IF UCBRVDEV = ON &              /*3330V DEVICE?               */ 00217900
*         UCBTYP(3:4) = COMP3330       /*                            */ 00218000
*        THEN V948 = VIRT;             /*YES - MOVE IN V             */ 00218100
         TM    UCBTBYT2-UCB(R5),UCBRVDEV                                00218200
         BNO   @RF00706                                                 00218300
         CLC   UCBTBYT3-UCB(2,R5),DEV3330                               00218400
         BNE   @RF00706                                                 00218500
         MVI   V948,C'V'                                                00218600
         B     @RC00706                                                 00218700
*                                                                       00218800
*        ELSE V948 = BLANK;            /*NO - MOVE IN BLANK          */ 00218900
@RF00706 MVI   V948,C' '                                                00219000
*      DEV948 = UCBNAME;               /*MOVE DEVICE ADDR            */ 00219100
@RC00706 MVC   DEV948(3),UCBNAME-UCB(R5)                                00219200
*      /* IEA948I VXXX NOW UNLOADED.                                 */ 00219300
*                                                                       00219400
         IEAPMNIP TYPE=WTO,PARAM=IEA948I                                00219500
*                                                                       00219600
@RF00701 B     @DE00634                                                 00219700
*                                                                       00219800
*    END;                                                               00219900
*    ELSE;                             /*VOL NOT UNLOADED            */ 00220000
*      END;                            /*                            */ 00220100
*    ELSE IF J > NUMSUPTD              /*UNMOUNTED MSS VOL?          */ 00220200
*      THEN DO;                        /*YES -                       */ 00220300
@RF00646 LH    R10,J                                                    00220400
         C     R10,NUMSUPTD                                             00220500
         BNH   @RF00714                                                 00220600
*/********************************************************************/ 00220700
*/*                                                                  */ 00220800
*/* SEGMENT NAME - VIRTMONT                                          */ 00220900
*/*                                                                  */ 00221000
*/* DESCRIPTIVE NAME - MOUNT MSS VOLUMES                             */ 00221100
*/*                                                                  */ 00221200
*/* FUNCTION -                                                       */ 00221300
*/*     LOCATE THE UCB SPECIFIED IN THE MOUNT LIST ENTRY. IF         */ 00221400
*/*     THERE IS A VOLUME ALREADY MOUNTED ON THE DEVICE,             */ 00221500
*/*     ISSUE THE DEMOUNT MACRO FOR THE DEVICE.  IF THE DE-          */ 00221600
*/*     MOUNT FAILS, ISSUE MESSAGE 'IEA986I MSS VOLUME AAAAAA        */ 00221700
*/*     REQUIRED ON VXXX. IEA985I UNABLE TO UNLOAD MSS               */ 00221800
*/*     VOLUME BBBBBB FROM VXXX - RC=RET.'                           */ 00221900
*/*                                                                  */ 00222000
*/*     IF THERE IS NO VOLUME ALREADY MOUNTED ON THE DEVICE,         */ 00222100
*/*     OR IF THE DEMOUNT WAS SUCCESSFUL, THEN ISSUE THE             */ 00222200
*/*     MOUNT MACRO FOR THE VOLUME AND VUA SPECIFIED IN THE          */ 00222300
*/*     ENTRY. IF THE MOUNT FAILS, THEN ISSUE MESSAGE                */ 00222400
*/*     'IEA987I UNABLE TO MOUNT MSS VOLUME AAAAAA ON VXXX -         */ 00222500
*/*     RC=RET.'  IF NO PATHS ARE AVAILABLE TO THE DEVICE            */ 00222600
*/*     OR IF THE DEVICE IS NOT OPERATIONAL THEN ISSUE               */ 00222700
*/*     MESSAGE 'IEA409I UNABLE TO MOUNT MSS VOLUME                  */ 00222800
*/*     AAAAAA ON VXXX, DEVICE NOT ACCESSIBLE'. IF THE MOUNT         */ 00222900
*/*     WAS SUCCESSFUL, THEN GO TO SEGMENT VIRTREAD TO               */ 00223000
*/*     READ THE VOLUME LABEL TO VERIFY THE VOLSER AND               */ 00223100
*/*     OBTAIN THE VTOC TTR.                                         */ 00223200
*/*                                                                  */ 00223300
*/*     REMOVE THE PROCESSED ENTRY FROM THE MOUNT LIST.              */ 00223400
*/*                                                                  */ 00223500
*/* ENTRY - IN-LINE SEGMENT                                          */ 00223600
*/*                                                                  */ 00223700
*/*     PURPOSE - SEE FUNCTION                                       */ 00223800
*/*                                                                  */ 00223900
*/*     INPUT DATA -                                                 */ 00224000
*/*                                                                  */ 00224100
*/*         MOUNT LIST ENTRY                                         */ 00224200
*/*                                                                  */ 00224300
*/* EXITS -                                                          */ 00224400
*/*     CONDITION - NORMAL - NO ERRORS MOUNTING VOLUME               */ 00224500
*/*                                                                  */ 00224600
*/*     OUTPUT DATA -                                                */ 00224700
*/*         MNTLIST - MSS VOLUME ENTRY REMOVED                       */ 00224800
*/*         UCB - MODIFIED                                           */ 00224900
*/*                                                                  */ 00225000
*/*     CONDITION - UNABLE TO DEMOUNT ALREADY MOUNTED                */ 00225100
*/*                 MSS VOLUME.                                      */ 00225200
*/*                                                                  */ 00225300
*/*     OUTPUT DATA -                                                */ 00225400
*/*                                                                  */ 00225500
*/*         MNTLIST - MSS VOLUME ENTRY REMOVED                       */ 00225600
*/*         MESSAGE IEA986I                                          */ 00225700
*/*         MESSAGE IEA985I                                          */ 00225800
*/*                                                                  */ 00225900
*/*     CONDITION - UNABLE TO MOUNT MSS VOLUME                       */ 00226000
*/*                                                                  */ 00226100
*/*     OUTPUT DATA -                                                */ 00226200
*/*                                                                  */ 00226300
*/*         MNTLIST - MSS VOLUME ENTRY REMOVED                       */ 00226400
*/*         MESSAGE IEA987I                                          */ 00226500
*/*         MESSAGE IEA409I                                          */ 00226600
*/*                                                                  */ 00226700
*/*     RETURN CODE - NONE                                           */ 00226800
*/*                                                                  */ 00226900
*/********************************************************************/ 00227000
*FAILSW = OFF;                         /*INIT DEMOUNT FAIL SW        */ 00227100
         NI    SWITCH3,255-FAILSW                                       00227200
*MSSVOL = MVOLSER(I);                  /*SAVE VOLSER                 */ 00227300
         L     R10,GETADDR                                              00227400
         LH    R8,I                                                     00227500
         MH    R8,KH18                                                  00227600
         ST    R8,@TF00001                                              00227700
         ALR   R8,R10                                                   00227800
         AL    R8,KFM18                                                 00227900
         MVC   MSSVOL,0(R8)                                             00228000
*FINDDEV = MDEVTYPE(I,2:4);            /*MOVE VUA TO PARM            */ 00228100
         AL    R10,@TF00001                                             00228200
         AL    R10,KFM9                                                 00228300
         MVC   FINDDEV(3),0(R10)                                        00228400
*R1 = FINDADDR;                        /*SET UP PARM                 */ 00228500
         L     R1,FINDADDR                                              00228600
*                                                                       00228700
         IEAPMNIP TYPE=UCBFN,PARAM=RPARM                                00228800
*                                                                       00228900
*UCBPTR = R1;                          /*POINT TO UCB                */ 00229000
*IF UCBVOLI ¬= ZEROVOLI                /*IS THERE A VOLUME ALREADY      00229100
*                                        MOUNTED ON THAT DEV?        */ 00229200
*  THEN DO;                            /*YES -                       */ 00229300
         LR    R5,R1                                                    00229400
         CLC   UCBVOLI-UCB(,R5),ZEROVOLI                                00229500
         BE    @RF00724                                                 00229600
*     R1=ADDR(DMLEN);/*PTR TO REQ BLK             */                    00229700
         LA    R1,DMLEN                                                 00229800
*     DMVOL=(UCBVOLI); /*VALUE OF VOLID         */                      00229900
         MVC   DMVOL(6),UCBVOLI-UCB(R5)                                 00230000
*     DMNTVUA=(UCBCHAN); /*FILL VALUE OF VUA         */                 00230100
         MVC   DMNTVUA(2),UCBCHAN-UCB(R5)                               00230200
*     DMVUAVAL='1'B;/* OR ON THE VUA VALID ATTRIBUTE FLAG         */    00230300
         OI    DMVUAVAL,B'00100000'                                     00230400
*     SVC  (126);/*INVOKE THE SSC SVC          */                       00230500
         SVC   126                                                      00230600
*    IF R15 ¬= ZERO                    /*RETURN CODE OK?             */ 00230700
*      THEN DO;                        /*NO -                        */ 00230800
         LTR   R15,R15                                                  00230900
         BZ    @RF00734                                                 00231000
*        FAILSW = ON;                  /*INDICATE FAILURE            */ 00231100
         OI    SWITCH3,FAILSW                                           00231200
*        RSNCDE = R0;                  /*MOVE REASON CODE            */ 00231300
         ST    R0,RSNCDE                                                00231400
         UNPK  UNPKAR(5),RSNAREA+2(3)                                   00231500
*        TR (UNPKAR(1:4),TRANSTAB);                                     00231600
         LA    R10,HEXTRAN                                              00231700
         AL    R10,KFM240                                               00231800
         TR    UNPKAR(4),0(R10)                                         00231900
*        VOL986 = MSSVOL;              /*MOVE REQUESTED VOLSER          00232000
*                                        INTO IEA986I                */ 00232100
         MVC   VOL986(6),MSSVOL                                         00232200
*        VOL985 = UCBVOLI;             /*MOVE VOLSER FOUND ON DEVICE    00232300
*                                        INTO IEA985I                */ 00232400
         MVC   VOL985(6),UCBVOLI-UCB(R5)                                00232500
*        DEV986 = UCBNAME;             /*MOVE VUA TO MSGS            */ 00232600
         MVC   DEV986(3),UCBNAME-UCB(R5)                                00232700
*        DEV985 = UCBNAME;                                              00232800
         MVC   DEV985(3),UCBNAME-UCB(R5)                                00232900
*        RET985 = UNPKAR(2:4);         /*MOVE RETURN CODE            */ 00233000
         MVC   RET985(3),UNPKAR+1                                       00233100
*        /*IEA986I MSS VOLUME AAAAAA REQUIRED ON VXXX.               */ 00233200
*        /*IEA985I UNABLE TO UNLOAD VIRTUAL VOLUME BBBBBB            */ 00233300
*        /*FROM VXXX - RC=RET.                                       */ 00233400
*                                      /*ISSUE IEA986I +985I         */ 00233500
         IEAPMNIP TYPE=WTO,PARAM=IEA986I                                00233600
         IEAPMNIP TYPE=WTO,PARAM=IEA985I                                00233700
*                                                                       00233800
         B     @RF00724                                                 00233900
*                                                                       00234000
*      END;                                                             00234100
*      ELSE DO;                        /*DEMOUNT SUCCESSFUL-         */ 00234200
*        UCBVOLI = ZEROVOLI;           /*UNLOAD THE VOLUME-          */ 00234300
@RF00734 MVC   UCBVOLI-UCB(,R5),ZEROVOLI                                00234400
*        UCBVTOC = ZEROVTOC;           /*ZERO VOLSER & VTOC          */ 00234500
         MVC   UCBVTOC-UCB(,R5),ZEROVTOC                                00234600
*        UCBNOTRD = YES;               /*MAKE NOT READY              */ 00234700
         OI    UCBFLA-UCB(R5),UCBNOTRD                                  00234800
*      END;                                                             00234900
*  END;                                                                 00235000
*IF FAILSW = OFF                       /*NO ERRORS ON DEMNT?         */ 00235100
*  THEN DO;                            /*RIGHT -                     */ 00235200
@RF00724 TM    SWITCH3,FAILSW                                           00235300
         BNZ   @RF00754                                                 00235400
*/********************************************************************/ 00235500
*/*                                                                  */ 00235600
*/* SEGMENT NAME - CKPATH                                            */ 00235700
*/*                                                                  */ 00235800
*/* DESCRIPTIVE NAME - CHECK MSS DATA PATHS                          */ 00235900
*/*                                                                  */ 00236000
*/* FUNCTION                                                         */ 00236100
*/*                                                                  */ 00236200
*/*     MSS VATLST ENTRIES ARE CHECKED TO DETERMINE WHETHER          */ 00236300
*/*     A PATH EXISTS TO THE DEVICE OR NOT. THIS IS DONE TO          */ 00236400
*/*     DETERMINE WHETHER THE MSS MOUNT SVC SHOULD BE ISSUED         */ 00236500
*/*     OR NOT. A MOUNT CAN BE ISSUED UNDER THE FOLLOWING            */ 00236600
*/*     CONDITIONS:                                                  */ 00236700
*/*       . THE UCB IS ONLINE                                        */ 00236800
*/*       . THE UCB IS OFFLINE, BUT THE DATA PATH ROUTINE            */ 00236900
*/*         COULD BE LOADED AND DETERMINED THAT A PATH IS            */ 00237000
*/*         AVAILABLE.                                               */ 00237100
*/*                                                                  */ 00237200
*/* ENTRY - IN-LINE SEGMENT                                          */ 00237300
*/*                                                                  */ 00237400
*/*     PURPOSE - SEE FUNCTION                                       */ 00237500
*/*                                                                  */ 00237600
*/*     INPUT DATA                                                   */ 00237700
*/*                                                                  */ 00237800
*/*         THE UCB ADDRESS FOR THE VATLST ENTRY                     */ 00237900
*/*                                                                  */ 00238000
*/* EXITS                                                            */ 00238100
*/*                                                                  */ 00238200
*/*       CONDITION - IT IS DETERMINED WHETHER A PATH IS             */ 00238300
*/*          IS AVAILABLE TO THE DEVICE.                             */ 00238400
*/*                                                                  */ 00238500
*/*       OUTPUT DATA                                                */ 00238600
*/*                                                                  */ 00238700
*/*          MSSMNT - IF 1, IT IS OK TO ISSUE THE MOUNT              */ 00238800
*/*                   IF 0, DO NOT ISSUE THE MOUNT                   */ 00238900
*/*                                                                  */ 00239000
*/*       RETURN CODE - NONE                                         */ 00239100
*/*                                                                  */ 00239200
*/********************************************************************/ 00239300
*IF UCBONLI = ON                       /*PATH OK IF ONLINE           */ 00239400
*  THEN MSSMNT = ON;                   /*OK TO MOUNT UNIT            */ 00239500
         TM    UCBSTAT-UCB(R5),UCBONLI                                  00239600
         BNO   @RF00756                                                 00239700
         OI    SWITCH2,MSSMNT                                           00239800
         B     @RC00756                                                 00239900
*                                                                       00240000
*ELSE                                  /*VERIFY PATH                 */ 00240100
*  IF DPLOADED = YES                   /*VDEV LOADED                 */ 00240200
*    THEN DO;                          /*YES, CHECK PATHS            */ 00240300
@RF00756 TM    SWITCH2,DPLOADED                                         00240400
         BNO   @RF00758                                                 00240500
*       DPPLIST = ADDR(DPPARM);        /*SET PLIST                   */ 00240600
         LA    R10,DPPARM                                               00240700
         ST    R10,DPPLIST                                              00240800
*       R1 = ADDR(DPPLIST);            /*SET R1 TO PLIST ADDR        */ 00240900
         LA    R1,DPPLIST                                               00241000
         ST    R5,DPPARM                                                00241100
*       DPUCB = UCBPTR;                /*SET UCB PTR IN PLIST        */ 00241200
*       R15 = DATAPATH;                /*SET ADDR OF VDEV            */ 00241300
         L     R15,DATAPATH                                             00241400
         BASR  R14,R15                                                  00241500
*       IF R15 = ZERO                  /*PATH OK OR                  */ 00241600
*          R15 = TWENTY                /*ALREADY VALIDATED           */ 00241700
*         THEN MSSMNT = ON;            /*OK TO MOUNT                 */ 00241800
         LTR   R15,R15                                                  00241900
         BZ    @RT00767                                                 00242000
         CH    R15,KH20                                                 00242100
         BNE   @RF00767                                                 00242200
@RT00767 OI    SWITCH2,MSSMNT                                           00242300
         B     @RC00756                                                 00242400
*                                                                       00242500
*       ELSE MSSMNT = OFF;             /*NO PATH AVAILABLE           */ 00242600
@RF00767 NI    SWITCH2,255-MSSMNT                                       00242700
         B     @RC00756                                                 00242800
*                                                                       00242900
*    END;                              /*END CHECKING PATHS          */ 00243000
*  ELSE MSSMNT = OFF;                  /*VDEV NOT LOADED, CANNOT TELL   00243100
*                                        WHETHER PATH AVAILABLE, DO     00243200
*                                        NOT MOUNT                   */ 00243300
@RF00758 NI    SWITCH2,255-MSSMNT                                       00243400
*    IF MSSMNT = ON THEN DO;           /*OK TO ISSUE MOUNT?          */ 00243500
@RC00756 TM    SWITCH2,MSSMNT                                           00243600
         BNO   @RF00772                                                 00243700
*       R1=ADDR(MDLEN);/*R1 PTR TO REQBLK             */                00243800
         LA    R1,MDLEN                                                 00243900
*       MDVOL=(MSSVOL);/*VALUE OF VOLID         */                      00244000
         MVC   MDVOL(6),MSSVOL                                          00244100
*       MDVUA=(UCBCHAN); /*VALUE OF VUA            */                   00244200
         MVC   MDVUA(2),UCBCHAN-UCB(R5)                                 00244300
*                                      /*MOUNT REQUESTED MSS VOLUME  */ 00244400
*       SVC  (126);/*INVOKE THE SSC SVC          */                     00244500
         SVC   126                                                      00244600
*      IF R15 ¬= ZERO                  /*CHECK RETURN CODE           */ 00244700
*        THEN DO;                      /*FAILURE -                   */ 00244800
         LTR   R15,R15                                                  00244900
         BZ    @RF00782                                                 00245000
*          RSNCDE = R0;                /*MOVE REASON CODE            */ 00245100
         ST    R0,RSNCDE                                                00245200
*          UNPK (UNPKAR,RSNAREA(3:5)); /*CONVERT REASON CODE         */ 00245300
         UNPK  UNPKAR(5),RSNAREA+2(3)                                   00245400
*          TR (UNPKAR(1:4),TRANSTAB);                                   00245500
         LA    R10,HEXTRAN                                              00245600
         AL    R10,KFM240                                               00245700
         TR    UNPKAR(4),0(R10)                                         00245800
*          VOL987 = MSSVOL;            /*MOVE VOLSER TO MSG          */ 00245900
         MVC   VOL987(6),MSSVOL                                         00246000
*          DEV987 = FINDDEV;           /*MOVE VUA TO MSG             */ 00246100
         MVC   DEV987(3),FINDDEV                                        00246200
*          RET987 = UNPKAR(2:4);       /*MOVE RETURN CODE            */ 00246300
         MVC   RET987(3),UNPKAR+1                                       00246400
*          /*IEA987I UNABLE TO MOUNT MSS VOLUME AAAAAA ON            */ 00246500
*          /*DDD - RC=RET                                            */ 00246600
*                                      /*ISSUE IEA987I               */ 00246700
         IEAPMNIP TYPE=WTO,PARAM=IEA987I                                00246800
         B     @RF00754                                                 00246900
*                                                                       00247000
*        END;                                                           00247100
*        ELSE DO;                      /*MOUNT SUCCESSFUL            */ 00247200
*/********************************************************************/ 00247300
*/*                                                                  */ 00247400
*/* SEGMENT NAME - VIRTREAD                                          */ 00247500
*/*                                                                  */ 00247600
*/* DESCRIPTIVE NAME - READ LABEL OF MSS VOLUME MOUNTED              */ 00247700
*/*                                                                  */ 00247800
*/* FUNCTION -                                                       */ 00247900
*/*                                                                  */ 00248000
*/*     USE SUBROUTINE EXCPSETP TO INITIALIZE CONTROL BLOCKS         */ 00248100
*/*     FOR EXCP. ISSUE EXCP TO READ LABEL. IF THERE WAS AN          */ 00248200
*/*     ERROR IN THE EXCP OR THE LABEL IS NOT STANDARD OR            */ 00248300
*/*     THE LABEL DOES NOT CONTAIN THE SAME VOLSER AS IN THE         */ 00248400
*/*     MOUNT LIST ENTRY, THEN ISSUE MESSAGE 'IEA854I ERROR          */ 00248500
*/*     READING VOLUME LABEL.' IF THE ERROR WAS DUE TO               */ 00248600
*/*     DEVICE FAILURE, ISSUE NIP SENSE TO PUT SENSE BYTES           */ 00248700
*/*     OUT TO CONSOLE. DEMOUNT THE VOLUME. IF THE DEMOUNT           */ 00248800
*/*     FAILS, ISSUE MESSAGE 'IEA985I UNABLE TO UNLOAD               */ 00248900
*/*     VOLUME AAAAAA FROM VXXX - RC=RET.' IF THE DEMOUNT            */ 00249000
*/*     WAS SUCCESSFUL, UNLOAD THE VOLUME AND ISSUE MESSAGE          */ 00249100
*/*     'IEA948I VXXX NOW UNLOADED.'                                 */ 00249200
*/*                                                                  */ 00249300
*/*     IF THERE WAS NO ERROR VERIFYING THE LABEL THEN CON-          */ 00249400
*/*     VERT THE VTOC TTR, MOVE THE TTR AND THE VOLSER               */ 00249500
*/*     INTO THE UCB, AND BRING THE DEVICE ONLINE. CALL              */ 00249600
*/*     SETSTAT TO SET THE VOLUME ATTRIBUTES.                        */ 00249700
*/*                                                                  */ 00249800
*/* ENTRY - IN-LINE SEGMENT                                          */ 00249900
*/*                                                                  */ 00250000
*/*     PURPOSE - SEE FUNCTION                                       */ 00250100
*/*                                                                  */ 00250200
*/*     INPUT DATA -                                                 */ 00250300
*/*                                                                  */ 00250400
*/*         UCB                                                      */ 00250500
*/*         MOUNT LIST ENTRY                                         */ 00250600
*/*                                                                  */ 00250700
*/* EXITS -                                                          */ 00250800
*/*                                                                  */ 00250900
*/*     CONDITION - NORMAL - VOLUME LABEL READ + VERIFIED            */ 00251000
*/*                                                                  */ 00251100
*/*     OUTPUT DATA -                                                */ 00251200
*/*                                                                  */ 00251300
*/*         UCB - MODIFIED, VOLUME MOUNTED, ATTRIBUTES SET           */ 00251400
*/*                                                                  */ 00251500
*/*     CONDITION - VERIFY LABEL FAILS, VOLUME SUCCESSFULLY          */ 00251600
*/*                 DEMOUNTED                                        */ 00251700
*/*                                                                  */ 00251800
*/*     OUTPUT DATA -                                                */ 00251900
*/*                                                                  */ 00252000
*/*         MESSAGE IEA854I                                          */ 00252100
*/*         MESSAGE IEA948I                                          */ 00252200
*/*                                                                  */ 00252300
*/*     CONDITION - VERIFY LABEL FAILS, DEMOUNT FAILS                */ 00252400
*/*                                                                  */ 00252500
*/*     OUTPUT DATA -                                                */ 00252600
*/*                                                                  */ 00252700
*/*         MESSAGE IEA854I                                          */ 00252800
*/*         MESSAGE IEA985I                                          */ 00252900
*/*                                                                  */ 00253000
*/*     RETURN CODE - NONE                                           */ 00253100
*/*                                                                  */ 00253200
*/********************************************************************/ 00253300
*                                                                       00253400
*CALL EXCPSETP;                        /*SETUP TO READ LABEL         */ 00253500
@RF00782 BAS   R14,EXCPSETP                                             00253600
*EXCPSW = ON;                          /*INDICATE SETUP DONE         */ 00253700
         OI    SWITCH3,EXCPSW                                           00253800
*DEBUCBA = UCBPTR;                     /*UCB ADDRESS INTO DEB        */ 00253900
         L     R10,DEBDAPTR                                             00254000
         STCM  R5,B'0111',DEBUCBA-DEBDASD(R10)                          00254100
*ECB = ZERO;                           /*CLEAR ECB                   */ 00254200
         L     R10,ECBPTR                                               00254300
         XC    0(4,R10),0(R10)                                          00254400
*LABELBUF = BLANK;                     /*CLEAR LABEL AREA            */ 00254500
         MVI   LABELBUF,C' '                                            00254600
         MVC   LABELBUF+1(L'LABELBUF-1),LABELBUF                        00254700
*R1 = IOBSTPTR;                        /*ADDRESS OF IOB              */ 00254800
         L     R1,IOBSTPTR                                              00254900
*                                      /*READ VOLUME LABEL           */ 00255000
         EXCP  (R1)                                                     00255100
*R1 = ECBPTR;                          /*ADDRESS OF ECB              */ 00255200
         L     R1,ECBPTR                                                00255300
*                                      /*AWAIT I/O COMPLETION        */ 00255400
         WAIT  ECB=(R1)                                                 00255500
*                                                                       00255600
*IF ECBCC ¬= GOODPOST                  /*ERROR ON EXCP?              */ 00255700
*   VOL1 ¬= COMPVOL1                   /*NOT STANDARD LABEL?         */ 00255800
*   VOLSER ¬= MSSVOL                   /*NOT RIGHT VOLSER?           */ 00255900
*  THEN DO;                            /*ERROR -                     */ 00256000
         L     R10,ECBPTR                                               00256100
         CLI   0(R10),X'7F'                                             00256200
         BNE   @RT00805                                                 00256300
         CLC   VOL1(4),KCVOL1                                           00256400
         BNE   @RT00805                                                 00256500
         CLC   VOLSER(6),MSSVOL                                         00256600
         BE    @RF00805                                                 00256700
*    IOBFLAG1 = IOBFLAGS;              /*RE-INIT FLAGS               */ 00256800
@RT00805 L     R10,IOBSTPTR                                             00256900
         MVI   IOBFLAG1-IOBSTDRD(R10),X'42'                             00257000
*    IF ECBCC ¬= GOODPOST              /*IF I/O ERROR                */ 00257100
*      THEN DO;                                                         00257200
         L     R8,ECBPTR                                                00257300
         CLI   0(R8),X'7F'                                              00257400
         BE    @RF00808                                                 00257500
*        R1 = IOBSTPTR;                /*ISSUE NIP SENSE TO          */ 00257600
         LR    R1,R10                                                   00257700
*                                                                       00257800
         IEAPMNIP TYPE=SENSE,PARAM=RPARM                                00257900
*                                                                       00258000
*      END;                                                             00258100
*    /*IEA854I ERROR READING VOLUME LABEL                            */ 00258200
@RF00808 DS    0H                                                       00258300
         IEAPMNIP TYPE=WTO,PARAM=IEA854I                                00258400
*                                                                       00258500
*     R1=ADDR(DMLEN);/*PTR TO REQ BLK             */                    00258600
         LA    R1,DMLEN                                                 00258700
*     DMVOL=(MSSVOL); /*VALUE OF VOLID         */                       00258800
         MVC   DMVOL(6),MSSVOL                                          00258900
*     DMNTVUA=(UCBCHAN); /*FILL VALUE OF VUA         */                 00259000
         MVC   DMNTVUA(2),UCBCHAN-UCB(R5)                               00259100
*     DMVUAVAL='1'B;/* OR ON THE VUA VALID ATTRIBUTE FLAG         */    00259200
         OI    DMVUAVAL,B'00100000'                                     00259300
*                                    DEMOUNT MSS VOLUME          */     00259400
*     SVC  (126);/*INVOKE THE SSC SVC          */                       00259500
         SVC   126                                                      00259600
*    IF R15 ¬=ZERO                     /*RETURN CODE OK?             */ 00259700
*      THEN DO;                        /*NO -                        */ 00259800
         LTR   R15,R15                                                  00259900
         BZ    @RF00824                                                 00260000
*        RSNCDE = R0;                  /*MOVE REASON CODE            */ 00260100
         ST    R0,RSNCDE                                                00260200
*        UNPK (UNPKAR,RSNAREA(3:5));   /*CONVERT REASON CODE         */ 00260300
         UNPK  UNPKAR(5),RSNAREA+2(3)                                   00260400
*        TR (UNPKAR(1:4),TRANSTAB);                                     00260500
         LA    R10,HEXTRAN                                              00260600
         AL    R10,KFM240                                               00260700
         TR    UNPKAR(4),0(R10)                                         00260800
*        VOL985 = MSSVOL;              /*MOVE VOLSER TO MSG          */ 00260900
         MVC   VOL985(6),MSSVOL                                         00261000
*        DEV985 = UCBNAME;             /*MOVE VUA TO MSG             */ 00261100
         MVC   DEV985(3),UCBNAME-UCB(R5)                                00261200
*        RET985 = UNPKAR(2:4);         /*MOVE RETURN CODE            */ 00261300
         MVC   RET985(3),UNPKAR+1                                       00261400
*                                      /*ISSUE IEA985I               */ 00261500
*        /*IEA985I UNABLE TO UNLOAD MSS VOLUME AAAAAA FROM           */ 00261600
*        /*VXXX - RC=RET.                                            */ 00261700
*                                                                       00261800
         IEAPMNIP TYPE=WTO,PARAM=IEA985I                                00261900
*                                                                       00262000
         B     @RF00754                                                 00262100
*                                                                       00262200
*      END;                                                             00262300
*      ELSE DO;                        /*DEMOUNT SUCCESSFUL          */ 00262400
*        UCBNOTRD = YES;               /*UNLOAD VOLUME               */ 00262500
@RF00824 OI    UCBFLA-UCB(R5),UCBNOTRD                                  00262600
*        V948 = VIRT;                  /*MOVE V TO MESSAGE           */ 00262700
         MVI   V948,C'V'                                                00262800
*        DEV948 = UCBNAME;             /*MOVE VUA TO MSG             */ 00262900
         MVC   DEV948(3),UCBNAME-UCB(R5)                                00263000
*        /*IEA948I VXXX NON UNLOADED                                    00263100
*                                      /*ISSUE IEA948I               */ 00263200
         IEAPMNIP TYPE=WTO,PARAM=IEA948I                                00263300
*                                                                       00263400
         B     @RF00754                                                 00263500
*                                                                       00263600
*      END;                                                             00263700
*  END;                                                                 00263800
*  ELSE DO;                            /*READ SUCCESSFUL             */ 00263900
*    R1 = DEBPTR;                      /*ADDRESS OF DEB              */ 00264000
@RF00805 L     R1,DEBPTR                                                00264100
*    MBB = ZERO;                       /*CLEAR BIN ADDRESS           */ 00264200
         XC    MBB,MBB                                                  00264300
*    CCHHR = VOLVTOC;                  /*VTOC CCHHR                  */ 00264400
         MVC   CCHHR(5),VOLVTOC                                         00264500
*    R15 = CVTPRLTV;                   /*ADDR OF CONVERT RTN         */ 00264600
         L     R10,CVTPTR                                               00264700
         L     R15,CVTPRLTV-CVT(,R10)                                   00264800
*                                      /*CONVERT THE TTR             */ 00264900
         STM   R1,R15,REGSAVE            SAVE REGISTERS                 00265000
         LA    R4,REGSAVE                                               00265100
         LA    R2,MBBCCHHR                                              00265200
         BASR  R14,R15                   CONVERT ROUTINE                00265300
         LM    R1,R15,0(R4)              RESTORE REGS (REGSAVE)         00265400
*    UCBVTOC = R0;                     /*VTOC TTR INTO UCB           */ 00265500
         ST    R0,UCBVTOC-UCB(,R5)                                      00265600
*    UCBVOLI = VOLSER;                 /*MOVE VOLSER INTO UCB        */ 00265700
         MVC   UCBVOLI-UCB(,R5),VOLSER                                  00265800
*    UCBONLI = YES;                    /*MAKE UCB ONLINE             */ 00265900
         OI    UCBSTAT-UCB(R5),UCBONLI                                  00266000
*    CALL SETSTAT;                     /*SET ATTRIBUTES              */ 00266100
         BAS   R14,SETSTAT                                              00266200
         B     @RF00754                                                 00266300
*                                                                       00266400
*  END;                                                                 00266500
*        END;                                                           00266600
*    END;                                                               00266700
*    ELSE DO;                          /*DEVICE NOT ACCESSIBLE       */ 00266800
*      VOL409 = MSSVOL;                /*VOLSER                      */ 00266900
@RF00772 MVC   VOL409(6),MSSVOL                                         00267000
*      DEV409 = FINDDEV;               /*UNIT NAME                   */ 00267100
         MVC   DEV409(3),FINDDEV                                        00267200
*      /*IEA409I UNABLE TO MOUNT MSS VOLUME AAAAAA ON DDD, DEVICE NOT   00267300
*        ACCESSIBLE.                                                 */ 00267400
*                                                                       00267500
         IEAPMNIP TYPE=WTO,PARAM=IEA409I                                00267600
*                                                                       00267700
*    END;                              /*END DEVICE NOT ACCESSIBLE   */ 00267800
*  END;                                                                 00267900
*MNTLIST(I) = MNTLIST(MTLSTCT);        /*REMOVE MNTLIST ENTRY        */ 00268000
@RF00754 L     R10,GETADDR                                              00268100
         LA    R8,18                                                    00268200
         LR    R15,R8                                                   00268300
         MH    R15,I                                                    00268400
         ALR   R15,R10                                                  00268500
         AL    R15,KFM18                                                00268600
         LH    R14,MTLSTCT                                              00268700
         LR    R1,R8                                                    00268800
         MR    R0,R14                                                   00268900
         ALR   R10,R1                                                   00269000
         AL    R10,KFM18                                                00269100
         MVC   0(18,R15),0(R10)                                         00269200
*MTLSTCT = MTLSTCT - ONE;              /*DECREASE COUNT              */ 00269300
         BCTR  R14,0                                                    00269400
         STH   R14,MTLSTCT                                              00269500
         B     @DE00634                                                 00269600
*                                                                       00269700
*      END;                                                             00269800
*      ELSE IF EMNTPRIO = SUPMNT       /*REAL VOLUME IS NOT MOUNTED.    00269900
*                                        IS MESSAGE SUPPRESSION         00270000
*                                        INDICATED?                  */ 00270100
*        THEN DO;                      /*YES-                        */ 00270200
@RF00714 L     R10,GETADDR                                              00270300
         LA    R8,18                                                    00270400
         LR    R15,R8                                                   00270500
         MH    R15,I                                                    00270600
         ST    R15,@TF00001                                             00270700
         ALR   R15,R10                                                  00270800
         BCTR  R15,R0                                                   00270900
         BCTR  R15,R0                                                   00271000
         CLI   0(R15),C'N'                                              00271100
         BNE   @RF00866                                                 00271200
*          MNTLIST(I) = MNTLIST(MTLSTCT); /*REMOVE MNTLIST ENTRY     */ 00271300
         LR    R1,R10                                                   00271400
         AL    R1,@TF00001                                              00271500
         AL    R1,KFM18                                                 00271600
         LH    R15,MTLSTCT                                              00271700
         LR    R5,R8                                                    00271800
         MR    R4,R15                                                   00271900
         ALR   R10,R5                                                   00272000
         AL    R10,KFM18                                                00272100
         MVC   0(18,R1),0(R10)                                          00272200
*          MTLSTCT = MTLSTCT - ONE;    /*DECREMENT LIST COUNT        */ 00272300
         BCTR  R15,0                                                    00272400
         STH   R15,MTLSTCT                                              00272500
         B     @DE00634                                                 00272600
*                                                                       00272700
*        END;                                                           00272800
*        ELSE DO;                      /*LEAVE ENTRY IN LIST         */ 00272900
*          I = I + ONE;                /*INDICATE NEXT ENTRY         */ 00273000
@RF00866 LA    R10,1                                                    00273100
         LH    R8,I                                                     00273200
         ALR   R8,R10                                                   00273300
         STH   R8,I                                                     00273400
*          DEVCT(J) = DEVCT(J) + ONE;  /*INCR. DEVICE TYPE COUNTER   */ 00273500
         L     R8,DEVCTAD                                               00273600
         LH    R15,J                                                    00273700
         ALR   R15,R15                                                  00273800
         LA    R1,0(R15,R8)                                             00273900
         BCTR  R1,0                                                     00274000
         BCTR  R1,0                                                     00274100
         AH    R10,0(,R1)                                               00274200
         BCTR  R8,0                                                     00274300
         BCTR  R8,0                                                     00274400
         STH   R10,0(R15,R8)                                            00274500
*        END;                                                           00274600
*END;                                                                   00274700
@DE00634 LH    R10,MTLSTCT                                              00274800
         CH    R10,I                                                    00274900
         BNL   @DL00634                                                 00275000
*END;                                                                   00275100
*IF MTLSTCT ¬= ZERO                    /* IF THERE IS A MOUNT LIST,  */ 00275200
*  THEN DO;                                                             00275300
         LTR   R10,R10                                                  00275400
         BZ    @RF00877                                                 00275500
*    DO I = ONE TO NUMSUPTD;           /* SET ALL AUXILIARY COUNTERS */ 00275600
         LA    R10,1                                                    00275700
         B     @DE00879                                                 00275800
*                                                                       00275900
*      AUXCT(I) = DEVCT(I);            /* EQUAL TO THE DEVICE TYPE   */ 00276000
@DL00879 LR    R8,R10                                                   00276100
         ALR   R8,R8                                                    00276200
         L     R1,DEVCTAD                                               00276300
         BCTR  R1,0                                                     00276400
         BCTR  R1,0                                                     00276500
         LH    R15,0(R8,R1)                                             00276600
         L     R14,AUXCTAD                                              00276700
         BCTR  R14,0                                                    00276800
         BCTR  R14,0                                                    00276900
         STH   R15,0(R8,R14)                                            00277000
*    END;                              /* COUNTERS                   */ 00277100
         AH    R10,KH1                                                  00277200
@DE00879 STH   R10,I                                                    00277300
         C     R10,NUMSUPTD                                             00277400
         BNH   @DL00879                                                 00277500
*    DO;                               /* PUT OUT MOUNT MESSAGES.    */ 00277600
*/********************************************************************/ 00277700
*/*                                                                  */ 00277800
*/* SEGMENT NAME - MOUNTMSG                                          */ 00277900
*/*                                                                  */ 00278000
*/* DESCRIPTIVE NAME - ISSUE MOUNT MESSAGES                          */ 00278100
*/*                                                                  */ 00278200
*/* FUNCTION -                                                       */ 00278300
*/*                                                                  */ 00278400
*/*     ISSUE WTO FOR MESSAGE 'IEA851I-FOLLOWING MAY BE MOUNTED'.    */ 00278500
*/*     FOR EACH ENTRY IN THE MOUNT LIST, MOVE VOLUME SERIAL NUMBER  */ 00278600
*/*     AND DEVICE TYPE INTO MESSAGE AREA AND ISSUE WTO.  WHEN ALL   */ 00278700
*/*     MOUNT LIST ENTRIES HAVE BEEN PROCESSED, ISSUE WTOR FOR       */ 00278800
*/*     MESSAGE 'IEA851A-REPLY DEVICE ADDRESSES OR U'.               */ 00278900
*/*                                                                  */ 00279000
*/* ENTRY - IN-LINE SEGMENT                                          */ 00279100
*/*                                                                  */ 00279200
*/*     PURPOSE -                                                    */ 00279300
*/*                                                                  */ 00279400
*/*         LIST ON THE OPERATOR'S CONSOLE ANY VOLUMES IN VATLST     */ 00279500
*/*         THAT WERE NOT MOUNTED AT SYSTEM START, AND DEVICE TYPES  */ 00279600
*/*         FOR THESE VOLUMES.                                       */ 00279700
*/*                                                                  */ 00279800
*/*     INPUT DATA -                                                 */ 00279900
*/*                                                                  */ 00280000
*/*         MNTLIST - MOUNT LIST                                     */ 00280100
*/*         MTLSTCT - NUMBER OF ENTRIES IN MNTLIST                   */ 00280200
*/*                                                                  */ 00280300
*/* EXITS -                                                          */ 00280400
*/*                                                                  */ 00280500
*/*     CONDITION - NORMAL                                           */ 00280600
*/*                                                                  */ 00280700
*/*     OUTPUT DATA -                                                */ 00280800
*/*                                                                  */ 00280900
*/*         MESSAGES IEA851I, IEA851A, LIST OF VOLUMES               */ 00281000
*/*                                                                  */ 00281100
*/*     RETURN CODE - NONE                                           */ 00281200
*/*                                                                  */ 00281300
*/********************************************************************/ 00281400
*                                                                       00281500
*                                     /*ISSUE HEADER MESSAGE IEA851I */ 00281600
* IEA851I FOLLOWING MAY BE MOUNTED.                                     00281700
*                                                                       00281800
         IEAPMNIP TYPE=WTO,PARAM=IEA851I                                00281900
*                                                                       00282000
*DO NEXTPTR = ONE TO MTLSTCT;          /*LOOP THROUGH MOUNT LIST     */ 00282100
         LA    R5,1                                                     00282200
         B     @DE00884                                                 00282300
*                                                                       00282400
*  SER851 = MVOLSER(NEXTPTR);          /*MOVE VOL SER INTO MESSAGE   */ 00282500
@DL00884 L     R10,GETADDR                                              00282600
         LR    R8,R5                                                    00282700
         MH    R8,KH18                                                  00282800
         ST    R8,@TF00001                                              00282900
         ALR   R8,R10                                                   00283000
         AL    R8,KFM18                                                 00283100
         MVC   SER851(6),0(R8)                                          00283200
*  DEV851 = MDEVTYPE(NEXTPTR);         /*MOVE DEVICE TYPE INTO MSG   */ 00283300
         AL    R10,@TF00001                                             00283400
         AL    R10,KFM10                                                00283500
         MVC   DEV851(8),0(R10)                                         00283600
*                                      /*PRINT ONE LINE              */ 00283700
*    SER ON DDDTYP                                                      00283800
*                                                                       00283900
         IEAPMNIP TYPE=WTO,PARAM=IEA851I2                               00284000
*                                                                       00284100
*END;                                                                   00284200
         AH    R5,KH1                                                   00284300
@DE00884 CH    R5,MTLSTCT                                               00284400
         BNH   @DL00884                                                 00284500
*                                      /*ISSUE MESSAGE IEA851A       */ 00284600
* IEA851A REPLY DEVICE ADDRESSES OR U                                   00284700
*                                                                       00284800
         IEAPMNIP TYPE=WTOR,PARAM=IEA851A                               00284900
*                                      /* RETURN TO TOP SEGMENT      */ 00285000
         B     @DE00891                                                 00285100
*                                      /* RETURN TO TOP SEGMENT      */ 00285200
*    END;                                                               00285300
*    DO WHILE NODEV = NO;              /* VALIDATE OPERATOR REPLY    */ 00285400
*/********************************************************************/ 00285500
*/*                                                                  */ 00285600
*/* SEGMENT NAME - CKREPLY                                           */ 00285700
*/*                                                                  */ 00285800
*/* DESCRIPTIVE NAME - CHECK REPLY TO MOUNT MESSAGES                 */ 00285900
*/*                                                                  */ 00286000
*/* FUNCTION -                                                       */ 00286100
*/*                                                                  */ 00286200
*/*     WAIT FOR REPLY TO MESSAGE IEA851A.  IF REPLY IS 'U' OR EOB,  */ 00286300
*/*     THEN SET 'NODEV' EQUAL TO YES (NO DEVICES REPLIED IN ANSWER  */ 00286400
*/*     TO MESSAGE).  OTHERWISE, EXECUTE 'DEVREPLY' SEGMENT.         */ 00286500
*/*                                                                  */ 00286600
*/* ENTRY - IN-LINE SEGMENT                                          */ 00286700
*/*                                                                  */ 00286800
*/*     PURPOSE -                                                    */ 00286900
*/*                                                                  */ 00287000
*/*         EXAMINE REPLY FROM MESSAGE IEA851A.                      */ 00287100
*/*                                                                  */ 00287200
*/*     INPUT DATA -                                                 */ 00287300
*/*                                                                  */ 00287400
*/*         WTORBUF - CONTAINS REPLY TO IEA851A                      */ 00287500
*/*                                                                  */ 00287600
*/* EXITS -                                                          */ 00287700
*/*                                                                  */ 00287800
*/*     CONDITION - REPLY IS U OR EOB                                */ 00287900
*/*                                                                  */ 00288000
*/*     OUTPUT DATA -                                                */ 00288100
*/*                                                                  */ 00288200
*/*         NODEV - SET TO ON                                        */ 00288300
*/*                                                                  */ 00288400
*/*     CONDITION - REPLY IS DEVICE ADDRESS(ES)                      */ 00288500
*/*                                                                  */ 00288600
*/*     OUTPUT DATA - NONE                                           */ 00288700
*/*                                                                  */ 00288800
*/*     RETURN CODE - NONE                                           */ 00288900
*/*                                                                  */ 00289000
*/********************************************************************/ 00289100
*                                                                       00289200
*IF WTORBUF=REPLYU WTORBUF=REPLYEOB    /*CHECK FOR REPLY OF U OR EOB */ 00289300
*  THEN NODEV = YES;                   /*NO DEVICES REPLIED          */ 00289400
@DL00891 CLC   WTORBUF(2),KCU                                           00289500
         BE    @RT00892                                                 00289600
         CLC   WTORBUF(2),@CC00169                                      00289700
         BNE   @RF00892                                                 00289800
@RT00892 OI    SWITCH1,NODEV                                            00289900
         B     @DE00891                                                 00290000
*                                                                       00290100
*  ELSE DO;                            /* VALIDITY CHECK REPLY       */ 00290200
*/********************************************************************/ 00290300
*/*                                                                  */ 00290400
*/* SEGMENT NAME - DEVREPLY                                          */ 00290500
*/*                                                                  */ 00290600
*/* DESCRIPTIVE NAME - CONTROL VALIDITY CHECK OF THE DEVICE REPLY    */ 00290700
*/*                    AND ISSUE FORMAT ERROR MESSAGE                */ 00290800
*/*                                                                  */ 00290900
*/* FUNCTION -                                                       */ 00291000
*/*                                                                  */ 00291100
*/*     INITIALIZE 'BADADDR', WHICH WILL CONTAIN THE INVALID DEVICE  */ 00291200
*/*     ADDRESS IF ONE IS FOUND, TO ZERO.  SET SWITCHES 'MSG1',      */ 00291300
*/*     'MSG2', AND 'GOODLIST' OFF.                                  */ 00291400
*/*                                                                  */ 00291500
*/*     AFTER THE REPLY HAS BEEN VALIDITY CHECKED, THE SWITCH 'MSG1' */ 00291600
*/*     IS TESTED.  IF IT IS ON, A FORMAT ERROR HAS BEEN FOUND AND   */ 00291700
*/*     MESSAGE IEA895A IS ISSUED.                                   */ 00291800
*/*                                                                  */ 00291900
*/*     IF NO FORMAT ERROR HAS BEEN FOUND, THE SEGMENT WHICH CHECKS  */ 00292000
*/*     THE VALIDITY OF THE DEVICE IS EXECUTED.                      */ 00292100
*/*                                                                  */ 00292200
*/* ENTRY - IN-LINE SEGMENT                                          */ 00292300
*/*                                                                  */ 00292400
*/*     PURPOSE - SEE FUNCTION                                       */ 00292500
*/*                                                                  */ 00292600
*/*     INPUT DATA -                                                 */ 00292700
*/*                                                                  */ 00292800
*/*         DEVICE REPLY (TO MESSAGE IEA851A)                        */ 00292900
*/*                                                                  */ 00293000
*/* EXITS -                                                          */ 00293100
*/*                                                                  */ 00293200
*/*     CONDITION - NORMAL                                           */ 00293300
*/*                                                                  */ 00293400
*/*     OUTPUT DATA - NONE                                           */ 00293500
*/*                                                                  */ 00293600
*/*     CONDITION - FORMAT ERROR                                     */ 00293700
*/*                                                                  */ 00293800
*/*     OUTPUT DATA -                                                */ 00293900
*/*                                                                  */ 00294000
*/*         MESSAGE IEA895A ISSUED                                   */ 00294100
*/*                                                                  */ 00294200
*/*     RETURN CODE - NONE                                           */ 00294300
*/*                                                                  */ 00294400
*/********************************************************************/ 00294500
*                                                                       00294600
*BADADDR = ZEROADDR;                   /* INIT INVALID DEVICE PTR    */ 00294700
@RF00892 MVC   BADADDR,ZEROADDR                                         00294800
*MSG1 = NO;                            /* INIT MESSAGE SWITCHES.     */ 00294900
*MSG2 = NO;                                                             00295000
         NI    SWITCH2,255-MSG1-MSG2                                    00295100
*GOODLIST = NO;                        /* INIT VALID REPLY INDIC     */ 00295200
         NI    SWITCH1,255-GOODLIST                                     00295300
*DO;                                   /* CHECK FORMAT OF REPLY      */ 00295400
*/********************************************************************/ 00295500
*/*                                                                  */ 00295600
*/* SEGMENT NAME - DELIMCK                                           */ 00295700
*/*                                                                  */ 00295800
*/* DESCRIPTIVE NAME - CHECK DELIMITERS IN THE DEVICE REPLY          */ 00295900
*/*                                                                  */ 00296000
*/* FUNCTION -                                                       */ 00296100
*/*                                                                  */ 00296200
*/*     WHEN THE END OF THE REPLY HAS BEEN ENCOUNTERED, THE COUNTER  */ 00296300
*/*     'TOMOUNT' IS SET TO THE NUMBER OF VOLUMES THE OPERATOR       */ 00296400
*/*     WISHES TO MOUNT.                                             */ 00296500
*/*                                                                  */ 00296600
*/*     IF THE END INDICATOR OR A COMMA IS FOUND IN THE DEVICE ADD-  */ 00296700
*/*     RESS FIELD, OR THE DELIMITER IS NOT A COMMA OR END INDICATOR,*/ 00296800
*/*     'MSG1' SWITCH IS SET ON TO INDICATE THAT A FORMAT ERROR WAS  */ 00296900
*/*     FOUND.                                                       */ 00297000
*/*                                                                  */ 00297100
*/* ENTRY - IN-LINE SEGMENT                                          */ 00297200
*/*                                                                  */ 00297300
*/*     PURPOSE - SEE FUNCTION                                       */ 00297400
*/*                                                                  */ 00297500
*/*     INPUT DATA -                                                 */ 00297600
*/*                                                                  */ 00297700
*/*         REPLAREA - CONTAINS THE DEVICE REPLY                     */ 00297800
*/*         MSG1 - SET OFF                                           */ 00297900
*/*                                                                  */ 00298000
*/* EXITS -                                                          */ 00298100
*/*                                                                  */ 00298200
*/*     CONDITION - NORMAL                                           */ 00298300
*/*                                                                  */ 00298400
*/*     OUTPUT DATA -                                                */ 00298500
*/*                                                                  */ 00298600
*/*         TOMOUNT - SET TO THE NUMBER OF VOLUMES TO BE MOUNTED     */ 00298700
*/*                                                                  */ 00298800
*/*     CONDITION - THE END INDICATOR OR A COMMA IS FOUND IN THE     */ 00298900
*/*                 DEVICE FIELD                                     */ 00299000
*/*                                                                  */ 00299100
*/*     OUTPUT DATA -                                                */ 00299200
*/*                                                                  */ 00299300
*/*         MSG1 - SET ON                                            */ 00299400
*/*                                                                  */ 00299500
*/*     CONDITION - DELIMITER IS NOT COMMA OR END INDICATOR          */ 00299600
*/*                                                                  */ 00299700
*/*     OUTPUT DATA -                                                */ 00299800
*/*                                                                  */ 00299900
*/*         MSG1 - SET ON                                            */ 00300000
*/*                                                                  */ 00300100
*/*     RETURN CODE - NONE                                           */ 00300200
*/*                                                                  */ 00300300
*/********************************************************************/ 00300400
*                                                                       00300500
*LOOPSW = NO;                          /* INIT LOOP SWITCH.  SET UP  */ 00300600
         NI    SWITCH3,255-LOOPSW                                       00300700
*DO I = ONE TO REPLYMAX WHILE LOOPSW = NO;    /* TO CHECK MAX REPLY. */ 00300800
         LA    R10,1                                                    00300900
         STH   R10,I                                                    00301000
@DL00901 TM    SWITCH3,LOOPSW                                           00301100
         BNZ   @DC00901                                                 00301200
*  DO N = THREE TO ONE BY - ONE WHILE MSG1 = NO; /* CK DEV ADDR  FOR */ 00301300
         LA    R5,3                                                     00301400
@DL00902 TM    SWITCH2,MSG1                                             00301500
         BNZ   @DC00902                                                 00301600
*    IF UNIT(I,N) = QUOTE   UNIT(I,N) = COMMA     /* END INDIC. OR   */ 00301700
*      THEN DO;                        /* DELIM. IF FOUND, SET SW TO */ 00301800
         LH    R10,I                                                    00301900
         SLA   R10,2                                                    00302000
         ALR   R10,R5                                                   00302100
         LA    R8,WTORBUF-5(R10)                                        00302200
         CLI   0(R8),C''''                                              00302300
         BE    @RT00903                                                 00302400
         LA    R8,WTORBUF-5(R10)                                        00302500
         CLI   0(R8),C','                                               00302600
         BNE   @RF00903                                                 00302700
*        MSG1 = YES;                   /* PUT OUT FORMAT ERROR MSG   */ 00302800
@RT00903 OI    SWITCH2,MSG1                                             00302900
*        LOOPSW = YES;                 /* AND TERM VALIDITY CHECK    */ 00303000
         OI    SWITCH3,LOOPSW                                           00303100
*      END;                                                             00303200
*  END;                                                                 00303300
@RF00903 BCTR  R5,0                                                     00303400
         LTR   R5,R5                                                    00303500
         BP    @DL00902                                                 00303600
                                                                        00303700
*  IF MSG1 = NO                        /* IF NO ERROR DETECTED YET,  */ 00303800
*    THEN DO;                          /* AND THIS IS THE END OF THE */ 00303900
@DC00902 TM    SWITCH2,MSG1                                             00304000
         BNZ   @RF00909                                                 00304100
*      IF DELIM(I) = QUOTE             /* OPERATOR'S REPLY, THEN SET */ 00304200
*        THEN DO;                      /* THE NUMBER OF VOLUMES TO   */ 00304300
         LH    R10,I                                                    00304400
         LR    R8,R10                                                   00304500
         SLA   R8,2                                                     00304600
         LA    R1,WTORBUF-1(R8)                                         00304700
         CLI   0(R1),C''''                                              00304800
         BNE   @RF00911                                                 00304900
*          TOMOUNT = I;                /* BE MOUNTED                 */ 00305000
         STH   R10,TOMOUNT                                              00305100
*          LOOPSW = YES;               /* TERMINATE REPLY CHECKING.  */ 00305200
         OI    SWITCH3,LOOPSW                                           00305300
         B     @RF00909                                                 00305400
*                                                                       00305500
*        END;                                                           00305600
*        ELSE IF DELIM(I) ¬= COMMA     /* IF IT IS NOT THE END AND   */ 00305700
*          THEN DO;                    /* NOT A VALID DELIMITER,     */ 00305800
@RF00911 LH    R10,I                                                    00305900
         SLA   R10,2                                                    00306000
         LA    R8,WTORBUF-1(R10)                                        00306100
         CLI   0(R8),C','                                               00306200
         BE    @RF00909                                                 00306300
*            MSG1 = YES;               /* SET ERROR MSG SWITCH AND   */ 00306400
         OI    SWITCH2,MSG1                                             00306500
*            LOOPSW = YES;             /* TERMINATE REPLY CHECKING   */ 00306600
         OI    SWITCH3,LOOPSW                                           00306700
*          END;                                                         00306800
*    END;                                                               00306900
*END;                                  /* RETURN TO DEVREPLY         */ 00307000
@RF00909 LA    R10,1                                                    00307100
         AH    R10,I                                                    00307200
         STH   R10,I                                                    00307300
         CH    R10,KH19                                                 00307400
         BNH   @DL00901                                                 00307500
*END;                                                                   00307600
*IF MSG1 = YES                         /* IF MSG SWITCH IS ON        */ 00307700
*  THEN DO;                                                             00307800
@DC00901 TM    SWITCH2,MSG1                                             00307900
         BNO   @RF00924                                                 00308000
*                                      /* ISSUE REPEAT REPLY MSG     */ 00308100
*                                      /* FOR FORMAT ERROR           */ 00308200
         IEAPMNIP TYPE=WTOR,PARAM=IEA895A                               00308300
*                                                                       00308400
         B     @DE00891                                                 00308500
*                                                                       00308600
*  END;                                                                 00308700
*  ELSE DO;                            /* IF NO FORMAT ERROR, THEN   */ 00308800
*                                      /* VALIDATE UCB               */ 00308900
*/********************************************************************/ 00309000
*/*                                                                  */ 00309100
*/* SEGMENT NAME - CHECKUCB                                          */ 00309200
*/*                                                                  */ 00309300
*/* DESCRIPTIVE NAME - CONTROL VALIDITY CHECK OF DEVICE ADDRESSES    */ 00309400
*/*                    IN THE REPLY AND ISSUE REPEAT REPLY MESSAGE.  */ 00309500
*/*                                                                  */ 00309600
*/* FUNCTION -                                                       */ 00309700
*/*                                                                  */ 00309800
*/*     CONTROL IS GIVEN TO THE SEGMENT THAT CHECKS THE VALIDITY OF  */ 00309900
*/*     THE ADDRESSES.                                               */ 00310000
*/*                                                                  */ 00310100
*/*     WHEN THE VALIDITY HAS BEEN CHECKED, 'BADADDR' IS TESTED.     */ 00310200
*/*     IF AN ERROR HAS BEEN DETECTED, IT WILL CONTAIN THE INVALID   */ 00310300
*/*     ADDRESS.  IF IT IS ZERO, THE SEGMENT THAT CHECKS FOR DUPLI-  */ 00310400
*/*     CATE DEVICES IN THE REPLY IS EXECUTED.                       */ 00310500
*/*                                                                  */ 00310600
*/*     THE SWITCH 'MSG2' IS TESTED.  IF IT IS NOT ON, THE SWITCHES  */ 00310700
*/*     'GOODLIST' AND 'NODEV' ARE SET ON.  THESE SWITCHES INDICATE  */ 00310800
*/*     THAT VOLUMES WILL BE MOUNTED AND THE DEVICE REPLY HAS BEEN   */ 00310900
*/*     COMPLETELY VALIDATED.  IF 'MSG2' IS ON, THE DEVICE COUNTS    */ 00311000
*/*     ARE RESET AND MESSAGE 'IEA852A-REPEAT REPLY' IS ISSUED.      */ 00311100
*/*                                                                  */ 00311200
*/* ENTRY - IN-LINE SEGMENT                                          */ 00311300
*/*                                                                  */ 00311400
*/*     PURPOSE - SEE FUNCTION                                       */ 00311500
*/*                                                                  */ 00311600
*/*     INPUT DATA -                                                 */ 00311700
*/*                                                                  */ 00311800
*/*         GOODLIST - SWITCH IS SET ON                              */ 00311900
*/*         REPLAREA - CONTAINS THE DEVICE ADDRESSES REPLY           */ 00312000
*/*                                                                  */ 00312100
*/* EXITS -                                                          */ 00312200
*/*                                                                  */ 00312300
*/*     CONDITION - NORMAL                                           */ 00312400
*/*                                                                  */ 00312500
*/*     OUTPUT DATA -                                                */ 00312600
*/*                                                                  */ 00312700
*/*         GOODLIST - SWITCH IS ON                                  */ 00312800
*/*         NODEV - SWITCH IS ON                                     */ 00312900
*/*                                                                  */ 00313000
*/*     CONDITION - ERROR                                            */ 00313100
*/*                                                                  */ 00313200
*/*     OUTPUT DATA -                                                */ 00313300
*/*                                                                  */ 00313400
*/*         GOODLIST - SWITCH IS LEFT OFF                            */ 00313500
*/*         MESSAGE IEA852A IS ISSUED                                */ 00313600
*/*         DEVCT(X) - SET EQUAL TO AUXCT(X)                         */ 00313700
*/*                                                                  */ 00313800
*/*     RETURN CODE - NONE                                           */ 00313900
*/*                                                                  */ 00314000
*/********************************************************************/ 00314100
*                                                                       00314200
*DO;                                   /* CHECK EACH DEVICE IN THE   */ 00314300
*                                      /* REPLY FOR A VALID UCB.     */ 00314400
*/********************************************************************/ 00314500
*/*                                                                  */ 00314600
*/* SEGMENT NAME - UCBFIND                                           */ 00314700
*/*                                                                  */ 00314800
*/* DESCRIPTIVE NAME - VALIDITY CHECK THE UCB'S CORRESPONDING TO     */ 00314900
*/*                    THE DEVICE ADDRESSES IN THE REPLY             */ 00315000
*/*                                                                  */ 00315100
*/* FUNCTION -                                                       */ 00315200
*/*                                                                  */ 00315300
*/*     FOR EACH DEVICE ON THE REPLY, UCBFN IS ISSUED.  THE          */ 00315400
*/*     DEVICE ADDRESS IS PLACED IN 'BADADDR' IN CASE ANY OF THESE   */ 00315500
*/*     ERRORS OCCURS:                                               */ 00315600
*/*                                                                  */ 00315700
*/*         1. UCBFN DOES NOT RETURN A UCB ADDRESS.                  */ 00315800
*/*         2. UCB IS FOR A DEMOUNTABLE DEVICE THAT CONTAINS         */ 00315900
*/*            A PERMANENTLY RESIDENT OR RESERVED VOLUME.            */ 00316000
*/*         3. THE UCB DEVICE TYPE IS NOT A DEVICE TYPE ON WHICH     */ 00316100
*/*            A VOLUME IS TO BE MOUNTED.                            */ 00316200
*/*         4. THE UCB IS FOR A NON-DEMOUNTABLE DEVICE THAT          */ 00316300
*/*            WAS ONLINE AT IPL.                                    */ 00316400
*/*         5. THE UCB IS AN EXPOSURE IN A MULTIPLE EXPOSURE         */ 00316500
*/*            DEVICE, BUT IS NOT FOR THE BASE EXPOSURE.             */ 00316600
*/*         6. THE UCB IS FOR AN MSS DEVICE.                         */ 00316700
*/*                                                                  */ 00316800
*/*     IF NONE OF THE ABOVE CONDITIONS ARE FOUND, THE SEGMENT WHICH */ 00316900
*/*     CHECKS FOR ONLINE STATUS IS EXECUTED.                        */ 00317000
*/*                                                                  */ 00317100
*/*     IF THE UCB IS VALID (BADADDR IS ZERO), THE DEVICE TYPE COUNT-*/ 00317200
*/*     ER IS DECREMENTED.  OTHERWISE, THE SEGMENT THAT ISSUES THE   */ 00317300
*/*     ERROR MESSAGE IS EXECUTED.                                   */ 00317400
*/*                                                                  */ 00317500
*/* ENTRY - IN-LINE SEGMENT                                          */ 00317600
*/*                                                                  */ 00317700
*/*     PURPOSE - SEE FUNCTION                                       */ 00317800
*/*                                                                  */ 00317900
*/*     INPUT DATA -                                                 */ 00318000
*/*                                                                  */ 00318100
*/*         REPLAREA - CONTAINS THE DEVICE ADDRESS REPLY             */ 00318200
*/*         TOMOUNT - CONTAINS THE NUMBER OF DEVICE ADDRESSES        */ 00318300
*/*                   TO CHECK                                       */ 00318400
*/*                                                                  */ 00318500
*/* EXITS -                                                          */ 00318600
*/*                                                                  */ 00318700
*/*     CONDITION - NORMAL                                           */ 00318800
*/*                                                                  */ 00318900
*/*     OUTPUT DATA -                                                */ 00319000
*/*                                                                  */ 00319100
*/*         DEVCT(X) - DEVICE TYPE COUNTERS ARE DECREMENTED          */ 00319200
*/*                                                                  */ 00319300
*/*     CONDITION - THE UCB IS INVALID                               */ 00319400
*/*                                                                  */ 00319500
*/*     OUTPUT DATA -                                                */ 00319600
*/*                                                                  */ 00319700
*/*         BADADDR - CONTAINS THE DEVICE ADDRESS CORRESPONDING      */ 00319800
*/*                   TO THE INVALID UCB                             */ 00319900
*/*         R852 - REASON CODE FIELD IN MESSAGE IEA852I SET TO:      */ 00320000
*/*                2 - IF NO UCB IS FOUND                            */ 00320100
*/*                3 - IF UCB IS FOR DEMOUNTABLE DEVICE THAT         */ 00320200
*/*                    CONTAINS A P/R OR RESV VOLUME                 */ 00320300
*/*                4 - IF DEVICE IS NOT DA                           */ 00320400
*/*                5 - IF THERE ARE NO MORE OF THIS TYPE TO BE       */ 00320500
*/*                    MOUNTED                                       */ 00320600
*/*                9 - ADDR SPECIFIED IS FOR AN EXPOSURE             */ 00320700
*/*                    WITHIN A MULTIPLE EXPOSURE DEVICE             */ 00320800
*/*               10 - UCB IS FOR A NON-DEMOUNTABLE DEVICE           */ 00320900
*/*                    THAT WAS ONLINE AT IPL.                       */ 00321000
*/*               11 - UCB IS FOR AN MSS DEVICE                      */ 00321100
*/*                                                                  */ 00321200
*/*     RETURN CODE - NONE                                           */ 00321300
*/*                                                                  */ 00321400
*/********************************************************************/ 00321500
*                                                                       00321600
*DO I = ONE TO TOMOUNT;                /* FOR EACH DEVICE ADDRESS    */ 00321700
@RF00924 LA    R10,1                                                    00321800
         B     @DE00930                                                 00321900
*                                                                       00322000
*  FINDDEV = UNIT(I);                  /* SPECIFIED IN THE REPLY,    */ 00322100
@DL00930 SLA   R10,2                                                    00322200
         LA    R8,WTORBUF-4(R10)                                        00322300
         MVC   FINDDEV(3),0(R8)                                         00322400
*  R1 = FINDADDR;                      /* FIND THE CORRESPONDING     */ 00322500
*                                      /* UCB ADDR                   */ 00322600
         L     R1,FINDADDR                                              00322700
*                                                                       00322800
         IEAPMNIP TYPE=UCBFN,PARAM=RPARM                                00322900
*                                                                       00323000
*  BADADDR = UNIT(I);                  /* SAVE DEV IN CASE OF ERROR. */ 00323100
         LH    R10,I                                                    00323200
         SLA   R10,2                                                    00323300
         LA    R8,WTORBUF-4(R10)                                        00323400
         MVC   BADADDR,0(R8)                                            00323500
*  IF R1 ¬= ZERO                                                        00323600
*    THEN DO;                          /* IF THERE IS A CORRESPOND-  */ 00323700
*                                      /* ING UCB, THEN TEST IT.     */ 00323800
         LTR   R1,R1                                                    00323900
         BZ    @RF00936                                                 00324000
*      UCBPTR = R1;                                                     00324100
         LR   R5,R1                                                     00324200
*      FOUND = NO;                     /* INIT SWITCH.               */ 00324300
         NI    SWITCH1,255-FOUND                                        00324400
*      ERROR = NO;                     /* INIT SWITCH                */ 00324500
         NI    SWITCH2,255-ERROR                                        00324600
*      IF UCB3DACC = YES               /* IF UCB IS FOR DIRECT ACCESS*/ 00324700
*        THEN IF UCBRVDEV = NO         /* NOT VIRTUAL,               */ 00324800
         TM    UCBTBYT3-UCB(R5),UCB3DACC                                00324900
         BNO   @RF00942                                                 00325000
*          THEN IF UCBRESV = NO        /* NOT RESERVED, AND          */ 00325100
         TM    UCBTBYT2-UCB(R5),UCBRVDEV                                00325200
         BNZ   @RF00943                                                 00325300
*            THEN DO;                                                   00325400
         TM    UCBSTAT-UCB(R5),UCBRESV                                  00325500
         BNZ   @RF00944                                                 00325600
*              IF UCBPRES = NO         /* NOT PERMANENTLY            */ 00325700
*                THEN IF UCBMTPXP = YES/* RESIDENT,BUT IS            */ 00325800
         TM    UCBSTAT-UCB(R5),UCBPRES                                  00325900
         BNZ   @RF00946                                                 00326000
*                  THEN DO;            /*MULTIPLE EXPOSURE,          */ 00326100
         TM    UCBWGT-UCB(R5),UCBMTPXP                                  00326200
         BNO   @RF00947                                                 00326300
*                    R852 = REASON9;   /*THEN THIS IS A              */ 00326400
         MVC   R852(2),@CC02576                                         00326500
*                                      /*NON-BASE EXPOSURE           */ 00326600
*                    ERROR = YES;                                       00326700
         OI    SWITCH2,ERROR                                            00326800
@RF00947 B     @RC00946                                                 00326900
*                                                                       00327000
*                  END;                                                 00327100
*                  ELSE;                                                00327200
*                ELSE DO;              /*IF DA, P/R,MULTI-           */ 00327300
*                  IF UCBMTPXP = YES   /*EXPOSURE DEVICE UCB         */ 00327400
*                    THEN IF UCBVOLI ¬= ZEROVOLI/*WITH VOLSER        */ 00327500
*                      THEN DO;        /*DEVICE WAS ONLINE AT        */ 00327600
@RF00946 TM    UCBWGT-UCB(R5),UCBMTPXP                                  00327700
         BNO   @RF00954                                                 00327800
         CLC   UCBVOLI-UCB(,R5),ZEROVOLI                                00327900
         BE    @RF00955                                                 00328000
*                        R852 = REASON10;/*IPL AND NOT               */ 00328100
*                                      /*ELIGIBLE FOR MOUNT          */ 00328200
         MVC   R852(2),@CC02578                                         00328300
*                        ERROR = YES;                                   00328400
         OI    SWITCH2,ERROR                                            00328500
@RF00955 B     @RC00946                                                 00328600
*                                                                       00328700
*                      END;                                             00328800
*                      ELSE;                               /*        */ 00328900
*                    ELSE              /* DA, P/R,DEMOUNTABLE        */ 00329000
*                      IF UCBVOLI ¬= ZEROVOLI /*VOL ON P/R?          */ 00329100
*                        THEN DO;      /* YES, NOT ELIGIBLE          */ 00329200
@RF00954 CLC   UCBVOLI-UCB(,R5),ZEROVOLI                                00329300
         BE    @RC00946                                                 00329400
*                          R852 = REASON3; /* FOR MOUNT              */ 00329500
         MVC   R852(2),@CC02564                                         00329600
*                          ERROR = YES;    /* INDICATE ERROR         */ 00329700
         OI    SWITCH2,ERROR                                            00329800
*                        END;                                           00329900
*                        ELSE;         /*NO VOL ON P/R DEVICE        */ 00330000
*                END;                                                   00330100
*              IF ERROR = NO                                            00330200
*                THEN DO;                                               00330300
@RC00946 TM    SWITCH2,ERROR                                            00330400
         BNZ   @RC00936                                                 00330500
*                 DO J = ONE TO NUMSUPTD WHILE FOUND = NO;              00330600
         LA    R10,1                                                    00330700
         B     @DE00970                                                 00330800
*                                                                       00330900
@DL00970 TM    SWITCH1,FOUND                                            00331000
         BNZ   @DC00970                                                 00331100
*                    IF UCBTBYT4 = UCBTYPE(J)                           00331200
*                      THEN DO;        /* IF DEV TYPE IS SUPPORTED   */ 00331300
         SLR   R8,R8                                                    00331400
         IC    R8,UCBTBYT4-UCB(,R5)                                     00331500
         L     R4,UCBTYPAD                                              00331600
         ALR   R4,R10                                                   00331700
         BCTR  R4,0                                                     00331800
         MVC   @ZT00003+3(1),0(R4)                                      00331900
         C     R8,@ZT00003                                              00332000
         BNE   @RF00971                                                 00332100
*                        FOUND = YES;  /* SET SWITCH.                */ 00332200
         OI    SWITCH1,FOUND                                            00332300
*                        IF DEVCT(J) ¬= ZERO                            00332400
*                          THEN DO;    /* IF MORE OF THIS TYPE TO BE */ 00332500
         LR    R8,R10                                                   00332600
         ALR   R8,R8                                                    00332700
         L     R4,DEVCTAD                                               00332800
         BCTR  R4,0                                                     00332900
         BCTR  R4,0                                                     00333000
         LH    R8,0(R8,R4)                                              00333100
         LTR   R8,R8                                                    00333200
         BZ    @RF00974                                                 00333300
*                                      /* MOUNTED,                   */ 00333400
*                            K = J;    /* SAVE INDEX AND             */ 00333500
         STH   R10,K                                                    00333600
*                                      /* SEE IF THE UCB IS ONLINE   */ 00333700
*/********************************************************************/ 00333800
*/*                                                                  */ 00333900
*/* SEGMENT NAME - CKONLINE                                          */ 00334000
*/*                                                                  */ 00334100
*/* DESCRIPTIVE NAME - CHECK UCB ONLINE STATUS                       */ 00334200
*/*                                                                  */ 00334300
*/* FUNCTION -                                                       */ 00334400
*/*                                                                  */ 00334500
*/*     THE UCB FOR EACH DEVICE ADDR IN THE REPLY IS CHECKED FOR     */ 00334600
*/*     ONLINE STATUS.  IF IT IS ONLINE, 'BADADDR' IS SET TO ZERO    */ 00334700
*/*     TO INDICATE THAT THE DEVICE IS VALID.  IF IT IS NOT ONLINE,  */ 00334800
*/*     THE ROUTINE THAT CHECKS FOR AN AVAILABLE DATA PATH TO THE    */ 00334900
*/*     DEVICE IS CALLED (IF IT IS LOADED).  IF THE RETURN CODE IS   */ 00335000
*/*     ZERO, 'BADADDR' IS SET TO ZERO TO INDICATE THAT THE DEVICE   */ 00335100
*/*     IS VALID.                                                    */ 00335200
*/*                                                                  */ 00335300
*/*     THE REASON CODE IN MESSAGE IEA852I IS SET WHEN:              */ 00335400
*/*         1. THE DATA PATH FIND ROUTINE IS NOT LOADED.             */ 00335500
*/*         2. THERE IS NO AVAILABLE DATA PATH TO THE DEVICE.        */ 00335600
*/*         3. THERE IS NO OPERATIONAL PATH TO THE DEVICE.           */ 00335700
*/*                                                                  */ 00335800
*/* ENTRY - IN-LINE SEGMENT                                          */ 00335900
*/*                                                                  */ 00336000
*/*     PURPOSE - SEE FUNCTION                                       */ 00336100
*/*                                                                  */ 00336200
*/*     INPUT DATA -                                                 */ 00336300
*/*                                                                  */ 00336400
*/*         THE UCB FOR THE DEVICE ADDRESS IN THE REPLY              */ 00336500
*/*                                                                  */ 00336600
*/* EXITS -                                                          */ 00336700
*/*                                                                  */ 00336800
*/*     CONDITION - THE UCB IS ONLINE OR A DATA PATH IS AVAILABLE    */ 00336900
*/*                 TO THE DEVICE                                    */ 00337000
*/*                                                                  */ 00337100
*/*     OUTPUT DATA -                                                */ 00337200
*/*                                                                  */ 00337300
*/*         BADADDR - SET TO ZERO                                    */ 00337400
*/*                                                                  */ 00337500
*/*     CONDITION - NO DATA PATH IS AVAILABLE                        */ 00337600
*/*                                                                  */ 00337700
*/*     OUTPUT DATA -                                                */ 00337800
*/*                                                                  */ 00337900
*/*         R852 - IS SET TO 7                                       */ 00338000
*/*                                                                  */ 00338100
*/*     CONDITION - THERE IS NO OPERATIONAL PATH TO THE DEVICE       */ 00338200
*/*                                                                  */ 00338300
*/*     OUTPUT DATA -                                                */ 00338400
*/*                                                                  */ 00338500
*/*         R852 - IS SET TO 8                                       */ 00338600
*/*                                                                  */ 00338700
*/*     CONDITION - THE ROUTINE THAT CHECKS FOR A DATA PATH IS NOT   */ 00338800
*/*                 LOADED                                           */ 00338900
*/*                                                                  */ 00339000
*/*     OUTPUT DATA -                                                */ 00339100
*/*                                                                  */ 00339200
*/*         R852 - IS SET TO 6                                       */ 00339300
*/*                                                                  */ 00339400
*/*     RETURN CODE - NONE                                           */ 00339500
*/*                                                                  */ 00339600
*/********************************************************************/ 00339700
*                                                                       00339800
*IF UCBONLI ¬= YES                                                      00339900
*  THEN DO;                            /* IF THE UCB IS OFFLINE, AND */ 00340000
         TM    UCBSTAT-UCB(R5),UCBONLI                                  00340100
         BO    @RF00977                                                 00340200
*    IF DPLOADED = YES                 /* THE DATA PATH ROUTINE IS   */ 00340300
*      THEN DO;                        /* LOADED, THEN EXECUTE RTN   */ 00340400
         TM    SWITCH2,DPLOADED                                         00340500
         BNO   @RF00979                                                 00340600
*        DPPLIST = ADDR(DPPARM);       /* SET PARAMETER LIST         */ 00340700
         LA    R10,DPPARM                                               00340800
         ST    R10,DPPLIST                                              00340900
*        R1 = ADDR(DPPLIST);           /* PASS PARM LIST ADDR IN R1  */ 00341000
         LA    R1,DPPLIST                                               00341100
*        DPUCB = UCBPTR;               /* PUT UCB ADDR IN PARM LIST  */ 00341200
         ST    R5,DPUCB                                                 00341300
*        R15 = DATAPATH;               /* IS DATA PATH AVAIL TO DEV? */ 00341400
         L     R15,DATAPATH                                             00341500
         BASR  R14,R15                                                  00341600
*        IF R15 = ZERO                 /* IF RETURN CODE IS ZERO,    */ 00341700
*          THEN BADADDR = ZEROADDR;    /* PATH IS AVAIL, RESET ERROR */ 00341800
         LTR   R15,R15                                                  00341900
         BNZ   @RF00989                                                 00342000
         MVC   BADADDR,ZEROADDR                                         00342100
         B     @RC00989                                                 00342200
*                                                                       00342300
*          ELSE IF R15 > FOUR          /* INDIC IF > 4 NO OPERA-     */ 00342400
*            THEN R852 = REASON8;      /* TIONAL PATH; IF 4 NO DATA  */ 00342500
@RF00989 CH    R15,KH4                                                  00342600
         BNH   @RF00991                                                 00342700
         MVC   R852(2),@CC02574                                         00342800
         B     @RC00989                                                 00342900
*                                                                       00343000
*            ELSE R852 = REASON7;      /* PATH AVAIL                 */ 00343100
@RF00991 MVC   R852(2),@CC02572                                         00343200
@RC00989 B     @RF00971                                                 00343300
*                                                                       00343400
*      END;                                                             00343500
*      ELSE R852 = REASON6;            /* DATA PATH RTN. NOT LOADED  */ 00343600
@RF00979 MVC   R852(2),@CC02570                                         00343700
         B     @RF00971                                                 00343800
*                                                                       00343900
*  END;                                                                 00344000
*  ELSE BADADDR = ZEROADDR;            /* IF ONLINE, DEV IS VALID    */ 00344100
@RF00977 MVC   BADADDR,ZEROADDR                                         00344200
         B     @RF00971                                                 00344300
*                                      /* RETURN TO UCBFIND          */ 00344400
*                          END;        /* ELSE TOO MANY OF THIS TYPE */ 00344500
*                          ELSE R852 = REASON5; /* REPLIED           */ 00344600
@RF00974 MVC   R852(2),@CC02568                                         00344700
*                      END;                                             00344800
*                  END;                                                 00344900
@RF00971 LA    R10,1                                                    00345000
         AH    R10,J                                                    00345100
@DE00970 STH   R10,J                                                    00345200
         C     R10,NUMSUPTD                                             00345300
         BNH   @DL00970                                                 00345400
*                  IF FOUND = NO       /* TYPE NOT NEEDED FOR MOUNT  */ 00345500
*                    THEN R852 = REASON5;                               00345600
@DC00970 TM    SWITCH1,FOUND                                            00345700
         BNZ   @RC00936                                                 00345800
         MVC   R852(2),@CC02568                                         00345900
         B     @RC00936                                                 00346000
*                                                                       00346100
*                END;                                                   00346200
*            END;                                                       00346300
*            ELSE R852 = REASON3;      /* DEVICE IS RESERVED         */ 00346400
@RF00944 MVC   R852(2),@CC02564                                         00346500
         B     @RC00936                                                 00346600
*                                                                       00346700
*          ELSE R852 = REASON11;       /* DEVICE IS VIRTUAL          */ 00346800
@RF00943 MVC   R852(2),@CC02580                                         00346900
         B     @RC00936                                                 00347000
*                                                                       00347100
*        ELSE R852 = REASON4;          /* DEVICE NOT DIRECT ACCESS   */ 00347200
@RF00942 MVC   R852(2),@CC02566                                         00347300
         B     @RC00936                                                 00347400
*                                                                       00347500
*    END;                                                               00347600
*    ELSE R852 = REASON2;              /* REASON CODE - NO UCB       */ 00347700
@RF00936 MVC   R852(2),@CC02562                                         00347800
*  IF BADADDR = ZEROADDR               /* IF UCB IS VALID, THEN      */ 00347900
*    THEN DEVCT(K) = (DEVCT(K) - ONE); /* DECRE. DEVS TO CK          */ 00348000
@RC00936 CLC   BADADDR,ZEROADDR                                         00348100
         BNE   @RF01012                                                 00348200
         L     R10,DEVCTAD                                              00348300
         LH    R8,K                                                     00348400
         ALR   R8,R8                                                    00348500
         LA    R1,0(R8,R10)                                             00348600
         BCTR  R1,0                                                     00348700
         BCTR  R1,0                                                     00348800
         LH    R15,0(,R1)                                               00348900
         BCTR  R15,0                                                    00349000
         BCTR  R10,0                                                    00349100
         BCTR  R10,0                                                    00349200
         STH   R15,0(R8,R10)                                            00349300
         B     @RC01012                                                 00349400
*                                                                       00349500
*    ELSE DO;                          /* ELSE SEND ERROR MSG TO     */ 00349600
*                                      /* OPERATOR                   */ 00349700
*/********************************************************************/ 00349800
*/*                                                                  */ 00349900
*/* SEGMENT NAME - REASON                                            */ 00350000
*/*                                                                  */ 00350100
*/* DESCRIPTIVE NAME - ISSUE INVALID DEVICE MESSAGE TO OPERATOR      */ 00350200
*/*                                                                  */ 00350300
*/* FUNCTION -                                                       */ 00350400
*/*                                                                  */ 00350500
*/*     'MSG2' SWITCH IS SET ON TO INDICATE THAT THE REPEAT REPLY    */ 00350600
*/*     MESSAGE IS TO BE ISSUED.  THE INVALID DEVICE ADDRESS IS      */ 00350700
*/*     MOVED INTO THE MESSAGE TEXT AND IEA852I IS ISSUED.           */ 00350800
*/*                                                                  */ 00350900
*/* ENTRY - IN-LINE SEGMENT                                          */ 00351000
*/*                                                                  */ 00351100
*/*     PURPOSE - SEE FUNCTION                                       */ 00351200
*/*                                                                  */ 00351300
*/*     INPUT DATA -                                                 */ 00351400
*/*                                                                  */ 00351500
*/*         BADADDR - CONTAINS THE INVALID DEVICE ADDRESS            */ 00351600
*/*                                                                  */ 00351700
*/* EXITS -                                                          */ 00351800
*/*                                                                  */ 00351900
*/*     CONDITION - NORMAL                                           */ 00352000
*/*                                                                  */ 00352100
*/*     OUTPUT DATA -                                                */ 00352200
*/*                                                                  */ 00352300
*/*         MESSAGE IEA852I IS ISSUED                                */ 00352400
*/*                                                                  */ 00352500
*/*     RETURN CODE - NONE                                           */ 00352600
*/*                                                                  */ 00352700
*/********************************************************************/ 00352800
*                                                                       00352900
*MSG2 = YES;                           /* INDIC. REPEAT REPLY MSG    */ 00353000
@RF01012 OI    SWITCH2,MSG2                                             00353100
*DEV852 = BADADDR;                     /* PUT DEV ADDR IN MSG        */ 00353200
         MVC   DEV852(3),BADADDR                                        00353300
*                                      /* ISSUE ERROR MESSAGE        */ 00353400
         IEAPMNIP TYPE=WTO,PARAM=IEA852I                                00353500
*                                      /* RET TO UCBFIND OR CHECKDUP */ 00353600
*    END;                                                               00353700
*END;                                  /* RETURN TO CHECKUCB         */ 00353800
@RC01012 LA    R10,1                                                    00353900
         AH    R10,I                                                    00354000
@DE00930 STH   R10,I                                                    00354100
         CH    R10,TOMOUNT                                              00354200
         BNH   @DL00930                                                 00354300
*END;                                                                   00354400
*IF TOMOUNT > ONE THEN                 /* IF MORE THAN ONE DEVICE;   */ 00354500
         LA    R10,1                                                    00354600
         CH    R10,TOMOUNT                                              00354700
         BNL   @RF01021                                                 00354800
*  DO;                                                                  00354900
*    BADADDR = ZEROADDR;               /* RESET VALID DEVICE INDIC   */ 00355000
         MVC   BADADDR,ZEROADDR                                         00355100
         LR    R5,R10                                                   00355200
         B     @DE01025                                                 00355300
*                                                                       00355400
*    DO;                               /* CHECK FOR DUPLICATE DEVICE */ 00355500
*                                      /* IN REPLY                   */ 00355600
*/********************************************************************/ 00355700
*/*                                                                  */ 00355800
*/* SEGMENT NAME - CHECKDUP                                          */ 00355900
*/*                                                                  */ 00356000
*/* DESCRIPTIVE NAME - CHECK FOR DUPLICATE DEVICE ADDRESS WITHIN     */ 00356100
*/*                    THE REPLY                                     */ 00356200
*/*                                                                  */ 00356300
*/* FUNCTION -                                                       */ 00356400
*/*                                                                  */ 00356500
*/*     ALL OF THE DEVICE ADDRESSES REPLIED ARE CHECKED FOR DUPLICA- */ 00356600
*/*     TION.  IF A DUPLICATE IS FOUND, IT IS PLACED IN 'BADADDR',   */ 00356700
*/*     AND THE REASON CODE IN MESSAGE TEXT IEA852I IS SET TO 1.     */ 00356800
*/*                                                                  */ 00356900
*/* ENTRY - IN-LINE SEGMENT                                          */ 00357000
*/*                                                                  */ 00357100
*/*     PURPOSE - SEE FUNCTION                                       */ 00357200
*/*                                                                  */ 00357300
*/*     INPUT DATA -                                                 */ 00357400
*/*                                                                  */ 00357500
*/*         REPLAREA - CONTAINS THE DEVICE REPLY                     */ 00357600
*/*         BADADDR - SET TO ZERO                                    */ 00357700
*/*         TOMOUNT - CONTAINS NUMBER OF DEVICES IN REPLY            */ 00357800
*/*                                                                  */ 00357900
*/* EXITS -                                                          */ 00358000
*/*                                                                  */ 00358100
*/*     CONDITION - NORMAL                                           */ 00358200
*/*                                                                  */ 00358300
*/*     OUTPUT DATA - NONE                                           */ 00358400
*/*                                                                  */ 00358500
*/*     CONDITION - DUPLICATE FOUND IN REPLY                         */ 00358600
*/*                                                                  */ 00358700
*/*     OUTPUT DATA -                                                */ 00358800
*/*                                                                  */ 00358900
*/*         BADADDR - CONTAINS THE INVALID ADDRESS                   */ 00359000
*/*         R852I - SET TO 1                                         */ 00359100
*/*                                                                  */ 00359200
*/*     RETURN CODE - NONE                                           */ 00359300
*/*                                                                  */ 00359400
*/********************************************************************/ 00359500
*                                                                       00359600
*DO CHECK = ONE TO (TOMOUNT - ONE);    /* CHECK EACH DEV WITH REMAIN-*/ 00359700
*  DO SCAN = (CHECK + ONE) TO TOMOUNT; /* ING DEVS IN REPLY, TO SEE  */ 00359800
@DL01025 LA    R10,1                                                    00359900
         ALR   R10,R5                                                   00360000
         B     @DE01026                                                 00360100
*                                                                       00360200
*    IF UNIT(CHECK) = UNIT(SCAN)       /* IF A DUPLICATE IS FOUND    */ 00360300
*      THEN DO;                        /* IF IT IS THEN              */ 00360400
@DL01026 LR    R8,R5                                                    00360500
         SLA   R8,2                                                     00360600
         SLA   R10,2                                                    00360700
         LA    R4,WTORBUF-4(R8)                                         00360800
         LA    R8,WTORBUF-4(R10)                                        00360900
         CLC   0(3,R4),0(R8)                                            00361000
         BNE   @RF01027                                                 00361100
*        BADADDR = UNIT(SCAN);         /* SAVE THE INVALID DEV ADDR  */ 00361200
         LA    R8,WTORBUF-4(R10)                                        00361300
         MVC   BADADDR,0(R8)                                            00361400
*        R852 = REASON1;               /* AND SET REASON CODE.       */ 00361500
         MVC   R852(2),@CC02560                                         00361600
*        DO;                           /* SEND MSG TO OPERATOR.      */ 00361700
*/********************************************************************/ 00361800
*/*                                                                  */ 00361900
*/* SEGMENT NAME - REASON                                            */ 00362000
*/*                                                                  */ 00362100
*/* DESCRIPTIVE NAME - ISSUE INVALID DEVICE MESSAGE TO OPERATOR      */ 00362200
*/*                                                                  */ 00362300
*/* FUNCTION -                                                       */ 00362400
*/*                                                                  */ 00362500
*/*     'MSG2' SWITCH IS SET ON TO INDICATE THAT THE REPEAT REPLY    */ 00362600
*/*     MESSAGE IS TO BE ISSUED.  THE INVALID DEVICE ADDRESS IS      */ 00362700
*/*     MOVED INTO THE MESSAGE TEXT AND IEA852I IS ISSUED.           */ 00362800
*/*                                                                  */ 00362900
*/* ENTRY - IN-LINE SEGMENT                                          */ 00363000
*/*                                                                  */ 00363100
*/*     PURPOSE - SEE FUNCTION                                       */ 00363200
*/*                                                                  */ 00363300
*/*     INPUT DATA -                                                 */ 00363400
*/*                                                                  */ 00363500
*/*         BADADDR - CONTAINS THE INVALID DEVICE ADDRESS            */ 00363600
*/*                                                                  */ 00363700
*/* EXITS -                                                          */ 00363800
*/*                                                                  */ 00363900
*/*     CONDITION - NORMAL                                           */ 00364000
*/*                                                                  */ 00364100
*/*     OUTPUT DATA -                                                */ 00364200
*/*                                                                  */ 00364300
*/*         MESSAGE IEA852I IS ISSUED                                */ 00364400
*/*                                                                  */ 00364500
*/*     RETURN CODE - NONE                                           */ 00364600
*/*                                                                  */ 00364700
*/********************************************************************/ 00364800
*                                                                       00364900
*MSG2 = YES;                           /* INDIC. REPEAT REPLY MSG.   */ 00365000
         OI    SWITCH2,MSG2                                             00365100
*DEV852 = BADADDR;                     /* PUT DEV ADDR IN MSG.       */ 00365200
         MVC   DEV852(3),BADADDR                                        00365300
*                                      /* ISSUE ERROR MESSAGE.       */ 00365400
         IEAPMNIP TYPE=WTO,PARAM=IEA852I                                00365500
*                                      /* RET TO UCBFIND OR CHECKDUP */ 00365600
*        END;                                                           00365700
*      END;                                                             00365800
*  END;                                                                 00365900
@RF01027 LA    R10,1                                                    00366000
         AH    R10,SCAN                                                 00366100
@DE01026 STH   R10,SCAN                                                 00366200
         CH    R10,TOMOUNT                                              00366300
         BNH   @DL01026                                                 00366400
*END;                                                                   00366500
         AH    R5,KH1                                                   00366600
@DE01025 LH    R10,TOMOUNT                                              00366700
         BCTR  R10,0                                                    00366800
         CR    R5,R10                                                   00366900
         BNH   @DL01025                                                 00367000
*                                      /* RETURN TO CHECKUCB         */ 00367100
*    END;                                                               00367200
*  END;                                                                 00367300
*IF MSG2 = NO                          /* IF UCBS ARE VALID AND      */ 00367400
*  THEN DO;                            /* THERE ARE NO DUPS IN REPLY */ 00367500
@RF01021 TM    SWITCH2,MSG2                                             00367600
         BNZ   @RF01041                                                 00367700
*    GOODLIST = YES;                   /* THEN SET VALID REPLY INDIC */ 00367800
*    NODEV = YES;                      /* AND TERM. REPLY PROCESSING.*/ 00367900
         OI    SWITCH1,GOODLIST                                         00368000
         B     @DE00891                                                 00368100
*                                                                       00368200
*  END;                                                                 00368300
*  ELSE DO;                            /* IF ERROR WAS FOUND,        */ 00368400
*    DO I = NUMSUPTD TO ONE BY - ONE;                                   00368500
@RF01041 L     R10,NUMSUPTD                                             00368600
         STH   R10,I                                                    00368700
         B     @DE01047                                                 00368800
*                                                                       00368900
*      DEVCT(I) = AUXCT(I);            /* RESET DEV TYPE COUNTERS    */ 00369000
@DL01047 LR    R8,R10                                                   00369100
         ALR   R8,R8                                                    00369200
         L     R1,AUXCTAD                                               00369300
         BCTR  R1,0                                                     00369400
         BCTR  R1,0                                                     00369500
         LH    R15,0(R8,R1)                                             00369600
         L     R14,DEVCTAD                                              00369700
         BCTR  R14,0                                                    00369800
         BCTR  R14,0                                                    00369900
         STH   R15,0(R8,R14)                                            00370000
*    END;                                                               00370100
         BCTR  R10,0                                                    00370200
         STH   R10,I                                                    00370300
@DE01047 LTR   R10,R10                                                  00370400
         BP    @DL01047                                                 00370500
*                                      /* ISSUE REPEAT REPLY MSG     */ 00370600
         IEAPMNIP TYPE=WTOR,PARAM=IEA852A                               00370700
*  END;                                                                 00370800
*  END;                                                                 00370900
*  END;                                                                 00371000
*    END;                                                               00371100
@DE00891 TM    SWITCH1,NODEV                                            00371200
         BZ    @DL00891                                                 00371300
*    IF GOODLIST = YES                 /* IF THE OPERATOR REPLY IS   */ 00371400
*      THEN DO;                        /* VALID,                     */ 00371500
         TM    SWITCH1,GOODLIST                                         00371600
         BNO   @RF01055                                                 00371700
*        DO;                           /* PREPARE FOR VOL MOUNTING   */ 00371800
*/********************************************************************/ 00371900
*/*                                                                  */ 00372000
*/* SEGMENT NAME - RDYUCB                                            */ 00372100
*/*                                                                  */ 00372200
*/* DESCRIPTIVE NAME - PREPARE THE UCB'S TO RECEIVE VOLUMES          */ 00372300
*/*                                                                  */ 00372400
*/* FUNCTION -                                                       */ 00372500
*/*                                                                  */ 00372600
*/*     THE UCBFN MACRO IS ISSUED FOR EACH DEVICE IN THE REPLY TO    */ 00372700
*/*     FIND THE CORRESPONDING UCB ADDRESS.  THE DEVICE ADDRESS AND  */ 00372800
*/*     UCB ADDRESS ARE PLACED IN 'DEVTABLE'.  THE VOLUME SERIAL IS  */ 00372900
*/*     CLEARED IN THE UCB, THE TAG AND NOT-READY BITS ARE TURNED    */ 00373000
*/*     ON, AND THE NUMBER OF ENTRIES IN 'DEVTABLE' IS SAVED IN      */ 00373100
*/*     'TABLECT'.                                                   */ 00373200
*/*                                                                  */ 00373300
*/* ENTRY - IN-LINE SEGMENT                                          */ 00373400
*/*                                                                  */ 00373500
*/*     PURPOSE - SEE FUNCTION                                       */ 00373600
*/*                                                                  */ 00373700
*/*     INPUT DATA -                                                 */ 00373800
*/*                                                                  */ 00373900
*/*         REPLAREA - CONTAINS THE DEVICE ADDRESS REPLY             */ 00374000
*/*         TOMOUNT - CONTAINS THE NUMBER OF DEVICES ON WHICH        */ 00374100
*/*                   VOLUMES ARE TO BE MOUNTED                      */ 00374200
*/*                                                                  */ 00374300
*/* EXITS -                                                          */ 00374400
*/*                                                                  */ 00374500
*/*     CONDITION - NORMAL                                           */ 00374600
*/*                                                                  */ 00374700
*/*     OUTPUT DATA -                                                */ 00374800
*/*                                                                  */ 00374900
*/*         UCB FIELDS ARE SET FOR VOLUME MOUNTING                   */ 00375000
*/*         DEVTABLE IS BUILT                                        */ 00375100
*/*         TABLECT - NUMBER OF ENTRIES IN DEVTABLE                  */ 00375200
*/*                                                                  */ 00375300
*/*     RETURN CODE - NONE                                           */ 00375400
*/*                                                                  */ 00375500
*/********************************************************************/ 00375600
*                                                                       00375700
*DO I = ONE TO TOMOUNT;                /* FOR EACH DEVICE IN THE     */ 00375800
         LA    R10,1                                                    00375900
         B     @DE01059                                                 00376000
*                                                                       00376100
*  FINDDEV = UNIT(I);                  /* REPLY, FIND THE CORRESPOND-*/ 00376200
*                                      /* ING UCB ADDRESS.           */ 00376300
@DL01059 SLA   R10,2                                                    00376400
         LA    R8,WTORBUF-4(R10)                                        00376500
         MVC   FINDDEV(3),0(R8)                                         00376600
*  R1 = FINDADDR;                                                       00376700
         L     R1,FINDADDR                                              00376800
*                                                                       00376900
         IEAPMNIP TYPE=UCBFN,PARAM=RPARM                                00377000
*                                                                       00377100
*  UCBPTR = R1;                                                         00377200
*  UCBVOLI = ZEROVOLI;                 /* CLEAR THE VOL SER IN UCB   */ 00377300
         LR    R5,R1                                                    00377400
         MVC   UCBVOLI-UCB(,R5),ZEROVOLI                                00377500
*  UCBVTOC = ZEROVTOC;                 /* CLEAR VTOC TTR             */ 00377600
         MVC   UCBVTOC-UCB(,R5),ZEROVTOC                                00377700
*  UCBPRSRS = YES;                     /* TURN ON TAG BIT            */ 00377800
         OI    UCBSTAB-UCB(R5),UCBPRSRS                                 00377900
*  UCBNOTRD = YES;                     /* TURN ON NOT-READY BIT      */ 00378000
         OI    UCBFLA-UCB(R5),UCBNOTRD                                  00378100
*  DEVICE(I) = UNIT(I);                /* BUILD THE DEVTABLE: DEVICE */ 00378200
         LH    R10,I                                                    00378300
         LR    R8,R10                                                   00378400
         SLA   R8,3                                                     00378500
         LA    R4,DEVICE-8(R8)                                          00378600
         LR    R15,R10                                                  00378700
         SLA   R15,2                                                    00378800
         LA    R14,WTORBUF-4(R15)                                       00378900
         MVC   0(3,R4),0(R14)                                           00379000
*  UCBADDR(I) = UCBPTR;                /* PLUS UCB ADDRESS           */ 00379100
         ST    R5,UCBADDR-8(R8)                                         00379200
*END;                                                                   00379300
         AH    R10,KH1                                                  00379400
@DE01059 STH   R10,I                                                    00379500
         CH    R10,TOMOUNT                                              00379600
         BNH   @DL01059                                                 00379700
*TABLECT = TOMOUNT;                    /* SAVE NBR. TABLE ENTRIES.   */ 00379800
*                                                                       00379900
         MVC   TABLECT,TOMOUNT                                          00380000
*IF EXCPSW = OFF                       /*SET UP EXCP IF NOT          */ 00380100
*  THEN CALL EXCPSETP;                 /*DONE ALREADY                */ 00380200
         TM    SWITCH3,EXCPSW                                           00380300
         BNZ   @RF01074                                                 00380400
         BAS   R14,EXCPSETP                                             00380500
*        END;                                                           00380600
*        DO;                           /* ISSUE READY DEV MESSAGES   */ 00380700
*/********************************************************************/ 00380800
*/*                                                                  */ 00380900
*/* SEGMENT NAME - WTORMT                                            */ 00381000
*/*                                                                  */ 00381100
*/* DESCRIPTIVE NAME - ISSUE MESSAGE FOR DEVICES TO BE READIED       */ 00381200
*/*                                                                  */ 00381300
*/* FUNCTION -                                                       */ 00381400
*/*                                                                  */ 00381500
*/*     SET 'DEVMTCT' EQUAL TO 'TOMOUNT'.  MOVE DEVICE ADDRESSES     */ 00381600
*/*     FROM 'DEVTABLE' TO  MESSAGE TEXT.  ISSUE MESSAGE 'DDD,DDD,...*/ 00381700
*/*     IEA860A REPLY U WHEN ALL DEVICES ARE READY.',                */ 00381800
*/*     IF REPLY IS NOT U OR EOB, REPEAT MESSAGE.                    */ 00381900
*/*                                                                  */ 00382000
*/* ENTRY - IN-LINE SEGMENT                                          */ 00382100
*/*                                                                  */ 00382200
*/*     PURPOSE - SEE FUNCTION                                       */ 00382300
*/*                                                                  */ 00382400
*/*     INPUT DATA -                                                 */ 00382500
*/*                                                                  */ 00382600
*/*         DEVTABLE - CONTAINS DEVICE ADDRESSES FROM REPLY          */ 00382700
*/*         TOMOUNT - NUMBER OF VOLS TO BE MOUNTED                   */ 00382800
*/*                                                                  */ 00382900
*/* EXITS -                                                          */ 00383000
*/*                                                                  */ 00383100
*/*     CONDITION - NORMAL                                           */ 00383200
*/*                                                                  */ 00383300
*/*     OUTPUT DATA -                                                */ 00383400
*/*                                                                  */ 00383500
*/*         MESSAGE IEA860A                                          */ 00383600
*/*         DEVMTCT - SET TO VALUE OF TOMOUNT                        */ 00383700
*/*                                                                  */ 00383800
*/*     RETURN CODE - NONE                                           */ 00383900
*/*                                                                  */ 00384000
*/********************************************************************/ 00384100
*                                                                       00384200
*DEVMTCT = TOMOUNT;                    /*INIT LOOP CONTROL COUNTER   */ 00384300
*                                                                       00384400
@RF01074 MVC   DEVMTCT,TOMOUNT                                          00384500
*DEV860 = BLANK;                       /*BLANK OUT MESSAGE AREA      */ 00384600
*                                                                       00384700
         MVI   DEV860,C' '                                              00384800
         MVC   DEV860+1(L'DEV860-1),DEV860+1                            00384900
*I = ZERO;                             /*INDEX THROUGH MESSAGE AREA  */ 00385000
         SLR   R10,R10                                                  00385100
         STH   R10,I                                                    00385200
*DO DEVIND = ONE TO TABLECT;           /*LOOP THROUGH DEVTABLE       */ 00385300
         LA    R5,1                                                     00385400
         B     @DE01081                                                 00385500
*                                                                       00385600
*      I = I + ONE;                                                     00385700
@DL01081 LH    R10,I                                                    00385800
         LA    R10,1(,R10)                                              00385900
         STH   R10,I                                                    00386000
*      UNITAD(I) = DEVICE(DEVIND);     /*MOVE ENTRY INTO MESSAGE AREA*/ 00386100
         SLA   R10,2                                                    00386200
         LA    R8,DEV860                                                00386300
         ALR   R8,R10                                                   00386400
         AL    R8,KFM4                                                  00386500
         LR    R10,R5                                                   00386600
         SLA   R10,3                                                    00386700
         LA    R4,DEVICE-8(R10)                                         00386800
         MVC   0(3,R8),0(R4)                                            00386900
*END;                                                                   00387000
         AH    R5,KH1                                                   00387100
@DE01081 CH    R5,TABLECT                                               00387200
         BNH   @DL01081                                                 00387300
*IF I > ONE THEN                       /*IF THERE IS MORE THAN ONE      00387400
*                                        DEVICE IN MESSAGE AREA THEN */ 00387500
         LA    R10,1                                                    00387600
         CH    R10,I                                                    00387700
         BNL   @RF01085                                                 00387800
*  DO J= ONE TO (I-ONE);                                                00387900
         B     @DE01086                                                 00388000
*                                                                       00388100
*    COM(J) = COMMA;                   /*INSERT COMMAS               */ 00388200
@DL01086 LR    R8,R10                                                   00388300
         SLA   R8,2                                                     00388400
         LA    R15,DEV860                                               00388500
         ALR   R15,R8                                                   00388600
         BCTR  R15,0                                                    00388700
         MVI   0(R15),C','                                              00388800
*  END;                                                                 00388900
*                                                                       00389000
         AH    R10,KH1                                                  00389100
@DE01086 STH   R10,J                                                    00389200
         LH    R8,I                                                     00389300
         BCTR  R8,0                                                     00389400
         CR    R10,R8                                                   00389500
         BNH   @DL01086                                                 00389600
*BADREPLY=YES;                                                          00389700
@RF01085 OI    SWITCH2,BADREPLY                                         00389800
         B     @DE01090                                                 00389900
*                                                                       00390000
*DO WHILE BADREPLY = YES;              /*REPLY LOOP FOR              */ 00390100
*  BADREPLY = NO;                      /*IEA860A                     */ 00390200
@DL01090 NI    SWITCH2,255-BADREPLY                                     00390300
*        IEA860A REPLY U WHEN ALL DEVICES ARE READY.                    00390400
*                                                                       00390500
         IEAPMNIP TYPE=WTO,PARAM=IEA860A                                00390600
*                                                                       00390700
         IEAPMNIP TYPE=WTOR,PARAM=IEA8602                               00390800
*                                                                       00390900
*  IF WTORBUF¬=REPLYU & WTORBUF¬=REPLYEOB /*CHECK FOR REPLY          */ 00391000
*    THEN BADREPLY=YES;                /*OF U OR EOB                 */ 00391100
         CLC   WTORBUF(2),KCU                                           00391200
         BE    @DE01090                                                 00391300
         CLC   WTORBUF(2),@CC00169                                      00391400
         BE    @DE01090                                                 00391500
         OI    SWITCH2,BADREPLY                                         00391600
*END;                                                                   00391700
@DE01090 TM    SWITCH2,BADREPLY                                         00391800
         BO    @DL01090                                                 00391900
         B     @DE01097                                                 00392000
*                                                                       00392100
*        END;                                                           00392200
*        DO WHILE DEVMTCT > ZERO;      /* PROCESS READIED VOLUMES.   */ 00392300
*/********************************************************************/ 00392400
*/*                                                                  */ 00392500
*/* SEGMENT NAME - TESTRDY                                           */ 00392600
*/*                                                                  */ 00392700
*/* DESCRIPTIVE NAME - SCAN FOR READY UCB'S                          */ 00392800
*/*                                                                  */ 00392900
*/* FUNCTION -                                                       */ 00393000
*/*                                                                  */ 00393100
*/*     SCAN FOR ALL UCBS POINTED TO BY THE LOOK-UP TABLE.           */ 00393200
*/*     IF THE UCB FOUND IS READY, AND THE VOLUME                    */ 00393300
*/*     SERIAL FIELD IS ZERO,  THE EXCP TO READ THE VOLUME SERIAL    */ 00393400
*/*     IS SET UP AND THE SEGMENT THAT ISSUES THE EXCP IS EXECUTED.  */ 00393500
*/*                                                                  */ 00393600
*/*     WHEN A COMPLETE SCAN OF THE UCB'S HAS BEEN MADE, 'DEVMTCT'   */ 00393700
*/*     IS UPDATED TO THE VALUE IN 'TOMOUNT'.MESSAGE IEA893A         */ 00393800
*/*     IS ISSUED AND THE REPLY IS EXAMINED. IF THE REPLY IS         */ 00393900
*/*     NO,THEN SCANNING OF UCB'S TERMINATES AND VAP                 */ 00394000
*/*     PREPARES TO EXIT.IF THE REPLY IS U OR EOB,                   */ 00394100
*/*     THEN THE VOLUMES LISTED IN THE MESSAGE ARE READY AND         */ 00394200
*/*     VAP SCANS THE UCB'S AGAIN.IF THE REPLY IS INVALID,           */ 00394300
*/*     MESSAGE IEA893A IS REISSUED.                                 */ 00394400
*/*                                                                  */ 00394500
*/* ENTRY - IN-LINE SEGMENT                                          */ 00394600
*/*                                                                  */ 00394700
*/*     PURPOSE - SEE FUNCTION                                       */ 00394800
*/*                                                                  */ 00394900
*/*     INPUT DATA - NONE                                            */ 00395000
*/*                                                                  */ 00395100
*/* EXITS -                                                          */ 00395200
*/*                                                                  */ 00395300
*/*     CONDITION - NORMAL                                           */ 00395400
*/*                                                                  */ 00395500
*/*     OUTPUT DATA -                                                */ 00395600
*/*                                                                  */ 00395700
*/*         EXCP - SET UP TO READ IF UCB IS READY AND VOLUME         */ 00395800
*/*                SERIAL FIELD IS ZERO                              */ 00395900
*/*         DEVMTCT - UPDATED                                        */ 00396000
*/*         MESSAGE IEA893A                                          */ 00396100
*/*                                                                  */ 00396200
*/*     RETURN CODE - NONE                                           */ 00396300
*/*                                                                  */ 00396400
*/********************************************************************/ 00396500
*DO UCINDXP = CVTILK2 BY 2 WHILE (HFUCBPTR ¬= LISTEND);                 00396600
@DL01097 L     R10,CVTPTR                                               00396700
         MVC   UCINDXP,CVTILK2-CVT(R10)                                 00396800
         B     @DE01098                                                 00396900
*                                      /* SCAN ALL UCBS IN LOOK UP      00397000
*                                         TABLE                      */ 00397100
*  IF HFUCBPTR ¬= ZERO THEN            /* IF UCB PTR NOT ZERO THEN   */ 00397200
@DL01098 L     R10,UCINDXP                                              00397300
         XR    R5,R5                                                    00397400
         ICM   R5,B'0011',0(R10)                                        00397500
         BZ    @RF01099                                                 00397600
*    DO;                               /* DO                         */ 00397700
*      UCBPTR = HFUCBPTR;              /* OBTAIN UCB ADDR            */ 00397800
*      IF UCB3DACC = YES &             /*IF UCB IS DIRECT ACCESS,    */ 00397900
*         UCBNOTRD = NO &              /*AND IS READY, AND HAS       */ 00398000
*         UCBVOLI = ZEROVOLI           /*ZERO VOL SER NUMBER,        */ 00398100
*        THEN DO;                      /*AND IS NOT A MULTIPLE       */ 00398200
         TM    UCBTBYT3-UCB(R5),UCB3DACC                                00398300
         BNO   @RF01099                                                 00398400
         TM    UCBFLA-UCB(R5),UCBNOTRD                                  00398500
         BNZ   @RF01099                                                 00398600
         CLC   UCBVOLI-UCB(,R5),ZEROVOLI                                00398700
         BNE   @RF01099                                                 00398800
*          IF UCBMTPXP = NO   (UCBBASE + ADJBASE) = UCBPTR /*        */ 00398900
*            THEN DO;                  /*EXPOSURE DEVICE, OR         */ 00399000
         TM    UCBWGT-UCB(R5),UCBMTPXP                                  00399100
         BZ    @RT01104                                                 00399200
         LA    R10,512                                                  00399300
         AL    R10,UCBBASE-UCB(,R5)                                     00399400
         CR    R10,R5                                                   00399500
         BNE   @RF01099                                                 00399600
*                                      /*IS THE                      */ 00399700
*                                      /*BASE EXPOSURE, THEN         */ 00399800
*                                      /*SET UP FOR EXCP:            */ 00399900
*              DEBUCBA = UCBPTR;       /*UCB ADDRESS                 */ 00400000
@RT01104 L     R10,DEBDAPTR                                             00400100
         STCM  R5,B'0111',DEBUCBA-DEBDASD(R10)                          00400200
*              ECB = ZERO;             /*CLEAR ECB                   */ 00400300
         L     R10,ECBPTR                                               00400400
         XC    0(4,R10),0(R10)                                          00400500
*              LABELBUF = BLANK;       /*CLEAR LABEL READ AREA       */ 00400600
         MVI   LABELBUF,C' '                                            00400700
         MVC   LABELBUF+1(L'LABELBUF-1),LABELBUF                        00400800
*                                      /*READ VOLUME LABEL           */ 00400900
*/********************************************************************/ 00401000
*/*                                                                  */ 00401100
*/* SEGMENT NAME - READSER                                           */ 00401200
*/*                                                                  */ 00401300
*/* DESCRIPTIVE NAME - READ SERIAL OF THE VOLUME MOUNTED             */ 00401400
*/*                                                                  */ 00401500
*/* FUNCTION -                                                       */ 00401600
*/*                                                                  */ 00401700
*/*     THE MESSAGE INDICATOR 'ERRMSG' IS INITIALIZED TO ZERO, AND   */ 00401800
*/*     AN EXCP IS ISSUED TO READ THE SERIAL OF THE VOLUME MOUNTED.  */ 00401900
*/*     IF AN I/O ERROR OCCURS, THE NOT-READY BIT IN THE UCB IS      */ 00402000
*/*     TURNED ON AND 'ERRMSG' IS SET TO 1.  IF THE READ IS SUCCESS- */ 00402100
*/*     FUL, THE VOLUME SERIAL IS CHECKED FOR DUPLICATION.  IF THE   */ 00402200
*/*     VOLUME SERIAL IS FOUND TO BE ALREADY MOUNTED, THE NOT-READY  */ 00402300
*/*     BIT IS TURNED ON IN THE UCB AND 'ERRMSG' IS SET TO 2.  IF    */ 00402400
*/*     THE VOLUME SERIAL IS NOT A DUPLICATE, THE SEGMENT WHICH      */ 00402500
*/*     CHECKS FOR THE VOLUME SERIAL IN THE MOUNT LIST IS EXECUTED.  */ 00402600
*/*                                                                  */ 00402700
*/*     IF THE NOT-READY BIT HAS NOT BEEN TURNED ON IN THE UCB, THE  */ 00402800
*/*     VOLUME SERIAL AND THE TTR ARE MOVED IN.                      */ 00402900
*/*                                                                  */ 00403000
*/*     IF 'ERRMSG' HAS BEEN SET, THE SEGMENT THAT HANDLES THE ERROR */ 00403100
*/*     PROCESSING IS EXECUTED.                                      */ 00403200
*/*                                                                  */ 00403300
*/* ENTRY - IN-LINE SEGMENT                                          */ 00403400
*/*                                                                  */ 00403500
*/*     PURPOSE - SEE FUNCTION                                       */ 00403600
*/*                                                                  */ 00403700
*/*     INPUT DATA -                                                 */ 00403800
*/*                                                                  */ 00403900
*/*         EXCP - SET UP TO READ                                    */ 00404000
*/*                                                                  */ 00404100
*/* EXITS -                                                          */ 00404200
*/*                                                                  */ 00404300
*/*     CONDITION - NORMAL                                           */ 00404400
*/*                                                                  */ 00404500
*/*     OUTPUT DATA -                                                */ 00404600
*/*                                                                  */ 00404700
*/*         UCB - UPDATED                                            */ 00404800
*/*                                                                  */ 00404900
*/*     CONDITION - I/O ERROR READING VOLUME SERIAL                  */ 00405000
*/*                                                                  */ 00405100
*/*     OUTPUT DATA -                                                */ 00405200
*/*                                                                  */ 00405300
*/*         UCB - UPDATED                                            */ 00405400
*/*         ERRMSG - SET TO 1                                        */ 00405500
*/*                                                                  */ 00405600
*/*     CONDITION - DUPLICATE VOLUME                                 */ 00405700
*/*                                                                  */ 00405800
*/*     OUTPUT DATA -                                                */ 00405900
*/*                                                                  */ 00406000
*/*         UCB - UPDATED                                            */ 00406100
*/*         ERRMSG - SET TO 2                                        */ 00406200
*/*                                                                  */ 00406300
*/*     RETURN CODE - NONE                                           */ 00406400
*/*                                                                  */ 00406500
*/********************************************************************/ 00406600
*                                                                       00406700
*ERRMSG = ZERO;                        /*INITIALIZE ERROR INDICATOR  */ 00406800
         XC    ERRMSG,ERRMSG                                            00406900
*R1 = IOBSTPTR;                        /*ADDRESS OF IOB              */ 00407000
         L     R1,IOBSTPTR                                              00407100
*                                                                       00407200
         EXCP  (R1)                                                     00407300
*                                                                       00407400
*R1 = ECBPTR;                          /*ADDRESS OF ECB              */ 00407500
         L     R1,ECBPTR                                                00407600
*                                                                       00407700
         WAIT  ECB=(R1)                                                 00407800
*                                                                       00407900
*IF ECBCC ¬= GOODPOST                  /*IF ERROR IN EXCP OR         */ 00408000
*  VOL1 ¬= COMPVOL1                    /*NO STANDARD LABEL,          */ 00408100
*  THEN DO;                                                             00408200
         L     R10,ECBPTR                                               00408300
         CLI   0(R10),X'7F'                                             00408400
         BNE   @RT01115                                                 00408500
         CLC   VOL1(4),KCVOL1                                           00408600
         BE    @RF01115                                                 00408700
*    IOBFLAG1 = IOBFLAGS;              /*RE-INIT CHAINING AND           00408800
*                                        UNRELATED REQUEST FLAGS,    */ 00408900
@RT01115 L     R10,IOBSTPTR                                             00409000
         MVI   IOBFLAG1-IOBSTDRD(R10),X'42'                             00409100
*    UCBNOTRD = YES;                   /*UNLOAD DEVICE, AND          */ 00409200
         OI    UCBFLA-UCB(R5),UCBNOTRD                                  00409300
*    ERRMSG = ONE;                     /*INDICATE ERROR.             */ 00409400
         MVC   ERRMSG,KF1                                               00409500
         B     @RC01115                                                 00409600
*                                                                       00409700
*  END;                                                                 00409800
*  ELSE DO;                                                             00409900
*    NMNTVS = VOLSER;                  /*MOVE VOLSER INTO PARM LIST     00410000
*                                        FOR NIPMOUNT ROUTINE        */ 00410100
@RF01115 LA    R10,NIPMNT                                               00410200
         MVC   NMNTVS(6,R10),VOLSER                                     00410300
*                                      /*CHECK FOR DUP VOLUME        */ 00410400
         IEAPMNIP TYPE=MOUNT,PARAM=NIPMNT,OPT=(,,,US)                   00410500
*                                                                       00410600
*    IF R1 ¬= ZERO                     /*ANOTHER VOLUME WITH SAME    */ 00410700
*      THEN DO;                        /*SERIAL IS MOUNTED           */ 00410800
         LTR   R1,R1                                                    00410900
         BZ    @RF01124                                                 00411000
*        UCBNOTRD = YES;               /*UNLOAD VOLUME               */ 00411100
         OI    UCBFLA-UCB(R5),UCBNOTRD                                  00411200
*        ERRMSG = TWO;                 /*SET ERROR INDICATOR         */ 00411300
         MVC   ERRMSG,KF2                                               00411400
         B     @RC01124                                                 00411500
*                                                                       00411600
*      END;                                                             00411700
*      ELSE DO;                        /*SEE IF VOL IS IN MOUNT LIST */ 00411800
*/********************************************************************/ 00411900
*/*                                                                  */ 00412000
*/* SEGMENT NAME - CKVOLIST                                          */ 00412100
*/*                                                                  */ 00412200
*/* DESCRIPTIVE NAME - CHECK THE MOUNT LIST FOR THE MOUNTED VOLUME   */ 00412300
*/*                                                                  */ 00412400
*/* FUNCTION -                                                       */ 00412500
*/*                                                                  */ 00412600
*/*                                                                  */ 00412700
*/*     IF THE READIED VOLUME IS IN THE MOUNTLIST, THEN THE DEVICE   */ 00412800
*/*     TYPE IS CHECKED.  IF THE DEVICE TYPE OF THE MOUNT LIST ENTRY */ 00412900
*/*     DOESN'T MATCH THAT OF THE DEVICE, THEN THE VOLUME IS UNLOADED*/ 00413000
*/*     AND 'ERRMSG' IS SET TO 5.                                    */ 00413100
*/*                                                                  */ 00413200
*/*     IF THE DEVICE TYPES MATCH, THEN IF THE READIED VOLUME IS IN  */ 00413300
*/*     THE MOUNT LIST, AND THE TAG BIT IS ON IN THE UCB (INDICATOR  */ 00413400
*/*     FOR REQUESTED DEVICE), THEN THE TAG BIT IS TURNED OFF, THE   */ 00413500
*/*     SUBROUTINE THAT SETS THE ATTRIBUTES IS EXECUTED, THE DEVICE  */ 00413600
*/*     ENTRY IN 'DEVTABLE' IS ZEROED, THE DEVICE IS SET ONLINE AND  */ 00413700
*/*     'TOMOUNT' IS DECREMENTED.                                    */ 00413800
*/*                                                                  */ 00413900
*/*     IF THE VOLUME IS IN THE MOUNT LIST, BUT MOUNTED ON AN UNRE-  */ 00414000
*/*     QUESTED DEVICE, THE NOT-READY BIT IS TURNED ON IN THE UCB    */ 00414100
*/*     AND 'ERRMSG' IS SET TO 4.                                    */ 00414200
*/*                                                                  */ 00414300
*/*     IF THE VOLUME IS NOT IN THE MOUNT LIST, BUT IS MOUNTED ON A  */ 00414400
*/*     REQUESTED DEVICE, THE NOT-READY BIT IS TURNED ON IN THE UCB  */ 00414500
*/*     AND 'ERRMSG' IS SET TO 3.                                    */ 00414600
*/*                                                                  */ 00414700
*/* ENTRY - IN-LINE SEGMENT                                          */ 00414800
*/*                                                                  */ 00414900
*/*     PURPOSE - SEE FUNCTION                                       */ 00415000
*/*                                                                  */ 00415100
*/*     INPUT DATA -                                                 */ 00415200
*/*                                                                  */ 00415300
*/*         MNTLIST - MOUNT LIST                                     */ 00415400
*/*         THE VOLUME SERIAL OF THE MOUNTED VOLUME                  */ 00415500
*/*         DEVTABLE - THE DEVICE ADDRESSES AND CORRESPONDING        */ 00415600
*/*                    UCB ADDRESSES                                 */ 00415700
*/*                                                                  */ 00415800
*/* EXITS -                                                          */ 00415900
*/*                                                                  */ 00416000
*/*     CONDITION - VOLUME AND ENTRY DEVICE TYPES ARE NOT THE SAME   */ 00416100
*/*                                                                  */ 00416200
*/*     OUTPUT DATA -                                                */ 00416300
*/*                                                                  */ 00416400
*/*         UCB - UPDATED                                            */ 00416500
*/*         ERRMSG - SET TO 5                                        */ 00416600
*/*                                                                  */ 00416700
*/*     CONDITION - VOLUME IS IN MOUNT LIST AND ON A REQUESTED       */ 00416800
*/*                 DEVICE                                           */ 00416900
*/*                                                                  */ 00417000
*/*     OUTPUT DATA -                                                */ 00417100
*/*                                                                  */ 00417200
*/*         UCB - UPDATED                                            */ 00417300
*/*         DEVTABLE - ENTRY IS ZEROED                               */ 00417400
*/*         TOMOUNT - UPDATED                                        */ 00417500
*/*                                                                  */ 00417600
*/*     CONDITION - VOLUME IS IN THE MOUNT LIST AND ON AN            */ 00417700
*/*                 UNREQUESTED DEVICE                               */ 00417800
*/*                                                                  */ 00417900
*/*     OUTPUT DATA -                                                */ 00418000
*/*                                                                  */ 00418100
*/*         UCB - UPDATED                                            */ 00418200
*/*         ERRMSG - SET TO 4                                        */ 00418300
*/*                                                                  */ 00418400
*/*     CONDITION - VOLUME IS NOT IN THE MOUNT LIST BUT IS ON        */ 00418500
*/*                 A REQUESTED DEVICE                               */ 00418600
*/*                                                                  */ 00418700
*/*     OUTPUT DATA -                                                */ 00418800
*/*                                                                  */ 00418900
*/*         UCB - UPDATED                                            */ 00419000
*/*         ERRMSG - SET TO 3                                        */ 00419100
*/*                                                                  */ 00419200
*/*                                                                  */ 00419300
*/*     RETURN CODE - NONE                                           */ 00419400
*/*                                                                  */ 00419500
*/********************************************************************/ 00419600
*                                                                       00419700
*FOUND = NO;                                                            00419800
@RF01124 NI    SWITCH1,255-FOUND                                        00419900
*DO I = ONE TO MTLSTCT WHILE (FOUND = NO);                              00420000
         LA    R10,1                                                    00420100
         B     @DE01132                                                 00420200
*                                                                       00420300
@DL01132 TM    SWITCH1,FOUND                                            00420400
         BNZ   @DC01132                                                 00420500
*  IF MVOLSER(I) = VOLSER              /*DETERMINE IF VOLUME IS IN   */ 00420600
*    THEN DO;                          /*THE MOUNTLIST               */ 00420700
         L     R8,GETADDR                                               00420800
         LR    R4,R10                                                   00420900
         MH    R4,KH18                                                  00421000
         ST    R4,@TF00001                                              00421100
         ALR   R4,R8                                                    00421200
         AL    R4,KFM18                                                 00421300
         CLC   0(6,R4),VOLSER                                           00421400
         BNE   @RF01133                                                 00421500
*      FOUND = YES;                                                     00421600
         OI    SWITCH1,FOUND                                            00421700
         L     R4,@TF00001                                              00421800
         BCTR  R8,R0                                                    00421900
*      J = DEVENT(I);                  /*OBTAIN UNIT TYPE INDEX      */ 00422000
         SLR   R15,R15                                                  00422100
         IC    R15,0(R4,R8)                                             00422200
         STH   R15,J                                                    00422300
*      MNTIND = I;                                                      00422400
         STH   R10,MNTIND                                               00422500
*      IF UCBTYPE(J) ¬= UCBTBYT4       /*IF UCB IS NOT SAME UNIT TYPE*/ 00422600
*        THEN DO;                      /*AS MNTLIST ENTRY            */ 00422700
         L     R10,UCBTYPAD                                             00422800
         BCTR  R10,0                                                    00422900
         SLR   R8,R8                                                    00423000
         IC    R8,0(R15,R10)                                            00423100
         MVC   @ZT00003+3(1),UCBTBYT4-UCB(R5)                           00423200
         C     R8,@ZT00003                                              00423300
         BE    @RF01133                                                 00423400
*          UCBNOTRD = YES;             /*UNLOAD THE DEVICE           */ 00423500
         OI    UCBFLA-UCB(R5),UCBNOTRD                                  00423600
*          ERRMSG = FIVE;              /*SET ERROR MESSAGE INDICATOR */ 00423700
         MVC   ERRMSG,KF5                                               00423800
*        END;                                                           00423900
*    END;                                                               00424000
*END;                                                                   00424100
@RF01133 LA    R10,1                                                    00424200
         AH    R10,I                                                    00424300
@DE01132 STH   R10,I                                                    00424400
         CH    R10,MTLSTCT                                              00424500
         BNH   @DL01132                                                 00424600
*IF ERRMSG = ZERO                                                       00424700
*  THEN IF FOUND = YES                 /*IF VOL IN MOUNT LIST AND    */ 00424800
@DC01132 ICM   R10,B'1111',ERRMSG                                       00424900
         BNZ   @RC01124                                                 00425000
*    THEN IF UCBPRSRS = YES            /*DEVICE IS REQUESTED, THEN   */ 00425100
         TM    SWITCH1,FOUND                                            00425200
         BNO   @RF01146                                                 00425300
*      THEN DO;                        /*REQUESTED VOL ON REQ. DEV.  */ 00425400
         TM    UCBSTAB-UCB(R5),UCBPRSRS                                 00425500
         BNO   @RF01147                                                 00425600
*        UCBONLI = YES;                /*MAKE UCB ONLINE AND         */ 00425700
         OI    UCBSTAT-UCB(R5),UCBONLI                                  00425800
*        UCBPRSRS = NO;                /*TURN OFF REQ DEV BIT        */ 00425900
         NI    UCBSTAB-UCB(R5),255-UCBPRSRS                             00426000
*        MAPAD = ADDR(MNTLIST(MNTIND));  /*MAPPING FOR MOUNT LIST    */ 00426100
         MVC   I(2),MNTIND                                              00426200
*        CALL SETSTAT;                 /*SET VOL ATTRIBUTES          */ 00426300
         BAS   R14,SETSTAT                                              00426400
*        LOOPSW = NO;                                                   00426500
         NI    SWITCH3,255-LOOPSW                                       00426600
*        DO J = ONE TO TABLECT         /*LOOP THROUGH THE DEVTABLE   */ 00426700
*          WHILE (LOOPSW = NO);                                         00426800
         LA    R10,1                                                    00426900
         B     @DE01154                                                 00427000
*                                                                       00427100
@DL01154 TM    SWITCH3,LOOPSW                                           00427200
         BNZ   @DC01154                                                 00427300
*          IF UCBADDR(J) = UCBPTR      /*WHEN ENTRY IS FOUND         */ 00427400
*            THEN DO;                                                   00427500
         SLA   R10,3                                                    00427600
         C     R5,DEVICE-4(R10)                                         00427700
         BNE   @RF01155                                                 00427800
*              DEVICE(J) = ZEROADDR;   /*ZERO THE ENTRY              */ 00427900
         LA    R8,DEVICE-8(R10)                                         00428000
         MVC   0(3,R8),ZEROADDR                                         00428100
*              LOOPSW = YES;                                            00428200
         OI    SWITCH3,LOOPSW                                           00428300
*            END;                                                       00428400
*        END;                                                           00428500
@RF01155 LA    R10,1                                                    00428600
         AH    R10,J                                                    00428700
@DE01154 STH   R10,J                                                    00428800
         CH    R10,TABLECT                                              00428900
         BNH   @DL01154                                                 00429000
*        TOMOUNT = TOMOUNT - ONE;      /*DECR CT OF VOLS TO BE MTD   */ 00429100
@DC01154 LH    R10,TOMOUNT                                              00429200
         BCTR  R10,0                                                    00429300
         STH   R10,TOMOUNT                                              00429400
         B     @RC01124                                                 00429500
*                                                                       00429600
*      END;                                                             00429700
*      ELSE DO;                        /*REQ VOL ON UNREQ DEVICE     */ 00429800
*        UCBNOTRD = YES;               /*UNLOAD VOLUME               */ 00429900
@RF01147 OI    UCBFLA-UCB(R5),UCBNOTRD                                  00430000
*        ERRMSG = FOUR;                /*SET ERROR CODE              */ 00430100
         MVC   ERRMSG,KF4                                               00430200
         B     @RC01124                                                 00430300
*                                                                       00430400
*      END;                                                             00430500
*    ELSE IF UCBPRSRS = YES            /*UNREQUESTED VOLUME ON       */ 00430600
*      THEN DO;                        /*REQUESTED DEVICE            */ 00430700
@RF01146 TM    UCBSTAB-UCB(R5),UCBPRSRS                                 00430800
         BNO   @RC01124                                                 00430900
*        UCBNOTRD = YES;               /*UNLOAD VOLUME               */ 00431000
         OI    UCBFLA-UCB(R5),UCBNOTRD                                  00431100
*        ERRMSG = THREE;               /*SET ERROR CODE              */ 00431200
         MVC   ERRMSG,KF3                                               00431300
*      END;                                                             00431400
*      END;                                                             00431500
*    IF UCBNOTRD = NO                  /*NO ERRORS WITH THIS VOLUME  */ 00431600
*      THEN DO;                        /*SET UP FOR TTR CONVERT      */ 00431700
@RC01124 TM    UCBFLA-UCB(R5),UCBNOTRD                                  00431800
         BNZ   @RC01115                                                 00431900
*        R1 = DEBPTR;                  /*ADDRESS OF DEB              */ 00432000
         L     R1,DEBPTR                                                00432100
*        MBB = ZERO;                   /*CLEAR BIN ADDRESS           */ 00432200
         XC    MBB,MBB                                                  00432300
*        CCHHR = VOLVTOC;              /*VTOC CCHHR                  */ 00432400
         MVC   CCHHR(5),VOLVTOC                                         00432500
*        R15 = CVTPRLTV;               /*ADDR OF CONVERT ROUTINE     */ 00432600
         L     R10,CVTPTR                                               00432700
         L     R15,CVTPRLTV-CVT(,R10)                                   00432800
         STM   R1,R15,REGSAVE            SAVE REGISTERS                 00432900
         LA    R4,REGSAVE                                               00433000
         LA    R2,MBBCCHHR                                              00433100
         BASR  R14,R15                   CONVERT ROUTINE                00433200
         LM    R1,R15,0(4)               RESTORE REGS                   00433300
*        UCBVTOC = R0;                 /*PUT VTOC TTR INTO UCB       */ 00433400
         ST    R0,UCBVTOC-UCB(,R5)                                      00433500
*        UCBVOLI = VOLSER;             /*MOVE VOLSER INTO UCB        */ 00433600
         MVC   UCBVOLI-UCB(,R5),VOLSER                                  00433700
*      END;                                                             00433800
*  END;                                                                 00433900
*IF ERRMSG > ZERO                      /*PROCESS ERRORS FOR THIS VOL */ 00434000
*  THEN DO;                                                             00434100
@RC01115 ICM   R10,B'1111',ERRMSG                                       00434200
         BNP   @RF01099                                                 00434300
*/********************************************************************/ 00434400
*/*                                                                  */ 00434500
*/* SEGMENT NAME - ERRPROC                                           */ 00434600
*/*                                                                  */ 00434700
*/* DESCRIPTIVE NAME - HANDLE VOLUME ERRORS                          */ 00434800
*/*                                                                  */ 00434900
*/* FUNCTION -                                                       */ 00435000
*/*                                                                  */ 00435100
*/*     IF 'ERRMSG' IS 1, AND IT WAS AN I/O ERROR, ISSUE NIPSENSE    */ 00435200
*/*     TO INFORM THE OPERATOR OF THE DEVICE ERROR.  MESSAGES        */ 00435300
*/*     'IEA854I-ERROR READING VOLUME LABEL. IEA948I                 */ 00435400
*/*     XXX NOW UNLOADED.' ARE ISSUED.                               */ 00435500
*/*                                                                  */ 00435600
*/*     IF 'ERRMSG' IS 2, MESSAGE 'IEA867I-DUPLICATE VOLUME AAAAAA.  */ 00435700
*/*     UNIT XXX NOW UNLOADED.' IS ISSUED.                           */ 00435800
*/*                                                                  */ 00435900
*/*     IF 'ERRMSG' IS 3, AND MESSAGE 'IEA859I-UNREQUESTED VOLUME.   */ 00436000
*/*     UNIT XXX NOW UNLOADED.' IS ISSUED.                           */ 00436100
*/*                                                                  */ 00436200
*/*     IF 'ERRMSG' IS 4, MESSAGE 'IEA894I-REQUESTED VOLUME ON UNRE- */ 00436300
*/*     QUESTED UNIT.  DDD NOW UNLOADED.' IS ISSUED.                 */ 00436400
*/*                                                                  */ 00436500
*/*     IF 'ERRMSG' IS 5, MESSAGES 'IEA866I VOLUME AAAAAA ON DDD     */ 00436600
*/*     REQUIRED ON A UUUUUUUU.' AND 'IEA948I DDD NOW UNLOADED.'     */ 00436700
*/*     ARE ISSUED.                                                  */ 00436800
*/*                                                                  */ 00436900
*/*                                                                  */ 00437000
*/* ENTRY - IN-LINE SEGMENT                                          */ 00437100
*/*                                                                  */ 00437200
*/*     PURPOSE - SEE FUNCTION                                       */ 00437300
*/*                                                                  */ 00437400
*/*     INPUT DATA -                                                 */ 00437500
*/*                                                                  */ 00437600
*/*         UCB ADDRESS                                              */ 00437700
*/*         ERRMSG - SET TO INDICATE ERROR ENCOUNTERED               */ 00437800
*/*                                                                  */ 00437900
*/* EXITS -                                                          */ 00438000
*/*                                                                  */ 00438100
*/*     CONDITION - ERRMSG IS SET TO 1                               */ 00438200
*/*                                                                  */ 00438300
*/*     OUTPUT DATA -                                                */ 00438400
*/*                                                                  */ 00438500
*/*         SENSE MESSAGE ISSUED IF DEVICE ERROR                     */ 00438600
*/*         MESSAGE IEA854I ISSUED                                   */ 00438700
*/*                                                                  */ 00438800
*/*     CONDITION - ERRMSG IS SET TO 2                               */ 00438900
*/*                                                                  */ 00439000
*/*     OUTPUT DATA -                                                */ 00439100
*/*                                                                  */ 00439200
*/*         MESSAGE IEA867I ISSUED                                   */ 00439300
*/*                                                                  */ 00439400
*/*     CONDITION - ERRMSG IS SET TO 3                               */ 00439500
*/*                                                                  */ 00439600
*/*     OUTPUT DATA -                                                */ 00439700
*/*                                                                  */ 00439800
*/*         MESSAGE IEA859I IS ISSUED                                */ 00439900
*/*                                                                  */ 00440000
*/*     CONDITION - ERRMSG IS SET TO 4                               */ 00440100
*/*                                                                  */ 00440200
*/*     OUTPUT DATA -                                                */ 00440300
*/*                                                                  */ 00440400
*/*         MESSAGE IEA894I IS ISSUED                                */ 00440500
*/*                                                                  */ 00440600
*/*     CONDITION - ERRMSG IS SET TO 5                               */ 00440700
*/*                                                                  */ 00440800
*/*     OUTPUT DATA -                                                */ 00440900
*/*                                                                  */ 00441000
*/*         MESSAGE IEA866I                                          */ 00441100
*/*         MESSAGE IEA948I                                          */ 00441200
*/*                                                                  */ 00441300
*/*     RETURN CODE - NONE                                           */ 00441400
*/*                                                                  */ 00441500
*/********************************************************************/ 00441600
*                                                                       00441700
*IF ERRMSG = ONE                       /*ERROR READING VOL SER NUMBER*/ 00441800
*  THEN DO;                                                             00441900
         CH    R10,KH1                                                  00442000
         BNE   @RF01188                                                 00442100
*    IF ECBCC ¬= GOODPOST              /*IF I/O ERROR FROM EXCP      */ 00442200
*      THEN DO;                                                         00442300
         L     R10,ECBPTR                                               00442400
         CLI   0(R10),X'7F'                                             00442500
         BE    @RF01190                                                 00442600
*        R1 = IOBSTPTR;                /*ISSUE NIP SENSE TO          */ 00442700
         L     R1,IOBSTPTR                                              00442800
*                                                                       00442900
         IEAPMNIP TYPE=SENSE,PARAM=RPARM                                00443000
*                                                                       00443100
*      END;                                                             00443200
*    V948 = BLANK;                     /*REMOVE V FROM MSG           */ 00443300
@RF01190 MVI   V948,C' '                                                00443400
*    DEV948 = UCBNAME;                                                  00443500
         MVC   DEV948(3),UCBNAME-UCB(R5)                                00443600
*    /*IEA854I ERROR READING VOLUME LABEL.                           */ 00443700
*    /*IEA948I DDD NOW UNLOADED.                                     */ 00443800
*                                      /*ISSUE IEA854I + 948I        */ 00443900
     IEAPMNIP TYPE=WTO,PARAM=IEA854I                                    00444000
*                                                                       00444100
     IEAPMNIP TYPE=WTO,PARAM=IEA948I                                    00444200
*                                                                       00444300
*  END;                                                                 00444400
*IF ERRMSG = TWO                       /*DUPLICATE VOLUME SER NUMBER */ 00444500
*  THEN DO;                                                             00444600
@RF01188 CLC   ERRMSG,KF2                                               00444700
         BNE   @RF01201                                                 00444800
*    SER867 = VOLSER;                  /*MOVE VOLSER INTO MESSAGE    */ 00444900
         MVC   SER867(6),VOLSER                                         00445000
*    DEV867 = UCBNAME;                 /*MOVE DEVICE ADDR INTO MSG   */ 00445100
         MVC   DEV867(3),UCBNAME-UCB(R5)                                00445200
*    /*IEA867I DUPLICATE VOLUME AAAAAA.UNIT XXX NOW UNLOADED         */ 00445300
*                                                                       00445400
         IEAPMNIP TYPE=WTO,PARAM=IEA867I                                00445500
*  END;                                                                 00445600
*IF ERRMSG = THREE                     /*UNREQUESTED VOLUME ON       */ 00445700
*  THEN DO;                            /*REQUESTED DEVICE            */ 00445800
@RF01201 CLC   ERRMSG(4),KF3                                            00445900
         BNE   @RF01207                                                 00446000
*    DEV859 = UCBNAME;                 /*MOVE DEVICE ADDR INTO MSG   */ 00446100
         MVC   DEV859(3),UCBNAME-UCB(R5)                                00446200
*    /*IEA859I UNREQUESTED VOLUME. UNIT XXX NOW UNLOADED             */ 00446300
*                                                                       00446400
         IEAPMNIP TYPE=WTO,PARAM=IEA859I                                00446500
*  END;                                                                 00446600
*IF ERRMSG = FOUR                      /*REQUESTED VOLUME ON         */ 00446700
*  THEN DO;                            /*UNREQUESTED DEVICE          */ 00446800
@RF01207 CLC   ERRMSG(4),KF4                                            00446900
         BNE   @RF01212                                                 00447000
*    DEV894 = UCBNAME;                 /*MOVE DEVICE ADDR INTO MSG   */ 00447100
         MVC   DEV894(3),UCBNAME-UCB(R5)                                00447200
*   /*IEA894I REQUESTED VOLUME ON UNREQUESTED DEVICE.XXX NOW UNLOADED*/ 00447300
*                                                                       00447400
         IEAPMNIP TYPE=WTO,PARAM=IEA894I                                00447500
*  END;                                                                 00447600
*IF ERRMSG = FIVE                      /*UCB DEVICE TYPE DOES NOT    */ 00447700
*  THEN DO;                            /*MATCH MNTLIST ENTRY         */ 00447800
@RF01212 CLC   ERRMSG(4),KF5                                            00447900
         BNE   @RF01099                                                 00448000
*    SER866 = VOLSER;                  /*MOVE VOLSER INTO MESSAGE    */ 00448100
         MVC   SER866(6),VOLSER                                         00448200
*    DEV866 = UCBNAME;                 /*MOVE DEVICE ADDR INTO MSG   */ 00448300
         MVC   DEV866(3),UCBNAME-UCB(R5)                                00448400
*    DT866 = ETYPE(J);                                                  00448500
         LH    R10,J                                                    00448600
         SLA   R10,3                                                    00448700
         L     R8,DEVTYPAD                                              00448800
         ALR   R8,R10                                                   00448900
         AL    R8,KFM8                                                  00449000
         MVC   DT866(8),0(R8)                                           00449100
*    /*IEA866I VOLUME AAAAAA ON DDD REQUIRED ON A UUUUUUUU           */ 00449200
*                                                                       00449300
         IEAPMNIP TYPE=WTO,PARAM=IEA866I                                00449400
*                                                                       00449500
*    DEV948 = UCBNAME;                                                  00449600
         MVC   DEV948(3),UCBNAME-UCB(R5)                                00449700
*    /*IEA948I XXX NOW UNLOADED                                      */ 00449800
*                                                                       00449900
         IEAPMNIP TYPE=WTO,PARAM=IEA948I                                00450000
*  END;                                                                 00450100
*  END;                                                                 00450200
*            END;                                                       00450300
*        END;                                                           00450400
*    END;                                                               00450500
*END;                                                                   00450600
@RF01099 L     R10,UCINDXP                                              00450700
         LA    R10,2(,R10)              INCR UCB ADDR ->                00450800
         ST    R10,UCINDXP                                              00450900
@DE01098 L     R10,UCINDXP                                              00451000
         CLC   0(2,R10),KXFFFF          END OF UCB CHAIN ?              00451100
         BNE   @DL01098                 NO, REDRIVE LOOP                00451200
*        END OF UCB CHAIN                                               00451300
*DEVMTCT = TOMOUNT;                    /*UPDATE LOOP CONTROL COUNTER */ 00451400
         LH    R10,TOMOUNT                                              00451500
         STH   R10,DEVMTCT                                              00451600
*IF TOMOUNT > 0                        /*IF ALL VOLS HAVE            */ 00451700
*  THEN DO;                            /*NOT COME READY,             */ 00451800
         SLR   R8,R8                                                    00451900
         CR    R10,R8                                                   00452000
         BNH   @DE01097                                                 00452100
*    DEV860 = BLANK;                   /*PREPARE MSG                 */ 00452200
         MVI   DEV860,C' '                                              00452300
         MVC   DEV860+1(L'DEV860-1),DEV860                              00452400
*    I = ZERO;                                                          00452500
         STH   R8,I                                                     00452600
*    DO DEVIND = ONE TO TABLECT;       /*LOOP THROUGH DEVTABL        */ 00452700
         LA    R5,1                                                     00452800
         B     @DE01236                                                 00452900
*                                                                       00453000
*      IF DEVICE(DEVIND) ¬= ZEROADDR   /*IF ENTRY HAS NOT            */ 00453100
*        THEN DO;                      /*BEEN MOUNTED, THEN          */ 00453200
@DL01236 LR    R10,R5                                                   00453300
         SLA   R10,3                                                    00453400
         LA    R8,DEVICE-8(R10)                                         00453500
         CLC   0(3,R8),ZEROADDR                                         00453600
         BE    @RF01237                                                 00453700
*          I = I + ONE;                /*MOVE ENTRY INTO             */ 00453800
         LA    R8,1                                                     00453900
         AH    R8,I                                                     00454000
         STH   R8,I                                                     00454100
*          UNITAD(I) = DEVICE(DEVIND); /*MESSAGE AREA                */ 00454200
         SLA   R8,2                                                     00454300
         LA    R4,DEV860                                                00454400
         ALR   R4,R8                                                    00454500
         AL    R4,KFM4                                                  00454600
         LA    R8,DEVICE-8(R10)                                         00454700
         MVC   0(3,R4),0(R8)                                            00454800
*        END;                                                           00454900
*    END;                                                               00455000
@RF01237 AL    R5,KF1                                                   00455100
@DE01236 CH    R5,TABLECT                                               00455200
         BNH   @DL01236                                                 00455300
*IF I > ONE THEN                       /*IF MORE THAN ONE            */ 00455400
         LA    R10,1                                                    00455500
         CH    R10,I                                                    00455600
         BNL   @RF01243                                                 00455700
         B     @DE01244                                                 00455800
*                                                                       00455900
*  DO J = ONE TO (I-ONE);              /*DEVICE IN MESSAGE,          */ 00456000
*    COM(J) = COMMA;                   /*INSERT COMMAS               */ 00456100
@DL01244 LR    R8,R10                                                   00456200
         SLA   R8,2                                                     00456300
         LA    R15,DEV860                                               00456400
         ALR   R15,R8                                                   00456500
         BCTR  R15,0                                                    00456600
         MVI   0(R15),C','                                              00456700
*  END;                                                                 00456800
         AL    R10,KF1                                                  00456900
@DE01244 STH   R10,J                                                    00457000
         LH    R8,I                                                     00457100
         BCTR  R8,0                                                     00457200
         CR    R10,R8                                                   00457300
         BNH   @DL01244                                                 00457400
*                                                                       00457500
*BADREPLY = YES;                                                        00457600
@RF01243 OI    SWITCH2,BADREPLY                                         00457700
         B     @DE01248                                                 00457800
*                                                                       00457900
*DO WHILE BADREPLY = YES;              /*ISSUE MESSAGE               */ 00458000
*  BADREPLY = NO;                      /*AND CHECK REPLY             */ 00458100
@DL01248 NI    SWITCH2,255-BADREPLY                                     00458200
*          IEA893A DEVICES NOT READY. REPLY U WHEN DEVICES              00458300
*          ARE READY OR NO TO CONTINUE.                                 00458400
*          DDD,DDD,...                                                  00458500
*                                                                       00458600
         IEAPMNIP TYPE=WTO,PARAM=IEA860A                                00458700
*                                                                       00458800
         IEAPMNIP TYPE=WTOR,PARAM=IEA893A                               00458900
*                                      /*                            */ 00459000
*  IF WTORBUF = COMPNO                 /*IF REPLY IS NO,             */ 00459100
*    THEN DEVMTCT = ZERO;              /*THEN STOP LOOPING           */ 00459200
         CLC   WTORBUF(2),KCNO                                          00459300
         BNE   @RF01251                                                 00459400
         SLR   R10,R10                                                  00459500
         STH   R10,DEVMTCT                                              00459600
         B     @DE01248                                                 00459700
*                                                                       00459800
*    ELSE IF WTORBUF ¬= REPLYU &       /*FOR VOLS TO COME            */ 00459900
*                                      /*RDY INVALID REPLY           */ 00460000
*      WTORBUF ¬= REPLYEOB                                              00460100
*      THEN BADREPLY = YES;            /*SET SWITCH                  */ 00460200
@RF01251 CLC   WTORBUF(2),KCU                                           00460300
         BE    @DE01248                                                 00460400
         CLC   WTORBUF(2),@CC00169                                      00460500
         BE    @DE01248                                                 00460600
         OI    SWITCH2,BADREPLY                                         00460700
*END;                                                                   00460800
@DE01248 TM    SWITCH2,BADREPLY                                         00460900
         BO    @DL01248                                                 00461000
*END;                                                                   00461100
*        END;                                                           00461200
@DE01097 SLR   R10,R10                                                  00461300
         CH    R10,DEVMTCT                                              00461400
         BL    @DL01097                                                 00461500
*        DO;                           /* CLEANUP TAG BITS IN UCBS   */ 00461600
*/********************************************************************/ 00461700
*/*                                                                  */ 00461800
*/* SEGMENT NAME - CLEANUP                                           */ 00461900
*/*                                                                  */ 00462000
*/* DESCRIPTIVE NAME - TURN OFF TAG BITS IN UCB                      */ 00462100
*/*                                                                  */ 00462200
*/* FUNCTION -                                                       */ 00462300
*/*                                                                  */ 00462400
*/*     IF ALL VOLUMES WERE NOT MOUNTED, THE TAG BIT IS TURNED OFF   */ 00462500
*/*     IN ALL UCB'S CORRESPONDING TO NON-ZEROED 'DEVTABLE' ENTRIES. */ 00462600
*/*                                                                  */ 00462700
*/* ENTRY - IN-LINE SEGMENT                                          */ 00462800
*/*                                                                  */ 00462900
*/*     INPUT DATA -                                                 */ 00463000
*/*                                                                  */ 00463100
*/*         DEVTABLE - THE DEVICE ADDRESSES AND CORRESPONDING        */ 00463200
*/*                    UCB ADDRESSES                                 */ 00463300
*/*                                                                  */ 00463400
*/* EXITS -                                                          */ 00463500
*/*                                                                  */ 00463600
*/*     CONDITION - ALL VOLUMES WERE NOT MOUNTED                     */ 00463700
*/*                                                                  */ 00463800
*/*     OUTPUT DATA -                                                */ 00463900
*/*                                                                  */ 00464000
*/*         UCB - UPDATED                                            */ 00464100
*/*                                                                  */ 00464200
*/*     RETURN CODE - NONE                                           */ 00464300
*/*                                                                  */ 00464400
*/********************************************************************/ 00464500
*                                                                       00464600
*IF TOMOUNT > ZERO                     /*IF ALL VOLS WERE NOT MOUNTED*/ 00464700
*  THEN DO;                            /*THEN TURN OFF UCBPRSRS BIT  */ 00464800
         CH    R10,TOMOUNT                                              00464900
         BNL   @RF01055                                                 00465000
*    DO I = ONE TO TABLECT;            /*SCAN DEVTABLE               */ 00465100
         LA    R10,1                                                    00465200
         B     @DE01261                                                 00465300
*                                                                       00465400
*      IF DEVICE(I) ¬= ZEROADDR        /*FOR ANY UNMOUNTED DEVICE    */ 00465500
*        THEN DO;                                                       00465600
@DL01261 SLA   R10,3                                                    00465700
         LA    R8,DEVICE-8(R10)                                         00465800
         CLC   0(3,R8),ZEROADDR                                         00465900
         BE    @RF01262                                                 00466000
*          UCBPTR = UCBADDR(I);                                         00466100
         L     R5,UCBADDR-8(R10)                                        00466200
*          UCBPRSRS = NO;              /*TURN OFF REQUESTED DEV BIT  */ 00466300
         NI    UCBSTAB-UCB(R5),255-UCBPRSRS                             00466400
*        END;                                                           00466500
*    END;                                                               00466600
@RF01262 LA    R10,1                                                    00466700
         AH    R10,I                                                    00466800
@DE01261 STH   R10,I                                                    00466900
         CH    R10,TABLECT                                              00467000
         BNH   @DL01261                                                 00467100
*  END;                                                                 00467200
*        END;                                                           00467300
*      END;                                                             00467400
*    IF DPLOADED = YES THEN                                             00467500
@RF01055 TM    SWITCH2,DPLOADED                                         00467600
         BNO   @RF00877                                                 00467700
*      DO;                                                              00467800
*          DO;/* DELETE EP(IEEVDEV)*/                                   00467900
*          R0 = ADDR(IEEVDEV);/* ->ENTRY NAME*/                         00468000
         LA    R0,IEEVDEV                                               00468100
*          SVC    (9);/* DELETE SVC*/                                   00468200
         SVC   9                                                        00468300
*          END;/* DELETE EP(IEEVDEV)*/                                  00468400
*      END;                                                             00468500
*  END;                                                                 00468600
*  DO; /*FREEMAIN(RU) LV(DATABLEN)A(DEVTYPAD) SP(0)*/                   00468700
*  R1 = 0; /* R1 MUST BE ZERO*/                                         00468800
@RF00877 SLR   R1,R1                                                    00468900
*  R15=3; /*SET TYPE*/                                                  00469000
         LA    R15,3                                                    00469100
*  R0 = DATABLEN; /* LENGTH REQUESTED*/                                 00469200
         L     R0,DATABLEN                                              00469300
*  R1=ADDR(DEVTYPAD); /*SET REGISTER ONE*/                              00469400
         L     R1,DEVTYPAD                                              00469500
*  R15=R15+((0)*256); /* SUBPOOL VALUE*/                                00469600
*  SVC(120); /*RC/RU-FORM OF GETMAIN*/                                  00469700
         SVC   120                                                      00469800
*  END; /*FREEMAIN(RU) LV(DATABLEN)A(DEVTYPAD) SP(0)*/                  00469900
*                                      /* FREE DA WORK AREAS @G64IPSJ*/ 00470000
         SLR   R1,R1                                                    00470100
         LA    R15,3                                                    00470200
         L     R0,GETSIZE                                               00470300
         L     R1,GETADDR                                               00470400
         SVC   120                                                      00470500
*RETURN;                               /* RETURN TO NIP CALLER.      */ 00470600
@EL00001 L     R13,4(,R13)                                              00470700
@ER00001 RETURN (14,12)                                                 00470800
*                                                                       00470900
*/********************************************************************/ 00471000
*/*                                                                  */ 00471100
*/* MACRO-      IEAPSPIO                                             */ 00471200
*/*                                                                  */ 00471300
*/* STATUS-     VERSION DATE=10/24/73, VS/2 RELEASE 2                */ 00471400
*/*                                                                  */ 00471500
*/* FUNCTION-   IEAPSPIO IS PART OF THE  SUPERVISOR                  */ 00471600
*/*             INITIALIZATION PROCESS FOR VS2.                      */ 00471700
*/*                                                                  */ 00471800
*/*             THIS MACRO GENERATES INLINE PL/S STATEMENTS          */ 00471900
*/*             WHICH FORM A SUBROUTINE TO FIND AND READ TEXT        */ 00472000
*/*             RECORDS FROM SYS1.PARMLIB.                           */ 00472100
*/*                                                                  */ 00472200
*/*  REGISTER DEPENDENCIES-                                          */ 00472300
*/*                                                                  */ 00472400
*/*                 1. IEAPSPIO DEPENDS ON THE INCLUDING ROUTINES    */ 00472500
*/*                    BASE REGISTERS FOR ADDRESSABILITY             */ 00472600
*/*                                                                  */ 00472700
*/*                 2. REGISTER 3 MUST CONTAIN THE ADDRESS OF        */ 00472800
*/*                    THE CVT ON ENTRY                              */ 00472900
*/*                                                                  */ 00473000
*/*                 3. REGISTER 2 MUST CONTAIN THE ADDRESS OF        */ 00473100
*/*                    THE NVT ON ENTRY                              */ 00473200
*/*                                                                  */ 00473300
*/*                 4. REGISTER 14 MUST CONTAIN THE ADDRESS OF       */ 00473400
*/*                    THE CALLERS RETURN POINT ON ENTRY             */ 00473500
*/*                                                                  */ 00473600
*/* ENTRY POINTS-                                                    */ 00473700
*/*                                                                  */ 00473800
*/*    TWO CALLING SEQUENCRS ARE AVAILABLE.  ONE PROVIDES            */ 00473900
*/*    COMPATIBILITY WITH THE VS2-1 VERSION OF THIS MACRO,           */ 00474000
*/*    THE OTHER CALLING SEQUENCE WAS DEVELOPED EXPRESSLY            */ 00474100
*/*    FOR VS2-2.                                                    */ 00474200
*/*                                                                  */ 00474300
*/*        VS2-1 COMPATIBLE VERSION-                                 */ 00474400
*/*                                                                  */ 00474500
*/*            1. CALL NIPPMPDS TO LOCATE (VIA BLDL) THE MEMBER      */ 00474600
*/*               OF SYS1.PARMLIB                                    */ 00474700
*/*                                                                  */ 00474800
*/*            2. CALL NIPPMTXT TO READ A TEXT RECORD FROM           */ 00474900
*/*               SYS1.PARMLIB                                       */ 00475000
*/*                                                                  */ 00475100
*/*        VS2-2 VERSION-                                            */ 00475200
*/*                                                                  */ 00475300
*/*            1. CALL NIPPMMEM TO LOCATE THE MEMBER AND RETURN      */ 00475400
*/*               A TEXT RECORD                                      */ 00475500
*/*                                                                  */ 00475600
*/*            2. REPEAT CALL TO NIPPMMEM TO READ ADDITIONAL         */ 00475700
*/*               TEXT RECORDS                                       */ 00475800
*/*                                                                  */ 00475900
*/* OUTPUT (NORMAL) -                                                */ 00476000
*/*                                                                  */ 00476100
*/*     THE ROUTINE WILL SAVE AND RESTORE ALL GENERAL REGISTERS      */ 00476200
*/*     WITH THE EXCEPTION OF R1.     ON A SUCCESSFUL READ,          */ 00476300
*/*     R1 (REGISTER 1) WILL BE SET TO POINT TO THE FIRST NON-       */ 00476400
*/*     BLANK CHARACTER IN THE TEXT RECORD.  IF THE RECORD           */ 00476500
*/*     COLUMNS 1 THRU 72 ALL CONTAIN BLANKS, R1 WILL                */ 00476600
*/*     POINT TO A BLANK IN COLUMN 72.  IF COLUMNS 1 THRU 71         */ 00476700
*/*     ARE BLANK BUT COLUMN 72 IS NON-BLANK, THE ROUTINE            */ 00476800
*/*     WILL AUTOMATICALLY ATTEMPT TO READ THE NEXT RECORD.  IN      */ 00476900
*/*     ALL CASES, COLUMN 72 WILL BE SET TO BLANK AND COLUMN 73 WILL */ 00477000
*/*     BE SET TO X'FF'.                                             */ 00477100
*/*                                                                  */ 00477200
*/* EXIT (NORMAL)-                                                   */ 00477300
*/*                                                                  */ 00477400
*/*     VS2-1 AND VS2-2 VERSIONS RETURN TO THE ADDRESS FOUND         */ 00477500
*/*     IN REGISTER 14 ON ENTRY.                                     */ 00477600
*/*                                                                  */ 00477700
*/* EXIT (ERROR)-                                                    */ 00477800
*/*                                                                  */ 00477900
*/*     VS2-1 COMPATIBLE VERSION-                                    */ 00478000
*/*                                                                  */ 00478100
*/*         RETURN TO THE ADDRESS IN REGISTER 14 +4                  */ 00478200
*/*                                                                  */ 00478300
*/*         NOTE- WHEN AN ERROR OCCURS ON AN ATTEMP TO READ A RECORD */ 00478400
*/*               THAT DOES NOT EXIST (E-O-F),                       */ 00478500
*/*               IT IS CONSIDERED A PERMANENT I/O ERROR             */ 00478600
*/*                                                                  */ 00478700
*/*     VS2-2 VERSION-                                               */ 00478800
*/*                                                                  */ 00478900
*/*        RETURN TO THE ADDRESS FOUND IN REGISTER 14 ON ENTRY       */ 00479000
*/*        WITH REGISTER 1 (R1) SET TO A NEGATIVE VALUE.     IN THE  */ 00479100
*/*        CASE WHERE R1 IS NEGATIVE ON RETURN, THE NIPPARC FIELD */    00479200
*/*        OF THE NIP PATAMETER AREA WILL INDICATE THE REASON FOR    */ 00479300
*/*        FAILURE AS FOLLOWS-                                       */ 00479400
*/*                            4 - MEMBER NOT FOUND                  */ 00479500
*/*                            8 - I/O ERROR DURING BLDL             */ 00479600
*/*                            12- I/O ERROR DURING READ             */ 00479700
*/*                            16- END-OF-FILE                       */ 00479800
*/*                                                                  */ 00479900
*/*     COMMON TO BOTH VERSIONS-                                     */ 00480000
*/*                                                                  */ 00480100
*/*        AN INTERPRETIVE MESSAGE WILL BE WRITTEN TO THE OPERATOR   */ 00480200
*/*        FOR EACH OF THE FIRST THREE ERROR CONDITIONS LISTED       */ 00480300
*/*        ABOVE.  THE CALLER MAY SUPPRESS THE 'MEMBER NOT FOUND'    */ 00480400
*/*        MESSAGE BY SETTING THE NIPPAFL1 FLAG FIELD TO BINARY      */ 00480500
*/*        ONE IN THE NIP PARAMETER AREA BEFORE CALLING THIS         */ 00480600
*/*        ROUTINE.  NO MESSAGE WILL BE WRITTEN FOR THE E-O-F        */ 00480700
*/*        CONDITION IF THE VS2-2 VERSION IS USED.                   */ 00480800
*/*                                                                  */ 00480900
*/* MACROS-                                                          */ 00481000
*/*     THE FOLLOWING MAPPING MACROS MUST BE                         */ 00481100
*/*     INCLUDED IN THE MODULE WHICH INCLUDES                        */ 00481200
*/*     IEAPSPIO-                                                    */ 00481300
*/*                                       IEZIOB                     */ 00481400
*/*                                       IHANVT                     */ 00481500
*/*                                       IHAECB                     */ 00481600
*/*                                       IEAPPNIP                   */ 00481700
*/*                                       IEFUCBOB                   */ 00481800
*/*                                       CVT                        */ 00481900
*/*                                                                  */ 00482000
*/* NOTES-                                                           */ 00482100
*/*        THE FIRST FOUR LETTERS OF ALL IEAPSPIO SYMBOLES ARE:      */ 00482200
*/*        NIPP OR IPPM.                                             */ 00482300
*/*                                                                  */ 00482400
*/*        REGISTERS 0, 1, 14, AND 15 WILL BE UNRESTRICTED AT THE    */ 00482500
*/*        END OF THE SEGMENT GENERATED BY IEAPSPIO.                 */ 00482600
*/*                                                                  */ 00482700
*/*        NIPPAREA WILL BE BASED ON NVTPAREA AND IOBSTDRD WILL BE   */ 00482800
*/*        BASED ON THE ADDR OF NIPPAIOB AT THE END OF THE SEGMENT   */ 00482900
*/*        GENERATED BY IEAPSPIO                                     */ 00483000
*/*                                                                  */ 00483100
*/*        IEAPSPIO MUST BE INCLUDED IN A CODE SEGMENT,              */ 00483200
*/*        NOT AT THE TOP OF THE PROCEDURE WITH THE                  */ 00483300
*/*        MAPPING MACROS LISTED ABOVE.                              */ 00483400
*/*                                                                  */ 00483500
*/********************************************************************/ 00483600
*                                                                       00483700
*          /* SAVE AREA FOR CALLER'S REGISTERS                       */ 00483800
*          DCL NIPPMREG (16) FIXED(31);                                 00483900
*                                                                       00484000
*          /* SAVE AREA FOR CALLER'S RETURN ADDRESS                  */ 00484100
*          DCL NIPPMADR PTR(31);                                        00484200
*                                                                       00484300
*          /* POINTER TO DCB FOR BLDL                                */ 00484400
*          DCL NIPPMDCB PTR(31);                                        00484500
*                                                                       00484600
*          /* POINTER TO BLDL HEADER FOR BLDL                        */ 00484700
*          DCL NIPPMBDL PTR(31);                                        00484800
*                                                                       00484900
*          /* NORMAL RETURN TO CALLER                                */ 00485000
*          DCL NIPPMAD0 LABEL BASED(NIPPMADR);                          00485100
*                                                                       00485200
*          /* ERROR RETURN TO CALLER                                 */ 00485300
*          DCL NIPPMAD4 LABEL BASED(NIPPMADR+4);                        00485400
*                                                                       00485500
*          /* ESTABLISH BASE FOR NIP COMMUNICATION AREA              */ 00485600
*          RESPECIFY NIPPAREA BASED(NVTPAREA);                          00485700
*                                                                       00485800
*          /* ONE BYTE SCANNING FIELD                                */ 00485900
*          DCL NIPPMBYT CHAR(1) BASED;                                  00486000
*                                                                       00486100
*          /* TEMPORARY POINTER                                      */ 00486200
*          DCL NIPPMKPR PTR(31);                                        00486300
*                                                                       00486400
*                                                                       00486500
*          /* INPUT RECORD READ FROM PARMLIB                         */ 00486600
*          DCL NIPPMBUF CHAR(80) BASED(R1);                             00486700
*                                                                       00486800
*          /* MBBCCHHR OF PARMLIB MEMBERS                            */ 00486900
*          DCL 1 NIPPMMBC CHAR(8),                                      00487000
*                2 NIPPMMBB CHAR(3),                                    00487100
*                2 NIPPMCCH CHAR (5);                                   00487200
*                                                                       00487300
*           /*  CCHHR OF PARMLIB MEMBERS            */                  00487400
*     DCL 1 NIPPMSID BDY(WORD) CHAR(5) BASED(ADDR(NIPPASID)),           00487500
*       2   NIPPMCC FIXED(15),  /* CYLINDER # OF SEARCH ID           */ 00487600
*      2  NIPPMHH CHAR(2),  /* HEAD # OF SEARCH ID          */          00487700
*     2  NIPPMR CHAR(1); /* RECORD # OF SEARCH ID          */           00487800
*                                                                       00487900
*          /* LOW ORDER 7 BYTES OF THE CSW STORED IN THE PARMLIB        00488000
*             IOB BY EXCP                                            */ 00488100
*          DCL 1 NIPPMCSW BASED(ADDR(IOBCSW)) BDY(BYTE),                00488200
*                2 * CHAR(3),                                           00488300
*                2 NIPPMCS2 BIT(8),   /* I/O OPERATION STATUS FLAGS     00488400
*                                                                       00488500
*                2 * CHAR(3);                                           00488600
*                                                                       00488700
*          /* MASKS TO TEST THE STATUS FLAGS OF THE PARMLIB CSW      */ 00488800
*          DCL  NIPPMMK1 BIT(8) BDY(BYTE) INIT('11110010'B);            00488900
*           DCL NIPPMMK2 BIT(8) BDY(BYTE) INIT('11110001'B);            00489000
*             /* MASK TO TEST THE IOBSENSE FLAGS              */        00489100
*      DCL NIPPMMK3 BIT(8) BDY(BYTE) INIT('00100000'B);                 00489200
*                                                                       00489300
*          /* INTERNALLY GENERATED LABELS                            */ 00489400
*          DCL NIPPMMB1 LABEL GENERATED INTERNAL;                       00489500
*          DCL NIPPMMB2 LABEL GENERATED INTERNAL;                       00489600
*          DCL NIPPMTND LABEL GENERATED INTERNAL;                       00489700
*                                                                       00489800
*          /* MAPPING AREAS INTO ERROR MESSAGES                      */ 00489900
*          DCL NIPPMME1 CHAR(8) BASED(ADDR(NIPPMMB1));                  00490000
*          DCL NIPPMME2 CHAR(8) BASED(ADDR(NIPPMMB2));                  00490100
*          DCL NIPPMNAM CHAR(8) INIT(' '); /*MEMBER NAME SAVE AREA   */ 00490200
*          DCL NIPPMNEG FIXED(31) INIT('FFFFFFFF'X); /*NEGATIVE VALUE*/ 00490300
*NIPPMMEM: NIPPMADR=R14;       /* SAVE CALLER'S RETURN REGISTER      */ 00490400
NIPPMMEM LR    R5,R14                                                   00490500
         STM   R2,R1,NIPPMREG               SAVE REGISTERS              00490600
*          NIPPARC=NIPPARC && NIPPARC; /*SET RETURN CODE TO ZERO     */ 00490700
         L     R10,NVTPAREA(,R2)                                        00490800
         L     R8,NIPPARC(,R10)                                         00490900
         LR    R4,R8                                                    00491000
         XR    R4,R8                                                    00491100
         ST    R4,NIPPARC(,R10)                                         00491200
*          IF NIPPMNAM = NIPPANAM      /*IS THIS NEW MEMBER NAME     */ 00491300
*              THEN GO TO NIPPMPRD;    /*NO- GO READ RECORD          */ 00491400
         CLC   NIPPMNAM(8),NIPPANAM(R10)                                00491500
         BE    NIPPMPRD                                                 00491600
*          NIPPMNAM = NIPPANAM;        /*YES- SAVE MEMBER NAME       */ 00491700
         MVC   NIPPMNAM(8),NIPPANAM(R10)                                00491800
*          GO TO NIPPMENT;             /*GO FIND MEMBER              */ 00491900
         B     NIPPMENT                                                 00492000
*                                                                       00492100
*NIPPMPDS: NIPPMADR = R14;               /* SAVE CALLER'S RETURN ADDR*/ 00492200
NIPPMPDS LR    R5,R14                                                   00492300
         STM   R2,R1,NIPPMREG                   SAVE REGS               00492400
*          NIPPMNAM = NIPPMNAM && NIPPMNAM;  /*CLEAR MEMBER NAME     */ 00492500
         XC    NIPPMNAM(8),NIPPMNAM                                     00492600
*NIPPMENT: R1 = ADDR(NIPPADCB) - 44;            /* R1= ADDR OF DCB   */ 00492700
NIPPMENT L     R10,NVTPAREA(,R2)                                        00492800
         LA    R1,NIPPADCB(,R10)                                        00492900
         SH    R1,KH44                                                  00493000
*          R0 = ADDR(NIPPABDL);          /* R0= ADDR OF BLDL LIST    */ 00493100
         LA    R0,NIPPABDL(,R10)                                        00493200
*          /* READ PDS ENTRY FOR MEMBER                              */ 00493300
*                                                                       00493400
         BLDL  (1),(0)                                                  00493500
*          NIPPARC = R15;        /* SET RETURN CODE                  */ 00493600
         L     R10,NVTPAREA(,R2)                                        00493700
         ST    R15,NIPPARC(,R10)                                        00493800
*          IF R15 = 4                    /* WAS MEMBER NAME FOUND    */ 00493900
*             THEN GO TO NIPPMPFN;       /* NO - TELL OPERATOR NOT      00494000
*                                           FOUND                    */ 00494100
         CH    R15,KH4                                                  00494200
         BE    NIPPMPFN                                                 00494300
*          IF R15 = 8                    /* WAS THERE AN I/O ERROR   */ 00494400
*             THEN GO TO NIPPMPER;       /* YES - TELL OPERATOR      */ 00494500
*                                           I/O ERROR                */ 00494600
         CH    R15,KH8                                                  00494700
         BE    NIPPMPER                                                 00494800
*          /* SET UP PARAMETERS FOR CONVERSION ROUTINE               */ 00494900
*          R0 = NIPPATTR;                /* R0 = ACTUAL TTR          */ 00495000
         ICM   R0,B'0111',NIPPATTR(R10)                                 00495100
         SLL   R0,8                       ZERO LOW BYTE IN R0           00495200
*          R1 = ADDR(NIPPADEB);          /* R1 = ADDR OF DEB         */ 00495300
         L     R1,NVTPAREA(,R2)                                         00495400
         LA    R1,NIPPADEB(,R1)                                         00495500
*          R15 = CVTPCNVT;               /* R15 = ADDR OF CONVERSION    00495600
*                                           ROUTINE                  */ 00495700
         L     R10,CVTPTR                                               00495800
         L     R15,CVTPCNVT-CVT(,R10)                                   00495900
*          /* CONVERT TTR TO CCHHR FORMAT                            */ 00496000
         STM   R2,R13,NIPPMSAV SAVE REGISTERS                           00496100
         LA    R2,NIPPMMBC                CONVERSION AREA               00496200
         BASR  R14,R15                    CALL CONVERT RTN              00496300
**         RESTORE BASE REGISTERS                                       00496400
NIPPMRST LM    R2,R13,NIPPMSAV-NIPPMRST(R14)                            00496500
         B     NIPPMSKP                   SKIP SAVE AREA                00496600
*                                                                       00496700
NIPPMSAV DC    12F'0'                     DECLARE REG SAVE AREA         00496800
*          IOBSEEK = NIPPMMBC;           /* RESET PARMLIB IOBSEEK TO    00496900
*                                           THIS MBBCCHHR            */ 00497000
NIPPMSKP L     R10,NVTPAREA(,R2)                                        00497100
         MVC   IOBSEEK-IOBSTDRD+72(8,R10),NIPPMMBC                      00497200
*          NIPPASID = NIPPMCCH;          /* RESET PARMLIB SEARCH ID     00497300
*                                           TO THIS CCHHR            */ 00497400
         MVC   NIPPASID(5,R10),NIPPMCCH                                 00497500
*          IF NIPPMNAM = NIPPANAM   /*SEE IF MEM NAMES MATCH         */ 00497600
*              THEN GO TO NIPPMPRD; /*YES- NEW VERSION- GO READ      */ 00497700
         CLC   NIPPMNAM(8),NIPPANAM(R10)                                00497800
         BE    NIPPMPRD                                                 00497900
         LM    R2,R1,NIPPMREG                RESTORE REGS               00498000
*          GO TO NIPPMAD0;               /* NORMAL RETURN TO CALLER  */ 00498100
         BR    R5                                                       00498200
*                                                                       00498300
*NIPPMPER: NIPPMME1 = NIPPANAM;          /* MOVE MEMBER NAME TO I/O     00498400
*                                           ERROR MESSAGE            */ 00498500
NIPPMPER LA    R10,NIPPMMB1                                             00498600
         L     R8,NVTPAREA(,R2)                                         00498700
         MVC   NIPPMME1(8,R10),NIPPANAM(R8)                             00498800
*          /* WTO I/O ERROR DURING BLDL MESSAGE                      */ 00498900
*                                                                       00499000
         IEAPMNIP TYPE=WTO,PARAM=NIPPMMS1   CALL WTO SERVICE ROUTINE    00499100
*                                                                       00499200
*          /* WTO I/O ERROR DURING BLDL MESSAGE                      */ 00499300
*          GO TO NIPPMPXT;               /* ERROR RETURN TO CALLER   */ 00499400
         B     NIPPMPXT                                                 00499500
*                                                                       00499600
*NIPPMPFN: IF NIPPMNAM = NIPPANAM  /*SEE IF MEMBER NAMES MATCH       */ 00499700
*              THEN IF NIPPAFL1 = '1'B  /*YES- SUPPRESS MESSAGE      */ 00499800
NIPPMPFN L     R10,NVTPAREA(,R2)                                        00499900
         CLC   NIPPMNAM(8),NIPPANAM(R10)                                00500000
         BNE   @RF01360                                                 00500100
*                 THEN GO TO NIPPMPXT;  /*YES- GO EXIT TO CALLER     */ 00500200
         L     R10,NVTPTAB(,R2)                                         00500300
         TM    NIPPAFL1(R10),B'10000000'                                00500400
         BO    NIPPMPXT                                                 00500500
*                 ELSE;                                                 00500600
*          NIPPMME2 = NIPPANAM;          /* MOVE MEMBER NAME TO NOT     00500700
*                                           FOUND MESSAGE            */ 00500800
*                                                                       00500900
@RF01360 LA    R10,NIPPMMB2                                             00501000
         L     R8,NVTPAREA(,R2)                                         00501100
         MVC   NIPPMME2(8,R10),NIPPANAM(R8)                             00501200
*          /* WTO MEMBER NOT FOUND IN DATA SET MESSAGE               */ 00501300
*                                                                       00501400
         IEAPMNIP TYPE=WTO,PARAM=NIPPMMS2 CALL WTO SERVICE ROUTINE      00501500
*                                                                       00501600
*NIPPMPXT: IF NIPPMNAM = NIPPANAM   /*SEE IF NAMES MATCH             */ 00501700
*             THEN DO;                                                  00501800
NIPPMPXT L     R10,NVTPAREA(,R2)                                        00501900
         CLC   NIPPMNAM(8),NIPPANAM(R10)                                00502000
         BNE   @RF01366                                                 00502100
*                     NIPPMNAM = NIPPMNAM && NIPPMNAM; /* FORCE NEW     00502200
*                                            NAME PATH ON NEXT ENTRY */ 00502300
         XC    NIPPMNAM(8),NIPPMNAM                                     00502400
*                     R1 = NIPPMNEG;        /* SET NEGATIVE VALUE RC */ 00502500
         L     R1,NIPPMNEG                                              00502600
         LM    R2,R0,NIPPMREG                RESTORE REGS               00502700
*                     GO TO NIPPMAD0;   /*EXIT TO CALLER             */ 00502800
         BR    R5                                                       00502900
*                  END;                                                 00503000
@RF01366 LM    R2,R1,NIPPMREG                 RESTORE REGS              00503100
*          GO TO NIPPMAD4;               /* READ ERROR - RETURN TO      00503200
*                                           CALLER                   */ 00503300
         LA    R10,NIPPMAD4+4(,R5)                                      00503400
         BR    R10                                                      00503500
*                                                                       00503600
         LR    R5,R14                                                   00503700
*          /**********************************************************/ 00503800
*          /*             ROUTINE TO READ PARMLIB TEXT               */ 00503900
*          /**********************************************************/ 00504000
*                                                                       00504100
*NIPPMTXT: NIPPMADR = R14;               /* SAVE CALLER'S RETURN        00504200
*                                           ADDRESS                  */ 00504300
NIPPMTXT STM   R2,R1,NIPPMREG               SAVE CALLERS REGS           00504400
*NIPPMPRD: NIPPAECB = NIPPAECB && NIPPAECB;   /* ZERO WAIT ECB       */ 00504500
NIPPMPRD L     R10,NVTPAREA(,R2)                                        00504600
         XC    NIPPAECB(4,R10),NIPPAECB(R10)                            00504700
*          IOBSEEK(4:7) = NIPPASID;         /* FILL IN CCHH IN IOB   */ 00504800
*                                                                       00504900
         LA    R8,72                                                    00505000
         ALR   R8,R10                                                   00505100
         MVC   IOBSEEK-IOBSTDRD+3(4,R8),NIPPASID(R10)                   00505200
*          /* REINITIALIZE IOB FLAGS                                 */ 00505300
*          IOBFLAG1 = '42'X;                                            00505400
         MVI   IOBFLAG1-IOBSTDRD(R8),X'42'                              00505500
*          IOBFLAG2 = '00'X;                                            00505600
         MVI   IOBFLAG2-IOBSTDRD(R8),X'00'                              00505700
*          IOBFLAG3 = '00'X;                                            00505800
         MVI   IOBFLAG3-IOBSTDRD(R8),X'00'                              00505900
*          IOBERRCT = '0000'X;                                          00506000
         SLR   R4,R4                                                    00506100
         STH   R4,IOBERRCT-IOBSTDRD(,R8)                                00506200
*          IOBCSW = '00000000000000'X;                                  00506300
         MVC   IOBCSW-IOBSTDRD(7,R8),@CB02714                           00506400
*          IOBSENS0 = '00'X;                                            00506500
         MVI   IOBSENS0-IOBSTDRD(R8),X'00'                              00506600
*          IOBSENS1 = '00'X;                                            00506700
         MVI   IOBSENS1-IOBSTDRD(R8),X'00'                              00506800
*          /* READ PARMLIB TEXT RECORD                               */ 00506900
*          R1 = ADDR(NIPPAIOB);                                         00507000
         LA    R1,NIPPAIOB(,R10)                                        00507100
*                                                                       00507200
         EXCP  (1)                 READ TEXT                            00507300
*                                                                       00507400
*          R1 = ADDR(NIPPAECB);                                         00507500
         L     R1,NVTPAREA(,R2)                                         00507600
         LA    R1,NIPPAECB(,R1)                                         00507700
*                                                                       00507800
         WAIT  ECB=(1)                  AWAIT I/O COMPLETION            00507900
*                                                                       00508000
*          /* TEST FOR I/O ERROR AFTER PARMLIB READ                  */ 00508100
*          IF NIPPAECC ¬= '7F'X          /* SKIP IF READ SUCCESSFUL  */ 00508200
*             THEN                                                      00508300
         L     R10,NVTPAREA(,R2)                                        00508400
         CLI   NIPPAECC(R10),X'7F'                                      00508500
         BE    NIPPMRCR                                                 00508600
*             DO;                                                       00508700
*               IF NIPPMNAM = NIPPANAM   /* SEE IF MEMBER NAMES MATCH*/ 00508800
*               THEN                                                    00508900
         CLC   NIPPMNAM(8),NIPPANAM(R10)                                00509000
         BNE   NIPPMTER                                                 00509100
*               DO;                                                     00509200
*                 /* DOES THE I/O ERROR REPRESENT EOF                */ 00509300
*                 IF NIPPAECC = '41'X &   /* IOBCSW FIELD VALID?     */ 00509400
*                    /* FALL THROUGH IF UNIT EXCEPTION, CHANNEL END     00509500
*                       AND DEVICE END FLAGS ARE ON IN THE IOBCSW    */ 00509600
*                    (NIPPMCS2   NIPPMMK1) = 'FF'X                      00509700
*                    THEN                                               00509800
         CLI   NIPPAECC(R10),X'41'                                      00509900
         BNE   @RF01394                                                 00510000
         MVC   @TS00001(1),NIPPMCS2+81(R10)                             00510100
         OC    @TS00001(1),NIPPMMK1                                     00510200
         CLI   @TS00001,X'FF'                                           00510300
         BNE   @RF01394                                                 00510400
*                      DO;                                              00510500
*                        NIPPARC = 16;   /* INDICATE EOF CONDITION   */ 00510600
         MVC   NIPPARC(4,R10),KF16                                      00510700
*                        GOTO NIPPMPXT;  /* RETURN TO CALLER         */ 00510800
         B     NIPPMPXT                                                 00510900
*                      END;                                             00511000
*              /* DOES THE I/O ERROR REPRESENT END OF CYL?          */  00511100
*              IF NIPPAECC='41'X&                                       00511200
*              (NIPPMCS2 NIPPMMK2)='FF'X&                               00511300
*              (IOBSENS1&NIPPMMK3)= '20'X THEN                          00511400
@RF01394 L     R10,NVTPAREA(,R2)                                        00511500
         CLI   NIPPAECC(R10),X'41'                                      00511600
         BNE   NIPPMTER                                                 00511700
         MVC   @TS00001(1),NIPPMCS2+81(R10)                             00511800
         OC    @TS00001(1),NIPPMMK2                                     00511900
         CLI   @TS00001,X'FF'                                           00512000
         BNE   NIPPMTER                                                 00512100
         MVC   @TS00001(1),IOBSENS1-IOBSTDRD+72(R10)                    00512200
         NC    @TS00001(1),NIPPMMK3                                     00512300
         CLI   @TS00001,X'20'                                           00512400
         BNE   NIPPMTER                                                 00512500
*               /* IF YES, MAKE SEEK ADDRESS POINT TO START OF NEXT     00512600
*                              CYLINDER          */                     00512700
*               DO;                                                     00512800
*               NIPPMCC=NIPPMCC+1;          /* INCREMENT SEEK@ TO NEXT  00512900
*                                              CYL                   */ 00513000
         AH    R10,KH64                                                 00513100
         LA    R8,1                                                     00513200
         AH    R8,NIPPMCC(,R10)                                         00513300
         STH   R8,NIPPMCC(,R10)                                         00513400
*            NIPPMHH=NIPPMHH&&NIPPMHH;  /* HEAD 0,          */          00513500
         XC    NIPPMHH(2,R10),NIPPMHH(R10)                              00513600
*                   NIPPMR='01'X;        /*  AND RECORD 1            */ 00513700
         MVI   NIPPMR(R10),X'01'                                        00513800
*                   GOTO NIPPMRCR;   /* CONTINUE TO PROCESS TEXT     */ 00513900
         B     NIPPMRCR                                                 00514000
*                                                                       00514100
*                    END;                                               00514200
*                  END;                                                 00514300
*                 GOTO NIPPMTER;         /* INDICATE I/O ERROR       */ 00514400
         B     NIPPMTER                                                 00514500
*                                                                       00514600
*               END;                                                    00514700
*          R1 = ADDR(NIPPARCD);          /* R1 = ADDR OF TEXT RECORD    00514800
*                                           READ IN                  */ 00514900
NIPPMRCR L     R1,NVTPAREA(,R2)                                         00515000
         LA    R1,NIPPARCD(,R1)                                         00515100
*               END;                                                    00515200
NIPPMTND LM    R2,R0,NIPPMREG                 RESTORE CALLERS REGS      00515300
*          GO TO NIPPMAD0;               /* NORMAL RETURN TO CALLER  */ 00515400
*                                                                       00515500
         BR    R5                        RETURN TO CALLER               00515600
*                                                                       00515700
*NIPPMTER: R1 = ADDR(NIPPAIOB);          /* R1 = ADDR OF PARMLIB IOB */ 00515800
NIPPMTER L     R1,NVTPAREA(,R2)                                         00515900
         LA    R1,NIPPAIOB(,R1)                                         00516000
*          /* NIPSENSE - FORMAT AND WRITE I/O ERROR MESSAGE          */ 00516100
*                                                                       00516200
         IEAPMNIP TYPE=SENSE,PARAM=R1                                   00516300
*                                                                       00516400
*          NIPPARC = 12;    /*SET RETURN CODE TO 12                  */ 00516500
         L     R10,NVTPAREA(,R2)                                        00516600
         MVC   NIPPARC(4,R10),KF12                                      00516700
*          IF NIPPMNAM = NIPPANAM  /*SEE IF MEMBER NAMES MATCH       */ 00516800
*             THEN GO TO NIPPMPXT; /*YES-TAKE NEW VERSION EXIT       */ 00516900
         CLC   NIPPMNAM(8),NIPPANAM(R10)                                00517000
         BE    NIPPMPXT                                                 00517100
         LM    R2,R1,NIPPMREG                 RESTORE CALLERS REGS      00517200
*          GO TO NIPPMAD4;               /* READ ERROR - RETURN TO      00517300
*                                           CALLER + 4               */ 00517400
         LA    R10,NIPPMAD4+4(,R5)                                      00517500
         BR    R10                                                      00517600
*                                                                       00517700
         B     @EL00001                                                 00517800
*                                                                       00517900
*          /**********************************************************/ 00518000
*          /* GENERATED MACRO PARAMETER LISTS FOR MESSAGES           */ 00518100
*          /**********************************************************/ 00518200
*                                                                       00518300
*SETSTAT: PROC;                        /*SET VOLUME ATTRIBS          */ 00518400
SETSTAT  STM   R14,R12,12(R13)                                          00518500
*/********************************************************************/ 00518600
*/*                                                                  */ 00518700
*/* SEGMENT NAME - SETSTAT                                           */ 00518800
*/*                                                                  */ 00518900
*/* DESCRIPTIVE NAME - SET MOUNT AND USE STATUS IN UCB               */ 00519000
*/*                                                                  */ 00519100
*/* FUNCTION -                                                       */ 00519200
*/*                                                                  */ 00519300
*/*     IF THE VOLUME IS NOT ON A NON-DEMOUNTABLE DEVICE, OR IS      */ 00519400
*/*     NOT ONE THAT THE SYSTEM REQUIRES TO BE PERMANENTLY RESI-     */ 00519500
*/*     DENT, THEN SET THE MOUNT STATUS.  IF THE  MOUNT CHARACTER-   */ 00519600
*/*     ISTIC IN VATLST ENTRY IS 1, THEN SET UCB MOUNT STATUS TO     */ 00519700
*/*     RESERVED. OTHERWISE, SET UCB MOUNT STATUS TO PERMANENTLY     */ 00519800
*/*     RESIDENT.                                                    */ 00519900
*/*                                                                  */ 00520000
*/*     IF USE ATTRIBUTE IN VATLST ENTRY IS 0, THEN UCB USE STATUS   */ 00520100
*/*     IS STORAGE.  IF USE ATTRIBUTE IS 2, THEN UCB USE STATUS IS   */ 00520200
*/*     PRIVATE. OTHERWISE, UCB USE STATUS IS PUBLIC.                */ 00520300
*/*                                                                  */ 00520400
*/* ENTRY - SUBROUTINE                                               */ 00520500
*/*                                                                  */ 00520600
*/*     PURPOSE -                                                    */ 00520700
*/*                                                                  */ 00520800
*/*         SET MOUNT AND USE STATUS, AS INDICATED IN VATLST ENTRY,  */ 00520900
*/*         IN ASSOCIATED UCB.                                       */ 00521000
*/*                                                                  */ 00521100
*/*     INPUT DATA -                                                 */ 00521200
*/*                                                                  */ 00521300
*/*         VATLST ENTRY                                             */ 00521400
*/*         UCBPTR - CONTAINS UCB ADDRESS                            */ 00521500
*/*         UCBPRES - SET ON FOR VOLUMES THE SYSTEM REQUIRES TO BE   */ 00521600
*/*                   PERMANENTLY RESIDENT AND NON-DEMOUNTABLE       */ 00521700
*/*                   DEVICES.                                       */ 00521800
*/*                                                                  */ 00521900
*/* EXITS -                                                          */ 00522000
*/*                                                                  */ 00522100
*/*     CONDITION - NORMAL                                           */ 00522200
*/*                                                                  */ 00522300
*/*     OUTPUT DATA -                                                */ 00522400
*/*                                                                  */ 00522500
*/*         UCB - MODIFIED                                           */ 00522600
*/*                                                                  */ 00522700
*/*     RETURN CODE - NONE                                           */ 00522800
*/*                                                                  */ 00522900
*/********************************************************************/ 00523000
*                                                                       00523100
*IF UCBPRES = NO                       /*IF VOL IS NOT P/R,          */ 00523200
*  THEN IF EMNTCHAR = RSV              /*SET MOUNT ATTRIBUTE         */ 00523300
         TM    UCBSTAT-UCB(R5),UCBPRES                                  00523400
         BNZ   @RF01442                                                 00523500
*    THEN DO;                          /*TO RESERVED IF COL 8 OF     */ 00523600
         LH    R10,I                                                    00523700
         MH    R10,KH18                                                 00523800
         L     R8,GETADDR                                               00523900
         ALR   R8,R10                                                   00524000
         AL    R8,KFM12                                                 00524100
         CLI   0(R8),C'1'                                               00524200
         BNE   @RF01443                                                 00524300
*      UCBRESV = YES;                  /*ENTRY IS EQUAL TO ONE, AND  */ 00524400
*      UCBPRES = NO;                   /*TURN OFF PERMANENTLY           00524500
*                                        RESIDENT ATTRIBUTE          */ 00524600
         OI    UCBSTAT-UCB(R5),UCBRESV                                  00524700
         NI    UCBSTAT-UCB(R5),255-UCBPRES                              00524800
         B     @RF01442                                                 00524900
*                                                                       00525000
*    END;                                                               00525100
*    ELSE DO;                          /*IF COL 8 ¬= 1 THEN          */ 00525200
*      UCBPRES = YES;                  /*SET DEFAULT ATTRIBUTE -        00525300
*                                        PERMANENTLY RESIDENT AND    */ 00525400
*      UCBRESV = NO;                   /*TURN OFF RESERVED ATTRIBUTE */ 00525500
@RF01443 OI    UCBSTAT-UCB(R5),UCBPRES                                  00525600
         NI    UCBSTAT-UCB(R5),255-UCBRESV                              00525700
*    END;                                                               00525800
*UCBBSTR = NO;                         /*TURN OFF USE ATTRIBUTES     */ 00525900
*UCBBPRV = NO;                                                          00526000
*UCBBPUB = NO;                                                          00526100
@RF01442 NI    UCBSTAB-UCB(R5),255-UCBBSTR-UCBBPRV-UCBBPUB              00526200
*IF EUSEATTR = STR                     /*SET USE ATTRIBUTES          */ 00526300
*  THEN                                /*IF COL 10 OF ENTRY = 0      */ 00526400
         LH    R10,I                                                    00526500
         MH    R10,KH18                                                 00526600
         L     R8,GETADDR                                               00526700
         ALR   R8,R10                                                   00526800
         AL    R8,KFM11                                                 00526900
         CLI   0(R8),C'0'                                               00527000
         BNE   @RF01455                                                 00527100
*    UCBBSTR = YES;                    /*SET USE ATTRI TO STORAGE,   */ 00527200
         OI    UCBSTAB-UCB(R5),UCBBSTR                                  00527300
         B     @ER00002                                                 00527400
*                                                                       00527500
*  ELSE IF EUSEATTR = PRIV             /*IF COL 10 = 2               */ 00527600
*    THEN                                                               00527700
@RF01455 LH    R10,I                                                    00527800
         MH    R10,KH18                                                 00527900
         L     R8,GETADDR                                               00528000
         ALR   R8,R10                                                   00528100
         AL    R8,KFM11                                                 00528200
         CLI   0(R8),C'2'                                               00528300
         BNE   @RF01457                                                 00528400
*      UCBBPRV = YES;                  /*SET USE ATTRI TO PRIVATE,   */ 00528500
         OI    UCBSTAB-UCB(R5),UCBBPRV                                  00528600
         B     @ER00002                                                 00528700
*                                                                       00528800
*    ELSE                              /*ELSE SET DEFAULT USE ATTRI  */ 00528900
*      UCBBPUB = YES;                  /*OF PUBLIC                   */ 00529000
@RF01457 OI    UCBSTAB-UCB(R5),UCBBPUB                                  00529100
*END SETSTAT;                          /*RETURN TO CALLER            */ 00529200
@ER00002 RETURN (14,12)                                                 00529300
*                                                                       00529400
*EXCPSETP: PROC;                       /* SET UP FOR EXCP            */ 00529500
EXCPSETP STM   R14,R12,12(R13)                                          00529600
*/********************************************************************/ 00529700
*/*                                                                  */ 00529800
*/* SEGMENT NAME - EXCPSETP                                          */ 00529900
*/*                                                                  */ 00530000
*/* DESCRIPTIVE NAME - SET UP CONTROL BLOCKS FOR EXCP                */ 00530100
*/*                                                                  */ 00530200
*/* FUNCTION -                                                       */ 00530300
*/*     THE APPENDAGE VECTOR TABLE AND EXCP CONTROL BLOCKS           */ 00530400
*/*     ARE INITIALIZED.                                             */ 00530500
*/*                                                                  */ 00530600
*/*  ENTRY - SUBROUTINE                                              */ 00530700
*/*                                                                  */ 00530800
*/*      PURPOSE - SEE FUNCTION                                      */ 00530900
*/*                                                                  */ 00531000
*/*      INPUT DATA - NONE                                           */ 00531100
*/*                                                                  */ 00531200
*/*  EXITS -                                                         */ 00531300
*/*                                                                  */ 00531400
*/*      CONDITION - VECTOR TABLE AND CONTROL BLOCKS                 */ 00531500
*/*              INITIALIZED                                         */ 00531600
*/*                                                                  */ 00531700
*/*      OUTPUT DATA -                                               */ 00531800
*/*                                                                  */ 00531900
*/*            APPENDAGE VECTOR TABLE                                */ 00532000
*/*            ECB                                                   */ 00532100
*/*            IOB                                                   */ 00532200
*/*            DEB                                                   */ 00532300
*/*            CCW'S                                                 */ 00532400
*/*            DCB                                                   */ 00532500
*/*                                                                  */ 00532600
*/*     RETURN CODE - NONE                                           */ 00532700
*/*                                                                  */ 00532800
*/********************************************************************/ 00532900
*                                                                       00533000
*DO VIND = ONE TO FIVE;                /*INITIALIZE APPENDAGE        */ 00533100
         LA    R5,1                                                     00533200
*  VECTAB(VIND) = ADDR(CVTBRET);       /*VECTOR TABLE                */ 00533300
@DL01463 LR    R10,R5                                                   00533400
         SLA   R10,2                                                    00533500
         L     R8,CVTPTR                                                00533600
         LA    R8,CVTBRET-CVT(,R8)                                      00533700
         ST    R8,VECTAB-4(R10)                                         00533800
*END;                                                                   00533900
         LA    R5,1(,R5)                                                00534000
         CH    R5,KH5                                                   00534100
         BNH   @DL01463                                                 00534200
*ECBPTR = ADDR(VAPECB);                /*ADDRESS OF ECB              */ 00534300
         LA    R10,VAPECB                                               00534400
         ST    R10,ECBPTR                                               00534500
*IOBSTPTR = ADDR(VAPIOB);              /*ADDRESS OF IOB              */ 00534600
         LA    R8,VAPIOB                                                00534700
         ST    R8,IOBSTPTR                                              00534800
*DEBPTR = ADDR(VAPDEB);                /*ADDRESS OF DEB              */ 00534900
         LA    R15,VAPDEB                                               00535000
         ST    R15,DEBPTR                                               00535100
*CCW1+1 = ADDR(VAPSRCH);               /*CYL 0, TRK 0, RCD 3         */ 00535200
         LA    R14,VAPSRCH                                              00535300
         STCM  R14,B'0111',CCW1+1                                       00535400
*CCW2+1 = ADDR(CCW1);                  /*POINT BACK TO FIRST CCW     */ 00535500
         LA    R14,CCW1                                                 00535600
         STCM  R14,B'0111',CCW2+1                                       00535700
*CCW3+1 = ADDR(LABELBUF);              /*BUFFER FOR READ             */ 00535800
         LA    R7,LABELBUF                                              00535900
         STCM  R7,B'0111',CCW3+1                                        00536000
*CCW3+6 = LENGTH(LABELBUF);            /*NUMBER OF BYTES TO BE READ  */ 00536100
         MVC   CCW3+6(2),KH80                                           00536200
*DCBDEBAD = DEBPTR;                    /*DEB ADDRESS IN DCB          */ 00536300
         STCM  R15,B'0111',DCBDEBAD                                     00536400
*DCBMACRF = MACRF;                     /*EXCP                        */ 00536500
         MVC   DCBMACRF(4),MACRF                                        00536600
*DCBOFLGS = OFLAGS;                    /*DCB IS OPEN                 */ 00536700
         MVC   DCBOFLGS(4),OFLAGS                                       00536800
*                                      /*SET UP IOB                  */ 00536900
*IOBFLAG1 = IOBFLAGS;                  /*CHAINING & UNRELATED REQUEST*/ 00537000
         MVI   IOBFLAG1-IOBSTDRD(R8),X'42'                              00537100
*IOBECBPT = ECBPTR;                    /*ECB ADDRESS                 */ 00537200
         ST    R10,IOBECBPT-IOBSTDRD(,R8)                               00537300
*IOBSTART = ADDR(CCW1);                /*CCW ADDRESS                 */ 00537400
         ST    R14,IOBSTART-IOBSTDRD(,R8)                               00537500
*IOBDCBPT = ADDR(VAPDCB1) - DCBDISP;   /*DCB ADDRESS                 */ 00537600
         LA    R10,VAPDCB1                                              00537700
         SH    R10,KH40                                                 00537800
         ST    R10,IOBDCBPT-IOBSTDRD(,R8)                               00537900
*IOBR = THREE;                         /*RECORD 3                    */ 00538000
         MVI   IOBR-IOBSTDRD(R8),X'03'                                  00538100
*                                      /*SET UP DEB                  */ 00538200
*DEBDAPTR = ADDR(DEBBASND);            /*ADDRESS OF DEB EXTENSION    */ 00538300
         LA    R8,DEBBASND-DEBBASIC(,R15)                               00538400
         ST    R8,DEBDAPTR                                              00538500
*DEBNMEXT = EXTENTS;                   /*NUMBER OF EXTENTS           */ 00538600
         MVI   DEBNMEXT-DEBBASIC(R15),X'01'                             00538700
*DEBDEBID = DEBID;                     /*DEB ID                      */ 00538800
         MVI   DEBDEBID-DEBBASIC(R15),X'0F'                             00538900
*DEBDCBB = IOBDCBPT;                   /*DCB ADDRESS                 */ 00539000
         STCM  R10,B'0111',DEBDCBB-DEBBASIC(R15)                        00539100
*DEBEXSCL = DASDEX;                    /*EXTENT SCALE                */ 00539200
         MVI   DEBEXSCL-DEBBASIC(R15),X'04'                             00539300
*DEBAPPB = ADDR(VECTAB);               /*APPENDAGE VECTOR TABLE      */ 00539400
         LA    R10,VECTAB                                               00539500
         STCM  R10,B'0111',DEBAPPB-DEBBASIC(R15)                        00539600
*        UPDATE DEBDASD FIELDS                                          00539700
*DEBENDCC = ENDEXT;                    /*END CYLINDER                */ 00539800
*DEBENDHH = ENDEXT;                    /* END TRACK                  */ 00539900
*DEBNMTRK = NUMTRKS;                   /*NUMBER OF TRACKS            */ 00540000
         MVC   DEBENDCC-DEBDASD(2,R8),ENDEXT                            00540100
         MVC   DEBENDHH-DEBDASD(2,R8),ENDEXT                            00540200
         MVC   DEBNMTRK-DEBDASD(2,R8),NUMTRKS                           00540300
*END EXCPSETP;                                                          00540400
@ER00003 RETURN (14,12)                                                 00540500
*                                                                       00540600
*        GETUCB                                               @ZP60041@ 00540700
*                                                             @ZP60041@ 00540800
*        REQUEST ADDR OF THE NEXT DASD UCB IN THE UCB CHAIN   @ZP60041@ 00540900
*                                                             @ZP60041@ 00541000
*        ON ENTRY -                                           @ZP60041@ 00541100
*        R1 =  0 - SCAN UCB CHAIN FROM THE BEGINNING          @ZP60041@ 00541200
*        R1 NE 0 - NEXT SEQUENTIAL DASD UCB IN CHAIN          @ZP60041@ 00541300
*        ON RETURN -                                          @ZP60041@ 00541400
*        R1 = 0  - END OF UCB CHAIN                           @ZP60041@ 00541500
*        R1 -> DASD UCB                                       @ZP60041@ 00541600
*                                                             @ZP60041@ 00541700
         USING UCB,R1                                         @ZP60041@ 00541800
         USING VATREC,R10                                     @ZP60041@ 00541900
*                                                             @ZP60041@ 00542000
GETUCB   LTR   R1,R1                   START AT BEGINNING     @ZP60041@ 00542100
*                                      OF CHAIN ?             @ZP60041@ 00542200
         BNZ   GETUCBA                 NO, BRANCH             @ZP60041@ 00542300
         L     R15,CVTPTR                                     @ZP60041@ 00542400
         MVC   UCINDXP,CVTILK2-CVT(R15)                       @ZP60041@ 00542500
GETUCBA  L     R15,UCINDXP             R15 -> CURRENT UCB PTR @ZP60041@ 00542600
         XR    R1,R1                                          @ZP60041@ 00542700
GETUCBN  ICM   R1,B'0011',0(R15)  *    R1 -> UCB, 0 OR X'FFFF'@ZP60041@ 00542800
         LA    R15,2(,R15)        ¦    INCR UCB CHAIN PTR     @ZP60041@ 00542900
         ST    R15,UCINDXP        ¦    SAVE CURRENT UCB PTR   @ZP60041@ 00543000
         BZ    GETUCBN            V    ZERO, GET NEXT UCB     @ZP60041@ 00543100
         CLM   R1,B'0011',KXFFFF       END OF UCB CHAIN ?     @ZP60041@ 00543200
         BE    GETUCBE                 YES, BRANCH            @ZP60041@ 00543300
         CLI   UCBTBYT3,UCB3DACC       DASD UCB ?             @ZP60041@ 00543400
         BNE   GETUCBN                 NO, REQUEST NEXT UCB   @ZP60041@ 00543500
         TM    UCBSTAT,UCBONLI         ONLINE ?               @ZP60041@ 00543600
         BZ    GETUCBN                 NO, DISCARD            @ZP60041@ 00543700
         B     GETUCBR                 VALID UCB TO RETURN    @ZP60041@ 00543800
*                                      TO CALLER              @ZP60041@ 00543900
GETUCBE  XR    R1,R1                   SIGNAL END OF UCB CHAIN@ZP60041@ 00544000
GETUCBR  BR    R14                     RETURN TO CALLER       @ZP60041@ 00544100
*                                                             @ZP60041@ 00544200
*        FINDVOL                                              @ZP60041@ 00544300
*                                                             @ZP60041@ 00544400
*        SCAN ALL DASD UCBS TO LOCATE THE UCB THAT MATCHS     @ZP60041@ 00544500
*        THE VOL IN VATVOL                                    @ZP60041@ 00544600
*        RETURM MATCHING USB ADDR IN R1 OR ZERO IF NOT FOUND  @ZP60041@ 00544700
*                                                             @ZP60041@ 00544800
FINDVOL  ST    R14,FINDSAV             SAVE RETURN ADDR       @ZP60041@ 00544900
         XR    R1,R1                   SET BEGINNING OF CHAIN @ZP60041@ 00545000
FINDVOLA BAS   R14,GETUCB                                     @ZP60041@ 00545100
         LTR   R1,R1                   END OF UCB CHAIN       @ZP60041@ 00545200
         BZ    FINDVOLR                                       @ZP60041@ 00545300
         CLC   VATVOL,UCBVOLI          LOCATED THE UCB ?      @ZP60041@ 00545400
         BNE   FINDVOLA                N0, REENTER LOOP       @ZP60041@ 00545500
FINDVOLR L     R14,FINDSAV             RESTORE R14            @ZP60041@ 00545600
         BR    R14                     RETURN TO CALLER       @ZP60041@ 00545700
*                                                             @ZP60041@ 00545800
         DROP  R1,R10                                         @ZP60041@ 00545900
*                                                                       00546000
*END IEAVAP00                                                         * 00546100
*/* THE FOLLOWING INCLUDE STATEMENTS WERE FOUND IN THIS PROGRAM       * 00546200
*/*%INCLUDE SYSLIB  (VAPSPEC )                                        * 00546300
*/*%INCLUDE SYSLIB  (DECLARES)                                        * 00546400
*/*%INCLUDE SYSLIB  (CVT     )                                        * 00546500
*/*%INCLUDE SYSLIB  (IEZSSC  )                                        * 00546600
*/*%INCLUDE SYSLIB  (IHANVT  )                                        * 00546700
*/*%INCLUDE SYSLIB  (IEFUCBOB)                                        * 00546800
*/*%INCLUDE SYSLIB  (IEAPPNIP)                                        * 00546900
*/*%INCLUDE SYSLIB  (IEAPMNIP)                                        * 00547000
*/*%INCLUDE SYSLIB  (IHAECB  )                                        * 00547100
*/*%INCLUDE SYSLIB  (IEZIOB  )                                        * 00547200
*/*%INCLUDE SYSLIB  (IEZDEB  )                                        * 00547300
*/*%INCLUDE SYSLIB  (IEFZB421)                                        * 00547400
*/*%INCLUDE SYSLIB  (MESSAGES)                                        * 00547500
*/*%INCLUDE SYSLIB  (DATABLES)                                        * 00547600
*/*%INCLUDE SYSLIB  (DATABSPC)                                        * 00547700
*/*%INCLUDE SYSLIB  (INITUCBS)                                        * 00547800
*/*%INCLUDE SYSLIB  (INITSPEC)                                        * 00547900
*/*%INCLUDE SYSLIB  (CKPARMS )                                        * 00548000
*/*%INCLUDE SYSLIB  (CKPMSPEC)                                        * 00548100
*/*%INCLUDE SYSLIB  (SYSPARMS)                                        * 00548200
*/*%INCLUDE SYSLIB  (SYSPSPEC)                                        * 00548300
*/*%INCLUDE SYSLIB  (RDENTRY )                                        * 00548400
*/*%INCLUDE SYSLIB  (RDENSPEC)                                        * 00548500
*/*%INCLUDE SYSLIB  (CKENTRY )                                        * 00548600
*/*%INCLUDE SYSLIB  (CKENSPEC)                                        * 00548700
*/*%INCLUDE SYSLIB  (MNTLSTCK)                                        * 00548800
*/*%INCLUDE SYSLIB  (MTCKSPEC)                                        * 00548900
*/*%INCLUDE SYSLIB  (MOUNTLST)                                        * 00549000
*/*%INCLUDE SYSLIB  (MLSTSPEC)                                        * 00549100
*/*%INCLUDE SYSLIB  (NOLIST  )                                        * 00549200
*/*%INCLUDE SYSLIB  (NLSTSPEC)                                        * 00549300
*/*%INCLUDE SYSLIB  (RDERR   )                                        * 00549400
*/*%INCLUDE SYSLIB  (RDERSPEC)                                        * 00549500
*/*%INCLUDE SYSLIB  (INFOLIST)                                        * 00549600
*/*%INCLUDE SYSLIB  (INFOSPEC)                                        * 00549700
*/*%INCLUDE SYSLIB  (LISTPROC)                                        * 00549800
*/*%INCLUDE SYSLIB  (LISTSPEC)                                        * 00549900
*/*%INCLUDE SYSLIB  (FINDVOL )                                        * 00550000
*/*%INCLUDE SYSLIB  (FINDSPEC)                                        * 00550100
*/*%INCLUDE SYSLIB  (WRONGVOL)                                        * 00550200
*/*%INCLUDE SYSLIB  (WRNGSPEC)                                        * 00550300
*/*%INCLUDE SYSLIB  (VIRTMONT)                                        * 00550400
*/*%INCLUDE SYSLIB  (VIRTSPEC)                                        * 00550500
*/*%INCLUDE SYSLIB  (CKPATH  )                                        * 00550600
*/*%INCLUDE SYSLIB  (CKPHSPEC)                                        * 00550700
*/*%INCLUDE SYSLIB  (VIRTREAD)                                        * 00550800
*/*%INCLUDE SYSLIB  (VTRDSPEC)                                        * 00550900
*/*%INCLUDE SYSLIB  (MOUNTMSG)                                        * 00551000
*/*%INCLUDE SYSLIB  (MNTSPEC )                                        * 00551100
*/*%INCLUDE SYSLIB  (CKREPLY )                                        * 00551200
*/*%INCLUDE SYSLIB  (CKRPSPEC)                                        * 00551300
*/*%INCLUDE SYSLIB  (DEVREPLY)                                        * 00551400
*/*%INCLUDE SYSLIB  (DEVRSPEC)                                        * 00551500
*/*%INCLUDE SYSLIB  (DELIMCK )                                        * 00551600
*/*%INCLUDE SYSLIB  (DELISPEC)                                        * 00551700
*/*%INCLUDE SYSLIB  (CHECKUCB)                                        * 00551800
*/*%INCLUDE SYSLIB  (CUCBSPEC)                                        * 00551900
*/*%INCLUDE SYSLIB  (UCBFIND )                                        * 00552000
*/*%INCLUDE SYSLIB  (UCBFSPEC)                                        * 00552100
*/*%INCLUDE SYSLIB  (CKONLINE)                                        * 00552200
*/*%INCLUDE SYSLIB  (CKONSPEC)                                        * 00552300
*/*%INCLUDE SYSLIB  (REASON  )                                        * 00552400
*/*%INCLUDE SYSLIB  (REASON  )                                        * 00552500
*/*%INCLUDE SYSLIB  (RESNSPEC)                                        * 00552600
*/*%INCLUDE SYSLIB  (RESNSPEC)                                        * 00552700
*/*%INCLUDE SYSLIB  (CHECKDUP)                                        * 00552800
*/*%INCLUDE SYSLIB  (CDUPSPEC)                                        * 00552900
*/*%INCLUDE SYSLIB  (RDYUCB  )                                        * 00553000
*/*%INCLUDE SYSLIB  (RUCBSPEC)                                        * 00553100
*/*%INCLUDE SYSLIB  (WTORMT  )                                        * 00553200
*/*%INCLUDE SYSLIB  (WTORSPEC)                                        * 00553300
*/*%INCLUDE SYSLIB  (TESTRDY )                                        * 00553400
*/*%INCLUDE SYSLIB  (TESTSPEC)                                        * 00553500
*/*%INCLUDE SYSLIB  (READSER )                                        * 00553600
*/*%INCLUDE SYSLIB  (READSPEC)                                        * 00553700
*/*%INCLUDE SYSLIB  (CKVOLIST)                                        * 00553800
*/*%INCLUDE SYSLIB  (CKVLSPEC)                                        * 00553900
*/*%INCLUDE SYSLIB  (ERRPROC )                                        * 00554000
*/*%INCLUDE SYSLIB  (ERRSPEC )                                        * 00554100
*/*%INCLUDE SYSLIB  (CLEANUP )                                        * 00554200
*/*%INCLUDE SYSLIB  (CLENSPEC)                                        * 00554300
*/*%INCLUDE SYSLIB  (IEAPSPIO)                                        * 00554400
*/*%INCLUDE SYSLIB  (SETSTAT )                                        * 00554500
*/*%INCLUDE SYSLIB  (SETSSPEC)                                        * 00554600
*/*%INCLUDE SYSLIB  (EXCPSETP)                                        * 00554700
*/*%INCLUDE SYSLIB  (EXCPSPEC)                                        * 00554800
*;                                                                      00554900
KH8      DC    H'8'                                                     00555000
KH13     DC    H'13'                                                    00555100
KH18     DC    H'18'                                                    00555200
KH19     DC    H'19'                                                    00555300
KH20     DC    H'20'                                                    00555400
KH40     DC    H'40'                                                    00555500
KH44     DC    H'44'                                                    00555600
KH64     DC    H'64'                                                    00555700
KH72     DC    H'72'                                                    00555800
KH80     DC    H'80'                                                    00555900
KH512    DC    H'512'                                                   00556000
KH9216   DC    H'9216'                                                  00556100
KXFFFF   DC    XL2'FFFF'                                                00556200
*                                                                       00556300
@SA00001 DC    18F'0'                                                   00556400
*                                                                       00556500
@TF00001 DC    F'0'                                                     00556600
@ZT00003 DC    F'0'                                                     00556700
*                                                                       00556800
KF1      DC    F'1'                                                     00556900
KH1      EQU   KF1+2                                                    00557000
KF2      DC    F'2'                                                     00557100
KF3      DC    F'3'                                                     00557200
KF4      DC    F'4'                                                     00557300
KH4      EQU   KF4+2                                                    00557400
KF5      DC    F'5'                                                     00557500
KH5      EQU   KF5+2                                                    00557600
KF12     DC    F'12'                                                    00557700
KF16     DC    F'16'                                                    00557800
KFM240   DC    F'-240'                                                  00557900
KFM18    DC    F'-18'                                                   00558000
KFM12    DC    F'-12'                                                   00558100
KFM11    DC    F'-11'                                                   00558200
KFM10    DC    F'-10'                                                   00558300
KFM9     DC    F'-9'                                                    00558400
KFM8     DC    F'-8'                                                    00558500
KFM4     DC    F'-4'                                                    00558600
@CF02592 DC    XL4'80000000'                                            00558700
*                                                                       00558800
ATESTMAS DC    A(TESTMASK)                                    @ZP60041@ 00558900
ADASDTAB DC    A(DASDTAB)                                     @ZP60041@ 00559000
ARESULT  DC    A(WILDRELT)                                    @ZP60041@ 00559100
AWORKA   DC    A(WORKAREA)                                    @ZP60041@ 00559200
FINDSAV  DC    A(0)                    SAVEAREA FOR FINDUCB   @ZP60041@ 00559300
VWILDPP  DC    V(WILDPP)          -> WILDPP ENTRY POINT       @ZP60041@ 00559400
VWILDPS  DC    V(WILDPS)          -> WILDPS ENTRY POINT       @ZP60041@ 00559500
*                                                             @ZP60041@ 00559600
SIXASTER DC    CL6'******'                                    @ZP60041@ 00559700
*                                                                       00559800
         DC    0D'0'                                                    00559900
*                                                                       00560000
SWITCHES DC    XL4'00'                                                  00560100
         ORG   SWITCHES                                                 00560200
SWITCH1  DC    X'00'                                                    00560300
DEFAULT  EQU   X'80'                                                    00560400
PEND     EQU   X'40'                                                    00560500
READ     EQU   X'20'                                                    00560600
NODEV    EQU   X'10'                                                    00560700
WTO      EQU   X'08'                                                    00560800
GOODLIST EQU   X'04'                                                    00560900
FOUND    EQU   X'02'                                                    00561000
BADVAL   EQU   X'01'                                                    00561100
*                                                                       00561200
SWITCH2  DC    X'00'                                                    00561300
BADREPLY EQU   X'80'                                                    00561400
DPLOADED EQU   X'40'                                                    00561500
ERROR    EQU   X'20'                                                    00561600
MSG1     EQU   X'10'                                                    00561700
MSG2     EQU   X'08'                                                    00561800
MSSMNT   EQU   X'04'                                                    00561900
DUPSER   EQU   X'02'                                                    00562000
DUPADDR  EQU   X'01'                                                    00562100
*                                                                       00562200
SWITCH3  DC    X'00'                                                    00562300
MSGSW    EQU   X'80'                                                    00562400
FAILSW   EQU   X'40'                                                    00562500
EXCPSW   EQU   X'20'                                                    00562600
LOOPSW   EQU   X'10'                                                    00562700
SUPPRESS EQU   X'08'                                                    00562800
MATCHGEN EQU   X'04'                   GEN VOL MATCHED A UCB  @ZP60041@ 00562900
         ORG                                                            00563000
*                                                                       00563100
VATUNIT  DC    X'00'                   VAT DEVTYPE CODE       @ZP60041@ 00563200
WILDPARM DC    3F'0'                   PARAMETER AREA         @ZP60041@ 00563300
ERRMSG   DC    F'0'                                                     00563400
MACRF    DC    XL4'00008000'                                            00563500
OFLAGS   DC    XL4'12000000'                                            00563600
MAPAD    DC    A(0)                                                     00563700
GETADDR  DC    A(0)                 -> GETMAINED WORKAREA               00563800
GETSIZE  DC    F'0'                 L' GETMAINED WORD AREA              00563900
NUMSUPTD DC    F'0'                                                     00564000
DEVTYPAD DC    A(0)                                                     00564100
UCBTYPAD DC    A(0)                                                     00564200
DEVCTAD  DC    A(0)                                                     00564300
AUXCTAD  DC    A(0)                                                     00564400
UCINDXP  DC    A(0)                 -> CURRENT UCB CHAIN ADDR           00564500
DATABLEN DC    F'0'                                                     00564600
PARMPTR  DC    A(0)                                                     00564700
DPPLIST  DC    A(0)                                                     00564800
DATAPATH DC    A(0)                                                     00564900
EDTPTR   DC    A(0)                                                     00565000
         DC    XL12'00'                                                 00565100
ECBPTR   DC    A(0)                                                     00565200
IOBSTPTR DC    A(0)                                                     00565300
DEBPTR   DC    A(0)                                                     00565400
DEBDAPTR DC    A(0)                                                     00565500
DEBEXPTR DC    A(0)                                                     00565600
IOBPRPTR DC    A(0)                                                     00565700
DEBSBPTR DC    A(0)                                                     00565800
*                                                                       00565900
FINDADDR DC    F'0'                                                     00566000
         ORG   FINDADDR                                                 00566100
FINDDEV  DS    CL3                                                      00566200
@NM00004 DS    CL1                                                      00566300
         ORG   FINDADDR+4                                               00566400
*                                                                       00566500
VAPECB   DC    F'0'                                                     00566600
NIPPMKPR DC    A(0)                                                     00566700
NIPPMNEG DC    XL4'FFFFFFFF'                                            00566800
NIPPMBDL DC    A(0)                                                     00566900
NIPPMDCB DC    A(0)                                                     00567000
ENDEXT   DC    XL2'FFFF'                                                00567100
NUMTRKS  DC    XL2'7FFF'                                                00567200
I        DC    H'0'                                                     00567300
J        DC    H'0'                                                     00567400
K        DC    H'0'                                                     00567500
MNTIND   DC    H'0'                                                     00567600
SCAN     DC    H'0'                                                     00567700
DEVMTCT  DC    H'0'                                                     00567800
TOMOUNT  DC    H'0'                                                     00567900
TABLECT  DC    H'0'                                                     00568000
MTLSTCT  DC    H'0'                                                     00568100
@TS00001 DC    XL18'00'                                                 00568200
KCVATLST DC    C'VATLST'                                                00568300
KCVOL1   DC    C'VOL1'                                                  00568400
KCCONT   DC    C'CONT'                                                  00568500
KCEND    DC    C'END'                                                   00568600
KCYES    DC    C'YES'                                                   00568700
KCPR     DC    C'P/R'                                                   00568800
KCRSV    DC    C'RSV'                                                   00568900
KCSTR    DC    C'STR'                                                   00569000
KCPRV    DC    C'PRV'                                                   00569100
KCPUB    DC    C'PUB'                                                   00569200
KCNO     DC    C'NO'                                                    00569300
KC00     DC    C'00'                                                    00569400
KCU      DC    C'U'''                                                   00569500
@CC00169 DC    C' '''                                                   00569600
@CC02560 DC    C' 1'                                                    00569700
@CC02562 DC    C' 2'                                                    00569800
@CC02564 DC    C' 3'                                                    00569900
@CC02566 DC    C' 4'                                                    00570000
@CC02568 DC    C' 5'                                                    00570100
@CC02570 DC    C' 6'                                                    00570200
@CC02572 DC    C' 7'                                                    00570300
@CC02574 DC    C' 8'                                                    00570400
@CC02576 DC    C' 9'                                                    00570500
@CC02578 DC    C'10'                                                    00570600
@CC02580 DC    C'11'                                                    00570700
@CB02714 DC    X'00000000000000'                                        00570800
DEV3330  DC    X'2009'                      UCBTBYT3+UCBTBYT4 FOR 3330  00570900
BADADDR  DC    AL3(0)                                                   00571000
VAPSRCH  DC    X'0000000003'                                            00571100
*                                                                       00571200
ZEROSEEK DC    D'0'                                                     00571300
         ORG   ZEROSEEK                                                 00571400
ZEROCSW  DS    CL7                                                      00571500
         ORG   ZEROCSW                                                  00571600
ZEROVOLI DS    CL6                                                      00571700
         ORG   ZEROVOLI                                                 00571800
ZEROVTOC DS    CL4                                                      00571900
         ORG   ZEROVTOC                                                 00572000
ZEROADDR DS    CL3                                                      00572100
         ORG   ZEROSEEK+8                                               00572200
*                                                                       00572300
PROMPT   DC    CL8'VAL'                                                 00572400
RDEND    DC    X'FF'                                                    00572500
MSSVOL   DC    XL6'00'                                                  00572600
*                                                                       00572700
DPPARM   DC    0D'0'                                                    00572800
DPUCB    DC    A(0)                                                     00572900
DPFCETC  DC    F'0'                                                     00573000
*                                                                       00573100
WTORBUF  DC    XL80'00'                                                 00573200
*                                                                       00573300
RSNAREA  DC    XL5'00'                                                  00573400
         ORG   RSNAREA                                                  00573500
RSNCDE   DS    FL4                                                      00573600
         ORG   RSNAREA+5                                                00573700
*                                                                       00573800
HEXTRAN  DC    CL16'0123456789ABCDEF'                                   00573900
UNPKAR   DC    XL5'00'                                                  00574000
REGSAVE  DC    15F'0'                                                   00574100
IEEVDEV  DC    CL8'IEEVDEV'                                             00574200
IEFEDTTB DC    CL8'IEFEDTTB'                                            00574300
*                                                                       00574400
LABELBUF DC    XL80'00'                                                 00574500
         ORG   LABELBUF                                                 00574600
VOL1     DS    CL4                                                      00574700
VOLSER   DS    CL6                                                      00574800
@NM00005 DS    CL1                                                      00574900
VOLVTOC  DS    CL5                                                      00575000
         ORG   LABELBUF+80                                              00575100
*                                                                       00575200
MBBCCHHR DC    D'0'                                                     00575300
         ORG   MBBCCHHR                                                 00575400
MBB      DS    CL3                                                      00575500
CCHHR    DS    CL5                                                      00575600
*                                                                       00575700
CCW1     CCW   X'31',0,X'40',5        SEARCH ID EQUAL                   00575800
*                                                                       00575900
CCW2     CCW   X'08',0,0,0            TIC                               00576000
*                                                                       00576100
CCW3     CCW   X'06',0,0,0            READ DATA                         00576200
*                                                                       00576300
@NM00014 DC    CL44'00'                                                 00576400
         ORG   @NM00014                                                 00576500
VAPIOBF  DC    F'0'                                                     00576600
VAPIOB   DC    10F'0'                                                   00576700
         ORG   @NM00014+44                                              00576800
*                                                                       00576900
@NM00015 DC    XL60'00'                                                 00577000
         ORG   @NM00015                                                 00577100
VAPDEB   DC    12F'0'                                                   00577200
VAPDCB1  DC    3F'0'                                                    00577300
         ORG   @NM00015+60                                              00577400
*                                                                       00577500
ICBDMLST DC    XL28'00'                                                 00577600
         ORG   ICBDMLST                                                 00577700
DMLEN    DC    XL4'1C'                                                  00577800
DMOPCD   DC    XL1'06'                                                  00577900
DMNTRES1 DC    X'00'                                                    00578000
DMNTFLAG DC    B'0000000000000000'                                      00578100
         ORG   DMNTFLAG                                                 00578200
DMBITRE1 DS    BL1                                                      00578300
DMDELRSP EQU   DMNTFLAG+0                                               00578400
DMVUAVAL EQU   DMNTFLAG+0                                               00578500
DMBITRES EQU   DMNTFLAG+0                                               00578600
         ORG   ICBDMLST+8                                               00578700
DMVOL    DC    XL6'0'                                                   00578800
DMNTASID DC    XL2'0'                                                   00578900
DMNTECB  DC    F'0'                                                     00579000
DMHOST   DC    XL5'0'                                                   00579100
DMNTRES2 DC    XL1'0'                                                   00579200
DMNTVUA  DC    H'0'                                                     00579300
         ORG   ICBDMLST+28                                              00579400
*                                                                       00579500
ICBMLST  DC    XL28'00'                                                 00579600
         ORG   ICBMLST                                                  00579700
MDLEN    DC    XL4'1C'                                                  00579800
MDOPCD   DC    XL1'08'                                                  00579900
@NM00106 DC    X'00'                                                    00580000
MDFLG    DC    B'0000000000000000'                                      00580100
         ORG   MDFLG                                                    00580200
@NM00107 DS    BL1                                                      00580300
MDVISMNT EQU   MDFLG+0                                                  00580400
MDVSVRQ  EQU   MDFLG+0                                                  00580500
MDSRTCH  EQU   MDFLG+0                                                  00580600
MDMEXT   EQU   MDFLG+0                                                  00580700
@NM00108 EQU   MDFLG+0                                                  00580800
         ORG   ICBMLST+8                                                00580900
MDVOL    DS    CL6                                                      00581000
         ORG   MDVOL                                                    00581100
@NM00109 DC    6X'00'                                                   00581200
         ORG   ICBMLST+14                                               00581300
MDVUA    DC    H'0'                                                     00581400
MDHOST   DS    CL5                                                      00581500
         ORG   MDHOST                                                   00581600
@NM00110 DC    5X'00'                                                   00581700
         ORG   ICBMLST+21                                               00581800
@NM00111 DS    CL3                                                      00581900
         ORG   @NM00111                                                 00582000
@NM00112 DC    3X'00'                                                   00582100
         ORG   ICBMLST+24                                               00582200
MNTEXTP  DC    A(0)                                                     00582300
         ORG   MNTEXTP                                                  00582400
MDJFCB   DS    FL4                                                      00582500
         ORG   ICBMLST+28                                               00582600
*                                                                       00582700
NIPPMMBC DC    XL8'00'                                                  00582800
         ORG   NIPPMMBC                                                 00582900
NIPPMMBB DS    CL3                                                      00583000
NIPPMCCH DS    CL5                                                      00583100
         ORG   NIPPMMBC+8                                               00583200
*                                                                       00583300
NIPPMMK1 DC    B'11110010'                                              00583400
NIPPMMK2 DC    B'11110001'                                              00583500
NIPPMMK3 DC    B'00100000'                                              00583600
*                                                                       00583700
NIPPMNAM DC    CL8' '                                                   00583800
*                                                                       00583900
         DS    CL1                                                      00584000
DEVTABLE DS    CL8                                                      00584100
         ORG   DEVTABLE+0                                               00584200
DEVICE   DS    CL3                                                      00584300
         DS    CL1                                                      00584400
UCBADDR  DS    AL4                                                      00584500
         ORG   DEVTABLE+152                                             00584600
*                                                                       00584700
VECTAB   DC    5A(0)                                                    00584800
NIPPMREG DC    16F'0'                                                   00584900
*                                                                       00585000
IEA166I  DC  0F'0'                                                      00585100
         IEAPMNIP TYPE=HEADER,MSGST=IEA166I,MSGEND=END166I              00585200
         DC  C'IEA166I VATLST'                                          00585300
NN166    DC  CL2'  '                   VATLIST NUMBER                   00585400
         DC  C': NO VOLUME MATCH FOUND FOR VOLUME '                     00585500
VOL166   DC  CL6' '                    GENERIC VOL                      00585600
         DC  C' ON DEVICE TYPE '                                        00585700
DEV166   DC  CL8' '                    DASD DEVICE TYPE                 00585800
END166I  EQU *                                                          00585900
*                                                                       00586000
IEA409I  DC  0F'0'                                                      00586100
         IEAPMNIP TYPE=HEADER,MSGST=IEA409I,MSGEND=END409I              00586200
         DC  C'IEA409I UNABLE TO MOUNT MSS VOLUME '                     00586300
VOL409   DC  CL6' '                                                     00586400
         DC  C' ON V'                                                   00586500
DEV409   DC  CL3' '                                                     00586600
         DC  C', DEVICE NOT ACCESSIBLE.'                                00586700
END409I  EQU *                                                          00586800
*                                                                       00586900
*                                                                       00587000
IEA850I  DC  0F'0'                                                      00587100
         IEAPMNIP TYPE=HEADER,MSGST=IEA850I,MSGEND=END850I              00587200
         DC  C'IEA850I FOLLOWING WILL BE PROCESSED'                     00587300
END850I  EQU *                                                          00587400
*                                                                       00587500
*                                                                       00587600
IEA850I2 DC  0F'0'                                                      00587700
         IEAPMNIP TYPE=HEADER,MSGST=IEA850I2,MSGEND=END850I2,OPT=(,NBC) 00587800
SER850   DC  CL6' '                    FILL IN VOLUME SERIAL NUMBER     00587900
         DC  C' ON '                                                    00588000
DEV850   DC  CL8' '                    FILL IN DEVICE TYPE              00588100
         DC  CL1' '                                                     00588200
MT850    DC  CL3' '                    FILL IN MOUNT ATTRIBUTE          00588300
         DC  CL1'-'                                                     00588400
USE850   DC  CL3' '                    FILL IN USE ATTRIBUTE            00588500
END850I2 EQU *                                                          00588600
*                                                                       00588700
*                                                                       00588800
IEA851I  DC  0F'0'                                                      00588900
         IEAPMNIP TYPE=HEADER,MSGST=IEA851I,MSGEND=END851I              00589000
         DC  C'IEA851I FOLLOWING MAY BE MOUNTED'                        00589100
END851I  EQU *                                                          00589200
*                                                                       00589300
*                                                                       00589400
IEA851I2 DC  0F'0'                                                      00589500
         IEAPMNIP TYPE=HEADER,MSGST=IEA851I2,MSGEND=END851I2,OPT=(,NBC) 00589600
SER851   DC  CL6' '                    FILL IN VOLUME SERIAL NUMBER     00589700
         DC  C' ON '                                                    00589800
DEV851   DC  CL8' '                    FILL IN DEVICE TYPE              00589900
END851I2 EQU *                                                          00590000
*                                                                       00590100
*                                                                       00590200
IEAH851A DC  0F'0'                                                      00590300
         IEAPMNIP TYPE=HEADER,MSGST=IEAH851A,MSGEND=END851A             00590400
         DC  C'IEA851A REPLY DEVICE ADDRESSES OR U.'                    00590500
END851A  EQU *                                                          00590600
*                                                                       00590700
*                                                                       00590800
IEA851A  DC  0F'0'                                                      00590900
         IEAPMNIP TYPE=PLIST,RMSGST=WTORBUF,RMSGL=80,MSGST=IEAH851A,   X00591000
               ASYNCH='NO'                                              00591100
*                                                                       00591200
*                                                                       00591300
IEA852I  DC  0F'0'                                                      00591400
         IEAPMNIP TYPE=HEADER,MSGST=IEA852I,MSGEND=END852I              00591500
         DC  C'IEA852I '                                                00591600
DEV852   DC  CL3' '                                                     00591700
         DC  C' ADDRESS INVALID - '                                     00591800
R852     DC  CL2' '                                                     00591900
END852I  EQU  *                                                         00592000
*                                                                       00592100
*                                                                       00592200
IEAH852A DC  0F'0'                                                      00592300
         IEAPMNIP TYPE=HEADER,MSGST=IEAH852A,MSGEND=END852A             00592400
         DC  C'IEA852A REPEAT REPLY.'                                   00592500
END852A  EQU *                                                          00592600
*                                                                       00592700
*                                                                       00592800
IEA852A  DC  0F'0'                                                      00592900
         IEAPMNIP TYPE=PLIST,RMSGST=WTORBUF,RMSGL=80,MSGST=IEAH852A,   X00593000
               ASYNCH='NO'                                              00593100
*                                                                       00593200
*                                                                       00593300
IEAH853A DC  0F'0'                                                      00593400
         IEAPMNIP TYPE=HEADER,MSGST=IEAH853A,MSGEND=END853A             00593500
         DC  C'IEA853A REPLY CONT, END OR RESPECIFY.'                   00593600
END853A  EQU *                                                          00593700
*                                                                       00593800
*                                                                       00593900
IEA853A  DC  0F'0'                                                      00594000
         IEAPMNIP TYPE=PLIST,RMSGST=WTORBUF,RMSGL=80,MSGST=IEAH853A,   X00594100
               ASYNCH='NO'                                              00594200
*                                                                       00594300
*                                                                       00594400
IEA854I  DC  0F'0'                                                      00594500
         IEAPMNIP TYPE=HEADER,MSGST=IEA854I,MSGEND=END854I              00594600
         DC  C'IEA854I ERROR READING VOLUME LABEL. '                    00594700
END854I  EQU *                                                          00594800
*                                                                       00594900
*                                                                       00595000
IEA855I  DC  0F'0'                                                      00595100
         IEAPMNIP TYPE=HEADER,MSGST=IEA855I,MSGEND=END855I              00595200
         DC  C'IEA855I INVALID VATLST'                                  00595300
NN855    DC  CL2' '                    FILL IN VATLST NUMBER            00595400
         DC  C' ENTRY '                                                 00595500
REC855   DC  CL21' '              FIRST 21 BYTES OF VATLST REC@ZP60041@ 00595600
END855I  EQU *                                                          00595700
*                                                                       00595800
*                                                                       00595900
IEA859I  DC  0F'0'                                                      00596000
         IEAPMNIP TYPE=HEADER,MSGST=IEA859I,MSGEND=END859I              00596100
         DC  C'IEA859I UNREQUESTED VOLUME. UNIT '                       00596200
DEV859   DC  CL3' '                    FILL IN UNIT ADDRESS             00596300
         DC  C' NOW UNLOADED.'                                          00596400
END859I  EQU *                                                          00596500
*                                                                       00596600
*                                                                       00596700
IEA860A  DC  0F'0'                                                      00596800
         IEAPMNIP TYPE=HEADER,MSGST=IEA860A,MSGEND=END860A              00596900
DEV860   DC  XL80'00'                  FILL IN UNIT ADDRESSES           00597000
END860A  EQU *                                                          00597100
*                                                                       00597200
*                                                                       00597300
IEAH8602 DC  0F'0'                                                      00597400
         IEAPMNIP TYPE=HEADER,MSGST=IEAH8602,MSGEND=END8602             00597500
         DC  C'IEA860A REPLY U WHEN ALL DEVICES ARE READY.'             00597600
END8602  EQU *                                                          00597700
*                                                                       00597800
*                                                                       00597900
IEA8602  DC  0F'0'                                                      00598000
         IEAPMNIP TYPE=PLIST,RMSGST=WTORBUF,RMSGL=80,MSGST=IEAH8602,   X00598100
               ASYNCH='NO'                                              00598200
*                                                                       00598300
*                                                                       00598400
IEAH861A DC  0F'0'                                                      00598500
         IEAPMNIP TYPE=HEADER,MSGST=IEAH861A,MSGEND=END861A             00598600
         DC  C'IEA861A VAL='                                            00598700
NN861    DC  CL2' '                    FILL IN VATLST NUMBER            00598800
         DC  C' NOT FOUND. REPLY U OR CORRECT VALUE.'                   00598900
END861A  EQU *                                                          00599000
*                                                                       00599100
*                                                                       00599200
IEA861A  DC  0F'0'                                                      00599300
         IEAPMNIP TYPE=PLIST,RMSGST=WTORBUF,RMSGL=80,MSGST=IEAH861A,   X00599400
               ASYNCH='NO'                                              00599500
*                                                                       00599600
*                                                                       00599700
IEA866I  DC  0F'0'                                                      00599800
         IEAPMNIP TYPE=HEADER,MSGST=IEA866I,MSGEND=END866I              00599900
         DC  C'IEA866I VOLUME '                                         00600000
SER866   DC  CL6' '                                                     00600100
         DC  C' ON '                                                    00600200
V866     DC  C' '                                                       00600300
DEV866   DC  CL3' '                                                     00600400
         DC  C' REQUIRED ON A '                                         00600500
DT866    DC  CL8' '                                                     00600600
END866I  EQU *                                                          00600700
*                                                                       00600800
IEA867I  DC  0F'0'                                                      00600900
         IEAPMNIP TYPE=HEADER,MSGST=IEA867I,MSGEND=END867I              00601000
         DC  C'IEA867I DUPLICATE VOLUME '                               00601100
SER867   DC  CL6' '                    FILL IN VOLUME SERIAL NUMBER     00601200
         DC  C'. UNIT '                                                 00601300
DEV867   DC  CL3' '                    FILL IN UNIT ADDRESS             00601400
         DC  C' NOW UNLOADED.'                                          00601500
END867I  EQU *                                                          00601600
*                                                                       00601700
IEAH893A DC  0F'0'                                                      00601800
         IEAPMNIP TYPE=HEADER,MSGST=IEAH893A,MSGEND=END893A             00601900
         DC  C'IEA893A NOT READY. REPLY U WHEN DEVICES ARE '            00602000
         DC  C'READY OR NO IF NOT MOUNTING.'                            00602100
END893A  EQU *                                                          00602200
*                                                                       00602300
IEA893A  DC  0F'0'                                                      00602400
         IEAPMNIP TYPE=PLIST,RMSGST=WTORBUF,RMSGL=80,MSGST=IEAH893A,   X00602500
               ASYNCH='NO'                                              00602600
*                                                                       00602700
IEA894I  DC  0F'0'                                                      00602800
         IEAPMNIP TYPE=HEADER,MSGST=IEA894I,MSGEND=END894I              00602900
         DC  C'IEA894I REQUESTED VOLUME ON UNREQUESTED UNIT. '          00603000
DEV894   DC  CL3' '                                                     00603100
         DC  C' NOW UNLOADED.'                                          00603200
END894I  EQU  *                                                         00603300
*                                                                       00603400
IEAH895A DC  0F'0'                                                      00603500
         IEAPMNIP TYPE=HEADER,MSGST=IEAH895A,MSGEND=END895A             00603600
         DC  C'IEA895A FORMAT ERROR. REPEAT REPLY.'                     00603700
END895A  EQU  *                                                         00603800
*                                                                       00603900
IEA895A  DC  0F'0'                                                      00604000
         IEAPMNIP TYPE=PLIST,RMSGST=WTORBUF,RMSGL=80,MSGST=IEAH895A,   X00604100
               ASYNCH='NO'                                              00604200
*                                                                       00604300
IEA948I  DC  0F'0'                                                      00604400
         IEAPMNIP TYPE=HEADER,MSGST=IEA948I,MSGEND=END948I              00604500
         DC  C'IEA948I '                                                00604600
V948     DC  C' '                                                       00604700
DEV948   DC  CL3' '                                                     00604800
         DC  C' NOW UNLOADED.'                                          00604900
END948I  EQU *                                                          00605000
*                                                                       00605100
IEAH947A DC  0F'0'                                                      00605200
         IEAPMNIP TYPE=HEADER,MSGST=IEAH947A,MSGEND=END947A             00605300
         DC  C'IEA947A REPLY U TO CONTINUE, OR RE-IPL.'                 00605400
END947A  EQU *                                                          00605500
*                                                                       00605600
IEA947A  DC  0F'0'                                                      00605700
         IEAPMNIP TYPE=PLIST,RMSGST=WTORBUF,RMSGL=80,MSGST=IEAH947A,   X00605800
               ASYNCH='NO'                                              00605900
*                                                                       00606000
IEA949I  DC  0F'0'                                                      00606100
         IEAPMNIP TYPE=HEADER,MSGST=IEA949I,MSGEND=END949I              00606200
         DC  C'IEA949I I/O ERROR READING VATLST'                        00606300
NN949    DC  CL2' '                                                     00606400
         DC  C'.'                                                       00606500
END949I  EQU *                                                          00606600
*                                                                       00606700
IEAH949A DC  0F'0'                                                      00606800
         IEAPMNIP TYPE=HEADER,MSGST=IEAH949A,MSGEND=END949A             00606900
         DC  C'IEA949A REPLY YES FOR LIST OF ENTRIES '                  00607000
         DC  C'THAT WILL BE PROCESSED, OR U FOR NO LIST.'               00607100
END949A  EQU *                                                          00607200
*                                                                       00607300
*                                                                       00607400
IEA949A  DC  0F'0'                                                      00607500
         IEAPMNIP TYPE=PLIST,RMSGST=WTORBUF,RMSGL=80,MSGST=IEAH949A,   X00607600
               ASYNCH='NO'                                              00607700
*                                                                       00607800
IEA985I  DC  0F'0'                                                      00607900
         IEAPMNIP TYPE=HEADER,MSGST=IEA985I,MSGEND=END985I              00608000
         DC  C'IEA985I UNABLE TO UNLOAD MSS VOLUME '                    00608100
VOL985   DC  CL6' '                                                     00608200
         DC  C' FROM V'                                                 00608300
DEV985   DC  CL3' '                                                     00608400
         DC  C' - RC='                                                  00608500
RET985   DC  CL3' '                                                     00608600
         DC  C'.'                                                       00608700
END985I  EQU *                                                          00608800
*                                                                       00608900
IEA986I  DC    0F'0'                                                    00609000
         IEAPMNIP TYPE=HEADER,MSGST=IEA986I,MSGEND=END986I              00609100
         DC    C'IEA986I MSS VOLUME '                                   00609200
VOL986   DC    CL6' '                                                   00609300
         DC    C' REQUIRED ON V'                                        00609400
DEV986   DC    CL3' '                                                   00609500
         DC    C'.'                                                     00609600
END986I  EQU   *                                                        00609700
*                                                                       00609800
IEA987I  DC    0F'0'                                                    00609900
         IEAPMNIP TYPE=HEADER,MSGST=IEA987I,MSGEND=END987I              00610000
         DC    C'IEA987I UNABLE TO MOUNT MSS VOLUME '                   00610100
VOL987   DC    CL6' '                                                   00610200
         DC    C' ON V'                                                 00610300
DEV987   DC    CL3' '                                                   00610400
         DC    C' - RC='                                                00610500
RET987   DC    CL3' '                                                   00610600
         DC    C'.'                                                     00610700
END987I  EQU   *                                                        00610800
*                                                                       00610900
NIPMNT   IEAPMNIP TYPE=MOUNTPL,PARAM=DUMMY                              00611000
*                                                                       00611100
NIPPMMS1 DC    0F'0'                                                    00611200
         IEAPMNIP TYPE=HEADER,MSGST=NIPPMMS1,MSGEND=NIPPMED1            00611300
         DC    CL34'IEA300I I/O ERROR DURING BLDL FOR '                 00611400
NIPPMMB1 DC    CL8'        '                                            00611500
         DC    CL16' IN SYS1.PARMLIB'                                   00611600
NIPPMED1 EQU   *                                                        00611700
*                                                                       00611800
NIPPMMS2 DC    0F'0'                                                    00611900
         IEAPMNIP TYPE=HEADER,MSGST=NIPPMMS2,MSGEND=NIPPMED2            00612000
         DC    CL8'IEA301I '                                            00612100
NIPPMMB2 DC    CL8'        '                                            00612200
         DC    CL26' NOT FOUND IN SYS1.PARMLIB'                         00612300
NIPPMED2 EQU   *                                                        00612400
*                                                                       00612500
*              DEVICE NAME         UCBTBYT4                   @ZP60041@ 00612600
DASDTAB  DC    CL8'2311'           X'01'                      @ZP60041@ 00612700
         DC    CL8'2301'           X'02'                      @ZP60041@ 00612800
         DC    CL8'2303'           X'03'                      @ZP60041@ 00612900
         DC    CL8'9345'           X'04'  REPURPOSED FROM 2302@ZP60041@ 00613000
         DC    CL8'2321'           X'05'                      @ZP60041@ 00613100
         DC    CL8'2305-1'         X'06'                      @ZP60041@ 00613200
         DC    CL8'2305-2'         X'07'                      @ZP60041@ 00613300
         DC    CL8'2314'           X'08'                      @ZP60041@ 00613400
         DC    CL8'3330'           X'09'                      @ZP60041@ 00613500
         DC    CL8'3340'           X'0A'                      @ZP60041@ 00613600
         DC    CL8'3350'           X'0B'                      @ZP60041@ 00613700
         DC    CL8'3375'           X'0C'                      @ZP60041@ 00613800
         DC    CL8'3330-1'         X'0D'                      @ZP60041@ 00613900
         DC    CL8'3380'           X'0E'                      @ZP60041@ 00614000
         DC    CL8'3390'           X'0F'                      @ZP60041@ 00614100
*                                                             @ZP60041@ 00614200
TESTMASK DC    XL256'00'                                      @ZP60041@ 00614300
         ORG   TESTMASK+C'*'                                  @ZP60041@ 00614400
         DC    X'FF'                                          @ZP60041@ 00614500
         ORG   TESTMASK+C'%'                                  @ZP60041@ 00614600
         DC    X'FF'                                          @ZP60041@ 00614700
         ORG   ,                                              @ZP60041@ 00614800
WILDRELT DC    XL16'00'                WILDCARD RESULT AREA   @ZP60041@ 00614900
WORKAREA DC    64F'0'                  WILDCARD WORKAREA      @ZP60041@ 00615000
*                                                                       00615100
         LTORG                                                          00615200
*                                                                       00615300
         DROP  R9,R11,R12                                               00615400
*                                                                       00615500
WILD     TITLE 'WILDCARD - WILD CARD SERVICES'                          00615600
*                                                                       00615700
*        FUNCTION -                                                     00615800
*        PERFORM WILDCARD MATCH CHECKING, BY COMPARING A PROVIDED       00615900
*        PATTERN STRING WHICH CAN CONTAIN WILDCARD CHARACTERS           00616000
*        TO AN INPUT STRING.                                            00616100
*        INVOKED BY VARIOUS PARAMETER LISTS                             00616200
*        DEPENDING ON THE ENTRY POINT INVOKED.                          00616300
*                                                                       00616400
*        DEFINED BY DSECTS -                                            00616500
*        ASASPARM                                                       00616600
*        ASAPPARM                                                       00616700
*        ASADPARM                                                       00616800
*                                                                       00616900
*        ENTRY POINTS -                                                 00617000
*                                                                       00617100
*        WILDCHK  - COMBINATION OF PREPROCESS AND SCAN OF INPUT STRING  00617200
*                   R13 SAVE AREA NOT REQUIRED                          00617300
*                   CALLER MUST PROVIDE ADDRESS IN R0 OF 256 BYTE       00617400
*                   AREA THAT IS USED AS SAVEAREA AND WORKAREA          00617500
*                                                                       00617600
*        WILDPP   - PREPROCESS THE PATTERN STRING                       00617700
*                                                                       00617800
*                   ENTRY POINT TO PREPROCESS THE PATTERN STRING        00617900
*                   R13 SAVE AREA NOT REQUIRED                          00618000
*                   CALLER MUST PROVIDE ADDRESS IN R0 OF 256 BYTE       00618100
*                   AREA THAT IS USED AS SAVEAREA AND WORKAREA          00618200
*                                                                       00618300
*        WILDPS   - SCAN INPUT STRING USING PREPROCESSED PATTERN        00618400
*                                                                       00618500
*                   ENTRY POINT TO PROCESS INPUT STRING USING           00618600
*                   PREPROCESSED PATTERN CONTROL BLOCK                  00618700
*                   GENERATED PREVIOUSLY BY ASAWLDPP                    00618800
*                   R13 SAVE AREA NOT REQUIRED                          00618900
*                   CALLER MUST PROVIDE ADDRESS IN R0 OF 256 BYTE       00619000
*                   AREA THAT IS USED AS SAVEAREA AND WORKAREA          00619100
*                                                                       00619200
WILDCRD  CSECT                                                          00619300
*                                                                       00619400
         USING WILDCRD,R15                                              00619500
         ENTRY WILDCHK                                                  00619600
         ENTRY WILDPP                                                   00619700
         ENTRY WILDPS                                                   00619800
*                                                                       00619900
         B     WILDCRDX                BRANCH AROUND MODULE EYE CATCHER 00620000
*                                                                       00620100
         DC    C'WILDCRD &SYSDATE &SYSTIME'                             00620200
WILDCRDX BR    R14                     RETURN TO CALLER                 00620300
         DROP  R15                                                      00620400
*                                                                       00620500
*        WILDCHK                                                        00620600
*                                                                       00620700
*        R0 -> 256 BYTE SAVEAREA AND WORK AREA                          00620800
*        R1 -> CALLER PARAMETER LIST                                    00620900
*                                                                       00621000
         USING WILDCHK,R15                                              00621100
         DC    0F'0'                                                    00621200
         DC    C'WILDCHK'                                               00621300
*                                                                       00621400
WILDCHK  XR    R0,R1                   EXCHANGE R0/R1 FOR ADDRESSING    00621500
         XR    R1,R0                   PURPOSES                         00621600
         XR    R0,R1                                                    00621700
         STM   R2,R14,8(R1)            SAVE CALLERS REGS IN WORKAREA    00621800
         ST    R1,0(,R1)                                                00621900
         ST    R0,4(,R1)                                                00622000
         LR    R13,R1                  SAVE WORKAREA ADDR IN R13        00622100
         L     R12,AWILDCRD                                             00622200
         DROP  R15                                                      00622300
         USING WILDCRD,R12                                              00622400
                                                                        00622500
         LR    R1,R0                   R1 -> CALLER PARAMETER LIST      00622600
                                                                        00622700
         USING WCHKPARM,R1                                              00622800
*                                                                       00622900
*        BUILD PARAMETER LIST FOR WILDPP                                00623000
*                                                                       00623100
         LA    R3,15*4(,R13)           R3 -> PARM AREA AFTER SAVE AREA  00623200
         LA    R4,16(,R3)              R4 -> RESULT AREA                00623300
         LA    R5,16(,R4)              R5 -> FREE AREA                  00623400
         USING WPPPARM,R3                                               00623500
         ST    R4,WPPRELT              PROVIDE RESULT AREA              00623600
         MVC   WPPPSTA,WCHKPSTA           ..   -> PATTERN STRING        00623700
         MVC   WPPPSTL,WCHKPSTL           ..   L'PATTERN STRING         00623800
         LR    R0,R5                   R0 -> SAVE AREA / WORKAREA       00623900
         LR    R1,R3                   R1 -> PARAMETER LIST             00624000
         LA    R15,WILDPP              R15 -> WILDPP ROUTINE            00624100
         BASR  R14,R15                 PREPROCESS PATTERN STRING        00624200
         DROP  R3                                                       00624300
*                                                                       00624400
*        BUILD PARAMETER LIST FOR WILDPS                                00624500
*                                                                       00624600
         L     R1,4(,R13)              RESTORE R1 FOR WCHKPARM          00624700
         USING WPSPARM,R3                                               00624800
         MVC   WPSISTA,WCHKISTA        PROVIDE -> INPUT STRING          00624900
         MVC   WPSISTL,WCHKISTL           ..   L'INPUT STRING           00625000
         LR    R0,R5                   R0 -> SAVE AREA / WORKAREA       00625100
         LR    R1,R3                   R1 -> PARAMETER LIST             00625200
         LA    R15,WILDPS              R15 -> WILDPS ROUTINE            00625300
         BASR  R14,R15                 PROCESS INPUT STRING             00625400
         LM    R0,R14,0(R13)           RESTORE CALLER REGS (NOT R15)    00625500
         BR    R14                     RETURN TO CALLER                 00625600
*                                                                       00625700
         DROP  R12,R1,R3                                                00625800
*                                                                       00625900
*        WILDPS ENTRY                                                   00626000
*                                                                       00626100
*        ENTRY POINT TO PROCESS INPUT STRING USING                      00626200
*        PREPROCESSED PATTERN CONTROL BLOCK                             00626300
*        GENERATED PREVIOUSLY BY WILDPP                                 00626400
*        R13 SAVE AREA NOT REQUIRED                                     00626500
*        CALLER MUST PROVIDE ADDRESS OF 256 BYTE AREA IN R0             00626600
*        THAT IS USED AS SAVEAREA AND WORKAREA                          00626700
*        CAN BE USED IN MVS 3.8 ENVIRONMENT                             00626800
*                                                                       00626900
*        R0 -> CALLER PROVIDED WORK AREA - 256 BYTES                    00627000
*        R1 -> CALLER PARAMETER LIST                                    00627100
*                                                                       00627200
         USING WILDPS,R15                                               00627300
         DC    0F'0'                                                    00627400
         DC    C'WILDPS'                                                00627500
*                                                                       00627600
WILDPS   XR    R0,R1                   EXCHANGE R0/R1 FOR ADDRESSING    00627700
         XR    R1,R0                   PURPOSES                         00627800
         XR    R0,R1                                                    00627900
         STM   R2,R14,8(R1)            SAVE CALLERS REGS IN WORKAREA    00628000
         ST    R1,0(,R1)                                                00628100
         ST    R0,4(,R1)                                                00628200
         LR    R13,R1                  SAVE WORKAREA ADDR IN R13        00628300
         L     R12,AWILDCRD                                             00628400
         DROP  R15                                                      00628500
         USING WILDCRD,R12                                              00628600
*                                                                       00628700
         LR    R1,R0                   R1 -> CALLER PARAMETER LIST      00628800
*                                                                       00628900
         USING WPSPARM,R1                                               00629000
*                                                                       00629100
         LM    R2,R4,WPSRELT           R2 -> RESULT FROM WILDPP         00629200
*                                            PREPROCESSED PATTERN       00629300
*                                      R3 -> INPUT STRING TO BE         00629400
*                                            SCANNED WITH PATTERN       00629500
*                                      R4 =  L'INPUT STRING             00629600
         DROP  R1                                                       00629700
         USING PPRESULT,R2                                              00629800
         XR    R7,R7                   USED FOR * LITERAL COUNT         00629900
         L     R5,PPRESL               R5 =  L'PREPROC PATTERN STRING   00630000
         LA    R2,PPRESDA              R2 -> PATTERN STRING CHARS       00630100
         DROP  R2                                                       00630200
*        TRIM L'INPUT STRING - DISCARD TRAILING BLANKS                  00630300
TRIML    LA    R15,0(R3,R4)                                             00630400
         BCTR  R15,0                   R15 -> LAST BYTE OF INPUT STRING 00630500
         CLI   0(R15),C' '             BLANK CHAR ?                     00630600
         BNE   WPSA                    NO, END LOOP                     00630700
         CR    R3,R15                  TESTED LEFTMOST CHAR ?           00630800
         BE    WPSXF                   YES, BRANCH TO FAIL TEST         00630900
*                                      AS INPUT STRING BLANK            00631000
         BCT   R4,TRIML                RE ENTER LOOP                    00631100
*        END INPUT STRING TRIM LOOP WITH R4 = L'INPUT STRING            00631200
*                                                                       00631300
*        BEGIN CHARACTER COMPARISON LOOP                                00631400
WPSA     LA    R8,1                    SET CHAR COUNTER TO 1            00631500
         CLI   0(R2),X'40'             PATTERN CHAR AN * LITERAL CNT ?  00631600
*                                      IE LESS THAN X'40'               00631700
         BL    WPSB                    YES, BRANCH                      00631800
         CLI   0(R2),C'%'              PATTERN CHAR AN % ?              00631900
         BE    WPSLA                   YES, BRANCH TO REDRIVE LOOP      00632000
*                                      AS ANY CHAR WILL MATCH           00632100
*        PATTERN CHAR IS A LITERAL, MUST MATCH INPUT STRING             00632200
         CLC   0(1,R2),0(R3)           MATCH WITH INPUT STRING ?        00632300
         BNE   WPSXF                   NO, MISMATCH, FAIL TEST          00632400
         B     WPSLA                   YES MATCH,BRANCH TO REDRIVE LOOP 00632500
*        FOUND AN * LITERAL COUNTER FLAG                                00632600
WPSB     ICM   R8,B'0001',0(R2)   *    R8 = L'LITERAL PATTERN CHARS     00632700
         LA    R2,1(,R2)          ¦    INCR PAST * LIT CHAR COUNTER     00632800
         BCTR  R5,0               ¦    DECR L'PATTERN STRING            00632900
*                                 ¦    FOLLOWING LITERALS ?             00633000
         BZ    WPSXR              V    NO, BRANCH TO RETURN MATCH       00633100
         LA    R0,X'20'                                                 00633200
         CR    R8,R0                   *LITERAL AT END FLAG ON ?        00633300
         BL    WPSBB                   NO, STANDARD * PROCESSING        00633400
*                                      YES, *LITERAL AT END FLAG ON     00633500
*                                      SETUP TO TEST END OF INPUT STR   00633600
         SR    R8,R0                   R8 = L'LITERAL PATTERN CHARS     00633700
         LA    R3,0(R3,R4)             R3 -> END OF INPUT STRING+1      00633800
         SR    R3,R8                   R3 -> LITERALS TO TEST           00633900
         CR    R4,R8                   ENOUGH INPUT CHARS TO TEST       00634000
         BL    WPSXF                   NO, FAIL TEST                    00634100
         LR    R4,R8                   SET NO OF INPUT CHARS TO TEST    00634200
         B     WPSA                                                     00634300
*                                                                       00634400
*        STANDARD * PROCESSING WITH LITERAL CHARS TO MATCH              00634500
*                                                                       00634600
*        STEP THROUGH THE INPUT STRING CHAR BY CHAR FOR A               00634700
*        MATCH ON THE STRING OF CHARS IN THE PATTERN STRING             00634800
*        ALLOWING FOR EMBEDDED % PATTERN CHARS                          00634900
*                                                                       00635000
WPSBB    LR    R10,R2                  R10 -> PATTERN LITERAL CHARS     00635100
         LR    R11,R8                  R11  = NO OF LITERAL PATTERN     00635200
*                                             CHARS TO MATCH            00635300
WPSBL    CLC   0(1,R3),0(R10)          INPUT CHAR MATCH PATTERN CHAR ?  00635400
         BE    WPSBM                   YES, BRANCH                      00635500
         CLI   0(R10),C'%'             % PATTERN CHAR FORCE A MATCH ?   00635600
         BE    WPSBM                   YES, BRANCH                      00635700
*        CHARS NOT MATCH                                                00635800
*                                                                       00635900
*        RESTART TESTING FROM FIRST PATTERN CHAR ONWARDS                00636000
         LR    R10,R2                  RESET -> PATTERN CHARS           00636100
         CR    R11,R8                  MISMATCH ON FIRST CHAR ?         00636200
         BNE   WPSBLJ                  NO, BRANCH                       00636300
         LA    R3,1(,R3)               YES, ADVANCE -> INPUT CHAR       00636400
         BCTR  R4,0                    DECR COUNT OF INPUT CHARS        00636500
WPSBLJ   LR    R11,R8                  RESET NO OF LITERAL CHARS TO     00636600
*                                      MATCH                            00636700
         CR    R11,R4                  ENOUGH INPUT CHARS REMAINING     00636800
*                                      TO MATCH PATTERN CHARS ?         00636900
         BH    WPSXF                   NO, RAN OUT OF INPUT CHARS       00637000
         B     WPSBL                   BRANCH TO REDRIVE LOOP           00637100
*        PATTERN AND INPUT CHARACTER MATCH                              00637200
WPSBM    LA    R10,1(,R10)             INCR -> PATTERN CHARS            00637300
         LA    R3,1(,R3)               INCR -> INPUT STRING CHARS       00637400
         CR    R11,R4                  ENOUGH INPUT CHARS REMAINING     00637500
*                                      TO MATCH PATTERN CHARS ?         00637600
         BCTR  R4,0                    DECR COUNT OF INPUT CHARS        00637700
         BCT   R11,WPSBL               DECR COUNT OF PATTERN CHARS      00637800
*                                      AND REDRIVE LOOP                 00637900
*        ALL LITERAL CHARS FOLLOWING * MATCHED                          00638000
         B     WPSLAA                  CONTINUE TO PROCESS REMAINING    00638100
*                                      PATTERN CHARS (IF ANY)           00638200
*        A PATTERN CHAR MATCHED AN INPUT CHAR OR % IN PATTERN           00638300
*        ADVANCE PTRS                                                   00638400
WPSLA    LA    R3,0(R3,R8)             R3 -> NEXT CHAR TO PROCESS       00638500
*                                            IN INPUT STRING            00638600
         SR    R4,R8                   R4 = REMAINING L'INPUT STRING    00638700
WPSLAA   LA    R2,0(R2,R8)             R2 -> NEXT CHAR TO PROCESS       00638800
*                                            IN PREPROC STRING          00638900
         SR    R5,R8                   R5 = REMAINING L'PATTERN STRING  00639000
         BZ    WPXA                    NO PATTERN CHARS ? BRANCH        00639100
*        IF (L'PATTERN & L'STRING) NOT 0 THEN REDRIVE LOOP              00639200
         LTR   R4,R4                   MORE INPUT CHARS ?               00639300
         BNZ   WPSA                    YES, REDRIVE LOOP                00639400
*        L'PATTERN NOT ZERO AND INPUT STRING = ZERO                     00639500
*        TEST FOR TRAILING * IN PATTERN                                 00639600
         CLI   0(R2),X'00'             TRAILING * IE NO LITERALS ?      00639700
         BE    WPSXR                   YES, MATCH                       00639800
         B     WPSXF                   NO, RAN OUT OF INPUT CHARS       00639900
*        PATTERN CHARS EXHAUSTED                                        00640000
WPXA     LTR   R4,R4                   MORE INPUT CHARS ?               00640100
         BNZ   WPSXF                   YES, FAIL                        00640200
*        INPUT STRING - PATTERM MATCH OR ALL CHARS COMPARED             00640300
WPSXR    XR    R15,R15                 SET ZERO RETURN CODE             00640400
         B     WPSXX                                                    00640500
*        INPUT STRING FAILED TO MATCH PATTERN OR UNEQUAL LENGTHS        00640600
WPSXF    LA    R15,8                   SET FAIL RETURN CODE             00640700
WPSXX    LM    R0,R14,0(R13)           RESTORE CALLER REGS (NOT R15)    00640800
         BR    R14                     RETURN TO CALLER                 00640900
*                                                                       00641000
         DROP  R12                                                      00641100
*                                                                       00641200
*        WILDPP ENTRY                                                   00641300
*                                                                       00641400
*        PREPROCESS THE PATTERN STRING                                  00641500
*                                                                       00641600
*        1. CONVERT ALL OCCURRENCES OF *% TO %* IF ANY ARE PRESENT      00641700
*        2. CONVERT ALL OCCURRENCES OF CONSECUTIVE *                    00641800
*           TO A SINGLE *                                               00641900
*        3. CONVERT EACH * TO A 1-BYTE BINARY NUMBER THAT IS A          00642000
*           COUNT OF THE IMMEDIATELY SUBSEQUENT LITERAL CHARACTERS      00642100
*           THAT MUST BE MATCH EXACTLY (ALLOWING FOR %)                 00642200
*        4. SET SPECIAL FLAG IN THE LITERAL COUNT FIELD IF THERE        00642300
*           ARE LITERALS AT THE END OF THE PATTERN PRECEEDED BY         00642400
*           AN *                                                        00642500
*                                                                       00642600
*        R0 -> CALLER PROVIDED WORK AREA                                00642700
*        R1 -> CALLER PARAMETER LIST                                    00642800
*        R13   N/A                                                      00642900
*                                                                       00643000
         USING WILDPP,R15                                               00643100
         DC    0F'0'                                                    00643200
         DC    C'WILDPP'                                                00643300
*                                                                       00643400
WILDPP   XR    R0,R1                   EXCHANGE R0/R1 FOR ADDRESSING    00643500
         XR    R1,R0                   PURPOSES                         00643600
         XR    R0,R1                                                    00643700
         STM   R2,R14,8(R1)            SAVE CALLERS REGS IN WORKAREA    00643800
         ST    R1,0(,R1)                                                00643900
         ST    R0,4(,R1)                                                00644000
         LR    R13,R1                  SAVE WORKAREA ADDR IN R13        00644100
         L     R12,AWILDCRD                                             00644200
         DROP  R15                                                      00644300
         USING WILDCRD,R12                                              00644400
*                                                                       00644500
         LR    R1,R0                   R1 -> CALLER PARAMETER LIST      00644600
*                                                                       00644700
         USING WPPPARM,R1                                               00644800
*                                                                       00644900
         LM    R2,R4,WPPRELT           R2 -> OUTPUT RESULT RETURNED TO  00645000
*                                            CALLER FROM PREPROCESSING  00645100
*                                      R3 -> PATTERN STRING TO BE       00645200
*                                            PROCESSED                  00645300
*                                      R4 =  L'PATTERN STRING           00645400
         DROP  R1                                                       00645500
         USING PPRESULT,R2                                              00645600
         XC    PPRESDAT,PPRESDAT       ZERO PREPROCESSOR RESULT         00645700
         XR    R7,R7                   ZERO R7 LITERAL COUNTER          00645800
         LA    R9,PPRESDA              R9 -> PROCESSED PATTERN CHARS    00645900
*                                                                       00646000
*        BEGIN LOOP                                                     00646100
*        TEST FOR MASKING CHARS AND BLANK                               00646200
*                                                                       00646300
LOOPA    CLI   0(R3),C'*'              * PATTERN CHAR ?                 00646400
         BE    LOOPA1                  YES, BRANCH                      00646500
         CLI   0(R3),C'%'              % PATTERN CHAR ?                 00646600
         BE    LOOPB                   YES, BRANCH                      00646700
         CLI   0(R3),C' '              FOUND BLANK TERMINATING CHAR ?   00646800
         BE    LOOPXX                  YES, BRANCH TO TERMINATE         00646900
*                                      PATTERN STRING PROCESSING        00647000
         B     LOOPX                   NO SPECIAL CHARS FOUND           00647100
*                                      BRANCH TO PROCESS LITERAL CHAR   00647200
*        * FOUND                                                        00647300
LOOPA1   TM    PPFLAGS,PPFPCAS         * PREVIOUS CHAR ?                00647400
         BO    LOOPX2                  YES, DUPLICATE, DISCARD THIS *   00647500
*                                      NO, THIS IS NEW * CHAR           00647600
         TM    PPFLAGS,PPFLITC         BEEN COUNTING LITERALS ?         00647700
         BZ    LOOPA2                  NO, BRANCH                       00647800
         STC   R7,0(,R8)               YES, STORE LITERAL COUNT AT      00647900
*                                      LOCATION OF PREVIOUS *           00648000
         XR    R7,R7                   ZERO COUNT                       00648100
LOOPA2   OI    PPFLAGS,PPFPCAS+PPFLITC SET CHAR * FOUND AND COUNT LITS  00648200
         LR    R8,R9                   SAVE LOCATION OF * IN RESULT     00648300
*                                      STRING                           00648400
         B     LOOPX1                                                   00648500
*        % FOUND                                                        00648600
LOOPB    TM    PPFLAGS,PPFPCAS         IS THIS *% ?                     00648700
         BNO   LOOPX                   NO, BRANCH                       00648800
*                                      YES, CONVERT TO %*               00648900
         LR    R15,R9                  SAVE NEW LOCATION OF *           00649000
         BCTR  R15,0                   BACKSPACE RESULT STRING ADDR     00649100
         MVI   0(R15),C'%'             MAKE PREVIOUS * TO A %           00649200
         B     LOOPA2                                                   00649300
*        NORMAL LITERAL CHAR, NOT *                                     00649400
LOOPX    NI    PPFLAGS,255-PPFPCAS     RESET PREVIOUS CHAR * FOUND FLAG 00649500
         TM    PPFLAGS,PPFLITC         BEEN COUNTING LITERALS ?         00649600
         BZ    LOOPXA                  NO, BRANCH                       00649700
         LA    R7,1(,R7)               INCR LITERAL COUNTER             00649800
LOOPXA   MVC   0(1,R9),0(R3)           MOVE CHAR TO PREPROC RESULT      00649900
LOOPX1   LA    R9,1(,R9)               INCR PREPROC RESULT PTR          00650000
LOOPX2   LA    R3,1(,R3)               INCR PATTERN STR POINTER         00650100
         BCT   R4,LOOPA                DECR COUNT OF PATTERN CHARS      00650200
*                                      AND REDRIVE LOOP                 00650300
*                                                                       00650400
*        ALL PATTERN STRING CHARS PROCESSED                             00650500
*                                                                       00650600
LOOPXX   TM    PPFLAGS,PPFLITC         BEEN COUNTING LITERALS ?         00650700
         BZ    LOOPXXA                 NO, BRANCH                       00650800
         STC   R7,0(,R8)               YES, STORE LITERAL COUNT AT      00650900
*                                      LOCATION OF PREVIOUS *           00651000
         LTR   R7,R7                   LITERALS AFTER * AT THE          00651100
*                                      TRAILING END OF THE STRING ?     00651200
         BZ    LOOPXXA                 NO, BRANCH                       00651300
         OI    0(R8),X'20'             YES, TURN ON *LITERAL FLAG       00651400
*                                                                       00651500
LOOPXXA  LA    R15,PPRESDA             R15 -> PROCESSED PATTERN CHARS   00651600
         SR    R9,R15                  CALC L'PATTERN STRING            00651700
         ST    R9,PPRESL               SAVE NEW L'PATTERN STRING        00651800
         LM    R0,R14,0(R13)           RESTORE CALLER REGS (NOT R15)    00651900
         XR    R15,R15                 SET ZERO RETURN CODE             00652000
         BR    R14                     RETURN TO CALLER                 00652100
*                                                                       00652200
         DROP  R12,R2                                                   00652300
*                                                                       00652400
AWILDCRD DC    A(WILDCRD)                                               00652500
*                                                                       00652600
*        PARAMETER LIST PASSED TO:- WILDCHK                             00652700
*                                                                       00652800
WCHKPARM DSECT                                                          00652900
WCHKPSTA DS    A             +00   -> PATTERN STRING                    00653000
WCHKPSTL DS    F             +04   L'PATTERN STRING                     00653100
WCHKISTA DS    A             +08   -> INPUT STRING                      00653200
WCHKISTL DS    F             +0C   L'INPUT STRING                       00653300
*                                                                       00653400
*        RESULT FROM PREPROCESSING PATTERN STRING                       00653500
*                                                                       00653600
PPRESULT DSECT                                                          00653700
PPRESDAT DS    0XL16         +00-15                                     00653800
PPFLAGS  DS    X             +00    FLAGS - INTERNAL USE ONLY           00653900
*                                           OVERRIDDEN BY L'PATTERN     00654000
*        FLAG DEFINITIONS                                               00654100
*                                                                       00654200
PPFPCAS  EQU   X'80'         PREVIOUS CHAR WAS * CHAR                   00654300
PPFLITC  EQU   X'40'         * FOUND SO COUNT LITERALS                  00654400
PPFRESVA EQU   X'20'         RESERVED                                   00654500
PPFRESVB EQU   X'10'           ..                                       00654600
PPFRESVC EQU   X'08'           ..                                       00654700
PPFRESVD EQU   X'04'           ..                                       00654800
PPFRESVE EQU   X'02'           ..                                       00654900
PPFRESVF EQU   X'01'           ..                                       00655000
*                                                                       00655100
         ORG   PPRESDAT                                                 00655200
PPRESL   DS    F             +00    L'PREPROCESSED DATA STRING          00655300
PPRESDA  DS    CL12          +04    RESULTS OF PREPROCESSING            00655400
*                                                                       00655500
R0       EQU   00                      EQUATES FOR REGISTERS 0-15       00655600
R1       EQU   01                                                       00655700
RPARM    EQU   R1                      USED BY NIP MACRO                00655800
R2       EQU   02                                                       00655900
RNVT     EQU   02                      USED BY NIP MACRO                00656000
R3       EQU   03                                                       00656100
R4       EQU   04                                                       00656200
R5       EQU   05                                                       00656300
R6       EQU   06                                                       00656400
R7       EQU   07                                                       00656500
R8       EQU   08                                                       00656600
R9       EQU   09                                                       00656700
R10      EQU   10                                                       00656800
R11      EQU   11                                                       00656900
R12      EQU   12                                                       00657000
R13      EQU   13                                                       00657100
R14      EQU   14                                                       00657200
REXIT    EQU   R14                     USED BT NIP MACRO                00657300
R15      EQU   15                                                       00657400
RENTRY   EQU   R15                     USED BY NIP MACRO                00657500
MNTENTRY EQU   0                                                        00657600
EVOLSER  EQU   MNTENTRY                                                 00657700
DELIM1   EQU   MNTENTRY+6                                               00657800
EMNTCHAR EQU   MNTENTRY+7                                               00657900
DELIM2   EQU   MNTENTRY+8                                               00658000
EUSEATTR EQU   MNTENTRY+9                                               00658100
DELIM3   EQU   MNTENTRY+10                                              00658200
EDEVTYPE EQU   MNTENTRY+11                                              00658300
DELIM4   EQU   MNTENTRY+19                                              00658400
EMNTPRIO EQU   MNTENTRY+20                                              00658500
ICB2SSCB EQU   0                                                        00658600
ICBOPT   EQU   ICB2SSCB+48                                              00658700
ICBFLG   EQU   ICB2SSCB+52                                              00658800
ICBFG1   EQU   ICBFLG                                                   00658900
ICBI     EQU   ICBFG1                                                   00659000
ICBTRACE EQU   ICB2SSCB+112                                             00659100
NVT      EQU   0                                                        00659200
NVTNPATR EQU   NVT+54                                                   00659300
NVTNPREN EQU   NVTNPATR                                                 00659400
NVTFLLB  EQU   NVT+55                                                   00659500
NVTABSAV EQU   NVT+140                                                  00659600
NVTFLCN  EQU   NVT+211                                                  00659700
NVTWTPSW EQU   NVT+224                                                  00659800
NVTWPSW2 EQU   NVTWTPSW+4                                               00659900
NVTFLWSC EQU   NVTWPSW2+3                                               00660000
NVTLOAD  EQU   NVT+232                                                  00660100
NVTSENSE EQU   NVT+236                                                  00660200
NVTSWAIT EQU   NVT+240                                                  00660300
NVTTIME  EQU   NVT+244                                                  00660400
NVTUCBFN EQU   NVT+248                                                  00660500
NVTWTO   EQU   NVT+252                                                  00660600
NVTWTOR  EQU   NVT+256                                                  00660700
NVTWTOR2 EQU   NVT+260                                                  00660800
NVTOPEN  EQU   NVT+264                                                  00660900
NVTMOUNT EQU   NVT+268                                                  00661000
NVTPRMPT EQU   NVT+272                                                  00661100
NVTVIRT  EQU   NVT+276                                                  00661200
NVTREAL  EQU   NVT+280                                                  00661300
NVTSCHED EQU   NVT+284                                                  00661400
NVTOPIO  EQU   NVT+288                                                  00661500
NVTDCBIC EQU   NVT+324                                                  00661600
NVTPAREA EQU   NVT+368                                                  00661700
NVTPTAB  EQU   NVT+372                                                  00661800
NVTXCTL  EQU   NVT+428                                                  00661900
NVTLOCAT EQU   NVT+436                                                  00662000
NVTFLPO  EQU   NVT+528                                                  00662100
NIPPAHDR EQU   0                                                        00662200
NIPPAREA EQU   0                                                        00662300
NIPPARC  EQU   NIPPAREA+8                                               00662400
NIPPABDL EQU   NIPPAREA+12                                              00662500
NIPPABDH EQU   NIPPABDL                                                 00662600
NIPPANAM EQU   NIPPABDL+4                                               00662700
NIPPATTR EQU   NIPPABDL+12                                              00662800
NIPPAIOD EQU   NIPPAREA+32                                              00662900
NIPPASID EQU   NIPPAIOD+32                                              00663000
NIPPAIOB EQU   NIPPAIOD+40                                              00663100
NIPPADCB EQU   NIPPAIOD+80                                              00663200
NIPPAECB EQU   NIPPAIOD+84                                              00663300
NIPPAECC EQU   NIPPAECB                                                 00663400
NIPPADEB EQU   NIPPAIOD+88                                              00663500
NIPPARCD EQU   NIPPAIOD+136                                             00663600
PARMTAB  EQU   0                                                        00663700
VAL      EQU   PARMTAB+232                                              00663800
@NM00079 EQU   PARMTAB+272                                              00663900
NIPPAFLG EQU   @NM00079                                                 00664000
NIPPAFL1 EQU   NIPPAFLG                                                 00664100
NIPPTE   EQU   0                                                        00664200
NIPPTOPF EQU   NIPPTE+4                                                 00664300
NIPPTATF EQU   NIPPTE+5                                                 00664400
NWTOHDR  EQU   0                                                        00664500
NWTOFL   EQU   NWTOHDR+2                                                00664600
NWTORLST EQU   0                                                        00664700
NWTORFL  EQU   NWTORLST+10                                              00664800
NIPSPE   EQU   0                                                        00664900
NIPMNTPL EQU   0                                                        00665000
NMNTDS   EQU   NIPMNTPL                                                 00665100
NMNTVS   EQU   NIPMNTPL+12                                              00665200
NMNTFL   EQU   NIPMNTPL+20                                              00665300
NIPOPNPL EQU   0                                                        00665400
NOPNDS   EQU   NIPOPNPL                                                 00665500
NOPNFL   EQU   NIPOPNPL+20                                              00665600
NIPSCHDL EQU   0                                                        00665700
EDTHDR   EQU   0                                                        00665800
EDTGENSP EQU   EDTHDR+4                                                 00665900
EDTGRPSP EQU   EDTHDR+8                                                 00666000
EDTUCBSP EQU   EDTHDR+12                                                00666100
EDTMSKTP EQU   EDTHDR+16                                                00666200
GENSECT  EQU   0                                                        00666300
GENHDR   EQU   GENSECT                                                  00666400
GENENTRY EQU   0                                                        00666500
GRPTRTAB EQU   0                                                        00666600
GRPSECT  EQU   0                                                        00666700
GRPHDR   EQU   GRPSECT                                                  00666800
GRPENTRY EQU   0                                                        00666900
GRPUCBP  EQU   GRPENTRY+8                                               00667000
EUCBSECT EQU   0                                                        00667100
EUCBHDR  EQU   EUCBSECT                                                 00667200
EUCBENTY EQU   0                                                        00667300
GRMSKTAB EQU   0                                                        00667400
GMTHDR   EQU   GRMSKTAB                                                 00667500
GMTENTRY EQU   0                                                        00667600
NIPPMAD0 EQU   0                                                        00667700
NIPPMAD4 EQU   0                                                        00667800
NIPPMSID EQU   0                                                        00667900
NIPPMCC  EQU   NIPPMSID                                                 00668000
NIPPMHH  EQU   NIPPMSID+2                                               00668100
NIPPMR   EQU   NIPPMSID+4                                               00668200
NIPPMCSW EQU   0                                                        00668300
NIPPMCS2 EQU   NIPPMCSW+3                                               00668400
NIPPMME1 EQU   0                                                        00668500
NIPPMME2 EQU   0                                                        00668600
@NM00003 EQU   NIPPANAM                                                 00668700
PLIBMEM  EQU   @NM00003                                                 00668800
SUFFIX   EQU   @NM00003+6                                               00668900
@NM00016 EQU   VAPDCB1                                                  00669000
DCBMACRF EQU   @NM00016                                                 00669100
DCBDEBAD EQU   @NM00016+5                                               00669200
DCBOFLGS EQU   @NM00016+8                                               00669300
@ENDDATA EQU   *                                                        00669400
*                                                                       00669500
*                                                                       00669600
*        VATLST INPUT RECORD                                            00669700
*                                                                       00669800
VATREC   DSECT                                                          00669900
VATVOL   DS    CL6                     VOLSER  (MASKING OPTIONAL)       00670000
VATSPECV DS    C                       , OR S FOR SPECIFIC VOL          00670100
VATMNT   DS    C                       0 = PREMANENTLY RESIDENT         00670200
*                                      1 = RESERVED                     00670300
VATCOM1  DS    C                       ,                                00670400
VATUSE   DS    C                       0 = STORAGE                      00670500
*                                      1 = PUBLIC                       00670600
*                                      2 = PRIVATE                      00670700
VATCOM2  DS    C                       ,                                00670800
VATDEV   DS    CL8                     DEVICE TYPE OR *                 00670900
VATCOM3  DS    C                       , OR BLANK                       00671000
VATMMS   DS    C                       N = NO MOUNT MESSAGE             00671100
VATCMT   DS    CL59                    COMMENT                          00671200
*                                                                       00671300
*        PARAMETER LIST PASSED TO:- WILDPP                              00671400
*                                                                       00671500
*        PREPROCESS THE PATTERN STRING                                  00671600
*        RETURN RESULT IN WPPPRES -> FOR USE BY WILDPS                  00671700
*                                                                       00671800
WPPPARM  DSECT                                                          00671900
WPPRELT  DS    A             +00   -> PREPROCESSED RESULT FOR WILDPS    00672000
WPPPSTA  DS    A             +04   -> PATTERN STRING                    00672100
WPPPSTL  DS    F             +08   L'PATTERN STRING                     00672200
*                                                                       00672300
*        PARAMETER LIST PASSED TO:- WILDPS                              00672400
*                                                                       00672500
*        USE PREPROCESSED PATTERN STRING GENERATED BY WILDPP            00672600
*        -> WPSRELT                                                     00672700
*                                                                       00672800
WPSPARM  DSECT                                                          00672900
WPSRELT  DS    A             +00   -> PREPROCESSED RESULT FROM WILDPP   00673000
WPSISTA  DS    A             +04   -> INPUT STRING                      00673100
WPSISTL  DS    F             +08   L'INPUT STRING                       00673200
*                                                                       00673300
         PRINT NOGEN                                                    00673400
*                                                                       00673500
*        CVT                                                            00673600
*                                                                       00673700
         CVT   DSECT=YES                                                00673800
*                                                                       00673900
*        DEB                                                            00674000
*                                                                       00674100
         IEZDEB                                                         00674200
*                                                                       00674300
*        IOB                                                            00674400
*                                                                       00674500
         IEZIOB                                                         00674600
*                                                                       00674700
*        UCB                                                            00674800
*                                                                       00674900
UCB      DSECT                                                          00675000
*                                                                       00675100
         IEFUCBOB                                                       00675200
*                                                                       00675300
         PRINT GEN                                                      00675400
*                                                                       00675500
         END   IEAVAP00                                                 00675600
/*
//*
//U41S06  EXEC PGM=IEBGENER
//SYSPRINT DD  SYSOUT=*
//SYSUT1   DD  *
  IDENTIFY IEAVAP00('ZP60041')
/*
//SYSUT2   DD  DSN=&&SMPMCS,DISP=(MOD,PASS)
//SYSIN    DD  DUMMY
//*  _________________________________________________________
//*
//*  USERMOD ZP60042
//U42S01  EXEC PGM=IEBGENER
//SYSPRINT DD  SYSOUT=*
//SYSUT1   DD  DATA
++USERMOD(ZP60042)              /* ADD INDIRECT CATALOGING */  .
++VER(Z038) FMID(EDM1102)
  PRE(UZ50553,UZ72608)
 /*
   PROBLEM DESCRIPTION:
     THERE IS NO WAY TO CATALOG A DATA SET ON "THE CURRENT SYSRES".
       CATALOG ENTRIES FOR SINGLE-VOLUME NON-VSAM DATA SETS SPECIFY
       THE DEVICE TYPE AND THE VOLUME SERIAL NUMBER.  THERE IS NO
       WAY TO INDICATE THAT THE DATA SET WILL BE FOUND ON WHICHEVER
       VOLUME HAPPENS TO BE THE CURRENT IPL OR SYSTEM RESIDENCE
       VOLUME.

       THIS USERMOD UPDATES SVC 26 - BOTH FOR NIP AND POST NIP - TO
       OVERLAY THE RESULTS OF A LOCATE FOR A SINGLE-VOLUME DATA SET
       WHERE THE CATALOG ENTRY HAS A VOLUME SERIAL OF SIX ASTERISKS.
       THE RESULT IS UPDATED SO THAT THE DEVICE TYPE AND THE VOLUME
       SERIAL INDICATE THE CURRENT IPL OR SYSTEM RESIDENCE VOLUME.

       NOTE THAT WITH NO CHANGE TO IDCAMS, A COMMAND SIMILAR TO
         DEFINE NONVSAM(NAME(DS.NAME) VOLUME(******) DEVT(3350))
       WILL BE SUCCESSFULLY PERFORMED FOR VSAM (BUT NOT OS SYSCTLG
       OR CVOL) CATALOGS.

       UNLIKE MVS/SP, DEVT(0000) IS NOT SUPPORTED - A VALID DEVICE
       TYPE MUST BE SPECIFIED.  ANY SPECIFIED DEVICE TYPE IS REPLACED
       BY THE IPL VOLUME'S DEVICE TYPE WHEN THE SIX ASTERISKS ARE
       REPLACED BY THE IPL VOLUME'S VOLUME SERIAL NUMBER.

   SPECIAL CONDITIONS:
     ACTION:
       THIS SYSMOD SHOULD BE ACTIVATED SIMULTANEOUSLY WITH ZP60041.
       A "CLPA" MUST BE PERFORMED AT IPL TIME FOR THIS SYSMOD TO
       BECOME ACTIVE.

   COMMENTS:
     PRYCROFT SIX P/L PUBLIC DOMAIN USERMOD FOR MVS 3.8 NUMBER 42.

     REWORK HISTORY:
       2021-11-05: INITIAL AVAILABILITY.

     THE FOLLOWING MODULES AND/OR MACROS ARE AFFECTED BY THIS USERMOD:
     MODULES:
       IEAVNP12
       IGG026DU
 */.
++MOD(IEAVNP12) DISTLIB(AOSC5).
/*
//SYSUT2   DD  DSN=&&SMPMCS,DISP=(MOD,PASS)
//SYSIN    DD  DUMMY
//*
//U42S02  EXEC PGM=IEBUPDTE,PARM='NEW'
//SYSPRINT DD  SYSOUT=*
//SYSUT2   DD  DSN=&&PVTMACS,DISP=(NEW,PASS),
//             UNIT=VIO,SPACE=(TRK,(20,20,20)),
//             DCB=SYS1.MACLIB
//SYSIN    DD  *
./ ADD NAME=COMB,SSI=31310664
* /*                                                                 */ 03050002
* /* MACCOMP Y-2 SC1DE/SJD61                                         */ 03100002
* /* MACSTAT Y-2 73127/Y02020                                        */ 03110002
* /*                                                                 */ 03120002
         MACRO                                                          03150002
&N       COMB  &A                                                       06000000
         LCLA  &X                                                       09000000
         LCLC  &C,&L                                                    12000000
&X       SETA  N'&A                                                     15000000
&X       SETA  N'&A                                                     18000000
&N       DS    0CL&X                                                    21000000
&X       SETA  1                                                        24000000
.LOOP    ANOP                                                           27000000
&C       SETC  '&A(&X)'                                                 30000000
         AIF   (K'&C GE 6).BIG                                          33000000
         AIF   (K'&C EQ 5).MED                                          36000000
&L       SETC  '&C'(1,2)                                                39000000
         AGO   .OUT                                                     42000000
.MED     ANOP                                                           45000000
&L       SETC  '&C'(1,2).'&C'(5,1)                                      48000000
         AGO   .OUT                                                     51000000
.BIG     ANOP                                                           54000000
&L       SETC  '&C'(1,2).'&C'(5,2)                                      57000000
.OUT     ANOP                                                           60000000
         DC    AL1((8+Z&L-ZDT)/8)                                       63000000
&X       SETA  &X+1                                                     66000000
         AIF   (N'&A GE &X).LOOP                                        69000000
         MEND                                                           72000000
./ ADD NAME=DICT,SSI=31310669
* /*                                                                 */ 03050002
* /* MACCOMP Y-2 SC1DE/SJD61                                         */ 03100002
* /* MACSTAT Y-2 73127/Y02020                                        */ 03150002
* /*                                                                 */ 03200002
         MACRO                                                          03250002
         DICT  &A,&B,&C,&D,&E                                           06000000
         LCLC  &N,&L,&M                                                 09000000
&L       SETC  '        '                                               12000000
&M       SETC  '&A'.'&L'(1,8-K'&A)                                      15000000
&N       SETC  '&M'(1,2).'&M'(5,2)                                      18000000
Z&N      DC    CL4'&N'                                                  21000000
         AIF   (&B EQ 32).COMB                                          24000000
         DC    AL1(&B),AL1(&C),AL1(&D),AL1(&E)                          27000000
         MEXIT                                                          30000000
.COMB    ANOP                                                           33000000
&L       SETC  'L''&N'                                                  36000000
         DC    AL1(&B),AL1(1+&N-ZCS),AL1(&L),AL1(&E)                    39000000
         MEND                                                           42000000
./ ADD NAME=IDAAMB,SSI=82010221
*/********************************************************************/ 00450037
*/*                                                                  */ 00500037
*/*   MACRO NAME = IDAAMB                                            */ 00550037
*/*                                                                  */ 00600037
*/*   DESCRIPTIVE NAME =ACCESS METHOD BLOCK                          */ 00650037
*/*                                                                  */ 00700037
*/*   FUNCTION = DESCRIBES DATA SET ATTRIBUTES AND SUPPLIES          */ 00750037
*/*              IOS COMPATIBLE FIELDS FOR I/O                       */ 00752037
*/*                                                                  */ 00760037
*/*   CONTROL BLOCK STRUCTURE = THE IDAAMB IS POINTED TO BY THE      */ 00770037
*/*              IDAAMBL                                             */ 00772037
*/*                                                                  */ 00780037
*/*   INCLUDED MACROS = NONE                                         */ 00790037
*/*                                                                  */ 00792037
*/*   METHOD OF ACCESS = PL/S - NO DECLARES NECESSARY                */ 00794037
*/*                                                                  */ 00796037
*/*   CREATED BY = VSAM OPEN                                         */ 00798037
*/*                                                                  */ 00798437
*/*   STATUS = VS/1 RELEASE 4  (CHANGE FLAG @X04SVXX)                */ 00798837
*/*            VS/2 RELEASE 3  (CHANGE FLAG @Y30SDXX)                */ 00798904
*/*            IDATRACE SUPPORT (CHANGE FLAG @ZA29388)               */ 00799037
*/*                                                                  */ 00799237
*/*   DATE OF LAST CHANGE = 08/11/75                         @Z40WSRL*/ 00799604
*/*                                                                  */ 29900037
*/********************************************************************/ 29950037
*     DCL  1 IDAAMB  BASED ,                /* AMB                 */   30000037
*               2 AMBID         BIT(8),     /* AMB IDENTIFIER      */   30400037
*               2 AMBRSC        BIT(8),     /* RESOURCE TS BYTE    */   30800037
*               2 AMBLEN        FIXED(15),  /* AMB LENGTH          */   31200037
*               2 AMBLINK       PTR(31),    /* NEXT AMB            */   31600037
*               2 AMBBUFC       PTR(31),    /* BUFFER CONTROL      */   32000037
*               2 AMBPH         PTR(31),    /* PLACEHOLDER         */   32400037
*               2 AMBCACB       PTR(31),    /*PTR TO ACB OF CATALOG*/   32800037
*                                           /*USED TO ACCESS OBJECT*/   33200037
*               2 AMBDSB        PTR(31),    /* AMDSB POINTER       */   33600037
*               2 AMBEOVR       CHAR(1),    /* EOV REQUEST TYPE - NOT   34000037
*                                              USED IN MVM   @Y30DSJH*/ 34002037
*                 3 AMBFLG0     BIT(8),     /* MVM AMB FLAGS @Y30DSJH*/ 34004037
*                   4 AMBPSDS   BIT(1),     /* PAGE SPACE    @Y30DSJH*/ 34006037
*                   4 AMBSWSP   BIT(1),     /* SWAP SPACE    @Z40WSRL*/ 34006404
*                   4 *         BIT(6),     /* UNUSED IN MVM @Z40WSRL*/ 34008004
*               2 AMBFLG1       BIT(8),     /* FLAG BYTE ONE       */   34400037
*                 3 AMBCREAT    BIT(1),     /* ON IF IN CREATE MODE*/   34800037
*                3 AMBTYPE    BIT(1),       /*                       */ 35200037
*                3 AMBMCAT    BIT(1),       /* MASTER CATL           */ 35600037
*                3 AMBPCAT    BIT(1),       /* PRIVATE CATL          */ 36000037
*                 3 AMBSPEED  BIT(1),       /* CREATE SPEED OPITON */   36400037
*                 3 AMBUBF      BIT(1),     /* USER BUFFERING      */   36800037
*                 3 AMBJRN      BIT(1),     /* JOURNAL EXIT PRESENT*/   37200037
*                 3 AMBINBUF    BIT(1),     /* SHARED DS--DIRECT   */   37600037
*                                           /* REQ BFR INVALIDATION*/   38000037
*               2 AMBDSORG      BIT(16),    /* DATA SET ORGANIZ.   */   38400037
*                    3 *        BIT(12),     /* ALWAYS ZERO         */  38800037
*                    3 AMBDORGA BIT(1),      /* ACCESS METHOD INDIC */  39200037
*                    3 *        BIT(3),      /* ALWAYS ZERO         */  39600037
*               2 AMBIOBAD      PTR(31),    /* IOB ADDR            */   40000037
*                 3 AMBIOMB     PTR(31),    /* IOMB CHAIN IN MVM        40002037
*                                                            @Y30DSJH*/ 40004037
*               2 AMBCDSN       CHAR(3),    /* CATALOG DSN         */   40400037
*               2 AMBDDSN       CHAR(3),    /* DATA DSN            */   40800037
*               2 *             PTR(16),    /* RESERVED            */   41200037
*               2 AMBTIOT       FIXED(15),  /* OFFSET TO TIOT      */   41600037
*                2 AMBINFL      PTR(8),     /* INDICATOR FLAGS     */   42000037
*                  3 *          BIT(1),     /* RESERVED FOR EXCP   */   42400037
*                  3 *          BIT(2),     /* RESERVED            */   42800037
*                  3 AMBCAT     BIT(1),     /* AMB FOR VSAM CATLG  */   43200037
*                  3 AMBSCRA    BIT(1),     /* CATALOG CONTROL BLOCK    43210037
*                                              SYSTEM AREA   @X04SVLC*/ 43220037
*                  3 AMBUCRA    BIT(1),     /* CATALOG CONTROL BLOCK    43230037
*                                              USER AREA     @X04SVLC*/ 43240037
*                  3 AMBUPX     BIT(1),     /* SET ON IF UPGRADE TABLE  43250037
*                                              EXISTS        @X04SVLC*/ 43300037
*                  3 AMBSDS     BIT(1),     /* SET ON IF SYSTEM DATA    43350004
*                                              SET           @Z40WSRL*/ 43400004
*                2 AMBAMETH     PTR(8),     /* ACCESS METHOD TYPE  */   43600037
*                  %AMBVSAM='''11''X';      /* VSAM CODE           */   44000037
*               2 AMBDEBPT      PTR(31),    /* DEB ADDR            */   44400037
*                 3 AMBIFLGS    BIT(8),     /* IOS ERROR FLAGS     */   44800037
*                 3 AMBDEBAD    PTR(24),    /* DEB ADDR            */   45200037
*               2 AMBOFLGS      BIT(8),     /* OPEN FLAGS          */   45600037
*                 3 *       BIT(3),         /* ALWAYS ZERO          */  46000037
*                 3 AMBOPEN BIT(1),         /* AMB IS OPEN          */  46400037
*                 3 *       BIT(2),         /* ALWAYS ZERO          */  46800037
*                 3 AMBEXFG BIT(1),         /* USER EXIT FLAG       */  47200037
*                 3 AMBBUSY BIT(1),         /* BUSY BIT             */  47600037
*               2 AMBFLG2       PTR(8),     /* FLAG BYTE TWO @X04SVLC*/ 48000037
*                 3 AMBPUG BIT(1),          /* AMB PARTICIPATES IN      48050037
*                                              UPGRADE       @X04SVLC*/ 48100037
*               2 AMBRPT        FIXED(15),  /*                     */   48400037
*               2 AMBEDB        PTR(31),    /* EDB POINTER         */   48800037
*               2 AMBEOVPT      PTR(31),    /* PTR TO KEY OR RBA - NOT  49200037
*                                              USED IN MVM   @Y30DSJH*/ 49202037
*                 3 AMBAMBXN    PTR(31),    /* PTR TO AMB EXTENSION IN  49204037
*                                              MVM           @Y30DSJH*/ 49206037
*               2 AMBWKA        PTR(31),    /* WORK AREA PTR       */   49600037
*               2 AMBIWA        PTR(31),    /* INSERT WORK AREA PTR*/   50000037
*               2 *             PTR(31),    /* UNUSED        @Z30SSMR*/ 50450037
*               2 AMBPIXP       PTR(31),    /* PTR TO PRIME INDEX AMB*/ 50800037
*               2 AMBPAMBL      PTR(31),    /* PTR TO PRIMARY AMBL      51200037
*                                                            @X04SVLC*/ 51210037
*               2 AMBUPLH       PTR(31),    /* PTR TO UPGRADE PLH       51250037
*                                                            @X04SVLC*/ 51300037
*               2 AMBCSWD1 FIXED(31)BDY(WORD),/* CS WORD 1   @X04SVLC*/ 51310037
*                 3 AMBAFLG BIT(8), /* ADDITIONAL FLAGS      @X04SVLC*/ 51350037
*                   4 *      BIT(1),/* UNUSED                @X04SVLC*/ 51400037
*                   4 AMBLSR BIT(1),/* LSR OPTION            @X04SVLC*/ 51450037
*                   4 AMBGSR BIT(1),/* GSR OPTION            @Y30SDLP*/ 51460037
*                   4 AMBICI BIT(1),/* ICIP OPTION           @Y30SDLP*/ 51500037
*                   4 AMBDFR BIT(1),/* DEFER WRITES          @X04SVLC*/ 51550037
*                   4 AMBSIS BIT(1),/* SEQ INSERT STRAT      @X04SVLC*/ 51560037
*                   4 AMBCFX BIT(1),/* FIXED CTRL BLK OPTN   @Y30SDLP*/ 51562037
*                   4 *      BIT(1),/* UNUSED                @X04SVLC*/ 51564037
*                 3 * FIXED(8),     /* UNUSED                @X04SVLC*/ 51570037
*                 3 AMBRDCNT FIXED(15),/* NBR OF CIS READ FOR THIS AMB  51580037
*                                           - VS1 ONLY       @X04SVLC*/ 51590037
*               2 AMBBM2SH PTR(31), /* ADDR OF PLH DOING 2ND SEARCH     51592037
*                                      OF SUBPOOL - VS1 ONLY @X04SVLC*/ 51594037
*               2 AMBCPA PTR(31),   /* DB/DC - PTR TO WSHD.  NON DB/DC  51594237
*                                      & VS1 - UNUSED.  NON DB/DC & VS2 51594437
*                                      - PTR TO STATIC CPA'S @Y30DSJH*/ 51594637
*               2 AMBWSHD PTR(31),  /* PTR TO WORK SPACE HDR @X04SVLC*/ 51594837
*               2 AMBEXEX CHAR(8),  /* EXCEPTION EXIT NAME   @X04SVLC*/ 51595237
*               2 AMBSZRD FIXED(15),/* CP SIZE FOR READ      @X04SVLC*/ 51596037
*               2 AMBSZWR FIXED(15),/* CP SIZE FOR WRITE     @X04SVLC*/ 51598037
*               2 AMBSZFW FIXED(15),/* CP SIZE FORMAT WRITE  @X04SVLC*/ 51598437
*               2 AMBSZCP FIXED(15),/* SIZE FOR CPA BASE     @X04SVLC*/ 51598837
*               2 AMBVIOT PTR(31),  /* POINTER TO IDAVIOT    @X04SVLC*/ 51599237
*               2 AMBTRACE PTR(31); /* PTR TO TRACE TABLE    @ZA29388*/ 51599437
*  DCL   AMBINDEX BIT(1) CONSTANT('1'B);    /* INDEX TYPE AMB        */ 51600037
*  DCL   AMBDATA  BIT(1) CONSTANT('0'B);    /* DATA TYPE AMB         */ 52000037
* DCL AMBEOVMK BIT(8) CONSTANT('00000001'B); /* MOUNT BY KEY         */ 52400037
* DCL AMBEOVMR BIT(8) CONSTANT('10000001'B); /* MOUNT BY RBA         */ 52800037
* DCL AMBEOVAK BIT(8) CONSTANT('00000010'B); /* ALLOCATE BY KEY      */ 53200037
* DCL AMBEOVAR BIT(8) CONSTANT('10000010'B); /* ALLOCATE BY RBA      */ 53600037
* DCL AMBEOVUC BIT(8) CONSTANT('00000100'B); /* UPDATE CATALOG       */ 53650037
* DCL AMBEXOFF BIT(1) CONSTANT('1'B);       /* AMB NOT LOCKED       */  54000037
*%GOTO AMBBSL2 ;                                                        54400037
*/*                                                                */   54800037
*/*                                                                */   55200037
*/*                  ASSEMBLER DSECT FOR AMB                       */   55600037
*/*                                                                */   56000037
          MACRO                                                         56400037
         IDAAMB &DSECT=YES                                              56800037
          AIF   ('&DSECT' EQ 'NO').NODS                                 57200037
IDAAMB    DSECT                                                         57600037
          AGO   .AMBDSCT                                                58000037
.NODS     ANOP                                                          58400037
IDAAMB    DS    0F                       ACCESS METHOD BLOCK            58800037
.AMBDSCT  ANOP                                                          59200037
AMBID     DS    XL1                      AMB IDENTIFIER='40'            59600037
AMBRSC    DS    XL1                      RESOURCE TS BYTE               60000037
AMBIDENT  EQU   X'40'                    ID OF AMB                      60400037
AMBLEN    DS    H                        AMB LENGTH IN BYTES            60800037
AMBLINK   DS    A                        AMB LINK FIELD                 61200037
AMBBUFC   DS    A                        AMB BUFFER PTR                 61600037
AMBPH     DS    A                        AMB PLACE HOLDER               62000037
AMBCACB   DS    A                        PTR TO CATALOG ACB             62400037
AMBDSB    DS    A                        ADDRESS OF ASB                 62800037
AMBEOVR   DS    0BL1                     EOV REQUEST TYPE - NOT USED    63200037
*                                        BY EOV IN MVM         @Y30DSJH 63202037
AMBEOVMK  EQU   X'01'                    MOUNT BY KEY                   63600037
AMBEOVMR  EQU   X'81'                    MOUNT BY RBA                   64000037
AMBEOVAK  EQU   X'02'                    ALLOCATE BY KEY                64400037
AMBEOVAR  EQU   X'82'                    ALLOCATE BY RBA                64800037
AMBFLG0   DS    BL1                      MVM AMB FLAGS FIELD   @Y30DSJH 64802037
AMBPSDS   EQU   X'80'                    PAGE SPACE DATA SET   @Y30DSJH 64804037
AMBSWSP   EQU   X'40'                    SWAP SPACE DATA SET   @Z40WSRL 64854004
AMBFLG1   DS    BL1                      FLAG BYTE ONE                  65200037
AMBCREAT  EQU   X'80'                    ON IF IN CREATE MODE           65600037
AMBTYPE  EQU   X'40'                     TYPE OF AMB                    66000037
AMBMCAT  EQU   X'20'                     MASTER CATL                    66400037
AMBPCAT  EQU   X'10'                     PRIVATE CATL                   66800037
AMBSPEED  EQU   X'08'                    CREATE SPEED OPTION            67200037
AMBUBF   EQU   X'04'                     USER BUFFERING--CNV, MOVE MODE 67600037
AMBJRN   EQU   X'02'                     JOURNAL EXIT SPECIFIED         68000037
AMBINBUF EQU   X'01'                     SHARE--INVALIDATE DIR REQ BFRS 68400037
AMBDSORG  DS    BL2                      DS ORG FIELD                   68800037
AMBDORGA EQU   X'08'                     ACCESS METHOD INDICATOR        69200037
AMBIOBAD  DS    0A                       IOB ADDR              @Y30DSJH 69600037
AMBIOMB   DS    A                        IOMB CHAIN IN MVM     @Y30DSJH 69602037
AMBCDSN   DS    CL3                      CATALOG DSN                    70000037
AMBDDSN   DS    CL3                      DATA DSN                       70400037
          DS    H                        RESERVED                       70800037
AMBTIOT   DS    H                        OFFSET TO TIOT                 71200037
AMBINFL  DS    XL1                       INDICATOR FLAGS                71600037
AMBCAT   EQU   X'10'                     AMB FOR VSAM CATALOG           72000037
AMBSCRA   EQU   X'08'                    CATALOG CONTROL BLOCK          72010037
*                                        SYSTEM AREA           @X04SVLC 72020037
AMBUCRA   EQU   X'04'                    CATALOG CONTROL BLOCK          72030037
*                                        USER AREA             @X04SVLC 72040037
AMBUPX   EQU   X'02'                     UPGRADE TAB EXISTS    @X04SVLC 72050037
AMBSDS    EQU   X'01'                    SYSTEM DATA SET       @Z40WSRL 72100004
AMBAMETH DS    XL1                       ACCESS METHOD TYPE             72400037
AMBVSAM  EQU   X'11'                     VSAM CODE                      72800037
AMBIFLGS  DS    XL1                      ERROR FLAGS                    73200037
AMBDEBAD  DS    AL3                      ADDRESS OF DEB                 73600037
AMBOFLGS  DS    BL1                      OPEN FLAGS                     74000037
AMBOPEN   EQU   X'10'                    AMB IS OPEN                    74400037
AMBEXFG  EQU   X'02'               USER EXIT FLAG                       74800037
AMBBUSY   EQU   X'01'                    AMB IS BUSY                    75200037
AMBFLG2   DS    BL1                      FLAG BYTE TWO         @X04SVLC 75250037
AMBPUG    EQU   X'80'                    AMB PARTICIPATES IN            75300037
*                                              UPGRADE         @X04SVLC 75350037
AMBRPT    DS    H                                                       76000037
AMBEDB    DS    A                        ADDRESS OF EDB                 76400037
AMBEOVPT  DS    0A                       PTR TO KEY OR RBA FOR @Y30DSJH 76800037
*                                        EOV - NOT USED IN MVM @Y30DSJH 76802037
AMBAMBXN  DS    A                        PTR TO AMB EXTENSION  @Y30DSJH 76804037
*                                        IN MVM                @Y30DSJH 76806037
AMBWKA    DS    A                        WORK AREA PTR                  77200037
AMBIWA    DS    A                        INSERT WORK AREA PTR           77600037
         DS    A                         UNUSED                @Z30SSMR 78000037
AMBPIXP   DS    A                        POINTER TO PRIME INDEX AMB     78400037
AMBPAMBL DS    A                         PTR TO PRIMARY AMBL            78800037
AMBUPLH  DS    A                         PTR TO UPGRADE PLH    @X04SVLC 78850037
AMBCSWD1 DS    0A                        CS WORD 1            @X04SVLC  78850437
AMBAFLG  DS    BL1                       ADDITIONAL FLAGS      @X04SVLC 78850837
AMBLSR   EQU   X'40'                     LSR OPTION            @X04SVLC 78851637
AMBGSR   EQU   X'20'                     GSR OPTION           @X04SVLC  78851737
AMBICI   EQU   X'10'                     ICIP OPTION           @X04SVLC 78851837
AMBDFR   EQU   X'08'                     DEFER WRITES          @X04SVLC 78855737
AMBSIS   EQU   X'04'                     SEQ INSERT STRAT      @X04SVLC 78863937
AMBCFX   EQU   X'02'                     FIXED CNTL BLK OPTION @X04SVLC 78865937
         DS    AL1                       UNUSED                @X04SVLC 78867937
AMBRDCNT DS    H                         NBR OF CIS READ FOR THIS AMB   78877937
*                                                            @X04SVLC   78879937
AMBBM2SH DS    A                         ADDR OF PLH DOING 2ND SEARCH   78881937
*                                        OF SUBPOOL            @X04SVLC 78883937
AMBCPA   DS    A                         DB/DC - PTR TO WSHD. NON DB/DC 78900037
*                                        & VS1 - UNUSED.  NON DB/DC &   78902037
*                                        VS2 - STATIC CPA PTR. @Y30DSJH 78904037
AMBWSHD  DS    A                         PTR TO WORK SPACE HDR @X04SVLC 78904437
AMBEXEX  DS    CL8                       EXCEPTION EXIT NAME   @X04SVLC 78904837
AMBSZRD  DS    H                         CP SIZE FOR READ      @X04SVLC 78905237
AMBSZWR  DS    H                         CP SIZE FOR WRITE     @X04SVLC 78905637
AMBSZFW  DS    H                         CP SIZE FORMAT WRITE  @X04SVLC 78905737
AMBSZCP  DS    H                         SIZE FOR CPA BASE     @X04SVLC 78905837
AMBVIOT  DS    A                         POINTER TO IDAVIOT    @X04SVLC 78905937
AMBTRACE DS    A                         PTR TO TRACE TABLE    @ZA29388 78955937
AMBLENTH  EQU   *-IDAAMB                 LENGTH OF AMB IN BYTES         79200037
          MEND                                                          79600037
*                                                                       80000037
*                                                                       80400037
*%AMBBSL2: ;                                                            80800037
./ ADD NAME=IDAAMBL
*/********************************************************************/ 00050003
*/*                                                                  */ 00100003
*/*   MACRO NAME = IDAAMBL                                           */ 00150003
*/*                                                                  */ 00200003
*/*   DESCRIPTIVE NAME = ACCESS METHOD BLOCK LIST.                   */ 00250003
*/*                                                                  */ 00300003
*/*   FUNCTION = THE AMBL DESCRIBES A VSAM CLUSTER AND POINTS TO THE */ 00350003
*/*              CLUSTER'S DATA SET AND INDEX AMB'S. WHEN THE CLUSTER*/ 00400003
*/*              IS OPENED, AN AMBL IS BUILT TO DESCRIBE THE CLUSTER.*/ 00450003
*/*              IF THE CLUSTER IS SHARED WITH OTHER USERS, THE      */ 00500003
*/*              EXISTING AMB'S ADDRESSES ARE PUT INTO THE AMBL.     */ 00550003
*/*                                                                  */ 00600003
*/*   CONTROL BLOCK STRUCTURE = THE AMBL IS POINTED TO BY AN ACB     */ 00650003
*/*                             (ACBAMBL).                           */ 00700003
*/*                                                                  */ 00750003
*/*   INCLUDED MACROS = NONE                                         */ 00800003
*/*                                                                  */ 00850003
*/*   METHOD OF ACCESS = PL/S - RESPECIFY IDAAMBL BASED.             */ 00900003
*/*                                                                  */ 00950003
*/*   CREATED BY: VSAM OPEN MODULE IDA0192F.                         */ 01000003
*/*                                                                  */ 01050003
*/*   STATUS = VS1 RELEASE 4, VS2 RELEASE 3,  (CHANGE FLAGS @X04SVXX)*/ 01100004
*/*                                                                  */ 01150003
*/*   DATE OF LAST CHANGE = 29/07/75                         @Z40WSRL*/ 01200004
*/*                                                                  */ 01250003
*/********************************************************************/ 01300003
*        DCL 1 IDAAMBL BASED,                                           64546803
*              2 AMBLPCHN     PTR(31),  /* PRIMARY CHAIN POINTER    */  64800003
*              2 AMBLSCHN     PTR(31),  /* SECONDARY CHAIN POINTER  */  65400003
*              2 AMBLACB      PTR(31),  /* POINTER TO ACB           */  66000003
*              2 AMBLEOV      FIXED(31),/* EOV/RM INTERFACE         */  66600003
*                3 AMBLEFLG   CHAR(1),  /* EOV FLAGS                */  67200003
*                  4 AMBLWAIT BIT(1),   /* EOV IS WAITING           */  67800003
*                  4 AMBLESET BIT(1),   /* EOV RESET CONTROL BLOCKS. */ 68400003
*                3 AMBLCOMP   CHAR(1),  /* EOV LOCK                 */  69000003
*                3 *          CHAR(2),  /* NOT USED                 */  69600003
*              2 AMBLDDNM     CHAR(8),  /* DDNAME FROM ACB          */  70200003
*                3 AMBLIDF    CHAR(8),  /* CLUSTER ID        @X04SVLC*/ 70250003
*                  4 AMBLCACB PTR(31)BDY(BYTE),/* CAT ACB    @X04SVLC*/ 70300003
*                  4 AMBLDCI  FIXED(24)BDY(BYTE),/* CI NBR   @X04SVLC*/ 70350003
*                  4 AMBLQ    BIT(8),   /* QUALIFIER         @X04SVLC*/ 70450003
*                   5 AMBLDDC BIT(1),/* DD CONNECT ONLY      @X04SVLC*/ 70500003
*                   5 AMBLGSR BIT(1),/* OPENED FOR GSR       @X04SVLC*/ 70550003
*                   5 AMBLLSR BIT(1),/* OPENED FOR LSR       @X04SVLC*/ 70600003
*                   5 AMBLFSTP BIT(1),/* OPENED FOR FAST PATH           70650003
*                                                            @X04SVLC*/ 70700003
*                   5 AMBLUBF BIT(1),/* OPENED FOR USER BFR  @X04SVLC*/ 70750003
*                   5 AMBLKSDS BIT(1),/* OPENED AS KSDS      @X04SVLC*/ 70760003
*                   5 AMBLESDS BIT(1),/* OPENED AS ESDS      @X04SVLC*/ 70770003
*                   5 AMBLDFR BIT(1),/* OPENED WITH DEFER OPTION        70780003
*                                                            @X04SVLC*/ 70790003
*              2 AMBLXPT      PTR(31),  /* PTR FR BASE AMBL TO PATH     70800003
*                                          AMBL & VICE-VERSA @X04SVLC*/ 70850003
*              2 AMBLVC       FIXED(15),/* VALID AMBL TABLE  @X04SVLC*/ 70950003
*                3 AMBLVRT    FIXED(8), /* RELATIVE VAT      @X04SVLC*/ 71000003
*                3 AMBLENO    FIXED(8), /* OFFSET WITHIN VAT @X04SVLC*/ 71050003
*              2 AMBLTYPE     BIT(8),   /* STRUCTURE TYPE    @X04SVLC*/ 71060003
*                3 AMBLPATH   BIT(1),   /* ACB IS FOR PATH   @X04SVLC*/ 71070003
*                3 AMBLUPGR   BIT(1),   /* ACB FOR UPGRADE   @X04SVLC*/ 71080003
*                3 AMBLAIX    BIT(1),   /* ACB FOR AIX END USE-IMPLIES  71090003
*                                          AMBLBASE ON       @X04SVLC*/ 71090403
*                3 AMBLBASE   BIT(1),   /* ACB FOR BASE      @X04SVLC*/ 71092003
*                3 AMBLFIX BIT(1),      /* STRUCTURE FIXED BY           71092403
*                                          OPEN              @X04SVLC*/ 71092803
*                3 *          BIT(3),   /* UNUSED            @X04SVLC*/ 71094003
*              2 *            CHAR(1),  /* UNUSED            @X04SVLC*/ 71100003
*              2 AMBLID       CHAR(1),  /* AMBL IDENTIFER           */  73200003
*              2 AMBLSHAR     BIT(8),   /* SHARING INDICATORS       */  73800003
*                3 AMBLPRIM   BIT(1),   /* P-AMBL INDICATOR         */  74400003
*                3 AMBLCATO   BIT(1),   /* CATALOG OPEN IND IS ON   */  75000003
*                3 AMBLWRIT   BIT(1),   /* OUTPUT/UPDATE SPECIFIED  */  75600003
*                3 *          BIT(5),   /* RESERVED                 */  76200003
*              2 AMBLLEN      PTR(8),   /* AMBL LENGTH              */  76800003
*              2 AMBLFLG1     BIT(8),   /* FLAG BYTE ONE            */  77400003
*                3 AMBLFULL   BIT(1),   /* FULL ACCESS OK           */  78000003
*                3 AMBLCINV   BIT(1),   /* CINV ACCESS OK           */  78600003
*                3 AMBLUPD    BIT(1),   /* UPDATE ACCESS OK         */  79200003
*                3 AMBLVVIC   BIT(1),   /* AMBL FOR VVIC DATA SET       79800003
*                                                            @X04SVRP*/ 79810003
*                  4 AMBLSDS  BIT(1),   /* AMBL FOR SYSTEM DATA SET     79820004
*                                                            @Z40WSRL*/ 79830004
*                3 AMBLSCRA   BIT(1),   /* AMBL FOR SYSTEM CATALOG      79850003
*                                          RECOVERY AREA     @X04SVRP*/ 79900003
*                3 AMBLUCRA   BIT(1),   /* AMBL FOR USER CATALOG        79950003
*                                          RECOVERY AREA     @X04SVRP*/ 80000003
*                3 AMBLCAT    BIT(1),   /* IND ACB FOR A CATALOG    */  80400003
*                3 AMBLDUMY   BIT(1),   /* DD DUMMY SPECIFIED       */  81000003
*                                       /* TO SIMPLIFY TESTING  FOR  */ 81050003
*                                       /* SPECIAL DATA SETS IN      */ 81100003
*                                       /* EXISTING CODE THE AMBLCAT */ 81150003
*                                       /* AMBLVVIC AND AMBLSCRA     */ 81200003
*                                       /* BITS ARE SET AS FOLLOWS:  */ 81250003
*                                       /* VVIC SCRA X CAT TYPE OF   */ 81300003
*                                       /*                 DATA SET  */ 81350003
*                                       /*   0    0   X 0  CATALOG   */ 81400003
*                                       /*   1    0   X 1  VVIC      */ 81450003
*                                       /*   0    1   X 1  SCRA      */ 81500003
*              2 AMBLFLG2     BIT(8),   /* FLAG BYTE TWO            */  81600003
*                3 *          BIT(3),   /* RESERVED          @Z30SSDT*/ 82860003
*                3 AMBLSTAG   BIT(1),   /* CLUSTER IS STAGED @X04ACPS*/ 82870003
*                3 *          BIT(4),   /* RESERVED          @X04ACPS*/ 82900003
*              2 AMBLNST      CHAR(1),  /* NUMBER OF STRINGS         */ 83400003
*              2 AMBLNUM      FIXED(15),/* NUMBER OF AMB PTRS IN    */  84000003
*                                       /* AMBL                     */  84600003
*              2 *            CHAR(1),  /* RESERVED                 */  85250003
*              2 AMBLNIDS     PTR(8),   /* NUMBER IF IDS            */  85300003
*              2 AMBLMIDS(5)  CHAR(2),  /* IDS OF MODULES LOADED    */  85350003
*              2 AMBLDTA      PTR(31),  /* POINTER TO DATA AMB      */  85400003
*              2 AMBLIX       PTR(31),  /* POINTER TO INDEX AMB     */  85450003
*              2 AMBLBIB      PTR(31),  /* PTR TO BIB        @X04SVLC*/ 89410003
*              2 AMBLCMB      PTR(31);  /* PTR TO CMB        @X04SVRP*/ 89460003
         MACRO ,                                                        90000100
         IDAAMBL ,                                                      90000200
*                                                                       90000300
*         ASSEMBLER DSECT FOR AMBL                                      90000400
*         COPIED FROM SYM601.F01 AND MANUALLY CONVERTED TO ASM          90000500
*                                                                       90000600
IDAAMBL  DSECT ,                         ACCESS METHOD BLOCK LIST       90000700
AMBLPCHN DS    A                         PRIMARY CHAIN POINTER          90000800
AMBLSCHN DS    A                         SECONDARY CHAIN POINTER        90000900
AMBLACB  DS    A                         POINTER TO ACB                 90001000
AMBLEOV  DS    0A                        EOV/RM INTERFACE               90001100
AMBLEFLG DS    XL1                       EOV FLAGS                      90001200
AMBLWAIT EQU   X'80'                     EOV IS WAITING                 90001300
AMBLESET EQU   X'40'                     EOV RESET CONTROL BLOCKS.      90001400
AMBLCOMP DS    XL1                       EOV LOCK                       90001500
         DS    XL2                       NOT USED                       90001600
AMBLDDNM DS    0CL8                      DDNAME FROM ACB                90001700
AMBLIDF  DS    0CL8                      CLUSTER ID                     90001800
AMBLCACB DS    A                         CAT ACB                        90001900
AMBLDCI  DS    XL3                       CI NBR                         90002000
AMBLQ    DS    XL1                       QUALIFIER                      90002100
AMBLDDC  EQU   X'80'                     DD CONNECT ONLY                90002200
AMBLGSR  EQU   X'40'                     OPENED FOR GSR                 90002300
AMBLLSR  EQU   X'20'                     OPENED FOR LSR                 90002400
AMBLFSTP EQU   X'10'                     OPENED FOR FAST PATH           90002500
AMBLUBF  EQU   X'08'                     OPENED FOR USER BFR            90002600
AMBLKSDS EQU   X'04'                     OPENED AS KSDS                 90002700
AMBLESDS EQU   X'02'                     OPENED AS ESDS                 90002800
AMBLDFR  EQU   X'01'                     OPENED WITH DEFER OPTION       90002900
AMBLXPT  DS    A                         PTR FR BASE AMBL TO PATH       90003000
*                                        AMBL & VICE-VERSA              90003100
AMBLVC   DS    0H                        VALID AMBL TABLE               90003200
AMBLVRT  DS    XL1                       RELATIVE VAT                   90003300
AMBLENO  DS    XL1                       OFFSET WITHIN VAT              90003400
AMBLTYPE DS    XL1                       STRUCTURE TYPE                 90003500
AMBLPATH EQU   X'80'                     ACB IS FOR PATH                90003600
AMBLUPGR EQU   X'40'                     ACB FOR UPGRADE                90003700
AMBLAIX  EQU   X'20'                     ACB FOR AIX END USE-IMPLI      90003800
*                                        AMBLBASE ON                    90003900
AMBLBASE EQU   X'10'                     ACB FOR BASE                   90004000
AMBLFIX  EQU   X'08'                     STRUCTURE FIXED BY             90004100
         DS    XL1                       UNUSED                         90004200
AMBLID   DS    XL1                       AMBL IDENTIFER                 90004300
IDXAMBL  EQU   X'05'                     SEE IDA0192F                   90004400
AMBLSHAR DS    XL1                       SHARING INDICATORS             90004500
AMBLPRIM EQU   X'80'                     P-AMBL INDICATOR               90004600
AMBLCATO EQU   X'40'                     CATALOG OPEN IND IS ON         90004700
AMBLWRIT EQU   X'20'                     OUTPUT/UPDATE SPECIFIED        90004800
AMBLLEN  DS    XL1                       AMBL LENGTH                    90004900
AMBLFLG1 DS    XL1                       FLAG BYTE ONE                  90005000
AMBLFULL EQU   X'80'                     FULL ACCESS OK                 90005100
AMBLCINV EQU   X'40'                     CINV ACCESS OK                 90005200
AMBLUPD  EQU   X'20'                     UPDATE ACCESS OK               90005300
AMBLVVIC EQU   X'10'                     AMBL FOR VVIC DATA SET         90005400
AMBLSDS  EQU   X'10'                     AMBL FOR SYSTEM DATA SET       90005500
AMBLSCRA EQU   X'08'                     AMBL FOR SYSTEM CATALOG        90005600
*                                        RECOVERY AREA                  90005700
AMBLUCRA EQU   X'04'                     AMBL FOR USER CATALOG          90005800
*                                        RECOVERY AREA                  90005900
AMBLCAT  EQU   X'02'                     IND ACB FOR A CATALOG          90006000
AMBLDUMY EQU   X'01'                     DD DUMMY SPECIFIED             90006100
*                                        TO SIMPLIFY TESTING  FOR       90006200
*                                        SPECIAL DATA SETS IN           90006300
*                                        EXISTING CODE THE AMBLCAT      90006400
*                                        AMBLVVIC AND AMBLSCRA          90006500
*                                        BITS ARE SET AS FOLLOWS:       90006600
*                                        VVIC SCRA X CAT TYPE OF        90006700
*                                                        DATA SET       90006800
*                                          0    0   X 0  CATALOG        90006900
*                                          1    0   X 1  VVIC           90007000
*                                          0    1   X 1  SCRA           90007100
AMBLFLG2 DS    XL1                       FLAG BYTE TWO                  90007200
AMBLSTAG EQU   X'10'                     CLUSTER IS STAGED              90007300
AMBLNST  DS    XL1                       NUMBER OF STRINGS              90007400
AMBLNUM  DS    XL2                       NUMBER OF AMB PTRS IN          90007500
*                                        AMBL                           90007600
         DS    XL1                       RESERVED                       90007700
AMBLNIDS DS    XL1                       NUMBER IF IDS                  90007800
AMBLMIDS DS    5CL2                      IDS OF MODULES LOADED          90007900
AMBLDTA  DS    A                         POINTER TO DATA AMB            90008000
AMBLIX   DS    A                         POINTER TO INDEX AMB           90008100
AMBLBIB  DS    A                         PTR TO BIB                     90008200
AMBLCMB  DS    A                         PTR TO CMB                     90008300
AMBLLENG EQU   *-IDAAMBL                                                90008400
         MEND  ,                                                        90008500
./ ADD NAME=IDAAMDSB
*/********************************************************************/ 00050003
*/*                                                                  */ 00100003
*/*   MACRO NAME = IDAAMDSB                                          */ 00150003
*/*                                                                  */ 00200003
*/*   DESCRIPTIVE NAME =DATA SET CHARACTERISTICS                     */ 00250003
*/*              AND STATISTICS BLOCK                                */ 00300003
*/*                                                                  */ 00320003
*/*   FUNCTION = CONTAINS DATA SET CHARACTERISTICS AND STATISTICS    */ 00350003
*/*                                                                  */ 00400003
*/*   CONTROL BLOCK STRUCTURE = THE IDAAMDSB IS POINTED TO BY IDAAMB */ 00450003
*/*                                                                  */ 00500003
*/*   INCLUDED MACROS = NONE                                         */ 00550003
*/*                                                                  */ 00600003
*/*   METHOD OF ACCESS = PL/S - NO DECLARES NECESSARY                */ 00650003
*/*                                                                  */ 00700003
*/*   CREATED BY = VSAM OPEN                                         */ 00750003
*/*                                                                  */ 00800003
*/*   STATUS = VS/1 RELEASE 4  (CHANGE FLAG @X04SVXX)                */ 00850003
*/*                                                                  */ 00900003
*/*   DATE OF LAST CHANGE = 8 AUG 74                                 */ 00950003
*/*                                                                  */ 01000003
*/********************************************************************/ 01050003
*        DCL 1 IDAAMDSB BASED,/* DATA SET CHAR./STATISTICS BLOCK     */ 02000003
*              2 AMDSBID      CHAR(1),  /* CONTROL BLOCK ID          */ 04000003
*              2 AMDATTR      CHAR(1),  /* ATTRIBUTES                */ 06000003
*                3 AMDDST     BIT(1),   /* KEY, CHRONOLOGIC          */ 08000003
*                3 AMDWCK     BIT(1),   /* WRITE CHECK               */ 10000003
*                3 AMDSDT     BIT(1),   /* SEQ SET WITH DATA         */ 12000003
*                3 AMDREPL BIT(1),      /* REPLICATION               */ 14000003
*                3 AMDORDER   BIT(1),   /* USE VOLS IN LIST ORDER    */ 16000003
*                3 AMDRANGE   BIT(1),   /* KEY RANGE DATA SET        */ 18000003
*                3 AMDRRDS    BIT(1),   /* RELATIVE RECORD DATA SET     18050003
*                                                            @X04SVLC*/ 18060003
*                3 AMDSPAN    BIT(1),   /* SPANNED RECORDS ARE ALLOWED  18100003
*                                                            @X04SVLC*/ 18150003
*              2 AMDLEN FIXED(15),      /* LENGTH OF AMDSB           */ 20000003
*              2 AMDNEST      FIXED(15),/* NO OF ENTRIES IN IDX SECTN*/ 22000003
*                3 AMDAXRKP   FIXED(15),/* RELATIVE KEY POSITION OF     22050003
*                                            ALTERNATE KEY   @X04SVLC*/ 22100003
*              2 AMDRKP       FIXED(15),/* RELATIVE KEY POSITION     */ 24000003
*              2 AMDKEYLN     FIXED(15),/* KEY LENGTH                */ 26000003
*              2 AMDPCTCA PTR(8),       /* % FREE CI IN CA           */ 28000003
*              2 AMDPCTCI PTR(8),       /* % FREE BYTES IN CI        */ 30000003
*              2 AMDCIPCA FIXED(15),    /* TOTAL NO. OF CIS PER CA   */ 32000003
*              2 AMDFSCA      FIXED(15),/* NO OF FREE CIS PER CA     */ 34000003
*              2 AMDFSCI      FIXED(31),/* NO OF FREE BYTES PER CI   */ 36000003
*              2 AMDCINV      FIXED(31),/* CONTROL INTERVAL SIZE     */ 38000003
*              2 AMDLRECL     FIXED(31),/* MAXIMUM RECORD SIZE       */ 40000003
*              2 AMDHLRBA     FIXED(32),/* RBA OF HIGH LEVEL IDX REC */ 42000003
*                3 AMDNSLOT   FIXED(31),/* NO. OF RECORD SLOTS PER CI   42050003
*                                                            @X04SVLC*/ 42100003
*              2 AMDSSRBA     FIXED(32),/* RBA OF FIRST SEQ SET REC  */ 44000003
*                3 AMDMAXRR   FIXED(31),/* MAX RELATIVE RECORD NUMBER   44050003
*                                                            @X04SVLC*/ 44150003
*              2 AMDPARDB     PTR(31),  /* PTR TO FIRST ARDB         */ 46000003
*              2 AMDATTR3   BIT(8),     /* ATTRIBUTES        @X04SVLC*/ 50050003
*                3 AMDUNQ     BIT(1),  /* ON=NON-UNIQUE KEYS @X04SVLC   50100003
*                                         OFF=UNIQUE KEYS    @X04SVLC*/ 50102003
*                3 AMDFAULT   BIT(1),  /* ON=CYLINDER FAULT ON SS1      50110003
*                                         OFF=STAGE THE DATA SET        50130003
*                                         (DEFAULT)          @X04SVLC*/ 50140003
*                3 AMDBIND    BIT(1),  /* ON=BIND THE DATA SET ON SS1   50142003
*                                         OFF=DO NOT BIND (DEFAULT)     50146003
*                                                            @X04SVLC*/ 50148003
*                3 AMDWAIT    BIT(1),  /* ON=WAIT ON A RELINQUISH       50148403
*                                         OFF=DO NOT WAIT (DEFAULT)     50149203
*                                                            @X04SVLC*/ 50149603
*                3 AMDLM      BIT(1),   /* ON=DATA SET LOADED           50149703
*                                          OFF=LOAD MODE OR NOT LOADED  50149803
*                                                            @X04SVLC*/ 50149903
*                3 *          BIT(3),   /* UNUSED            @X04SVLC*/ 50150003
*              2 *          CHAR(7),    /* UNUSED            @X04SVLC*/ 50200003
*              2 AMDSTAT      BDY(WORD),/* STATISTICS        @X04SVLC*/ 50250003
*                3 AMDSTSP    CHAR(8),  /*    SYSTEM TIME STAMP      */ 52000003
*                3 AMDNIL     FIXED(15),/* NUMBER INDEX LEVELS       */ 54000003
*                3 AMDNEXT    FIXED(15),/* NUMBER OF EXTENTS         */ 56000003
*                3 AMDNLR     FIXED(31),/* NUMBER LOGICAL RECORDS    */ 58000003
*                3 AMDDELR    FIXED(31),/* NUMBER DELETED RECORDS    */ 60000003
*                3 AMDIREC    FIXED(31),/* NUMBER INSERTED RECORDS   */ 62000003
*                3 AMDUPR     FIXED(31),/* NUMBER UPDATED RECORDS    */ 64000003
*                3 AMDRETR    FIXED(31),/* NUMBER RETRIEVED RECORDS  */ 66000003
*                3 AMDASPA    FIXED(31),/* BYTES OF FREE SPACE IN DS */ 68000003
*                3 AMDNCIS    FIXED(31),/* NUMBER OF CI SPLITS       */ 70000003
*                3 AMDNCAS    FIXED(31),/* NUMBER OF CA SPLITS       */ 72000003
*                3 AMDEXCP    FIXED(31);/* NUMBER OF EXCPS           */ 74000003
*                                                                       76000003
*                                                                       78000003
*                                                                       80000003
*%  DCL  (AMDKSDS,AMDCSDS) CHAR;                                        82000003
*%       AMDKSDS = '''1''B';            /* KEY SEQUENTIAL DATA SET   */ 84000003
*%       AMDCSDS = '''0''B';            /* CHRONOLOGIC SEQ DATA SET  */ 86000003
*%       AMDSBLEN = 'LENGTH(IDAAMDSB)'; /* LENGTH OF AMDSB           */ 88000003
         MACRO ,                                                        90000100
         IDAAMDSB ,                                                     90000200
*                                                                       90000300
*         ASSEMBLER DSECT FOR AMDSB                                     90000400
*         COPIED FROM SYM601.F01 AND MANUALLY CONVERTED TO ASM          90000500
*                                                                       90000600
IDAAMDSB DSECT ,                         DATA SET CHAR/STATISTICS BLOCK 90000700
AMDSBID  DS    XL1                       CONTROL BLOCK ID               90000800
AMDIDVAL EQU   X'60'                     ID OF AMDSB (SEE IGG0CLDA)     90000900
AMDATTR  DS    XL1                       ATTRIBUTES                     90001000
AMDDST   EQU   X'80'                     KEY, CHRONOLOGIC               90001100
*AMDKSDS                                 ON=KEY SEQUENTIAL DATA SET     90001200
*AMDCSDS                                 OFF=CHRONOLOGIC SEQ DATA SET   90001300
AMDWCK   EQU   X'40'                     WRITE CHECK                    90001400
AMDSDT   EQU   X'20'                     SEQ SET WITH DATA              90001500
AMDREPL  EQU   X'10'                     REPLICATION                    90001600
AMDORDER EQU   X'08'                     USE VOLS IN LIST ORDER         90001700
AMDRANGE EQU   X'04'                     KEY RANGE DATA SET             90001800
AMDRRDS  EQU   X'02'                     RELATIVE RECORD DATA SET       90001900
AMDSPAN  EQU   X'01'                     SPANNED RECORDS ARE ALLOWED    90002000
AMDLEN   DS    XL2                       LENGTH OF AMDSB                90002100
AMDNEST  DS    0XL2                      NO OF ENTRIES IN IDX SECTN     90002200
AMDAXRKP DS    XL2                       RELATIVE KEY POSITION OF       90002300
*                                          ALTERNATE KEY                90002400
AMDRKP   DS    XL2                       RELATIVE KEY POSITION          90002500
AMDKEYLN DS    XL2                       KEY LENGTH                     90002600
AMDPCTCA DS    XL1                       % FREE CI IN CA                90002700
AMDPCTCI DS    XL1                       % FREE BYTES IN CI             90002800
AMDCIPCA DS    H                         TOTAL NO. OF CIS PER CA        90002900
AMDFSCA  DS    H                         NO OF FREE CIS PER CA          90003000
AMDFSCI  DS    A                         NO OF FREE BYTES PER CI        90003100
AMDCINV  DS    A                         CONTROL INTERVAL SIZE          90003200
AMDLRECL DS    A                         MAXIMUM RECORD SIZE            90003300
AMDHLRBA DS    0A                        RBA OF HIGH LEVEL IDX REC      90003400
AMDNSLOT DS    A                         NO. OF RECORD SLOTS PER CI     90003500
AMDSSRBA DS    0A                        RBA OF FIRST SEQ SET REC       90003600
AMDMAXRR DS    A                         MAX RELATIVE RECORD NUMBER     90003700
AMDPARDB DS    A                         PTR TO FIRST ARDB              90003700
AMDATTR3 DS    XL1                       ATTRIBUTES                     90003800
AMDUNQ   EQU   X'80'                     ON=NON-UNIQUE KEYS             90003900
*                                        OFF=UNIQUE KEYS                90004000
AMDFAULT EQU   X'40'                     ON=CYLINDER FAULT ON SS1       90004100
*                                        OFF=STAGE THE DATA SET         90004200
*                                        (DEFAULT)                      90004300
AMDBIND  EQU   X'20'                     ON=BIND THE DATA SET ON SS1    90004400
*                                        OFF=DO NOT BIND (DEFAULT)      90004500
AMDWAIT  EQU   X'10'                     ON=WAIT ON A RELINQUISH        90004600
*                                        OFF=DO NOT WAIT (DEFAULT)      90004700
AMDLM    EQU   X'08'                     ON=DATA SET LOADED             90004800
*                                        OFF=LOAD MODE OR NOT LOADED    90004900
         DS    XL7                       UNUSED                         90005000
AMDSTAT  DS    0F                        STATISTICS                     90005100
AMDSTSP  DS    D                            SYSTEM TIME STAMP           90005200
AMDNIL   DS    H                         NUMBER INDEX LEVELS            90005300
AMDNEXT  DS    H                         NUMBER OF EXTENTS              90005400
AMDNLR   DS    A                         NUMBER LOGICAL RECORDS         90005500
AMDDELR  DS    A                         NUMBER DELETED RECORDS         90005600
AMDIREC  DS    A                         NUMBER INSERTED RECORDS        90005700
AMDUPR   DS    A                         NUMBER UPDATED RECORDS         90005800
AMDRETR  DS    A                         NUMBER RETRIEVED RECORDS       90005900
AMDASPA  DS    A                         BYTES OF FREE SPACE IN DS      90006000
AMDNCIS  DS    A                         NUMBER OF CI SPLITS            90006100
AMDNCAS  DS    A                         NUMBER OF CA SPLITS            90006200
AMDEXCP  DS    A                         NUMBER OF EXCPS                90006300
AMDSBLEN EQU   *-IDAAMDSB                                               90006400
         MEND  ,                                                        90006500
./ ADD NAME=IDABUFC
*/********************************************************************/ 00050004
*/*                                                                  */ 00100004
*/*   MACRO NAME = IDABUFC                                           */ 00150004
*/*                                                                  */ 00200004
*/*   DESCRIPTIVE NAME = VSAM BUFFER CONTROL BLOCK HEADER (IDABUFDR) */ 00250004
*/*              VSAM BUFFER CONTROL BLOCK (IDABUFC)                 */ 00260004
*/*                                                                  */ 00300004
*/*   FUNCTION = THIS MACRO CONTAINS:                                */ 00350004
*/*              IDABUFDR = ORIGIN OF THE COMMON BUFFER AND THE      */ 00360004
*/*               PREFORMAT BUFFER CHAINS                            */ 00370004
*/*              IDABUFC = DESCRIBES THE BUFFER                      */ 00380004
*/*                                                                  */ 00400004
*/*   CONTROL BLOCK STRUCTURE = IDABUFDR IS POINTED TO BY IDAAMB     */ 00450004
*/*                                                                  */ 00500004
*/*   INCLUDED MACROS = NONE                                         */ 00550004
*/*                                                                  */ 00600004
*/*   METHOD OF ACCESS = PL/S - NO DECLARES NECESSARY                */ 00650004
*/*                                                                  */ 00700004
*/*   CREATED BY = VSAM OPEN                                         */ 00750004
*/*                                                                  */ 00800004
*/*   STATUS = VS/1 RELEASE 4  (CHANGE FLAG @X04SVXX)                */ 00850004
*/*                                                                  */ 00900004
*/*   DATE OF LAST CHANGE = 9 AUG 74                                 */ 00950004
*/********************************************************************/ 00960004
*  DCL 1 IDABUFDR BASED BDY(WORD),         /* BUFFER HEADER          */ 00970004
*        2 BUFDRID CHAR(1),                /* BUFFER HEADER ID      */  00980004
*        2 BUFDRNO PTR(8),                 /* NUMBER OF BUFFERS     */  00990004
*        2 BUFDRLEN FIXED(15),             /* LENGTH OF CNTL BLK    */  00992004
*        2 BUFDRPFB PTR(31),               /* FIRST PREFORMAT BUFC  */  00994004
*        2 BUFDRPFN PTR(8),                /* NO. OF PREFORMAT BUFCS*/  00996004
*        2 BUFDRCIX PTR(8),                /* NO OF COMMON IX BFRS  */  00998004
*          3 BUFDRMAX PTR(8),              /* MAX BFRS PER SEQ PLH  */  00998404
*        2 BUFDRTSB CHAR(1),               /* HDR TEST AND SET BYTE */  00998804
*        2 BUFDRFLG BIT(8),                /* BFR HEADER FLAGS      */  00999204
*          3 BUFDRREL BIT(1),              /* BFR REL FLG           */  00999604
*          3 BUFDRAVL BIT(1),              /* BFR AVAILABLE          */ 00999704
*          3 * BIT(6),                     /* UNUSED                 */ 00999804
*        2 BUFDBUFC PTR(31),               /* PTR TO 1ST BUFC@X04SVLC*/ 00999904
*        2 *        CHAR(4);               /* RESERVED              */  48000000
*/********************************************************************/ 48050004
*/* BUFFER CONTROL BLOCK                                             */ 48060004
*/********************************************************************/ 48100004
*  DCL 1 IDABUFC  BASED BDY(DWORD),        /* BUFC ENTRY     @X04SVLC*/ 48600004
*        2 BUFCAVL CHAR(1),                /* BUFFER TEST/SET BYTE  */  49200000
*          3 BUFCUCNT FIXED(8),            /* USE COUNT      @X04SVLC*/ 49250004
*        2 BUFCFLG1 BIT(8),                /* BUFC FLAGS--BYTE ONE  */  49800000
*          3 BUFCUPG BIT(1),               /* UPGRADE SET BUFC          50400004
*                                                           @X04SVLC*/  50450004
*          3 BUFCSEG BIT(1),               /* SEGMENTED REC IN BFR  */  51000000
*          3 BUFCINS BIT(1),               /* BUFC FOR INSERTS ONLY */  51600000
*          3 BUFCER1 BIT(1),               /* READ ERROR OCCURRED   */  52200000
*          3 BUFCER2 BIT(1),               /* WRITE ERROR OCCURRED  */  52800000
*          3 BUFCVAL BIT(1),               /* BUFCDDDD IS VALID     */  53400000
*          3 BUFCEXC BIT(1),               /* BFR IN EXCL CNTL      */  54000000
*          3 BUFCEPT BIT(1),               /* POST BIT               */ 54600000
*        2 BUFCIOFL BIT(8),                /* I/O MGR COMMUN FLAGS   */ 55200000
*          3 BUFCMW  BIT(1),               /* MUST WRITE THIS CINV   */ 55800000
*          3 BUFCFMT BIT(1),               /* FORMAT WRITE BUFC      */ 56400000
*          3 BUFCRRD BIT(1),               /* READ REQUIRED          */ 57000000
*          3 BUFCREAL BIT(1),              /* BUFCBAD IS A REAL ADDR */ 57600000
*          3 BUFCWC  BIT(1),               /* WRITE CHECK OPTION     */ 58200000
*          3 BUFCXEDB BIT(1),              /* NO EDB FOUND FOR RBA */   58800000
*          3 BUFCPFCP BIT(1),              /* PREFORMAT CP COMPLETE  */ 59400000
*          3 BUFCFIX  BIT(1),              /* BUFFER FIXED           */ 60000000
*        2 BUFCFLG2 BIT(8),         /* FLAG BYTE--TWO        @X04SVLC*/ 60600004
*          3 BUFCXDDR BIT(1),       /* SUPRESS DDR ON ERRORS @X04SVLC*/ 60610004
*          3 BUFCNLAS BIT(1),       /* NON-EXIST PG RD IND   @X04SVLC*/ 60620004
*          3 BUFCBSYR BIT(1),       /* BUSY READING          @X04SVLC*/ 60650004
*          3 BUFCBSYW BIT(1),       /* BUSY WRITING          @X04SVLC*/ 60700004
*          3 * BIT(4),              /* UNUSED                @X04SVLC*/ 60750004
*        2 BUFCPLH PTR(31),         /* POINTER TO PLH        @X04SVLC*/ 61200004
*          3 BUFCAMB PTR(31),       /* PTR TO AMB            @X04SVLC*/ 61210004
*        2 BUFCDDDD PTR(32),        /* INPUT RBA             @X04SVLC*/ 61800004
*        2 BUFCORBA PTR(32),        /* OUTPUT RBA            @X04SVLC*/ 63000004
*        2 BUFCCPA PTR(31),         /* CHAN PGM AREA ADDRESS @X04SVLC*/ 63600004
*        2 BUFCBAD PTR(31),         /* BUFFER ADDRESS        @X04SVLC*/ 64200004
*        2 BUFCNXT1 PTR(31),        /* NEXT BUFC IN I/O CHN  @X04SVLC*/ 64800004
*        2 BUFCINV    PTR(31),      /* INVOKERS FLD FOR ASM AND DB/DC   64804904
*                                                            @X04SVLC*/ 64805304
*          3 BUFCWLEN FIXED(15),    /* BUFC DATA LEN FOR VBP @X04SVLC*/ 64806004
*        2 BUFCDSPC   PTR(31),      /* DSPCT PTR FOR VBP.    @X04SVLC*/ 64808804
*        2 BUFCIDXL FIXED(8),       /* INDEX LEVEL           @X04SVLC*/ 64811604
*        2 BUFCNXT2 PTR(24),        /* NEXT LOGICAL BUFFER   @X04SVLC*/ 64814404
*        2 BUFXIRBA FIXED(32),      /* EXCL INPUT RBA        @X04SVLC*/ 64817204
*        2 BUFXORBA FIXED(32),      /* EXCL OUTPUT RBA       @X04SVLC*/ 64820004
*        2 BUFCHAIN PTR(31),        /* NEXT BUFC IN POOL     @X04SVLC*/ 64850004
*        2 BUFCMDBT FIXED(32),      /* MODIFICATION MASK     @X04SVLC*/ 64950004
*        2 BUFCUCUP PTR(31),        /* NXT BUFC UP USE CHN   @X04SVLC*/ 64960004
*        2 BUFCUCDN PTR(31),        /* NXT BUFC DOWN USE CHN @X04SVLC*/ 64970004
*        2 BUFCEND CHAR(0)BDY(DWORD);/* ROUND LEN TO DWORD   @X04SVLC*/ 65000004
*        DCL BUFCRSC1 CHAR(8)DEFINED(BUFCAVL);/* CDS RESOURCE           65100004
*                                                            @X04SVLC*/ 65150004
         MACRO ,                                                        90000100
         IDABUFC ,                                                      90000200
*                                                                       90000300
*         ASSEMBLER DSECT FOR BUFC/BUFDR                                90000400
*         COPIED FROM SYM601.F01 AND MANUALLY CONVERTED TO ASM          90000500
*                                                                       90000600
IDABUFDR DSECT ,                                                        90000700
BUFDRID  DS    XL1                       BUFFER HEADER ID               90000800
BUFDRNO  DS    XL1                       NUMBER OF BUFFERS              90000900
BUFDRLEN DS    XL2                       LENGTH OF CNTL BLK             90001000
BUFDRPFB DS    A                         FIRST PREFORMAT BUFC           90001100
BUFDRPFN DS    XL1                       NO. OF PREFORMAT BUFCS         90001200
BUFDRCIX DS    0XL1                      NO OF COMMON IX BFRS           90001300
BUFDRMAX DS    XL1                       MAX BFRS PER SEQ PLH           90001400
BUFDRTSB DS    XL1                       HDR TEST AND SET BYTE          90001500
BUFDRFLG DS    XL1                       BFR HEADER FLAGS               90001600
BUFDRREL EQU   X'80'                     BFR REL FLG                    90001700
BUFDRAVL EQU   X'40'                     BFR AVAILABLE                  90001800
BUFDBUFC DS    A                         PTR TO 1ST BUFC@X04SVLC        90001900
         DS    A                         RESERVED                       90002000
BUFDRLNG EQU   *-IDABUFDR                                               90002100
*                                                                       90002200
*                                                                       90002300
*                                                                       90002400
IDABUFC  DSECT ,                         BUFFER CONTROL BLOCK           90002500
BUFCRSC1 DS    0D                        CDS RESOURCE                   90002600
BUFCAVL  DS    0X                        BUFFER TEST/SET BYTE           90002700
BUFCUCNT DS    XL1                       USE COUNT                      90002800
BUFCFLG1 DS    XL1                       BUFC FLAGS--BYTE ONE           90002900
BUFCUPG  EQU   X'80'                     UPGRADE SET BUFC               90003000
BUFCSEG  EQU   X'40'                     SEGMENTED REC IN BFR           90003100
BUFCINS  EQU   X'20'                     BUFC FOR INSERTS ONLY          90003200
BUFCER1  EQU   X'10'                     READ ERROR OCCURRED            90003300
BUFCER2  EQU   X'08'                     WRITE ERROR OCCURRED           90003400
BUFCVAL  EQU   X'04'                     BUFCDDDD IS VALID              90003500
BUFCEXC  EQU   X'02'                     BFR IN EXCL CNTL               90003600
BUFCEPT  EQU   X'01'                     POST BIT                       90003700
BUFCIOFL DS    XL1                       I/O MGR COMMUN FLAGS           90003800
BUFCMW   EQU   X'80'                     MUST WRITE THIS CINV           90003900
BUFCFMT  EQU   X'40'                     FORMAT WRITE BUFC              90004000
BUFCRRD  EQU   X'20'                     READ REQUIRED                  90004100
BUFCREAL EQU   X'10'                     BUFCBAD IS A REAL ADDR         90004200
BUFCWC   EQU   X'08'                     WRITE CHECK OPTION             90004300
BUFCXEDB EQU   X'04'                     NO EDB FOUND FOR RBA           90004400
BUFCPFCP EQU   X'02'                     PREFORMAT CP COMPLETE          90004500
BUFCFIX  EQU   X'01'                     BUFFER FIXED                   90004600
BUFCFLG2 DS    XL1                       FLAG BYTE--TWO                 90004700
BUFCXDDR EQU   X'80'                     SUPRESS DDR ON ERRORS          90004800
BUFCNLAS EQU   X'40'                     NON-EXIST PG RD IND            90004900
BUFCBSYR EQU   X'20'                     BUSY READING                   90005000
BUFCBSYW EQU   X'10'                     BUSY WRITING                   90005100
BUFCPLH  DS    0A                        POINTER TO PLH                 90005200
BUFCAMB  DS    A                         PTR TO AMB                     90005300
BUFCDDDD DS    A                         INPUT RBA                      90005400
BUFCORBA DS    A                         OUTPUT RBA                     90005500
BUFCCPA  DS    A                         CHAN PGM AREA ADDRESS          90005600
BUFCBAD  DS    A                         BUFFER ADDRESS                 90005700
BUFCNXT1 DS    A                         NEXT BUFC IN I/O CHN           90005800
BUFCWLEN DS    0H                        BUFC DATA LEN FOR VBP          90005900
BUFCINV  DS    A                         INVOKERS FLD FOR ASM AND DB/DC 90006000
BUFCDSPC DS    A                         DSPCT PTR FOR VBP.             90006100
BUFCIDXL DS    X                         INDEX LEVEL                    90006200
BUFCNXT2 DS    XL3                       NEXT LOGICAL BUFFER            90006300
BUFXIRBA DS    A                         EXCL INPUT RBA                 90006400
BUFXORBA DS    A                         EXCL OUTPUT RBA                90006500
BUFCHAIN DS    A                         NEXT BUFC IN POOL              90006600
BUFCMDBT DS    A                         MODIFICATION MASK              90006700
BUFCUCUP DS    A                         NXT BUFC UP USE CHN            90006800
BUFCUCDN DS    A                         NXT BUFC DOWN USE CHN          90006900
         DS    0D                        ROUND LEN TO DWORD             90007000
BUFCLEN  EQU   *-IDABUFC                                                90007100
         MEND  ,                                                        90007200
./ ADD NAME=IDAIOMB,SSI=81790426
*/********************************************************************* 00300002
*                                                                     * 00350002
*   THIS MAPPING MACRO DESCRIBES THE CONTROL BLOCK PASSED TO THE I/O  * 00400002
*   MANAGER BY USERS SUCH AS RECORD MANAGEMENT AND ASM.  IT CONTAINS  * 00410002
*   POINTERS TO OTHER CONTROL BLOCKS, FLAGS FOR I/O MANAGER USE, AND  * 00450002
*   A SIXTEEN WORD SAVE AREA.  POINTERS TO THE FIRST BUFC AND CPA ARE * 00500002
*   INSERTED BY I/O MGR AFTER THEY HAVE BEEN VERIFIED.                * 00550002
*                                                                     * 00650002
*   THE IOMB IS USED IN CONJUNCTION WITH AN IOSB AND AN SRB FOR I/O   * 00700002
*   PURPOSES IN PLACE OF THE IOB USED BY OTHER IOS DRIVERS.  THE IOMB * 00750002
*   POINTS TO THE IOSB, WHICH POINTS TO THE SRB.                      * 00760002
*                                                                     * 00810002
*    09/18/74          LEVEL=01                                       * 00850037
*    08/15/75          LEVEL=02           CHANGE FLAG=@Z40GSDT        * 00860004
*                                                                     * 00900002
**********************************************************************/ 00950002
* %      GO TO IOMBPLS;             /* GO TO THE PLS VERSION         */ 00960002
         MACRO                                                          00970002
         IDAIOMB                                                        00980002
IOMB     DSECT                                                          00990002
         SPACE 1                                                        01000002
         DS    0F                                                       01050002
IOMBID   DS    XL4                  IOMB IDENTIFIER                     01100002
IOMBUFC  DS    F                    POINTER TO THE FIRST BUFC           01150002
IOMCPA   DS    F                    POINTER TO THE FIRST CPA            01200002
IOMPLH   DS    F                    POINTER TO THE PLH                  01250002
IOMAMB   DS    F                    POINTER TO THE AMB                  01300002
IOMIQE   DS    F                    POINTER TO THE IQE                  01350002
IOMECBPT DS    F                    POINTER TO THE ECB                  01400002
IOMVSL   DS    F                    POINTER TO THE VIRTUAL SUBAREA LIST 01450002
IOMPGAD  DS    F                    ADDR OF CALLER TO RECEIVE CONTROL   01500002
*                                   ON COMPLETION OF I/O OPERATION      01510002
*                                   (ZEROED FOR RECORD MANAGEMENT)      01520002
IOMIOSB  DS    F                    POINTER TO THE IOSB                 01550002
IOMFLAGS DS    0XL3                 INTERNAL FLAGS                      01600002
IOMFL    DS    XL2                  FLAGS TO BE RESET AFTER I/O         01650002
IOMAPEND EQU   X'C0'                ABNORMAL END AND NORMAL END ENTERED 01700002
IOMNE    EQU   X'80'                NORMAL END ENTERED                  01750002
IOMAE    EQU   X'40'                ABNORMAL END ENTERED                01800002
IOMPURGE EQU   X'20'                PURGE IN PROGRESS                   01850002
IOMCBERR EQU   X'08'                CONTROL BLOCK VALIDITY ERROR        01950002
IOMADERR EQU   X'04'                ERROR CONVERTING VPL TO IDAL        02000002
IOMPGFIX EQU   X'02'                PAGES FIXED                         02050002
IOMCSW   EQU   X'01'                CSW ADDRESS NOT VALID               02100002
*                                   SECOND BYTE OF IOMFL AND IOMFLAGS   02102002
IOMDDR   EQU   X'80'                DYNAMIC DEVICE RECONFIGURATION      02110002
IOMCPRB  EQU   X'40'                CALLER IN PROBLEM STATE    @ZA09130 02130037
IOMEEXIT EQU   X'08'                END APPENDAGE EXIT BIT     @ZA02276 02160037
IOMIRBSW EQU   X'04'                ASYNCH PROCESSING SCHED    @ZA02276 02210037
         SPACE 1                                                        02250002
*                                   THIRD BYTE OF IOMFLAGS              02260002
IOMSTIND DS    XL1                  ONE BYTE OF STATUS INDICATORS       02300002
IOMAMUSE EQU   X'80'                IOMB CURRENTLY IN USE               02350002
IOMEOVW  EQU   X'40'                EOV WAITING FOR IOMB                02400002
IOMEOVTS EQU   X'20'                EOV HAS SET IOMLOCK                 02450002
IOMEOVXC EQU   X'10'                END OF VOLUME INDICATOR             02500002
IOMLLOCK EQU   X'08'                LOCAL LOCK HELD                     02510002
IOMSLOC  EQU   X'04'                SALLOC HELD                @Y30SDLC 02520037
IOMSRBM  EQU   X'02'                USER IN SRB MODE           @Y30SDLP 02530037
IOMSR    EQU   X'01'                SUSPEND/RESUME INDICATOR   @Z40GSDT 02540004
IOMCKEY  DS    XL1                  USER KEY SAVED FOR APPENDAGE USE    02550002
IOMPFERR DS    XL1                  RETURN CODE FROM PAGEFIX            02600002
IOMLOCK  DS    XL1                  END OF VOLUME LOCK                  02650002
IOMNMOD  DS    H                    NUMBER OF MODULES TO BE FIXED       02700002
IOMNBUF  DS    H                    NUMBER OF BUFFERS                   02750002
IOMNSEG  DS    H                    NUMBER OF CHANNEL PROGRAM SEGMENTS  02800002
IOMSAVER DS    0CL64                16 WORD SAVE AND WORK AREA          02850002
IOMSAVE0 DS    F                                                        02900002
IOMSAVE1 DS    F                                                        02950002
IOMSAVE2 DS    F                                                        03000002
IOMSAVE3 DS    F                                                        03050002
IOMSAVE4 DS    F                                                        03100002
IOMSAVE5 DS    F                                                        03150002
IOMSAVE6 DS    F                                                        03200002
IOMSAVE7 DS    F                                                        03250002
IOMSAVE8 DS    F                                                        03300002
IOMSAVE9 DS    F                                                        03350002
IOMSAVEA DS    F                                                        03400002
IOMSAVEB DS    F                                                        03450002
IOMSAVEC DS    F                                                        03500002
IOMSAVED DS    F                                                        03550002
IOMSAVEE DS    F                                                        03600002
IOMSAVEF DS    F                                                        03650002
IOMNXT1  DS    F                    POINTER TO NEXT IOMB ON CHAIN       03700002
IOMUFLD  DS    F                    USER FIELD-PTR TO IDAIOMBX FOR RM   03710002
IOMSRBP  DS    F                    ADDRESS OF SUSPENDED RB    @Z40GSDT 03720004
IOMSTCB  DS    F                    TCB FOR SUSPENDED RB       @Z40GSDT 03730004
         MEND                                                           03750002
         EJECT                                                          03800002
* /*      IOMB DECLARATION                                           */ 07000002
* /*                                                                 */ 07050002
*%IOMBPLS: ;                                                            07060002
* /*                                                                 */ 07150002
*     DCL 1 IDAIOMB BASED BDY(WORD),                                    07200002
*           2 IOMBID     CHAR(4),   /* IOMB IDENTIFIER               */ 07250002
*           2 IOMBUFC    PTR(31),   /* FIRST BUFC ADDRESS            */ 07300002
*           2 IOMCPA     PTR(31),   /* 1ST CPA IN CHAIN              */ 07350002
*           2 IOMPLH     PTR(31),   /* PLH ADDRESS                   */ 07400002
*           2 IOMAMB     PTR(31),   /* AMB ADDRESS                   */ 07450002
*           2 IOMIQE     PTR(31),   /* IQE ADDRESS                   */ 07500002
*           2 IOMECBPT   PTR(31),   /* ECB ADDRESS                   */ 07550002
*           2 IOMVSL     PTR(31),   /* VIRTUAL SUBAREA LIST PTR      */ 07600002
*           2 IOMPGAD    PTR(31),   /* ADDR OF CALLER TO GET CONTROL    07650002
*                                      ON COMPLETION OF I/O OPERATION   07660002
*                                      (ZEROED FOR RECORD MGMT)      */ 07670002
*           2 IOMIOSB    PTR(31),   /* IOSB ADDRESS                  */ 07700002
*           2 IOMFLAGS   BIT(24),   /* INTERNAL FLAGS                */ 07750002
*             3 IOMFL    BIT(16),   /* FLAGS TO BE RESET AFTER I/O   */ 07800002
*               4 IOMAPEND BIT(2),  /* APPENDAGE FLAGS               */ 07850002
*                 5 IOMNE  BIT(1),  /* NE APPENDAGE COMPLETED        */ 07900002
*                 5 IOMAE  BIT(1),  /* AE APPENDAGE COMPLETED        */ 07950002
*               4 IOMPURGE BIT(1),  /* PURGE IN PROGRESS             */ 08000002
*               4 *        BIT(1),  /* RESERVED                      */ 08050002
*               4 IOMCBERR BIT(1),  /* CONTROL BLOCK VALIDITY ERROR  */ 08100002
*               4 IOMADERR BIT(1),  /* ERROR CONVERTING VPL TO IDAL  */ 08150002
*               4 IOMPGFIX BIT(1),  /* PAGES FIXED                   */ 08200002
*               4 IOMCSW   BIT(1),  /* CSW ADDRESS NOT VALID         */ 08250002
*               4 IOMDDR   BIT(1),  /* DYNAMIC DEVICE RECONFIGURATION*/ 08300002
*               4 IOMCPRB  BIT(1),  /* PROBLEM STATE CALLER  @ZA09130*/ 08310037
*               4 *        BIT(2),  /* RESERVED              @ZA09130*/ 08315037
*               4 IOMEEXIT BIT(1),  /* END APPENDAGE EXIT    @ZA02276*/ 08320037
*               4 IOMIRBSW BIT(1),  /* ASYNCH PROCESSING SCH @ZA02276*/ 08330037
*               4 *        BIT(2),  /* RESERVED              @ZA02276*/ 08340037
*             3 IOMSTIND   BIT(8),  /* STATUS INDICATORS             */ 08400002
*               4 IOMAMUSE BIT(1),  /* IOMB CURRENTLY IN USE         */ 08450002
*               4 IOMEOVW  BIT(1),  /* EOV WAITING FOR IOMB          */ 08500002
*               4 IOMEOVTS BIT(1),  /* EOV HAS SET IOMLOCK           */ 08550002
*               4 IOMEOVXC BIT(1),  /* END OF VOLUME INDICATOR       */ 08600002
*               4 IOMLLOCK BIT(1),  /* LOCAL LOCK HELD               */ 08610002
*               4 IOMSLOC  BIT(1),  /* SALLOC HELD           @Y30SDLC*/ 08620037
*               4 IOMSRBM  BIT(1),  /* USER IN SRB MODE      @Y30SDLP*/ 08630037
*               4 IOMSR    BIT(1),  /* SUSPEND/RESUME IND    @Z40GSDT*/ 08680004
*           2 IOMCKEY    CHAR(1),   /* USER KEY FOR APPENDAGE USE    */ 08700002
*           2 IOMPFERR   CHAR(1),   /* RETURN CODE FROM PAGE FIX     */ 08750002
*           2 IOMLOCK    CHAR(1),   /* END-OF-VOLUME LOCK            */ 08800002
*           2 IOMNMOD    PTR(16),   /* NUMBER OF MODULES TO BE FIXED */ 08850002
*           2 IOMNBUF    PTR(16),   /* NUMBER OF BUFFERS             */ 08900002
*           2 IOMNSEG    PTR(16),   /* NUMBER OF CHANNEL PGM SEGMENTS*/ 08950002
*           2 IOMSAVER   BDY(WORD), /* 16 WORD SAVE AND WORK AREA    */ 09000002
*             3 IOMSAVE0 PTR(31),                                       09050002
*             3 IOMSAVE1 PTR(31),                                       09100002
*             3 IOMSAVE2 PTR(31),                                       09150002
*             3 IOMSAVE3 PTR(31),                                       09200002
*             3 IOMSAVE4 PTR(31),                                       09250002
*             3 IOMSAVE5 PTR(31),                                       09300002
*             3 IOMSAVE6 PTR(31),                                       09350002
*             3 IOMSAVE7 PTR(31),                                       09400002
*             3 IOMSAVE8 PTR(31),                                       09450002
*             3 IOMSAVE9 PTR(31),                                       09500002
*             3 IOMSAVEA PTR(31),                                       09550002
*             3 IOMSAVEB PTR(31),                                       09600002
*             3 IOMSAVEC PTR(31),                                       09650002
*             3 IOMSAVED PTR(31),                                       09700002
*             3 IOMSAVEE PTR(31),                                       09750002
*             3 IOMSAVEF PTR(31),                                       09800002
*           2 IOMNXT1    PTR(31),   /* POINTER TO NEXT IOMB ON CHAIN */ 09850002
*           2 IOMUFLD    PTR(31),   /* USER FIELD   -                   09860004
*                                      PTR TO IDAIOMBX FOR REC MGMT  */ 09900002
*           2 IOMSRBP    PTR(31),   /* ADDR OF SUSPENDED RB  @Z40GSDT*/ 09950004
*           2 IOMSTCB    PTR(31);   /* TCB FOR SUSPENDED RB  @Z40GSDT*/ 10000004
./ ADD NAME=IDAIXH
         MACRO ,                                                        00000100
         IDAIXH &DSECT=YES                                              00000200
********************************************************************    00000300
*                                                                  *    00000400
*                    ASSEMBLER DSECT FOR IXH                       *    00000500
*                                                                  *    00000600
********************************************************************    00000700
         AIF   ('&DSECT' EQ 'NO').NODS                                  00000800
IDAIXH   DSECT ,                                                        00000900
         AGO   .IXHDSCT                                                 00001000
.NODS    ANOP  ,                                                        00001100
IDAIXH   DS    0F                                                       00001200
.IXHDSCT ANOP  ,                                                        00001300
IXHLL    DS    H                                                        00001400
IXHFLPLN DS    X                                                        00001500
IXHPTLS  DS    X                                                        00001600
IXHBRBA  DS    F                                                        00001700
IXHHP    DS    F                                                        00001800
IXHXX    DS    F                                                        00001900
IXHLV    DS    X                                                        00002000
IXHFLGS  DS    X                                                        00002100
IXHFSO   DS    H                                                        00002200
IXHLEO   DS    H                                                        00002300
IXHSEO   DS    H                                                        00002400
IXHLENG  EQU   *-IDAIXH                                                 00002500
         MEND  ,                                                        00002600
./ ADD NAME=IEACIWA,SSI=32820429
*        %GOTO CIWAPLS;                                              /* 00050002
         MACRO                                                          00100002
         IEACIWA &DSECT=YES                                             00150002
         AGO  .CIWARND                                                  00200002
*********************************************************************** 00250002
*                                                                     * 00300002
* STATUS -                                                            * 00350002
*    CHANGE LEVEL 0 (OS/VS2 REL 2 VERSION)                            * 00400002
* FUNCTION -                                                          * 00450002
*    MAPPING MACRO FOR COMMON INTERNAL WORK AREA                      * 00500002
* ENTRY POINTS -                                                      * 00550002
*     IEACIWA MACRO CALL                                              * 00600002
* INPUT -                                                             * 00650002
*    SEE IEACIWA MACRO DEFINITION                                     * 00700002
* OUTPUT -                                                            * 00750002
*    COMMON INTERNAL WORK AREA MAPPING MACRO                          * 00800002
* EXTERNAL REFERENCES -                                               * 00850002
*    N/A                                                              * 00900002
* EXITS, NORMAL -                                                     * 00950002
*    N/A                                                              * 01000002
* EXITS, ERROR -                                                      * 01050002
*    N/A                                                              * 01100002
* TABLES/WORK AREAS -                                                 * 01150002
*    N/A                                                              * 01200002
* ATTRIBUTES -                                                        * 01250002
*    BILINGUAL MACRO                                                  * 01300002
* CHARACTER CODE DEPENDENCY -                                         * 01350002
*    NONE                                                             * 01400002
* NOTES -                                                             * 01450002
*    NONE                                                             * 01500002
*                                                                     * 01550002
*********************************************************************** 01600002
.CIWARND ANOP                                                           01650002
         IEZBITS                                                        01700002
*********************************************************************** 01750002
*                  CIWA MAPPING     9/17/73                           * 01760002
*********************************************************************** 01800002
         AIF   ('&DSECT' EQ 'NO').CIWA001                               01850002
CIWA     DSECT , CIWAPTR                                                01900002
         AGO   .CIWA002                                                 01950002
.CIWA001 ANOP                                                           02000002
CIWA     DS    0F                                                       02050002
.CIWA002 ANOP                                                           02100002
CIWFLG1  DS    BL1 -                FIRST INTERNAL FLAG FIELD           02110002
CIWSVC2  EQU   BIT0 -               PSI ENTERED AT IGC112               02120002
CIWSVC3  EQU   BIT1 -               PSI ENTERED AT IGC113               02130002
CIWBREX  EQU   BIT3 -               PSI ENTERED VIA BRANCH ENTRY        02140002
*                                   FROM NON-RSM ROUTINE AT             02140602
*                                   IEAVPSIB/IEAVPSIX/IEAVPSIF.         02141202
CIWBRIN  EQU   BIT4 -               PSI ENTERED AT IEAVPSII             02142002
CIWOUTKR EQU   BIT5 -               INTERNAL KEEPREAL FLAG (PGOUT)      02144002
CIWFIXC  EQU   BIT6 -               PGFIX IS CALLING PGFREE             02146002
CIWNOPST EQU   BIT7 -               DO NOT POST REQUESTOR ECB FLAG.     02146402
*                                   SET BY PGFIX/PGLOAD MODULE          02146802
CIWFLG2  DS    BL1 -                RESERVED FLAG FIELD                 02148002
CIWOPFL1 DS    BL1 -                FIRST BYTE OF INPUT VSL ENTRY       02148402
CIWCONT  EQU   BIT0 -               CONTINUATION/LIST FORM FLAG         02148802
CIWFIX   EQU   BIT1 -               PGFIX FLAG                          02149202
CIWFREE  EQU   BIT2 -               PGFREE FLAG                         02149602
CIWLOAD  EQU   BIT3 -               PGLOAD FLAG                         02149702
CIWRLS   EQU   BIT4 -               PGRLSE FLAG                         02149802
CIWLONG  EQU   BIT6 -               LONG-FIX OPTION FLAG                02149902
CIWOPFL2 DS    BL1 -                FIFTH BYTE OF INPUT VSL ENTRY       02166602
CIWLAST  EQU   BIT0 -               LAST ENTRY FLAG                     02176602
CIWNULL  EQU   BIT1 -               NULL ENTRY FLAG                     02178602
CIWRAO   EQU   BIT2 -               REAL ADDRESS OPTION FLAG            02180602
CIWERR   EQU   BIT3 -               ERROR FLAG                          02182602
CIWPGOUT EQU   BIT5 -               PGOUT FLAG                          02183002
CIWKEPRL EQU   BIT6 -               KEEPREAL OPTION FLAG                02183102
CIWEXTRS EQU   BIT7 -               RESERVED FOR EXTENDABILITY          02185102
CIWRETC  DS    FL1 -                RETURN CODE FIELD USED BY           02188202
*                                   SERVICE MODULES TO COMMUNICATE      02190202
*                                   RETURN CODES BACK TO PSI            02192202
CIWSAVRC DS    FL1 -                RETURN CODE SAVE AREA USED BY       02194202
*                                   PAGE SERVICES MODULES WHEN          02196202
*                                   CALLING ANOTHER PAGE SERVICES       02198202
*                                   MODULE                              02200202
CIWKEY   DS    FL1 -                THE CALLER'S PROTECTION KEY         02202202
         DS    FL1 -                RESERVED                            02204202
CIWINVSL DS    A -                  VSA OF THE REQUESTOR SUPPLIED       02206202
*                                   VSL. ZERO IF REGISTER FORM ENTRY    02208202
*                                   USED.                               02218202
CIWCUVSL DS    A -                  VSA OF THE CURRENT VSL ENTRY        02220202
*                                   BEING PROCESSED. ZERO FOR           02220602
*                                   REGISTER ENTRY REQUEST.             02221002
CIWVSL   DS    0D -                 INTERNAL VSL ENTRY WHERE CURRENT    02221402
*                                   VSL ENTRY IS PLACED WHILE BEING     02221802
*                                   PROCESSED.                          02221902
CIWSTRT  DS    0F -                 FULLWORD REFERENCE TO FIRST WORD    02222002
*                                   OF VSL                              02222102
CIWIFLG1 DS    BL1 -                FIRST BYTE OF VSL ENTRY             02226702
CIWICONT EQU   BIT0 -               CONTINUATION/LIST FORM FLAG         02228702
CIWIFIX  EQU   BIT1 -               PGFIX FLAG                          02230702
CIWIFREE EQU   BIT2 -               PGFREE FLAG                         02231102
CIWILOAD EQU   BIT3 -               PGLOAD FLAG                         02231202
CIWIRLS  EQU   BIT4 -               PGRLSE FLAG                         02231302
CIWILONG EQU   BIT6 -               LONG-FIX OPTION FLAG                02231402
CIWSTRTA DS    AL3 -                START ADDR OF VIRTUAL SUBAREA       02236002
CIWEND1  DS    0F -                 FULLWORD REFERENCE TO LAST WORD     02238002
*                                   OF VSL                              02240002
CIWIFLG2 DS    BL1 -                FIFTH BYTE OF VSL ENTRY             02240402
CIWILAST EQU   BIT0 -               LAST ENTRY FLAG                     02240502
CIWINULL EQU   BIT1 -               NULL ENTRY FLAG                     02240602
CIWIRAO  EQU   BIT2 -               REAL ADDRESS OPTION FLAG            02240702
CIWIERR  EQU   BIT3 -               ERROR FLAG                          02252502
CIWIOUT  EQU   BIT5 -               PGOUT FLAG                          02262502
CIWIKPRL EQU   BIT6 -               KEEPREAL OPTION FLAG                02264502
CIWEND1A DS    AL3 -                END ADDR+1 OF VIRTUAL SUBAREA       02268402
CIWTCB   DS    A -                  ADDRESS OF REQUESTOR TCB            02270402
CIWECB   DS    A -                  ADDRESS OF REQUESTOR SUPPLIED ECB   02272402
CIWCURPG DS    A -                  ADDRESS OF CURRENT VIRTUAL PAGE     02276302
*                                   BEING PROCESSED                     02278302
CIWLSTPG DS    A -                  ADDRESS OF LAST VIRTUAL PAGE TO     02280302
*                                   BE PROCESSED                        02284202
CIWRETRN DS    A -                  SAVE AREA FOR RETURN ADDR TO PSI.   02286202
*                                   USED BY SERVICE MODULES WHEN        02288202
*                                   CALLED BY PSI                       02291802
CIWWRK1  DS    F -                  FIRST WORK AREA                     02293802
CIWWRK2  DS    F -                  SECOND WORK AREA                    02294202
CIWWRK3  DS    F -                  THIRD WORK AREA                     02294602
CIWWRK4  DS    F -                  FOURTH WORK AREA                    02295002
CIWWRK5  DS    F -                  FIFTH WORK AREA                     02295402
CIWALEN  EQU   *-CIWA -             LENGTH OF CIWA                      02295602
         MEND  , */                                                     02299202
*%CIWAPLS :  ;                                                          02302802
* /*******************************************************************/ 02306402
* /*               CIWA MAPPING     9/17/73                          */ 02310002
* /*******************************************************************/ 02350002
*        %IF CIWA9999 ^= ','        /* IF THIS IS LAST BLOCK         */ 02400002
*          %THEN %CIWA9999 = ';';   /* THEN CLOSE DCL STATEMENT      */ 02450002
*        %IF CIWALEVL ^= ''         /* IF THIS IS CONCATENATED       */ 02500002
*          %THEN %GOTO CIWAPLS1;    /* THEN SKIP DCL                 */ 02550002
*DCL 1 CIWA BASED (CIWAPTR)         /* DECLARE CIWA LEVEL 1          */ 02600002
*        %GO TO CIWAPLS2;           /* AND SKIP LEVEL TWO DCL        */ 02650002
*%CIWAPLS1: CIWADUM=CIWALEVL ³³' CIWA'; /* SET LEVEL FOR MINOR       */ 02700002
*    CIWADUM                        /* MINOR STRUCTURE NAME PARM     */ 02750002
*%CIWAPLS2:;                                                            02800002
*        BDY(WORD),                                                     02850002
*    3 CIWFLG1  BIT(8),             /* FIRST INTERNAL FLAG FIELD     */ 02860002
*        5 CIWSVC2  BIT(1),         /* PSI ENTERED AT IGC112         */ 02870002
*        5 CIWSVC3  BIT(1),         /* PSI ENTERED AT IGC113         */ 02890002
*        5 *        BIT(1),         /* RESERVED                      */ 02892002
*        5 CIWBREX  BIT(1),         /* PSI ENTERED VIA BRANCH ENTRY     02894002
*                                      FROM NON-RSM ROUTINE AT          02894602
*                                      IEAVPSIB/IEAVPSIX/IEAVPSIF.   */ 02895202
*        5 CIWBRIN  BIT(1),         /* PSI ENTERED AT IEAVPSII       */ 02896002
*        5 CIWOUTKR BIT(1),         /* INTERNAL KEEPREAL FLAG (PGOUT)*/ 02898002
*        5 CIWFIXC  BIT(1),         /* PGFIX IS CALLING PGFREE       */ 02898402
*        5 CIWNOPST BIT(1),         /* DO NOT POST REQUESTOR ECB        02898802
*                                      FLAG. SET BY PGFIX/PGLOAD MOD */ 02898902
*    3 CIWFLG2  BIT(8),             /* RESERVED FLAG FIELD           */ 02899202
*    3 CIWOPFL1 BIT(8),             /* FIRST BYTE OF INPUT VSL ENTRY */ 02899602
*        5 CIWCONT  BIT(1),         /* CONTINUATION FLAG             */ 02899702
*        5 CIWFIX   BIT(1),         /* PGFIX FLAG                    */ 02899802
*        5 CIWFREE  BIT(1),         /* PGFREE FLAG                   */ 02899902
*        5 CIWLOAD  BIT(1),         /* PGLOAD FLAG                   */ 02949902
*        5 CIWRLS   BIT(1),         /* PGRLSE FLAG                   */ 02959902
*        5 *        BIT(1),         /* RESERVED FOR VS1              */ 02969902
*        5 CIWLONG  BIT(1),         /* LONG-FIX OPTION FLAG          */ 02979902
*        5 *        BIT(1),         /* RESERVED FOR VS1              */ 02989902
*    3 CIWOPFL2 BIT(8),             /* FIFTH BYTE OF INPUT VSL ENTRY */ 02991902
*        5 CIWLAST  BIT(1),         /* LAST ENTRY FLAG               */ 02993902
*        5 CIWNULL  BIT(1),         /* NULL ENTRY FLAG               */ 02995902
*        5 CIWRAO   BIT(1),         /* REAL ADDRESS OPTION FLAG      */ 02997902
*        5 CIWERR   BIT(1),         /* ERROR FLAG                    */ 02998302
*        5 *        BIT(1),         /* RESERVED                      */ 02998702
*        5 CIWPGOUT BIT(1),         /* PGOUT FLAG                    */ 02999102
*        5 CIWKEPRL BIT(1),         /* KEEPREAL OPTION FLAG          */ 02999502
*        5 CIWEXTRS BIT(1),         /* RESERVED FOR EXTENDABILITY    */ 02999602
*    3 CIWRETC  FIXED(8),           /* RETURN CODE FIELD USED BY        02999702
*                                      SERVICE MODULES TO COMMUNICATE   02999802
*                                      RETURN CODES BACK TO PSI      */ 03049802
*    3 CIWSAVRC FIXED(8),           /* RETURN CODE SAVE AREA USED BY    03059802
*                                      PAGE SERVICES MODULES WHEN       03069802
*                                      CALLING ANOTHER PAGE SERVICES    03079802
*                                      MODULE                        */ 03089802
*    3 CIWKEY   FIXED(8),           /* THE CALLER'S PROTECTION KEY   */ 03091802
*    3 *        FIXED(8),           /* RESERVED                      */ 03093802
*    3 CIWINVSL PTR(31),            /* VSA OF THE REQUESTOR SUPPLIED    03095802
*                                      VSL. ZERO IF REGISTER FORM       03097802
*                                      ENTRY IS USED.                */ 03098202
*    3 CIWCUVSL PTR(31),            /* VSA OF THE CURRENT VSL ENTRY     03098602
*                                      BEING PROCESSED. ZERO FOR        03099002
*                                      REGISTER ENTRY REQUESTS.      */ 03099402
*    3 CIWVSL BDY(WORD)  CHAR(8),   /* INTERNAL VSL ENTRY WHERE         03099502
*                                      CURRENT VSL ENTRY IS PLACED      03099602
*                                      WHILE BEING PROCESSED.        */ 03099702
*        5 CIWSTRT BDY(WORD),       /* FULLWORD REFERNCE TO FIRST       03149702
*                                      WORD OF VSL                   */ 03159702
*          7 CIWIFLG1 BIT(8),       /* FIRST BYTE OF INPUT VSL ENTRY */ 03169702
*             9 CIWICONT  BIT(1),   /* CONTINUATION FLAG             */ 03179702
*             9 CIWIFIX   BIT(1),   /* PGFIX FLAG                    */ 03189702
*             9 CIWIFREE  BIT(1),   /* PGFREE FLAG                   */ 03191702
*             9 CIWILOAD  BIT(1),   /* PGLOAD FLAG                   */ 03193702
*             9 CIWIRLS   BIT(1),   /* PGRLSE FLAG                   */ 03195702
*             9 *         BIT(1),   /* RESERVED FOR VS1              */ 03197702
*             9 CIWILONG  BIT(1),   /* LONG-FIX OPTION FLAG          */ 03198102
*             9 *         BIT(1),   /* RESERVED FOR VS1              */ 03198502
*          7 CIWSTRTA PTR(24),      /* START ADDR OF VIRTUAL SUBAREA */ 03198602
*        5 CIWEND1 BDY(WORD),       /* FULLWORD REFERENCE TO LAST       03198702
*                                       WORD OF VSL                  */ 03198802
*          7 CIWIFLG2 BIT(8),       /* FIFTH BYTE OF INPUT VSL ENTRY */ 03198902
*             9 CIWILAST  BIT(1),   /* LAST ENTRY FLAG               */ 03199302
*             9 CIWINULL  BIT(1),   /* NULL ENTRY FLAG               */ 03199402
*             9 CIWIRAO   BIT(1),   /* REAL ADDRESS OPTION FLAG      */ 03199502
*             9 CIWIERR   BIT(1),   /* ERROR FLAG                    */ 03199602
*             9 *         BIT(1),   /* RESERVED                      */ 03249602
*             9 CIWIOUT   BIT(1),   /* PGOUT FLAG                    */ 03259602
*             9 CIWIKPRL  BIT(1),   /* KEAPREAL OPTION FLAG          */ 03269602
*             9 *         BIT(1),   /* RESERVED FOR EXTENDABILITY    */ 03279602
*          7 CIWEND1A PTR(24),      /* END ADDR+1 OF VIRTUAL AREA       03289602
*                                      SUBLIST                       */ 03291602
*    3 CIWTCB   PTR(31),            /* ADDRESS OF REQUESTOR TCB      */ 03293602
*    3 CIWECB   PTR(31),            /* ADDR OF REQUESTOR SUPPLIED       03295602
*                                      ECB                           */ 03297602
*    3 CIWCURPG PTR(31),            /* ADDR OF CURRENT VIRTUAL          03298002
*                                      PAGE BEING PROCESSED          */ 03298402
*    3 CIWLSTPG PTR(31),            /* ADDR OF LAST PAGE TO BE          03298802
*                                      PROCESSED                     */ 03299202
*    3 CIWRETRN PTR(31),            /* SAVE AREA FOR RETURN ADDR        03299302
*                                      TO PSI. USED BY SERVICE          03299402
*                                      MODULES WHEN CALLED BY PSI    */ 03299502
*    3 CIWWRK1  PTR(31),            /* FIRST  WORK AREA              */ 03349502
*    3 CIWWRK2  PTR(31),            /* SECOND WORK AREA              */ 03359502
*    3 CIWWRK3  PTR(31),            /* THIRD  WORK AREA              */ 03369502
*    3 CIWWRK4  PTR(31),            /* FOURTH WORK AREA              */ 03379502
*    3 CIWWRK5  PTR(31) CIWA9999    /* FIFTH  WORK AREA              */ 03389502
*        %CIWALEN = 'LENGTH(CIWA)'; /* OBTAIN LENGTH OF CIWA         */ 03399502
./ ADD NAME=IEAPMNIP,SSI=41900097
*%GOTO MNIPBSL ;                      /*                                00050001
         MACRO                                                          00100001
&NAME    IEAPMNIP  &TYPE=,&MSGST=,&MSGEND=,&RMSGST=,&RMSGL=,&MOD=,     X00150002
               &ASYNCH=,&PARAM=,&BUFREL=,&OPT=,&CPUID=,&ADDR=,  DSK0067X00200002
               &PLS=YES                                         DSK0067 00200010
         LCLC  &RPARM,&RNVT,&REXIT,&RENTRY                      DSK0067 00200020
         AIF   ('&PLS' EQ 'NO').PLS010                          DSK0067 00200030
&RPARM   SETC  'RPARM'                                          DSK0067 00200040
&RNVT    SETC  'RNVT'                                           DSK0067 00200050
&REXIT   SETC  'REXIT'                                          DSK0067 00200060
&RENTRY  SETC  'RENTRY'                                         DSK0067 00200070
         AGO   .PLS020                                          DSK0067 00200080
.PLS010  ANOP  .                                                DSK0067 00200090
&RPARM   SETC  'R1'                                             DSK0067 00200100
&RNVT    SETC  'R2'                                             DSK0067 00200110
&REXIT   SETC  'R14'                                            DSK0067 00200120
&RENTRY  SETC  'R15'                                            DSK0067 00200130
.PLS020  ANOP  .                                                DSK0067 00200140
         LCLC  &NB,&LB,&LC,&SX,&LM,&LI,&AU,&RS,&US                      00250002
.********************************************************************** 00400001
.*           06/27/74   VS2-3 VERSION                                   00450003
.*       INITIALIZE ALL FLAG-SETTING SWITCHES TO ZERO                   00500001
.*                                                                      00550001
.********************************************************************** 00600001
&NB      SETC  '0'                    OPEN - NON-NUCLEUS DEB            00650001
&LB      SETC  '0'                    OPEN - END OF NUCLEUS DEB         00700001
.*                                    MOUNT - UCB ADDRESS GIVEN         00750001
&LC      SETC  '0'                    OPEN,MOUNT - CONDITIONAL REQUEST  00800001
&SX      SETC  '0'                    OPEN - SINGLE EXTENT              00850001
&LM      SETC  '0'                    OPEN - SUPPRESS OPEN MSGS         00900001
&LI      SETC  '0'                    OPEN,MOUNT - DS NAME PTR GIVEN    01000001
&AU      SETC  '0'                    OPEN - AUTHORINZED LIBRARY        01050002
&RS      SETC  '0'                    OPEN - PERMANENTLY RESIDENT DS    01100002
&US      SETC  '0'                    MOUNT- UCB SCAN ONLY              01150002
         AIF   ('&TYPE' EQ 'PLIST').LISTMAC                             01200002
         AIF   ('&TYPE' EQ 'MOUNTPL').LISTMAC                           01250002
         AIF   ('&TYPE' EQ 'OPENPL').LISTMAC                            01300002
         AIF   ('&TYPE' EQ 'SCHEDL').LISTMAC                            01400002
&NAME    DC    0H'0'                                            DSK0067 01450002
         AGO   .EXMACRO                                                 01500002
.LISTMAC ANOP                                                           01550002
&NAME    DC    0F'0'                                            DSK0067 01600002
.EXMACRO ANOP                                                           01650002
         AIF   ('&TYPE' NE 'MOUNTPL').NOMPL                             05800002
.**************                                                         05850001
.*                                                                      05900001
.*        NIPMOUNT  PARAMETER  LIST                                     05950001
.*                                                                      06000001
.**************                                                         06050001
         AIF   ('&OPT' NE 'PTR').MNOPTR                                 06100001
         AIF   (K'&PARAM EQ 0).MNOPRM                                   06150001
         DC    A(&PARAM)              DATA SET NAME ADDRESS             06200001
         AGO   .MZER                                                    06250001
.MNOPRM  ANOP                                                           06300001
         DC    A(0)                   DATA SET NAME ADDRESS             06350001
.MZER    ANOP                                                           06400001
         DC    XL8'0000000000000000'  RESERVED                          06450001
         AGO   .MPTR                                                    06500001
.MNOPTR  ANOP                                                           06550001
         DC    CL12'&PARAM '          DATASET NAME                      06600001
.MPTR    ANOP                                                           06650001
         DC    CL6' '                 VOLUME SERIAL OR UCB ADDRESS      06700001
         DC    XL2'0000'              DEVICE TYPE                       06750001
         DC    X'00'                  NIPMOUNT FLAGS                    06800001
         DC    XL3'000000'            UNASSIGNED                        06850001
         AGO   .MACEND                                                  06900001
.NOMPL   AIF   ('&TYPE' NE 'OPENPL').NOOPL                              06950001
.**************                                                         07000001
.*                                                                      07050001
.*        NIPOPEN  PARAMETER  LIST                                      07100001
.*                                                                      07150001
.**************                                                         07200001
         AIF   ('&OPT' NE 'PTR').ONOPTR                                 07250001
         AIF   (K'&PARAM EQ 0).ONOPRM                                   07300001
         DC    A(&PARAM)              DATA SET NAME ADDRESS             07350001
         AGO   .OZER                                                    07400001
.ONOPRM  ANOP                                                           07450001
         DC    A(0)                   DATA SET NAME ADDRESS             07500001
.OZER    ANOP                                                           07550001
         DC    XL8'0000000000000000'  RESERVED                          07600001
         AGO   .OPTR                                                    07650001
.ONOPTR  ANOP                                                           07700001
         DC    CL12'&PARAM '          DATASET NAME                      07750001
.OPTR    ANOP                                                           07800001
         DC    A(0)                   DCB ADDRESS                       07850001
         DC    A(0)                   UCB ADDRESS                       07900001
         DC    X'00'                  NIPOPEN FLAGS                     07950001
         DC    X'00'                  NIPOPEN RETURN CODE               08000001
         DC    XL2'0000'              UNASSIGNED                        08050001
         AGO   .MACEND                                                  08100001
.NOOPL   AIF   ('&TYPE' NE 'MOUNT').NOMNT                               08150001
.**************                                                         08200001
.*                                                                      08250001
.*        LINKAGE TO  NIPMOUNT                                          08300001
.*                                                                      08350001
.**************                                                         08400001
         AIF   ('&OPT(1)' NE 'LB').MNOLB                                08650001
&LB      SETC  '1'                                                      08700001
.MNOLB   AIF   ('&OPT(2)' NE 'LC').MNOLC                                08750001
&LC      SETC  '1'                                                      08800001
.MNOLC   AIF   ('&OPT(3)' NE 'LI').MNOLI                                08850001
&LI      SETC  '1'                                                      08900001
.MNOLI   AIF   ('&OPT(4)' NE 'US').MNOUS                                08910002
&US      SETC  '1'                                                      08920002
.MNOUS   ANOP                                                           08950002
         LA    &RPARM,&PARAM       LOAD PARM LIST ADDRESS       DSK0067 09050001
         AIF   ('&PLS' EQ 'NO').PLS030                          DSK0067 09050010
         MVI   NMNTFL(&RPARM),B'0000&US&LI&LC&LB' SET FLAG BITS DSK0067 09100002
         AGO   .PLS040                                          DSK0067 09100010
.PLS030  ANOP  ,                                                DSK0067 09100020
         MVI   NMNTFL-NIPMNTPL(&RPARM),B'0000&US&LI&LC&LB'      DSK0067 09100030
.PLS040  ANOP  ,                                                DSK0067 09100040
         AGO   .ELOAD                                                   09160002
.NOMNT   AIF   ('&TYPE' NE 'OPEN').NOOPN                                09550001
.**************                                                         09600001
.*                                                                      09650001
.*        LINKAGE TO  NIPOPEN                                           09700001
.*                                                                      09750001
.**************                                                         09800001
         AIF   ('&OPT(1)' NE 'NB').NONB                                 10050001
&NB      SETC  '1'                                                      10100001
.NONB    AIF   ('&OPT(2)' NE 'LB').NOLB                                 10150001
&LB      SETC  '1'                                                      10200001
.NOLB    AIF   ('&OPT(3)' NE 'LC').NOLC                                 10250001
&LC      SETC  '1'                                                      10300001
.NOLC    AIF   ('&OPT(4)' NE 'SX').NOSX                                 10350001
&SX      SETC  '1'                                                      10400001
.NOSX    AIF   ('&OPT(5)' NE 'LM').NOLM                                 10450001
&LM      SETC  '1'                                                      10500001
.NOLM    AIF   ('&OPT(6)' NE 'LI').NOLI                                 10550001
&LI      SETC  '1'                                                      10600001
.NOLI    AIF   ('&OPT(7)' NE 'AU').NOAU                                 10610002
&AU      SETC  '1'                                                      10620002
.NOAU    AIF   ('&OPT(8)' NE 'RS').NORS                                 10630002
&RS      SETC  '1'                                                      10640002
.NORS    ANOP                                                           10650002
         LA    &RPARM,&PARAM       LOAD PARM LIST ADDRESS       DSK0067 10750001
         AIF   ('&PLS' EQ 'NO').PLS050                          DSK0067 10750010
         MVI   NOPNFL(&RPARM),B'&RS&AU&LM&LI&NB&LB&LC&SX'       DSK0067 10800002
         AGO   .PLS060                                          DSK0067 10800010
.PLS050  ANOP  ,                                                DSK0067 10800020
        MVI NOPNFL-NIPOPNPL(&RPARM),B'&RS&AU&LM&LI&NB&LB&LC&SX' DSK0067 10800030
.PLS060  ANOP  ,                                                DSK0067 10800040
         AGO   .ELOAD                                                   10810002
.NOOPN   AIF   ('&TYPE' NE 'HEADER').NOHEAD                             11250001
.**************                                                         11300001
.*                                                                      11350001
.*        NIPWTO  MESSAGE  HEADER                                       11400001
.*                                                                      11450001
.**************                                                         11500001
         DC    Y(&MSGEND-&MSGST)      MESSAGE LENGTH                    11550001
         AIF   ('&OPT(1)' NE 'NHC').NONHC                               11600001
         AIF   ('&OPT(2)' NE 'NBC').NONBC1                              11610001
         DC    X'C0'                  FLAG BYTE 1                       11620001
         AGO   .HEADB2                                                  11630001
.NONBC1  DC    X'80'                  FLAG BYTE 1                       11640001
         AGO   .HEADB2                                                  11642001
.NONHC   AIF ('&OPT(2)' NE 'NBC').NONBC2                                11644001
         DC    X'40'                 FLAG BYTE 1                        11646001
         AGO   .HEADB2                                                  11648001
.NONBC2  DC    X'00'                 FLAG BYTE 1                        11648401
.HEADB2  DC    X'00'                 FLAG BYTE 2                        11648801
         AGO   .MACEND                                                  11650001
.NOHEAD  AIF   ('&TYPE' NE 'PLIST').NOLIST                              11700001
.**************                                                         11750001
.*                                                                      11800001
.*        NIPWTOR  PARAMETER  LIST                                      11850001
.*                                                                      11900001
.**************                                                         11950001
         AIF   ('&RMSGST' EQ 'SQARBUF').ZERRPA                          12000001
         DC    A(&RMSGST)             REPLY AREA ADDRESS                12050001
         DC    A(0)                   REPLY ECB ADDRESS                 12100001
         DC    H'&RMSGL'              REPLY AREA LENGTH                 12150001
         AIF   ('&ASYNCH' EQ 'YES').ASYN1                               12200001
         DC    XL1'00'                NIP WTOR FLAGS                    12250001
         AGO   .PARM1                                                   12300001
.ASYN1   DC    XL1'80'                NIP WTOR FLAGS                    12350001
         AGO   .PARM1                                                   12400001
.ZERRPA  DC    A(0)                   REPLY AREA ADDRESS                12450001
         DC    A(0)                   REPLY ECB ADDRESS                 12500001
         DC    H'0'                   REPLY AREA LENGTH                 12550001
         AIF   ('&ASYNCH' EQ 'YES').ASYN2                               12600001
         DC    XL1'08'                NIP WTOR FLAGS                    12650001
         AGO   .PARM1                                                   12700001
.ASYN2   DC    XL1'88'                NIP WTOR FLAGS                    12750001
.PARM1   DC    XL1'00'                RESERVED                          12800001
         DC    A(&MSGST)              WTOR MESSAGE ADDRESS              12850001
         AGO   .MACEND                                                  12852002
.********************                                                   12860002
.*                                                                      12870002
.*            NIPSCHED PARAMETER LIST                                   12880002
.*                                                                      12890002
.**********************                                                 12892002
.NOLIST  AIF   ('&TYPE' NE 'SCHEDL').NOSCHDL                            12894002
         AIF   (K'&ADDR EQ 0).SCHDL1                                    12896002
         DC    A(&ADDR)                                                 12898002
         AGO   .SCHDL2                                                  12898402
.SCHDL1  DC    A(0)                                                     12898802
.SCHDL2  AIF   (K'&PARAM EQ 0).SCHDL3                                   12898902
         DC     A(&PARAM)                                               12899002
         AGO    .SCHDL4                                                 12899102
.SCHDL3  DC     A(0)                                                    12899302
.SCHDL4  DC     XL2'0000'                                               12899702
         AGO   .MACEND                                                  12900002
.********************                                                   12949602
.*                                                                      12949702
.*       LINKAGE FOR THE NIPSCHED  ROUTINE                              12949802
.*                                                                      12949902
.*********************                                                  12966602
.NOSCHDL AIF   ('&TYPE' NE 'SCHED').NOSCHED                             12976602
         LA    &RPARM,&PARAM                                    DSK0067 12978602
         MVC   8(2,&RPARM),0(&CPUID)                            DSK0067 12980602
         AIF   (K'&ADDR EQ 0).ELOAD                                     12982602
         ST    &ADDR,0(0,&RPARM)                                DSK0067 12983002
         AGO   .ELOAD                                                   12983102
.NOSCHED AIF   ('&TYPE' NE 'PRMPT').NOPRMPT                             12983202
.*******************************************                            12988802
.*                                                                      12990802
.*      LINKAGE FOR THE NIPPRMPT ROUTINE                                12992802
.*                                                                      12993202
.******************************************                             12993602
         LA    &RPARM,&PARAM       ADDR OF PARM FOR PROMPT      DSK0067 13018202
         AIF   ('&OPT' NE 'ERROR').PRMPT1                               13018602
         LCR   &RPARM,&RPARM       COMPLEMENT PARAM (ERROR)     DSK0067 13019002
.PRMPT1  AGO   .ELOAD                                                   13019402
.**************                                                         13032602
.*                                                                      13036102
.*        LINKAGE  FOR:  NIPSENSE, NIPSWAIT,NIPTIME,NIPUCBFN,           13050001
.*                       NIPWTO, NIPWTOR, NIPWTOR2                      13100001
.*                       NIPOPIO,NIPVIRT,NIPREAL,NIPPRMPT               13110002
.*                                                                      13150001
.**************                                                         13200001
.NOPRMPT AIF   ('&TYPE' EQ 'SENSE').PLOAD                               13250002
         AIF   ('&TYPE' EQ 'SWAIT').ELOAD                               13300001
         AIF   ('&TYPE' EQ 'OPIO').ELOAD                                13310002
         AIF   ('&TYPE' EQ 'VIRT').ELOAD                                13320002
         AIF   ('&TYPE' EQ 'REAL').ELOAD                                13330002
         AIF   ('&TYPE' NE 'TIME').NTIME                                13350001
         AIF   ('&PARAM' NE 'DEC').BTIME                                13400001
         SR    &RPARM,&RPARM       REQUEST DECIMAL TIME         DSK0067 13450001
         AGO   .ELOAD                                                   13500001
.BTIME   LA    &RPARM,4(0,0)       REQUEST BINARY TIME          DSK0067 13550002
         AGO   .ELOAD                                                   13600001
.NTIME   AIF   ('&TYPE' EQ 'UCBFN').PLOAD                               13650001
         AIF   ('&TYPE' EQ 'WTOR2').WTOR2                               13700001
         LA    &RPARM,&PARAM       LOAD PARM REGISTER           DSK0067 13750001
         AGO   .ELOAD                                                   13800001
.WTOR2   AIF   ('&BUFREL' NE 'YES').PLOAD                               13850001
         AIF   ('&PLS' EQ 'YES').PLS070                         DSK0067 13850010
         AIF   ('&PARAM' EQ 'RPARM').PLS080                     DSK0067 13850020
.PLS070  ANOP  ,                                                DSK0067 13850030
         LCR   &RPARM,&PARAM       INDICATE SQA RELEASE         DSK0067 13900001
         AGO   .PLS090                                          DSK0067 13900010
.PLS080  ANOP  ,                                                DSK0067 13900020
         LCR   &RPARM,&RPARM       INDICATE SQA RELEASE         DSK0067 13900030
.PLS090  ANOP  ,                                                DSK0067 13900040
         AGO   .ELOAD                                                   13950001
.PLOAD   AIF   ('&PARAM' EQ 'RPARM').ELOAD                              14000001
         LR    &RPARM,&PARAM       LOAD PARM REGISTER           DSK0067 14050001
.ELOAD   AIF   ('&MOD' EQ 'NIPM').ELOAD1                                14050402
         AIF   ('&PLS' EQ 'NO').PLS110                          DSK0067 14050790
         L     &RENTRY,NVT&TYPE.(0,&RNVT) LOAD BRANCH ADDRESS   DSK0067 14050802
         AGO   .PLS120                                          DSK0067 14050810
.PLS110  ANOP  .                                                DSK0067 14050820
         L     &RENTRY,NVT&TYPE-NVT(,&RNVT) ROUTINE ADDR        DSK0067 14050830
.PLS120  ANOP  .                                                DSK0067 14050840
         BALR  &REXIT,&RENTRY      CALL THE ROUTINE             DSK0067 14051202
         AGO   .MACEND                                                  14051602
.ELOAD1  ANOP                                                           14052002
         L     &RENTRY,NVT&TYPE    LOAD BRANCH ADDRESS          DSK0067 14100002
         BALR  &REXIT,&RENTRY      BRANCH TO ROUTINE            DSK0067 14150001
.MACEND  ANOP                                                           14200001
         MEND  ,                      */                                14250001
*%MNIPBSL: ;                                                            14300001
*        /***             NIPWTO  MESSAGE  HEADER                  ***/ 14350001
*        /* THE FOLLOWING STRUCTURE MAPS THE NIPWTO MESSAGE HEADER   */ 14360002
*        /* THAT IS GENERATED BY THE BAL MACRO -IEAPMNIP TYPE=HEADER-*/ 14370002
*        /* AND IS USED TO PASS INFORMATION TO THE NIPWTO SERVICE    */ 14380002
*        /* ROUTINE. THE MESSAGE LENGTH FIELD, NWTOLNG, INCLUDES THE */ 14390002
*        /* LENGTH OF THE MESSAGE HEADER ITSELF.                     */ 14392002
*        DECLARE 1 NWTOHDR BASED ,        /* MESSAGE HEADER START    */ 14400001
*                 2 NWTOLNG  FIXED(15),   /* MESSAGE LENGTH          */ 14450001
*                 2 NWTOFL   CHAR(2),     /* NIP MESSAGE FLAGS       */ 14500001
*                  3 NWTOFLNH  BIT(1),    /* NOT TO BE HARDCOPIED    */ 14550001
*                  3 NWTOFLNC  BIT(1),    /* SUPRESS BLANK COMPRESS  */ 14560001
*                  3 *         BIT(14);   /* RESERVED                */ 14600001
*        /***        END  OF  NIPWTO  MESSAGE  HEADER              ***/ 14650001
*                                                                       14700001
*        /***             NIPWTOR  PARAMETER  LIST                 ***/ 14750001
*        /* THE FOLLOWING STRUCTURE MAPS THE NIPWTOR PARAMETER LIST  */ 14760002
*        /* THAT IS GENERATED BY THE BAL MACRO -IEAPMNIP TYPE=PLIST- */ 14770002
*        /* AND IS USED TO PASS INFORMATION TO THE NIPWTOR SERVICE   */ 14780002
*        /* ROUTINE.                                                 */ 14790002
*        DECLARE 1 NWTORLST BASED,        /* PARM LIST START         */ 14800001
*                 2 NWTORRPA PTR(31),     /* REPLY AREA ADDRESS      */ 14850001
*                 2 NWTORECB PTR(31),     /* REPLY ECB ADDRESS       */ 14900001
*                 2 NMTORRDL FIXED(15),   /* REPLY AREA LENGTH       */ 14950001
*                 2 NWTORFL  CHAR(1),     /* NIP WTOR FLAGS          */ 15000001
*                  3 NWTORFLA BIT(1),     /* ASYNCHRONOUS REQUEST    */ 15050001
*                  3 *        BIT(3),     /* RESERVED                */ 15100001
*                  3 NWTORFLB BIT(1),     /* PROVIDE SQA BUFFER      */ 15150001
*                  3 *        BIT(3),     /* RESERVED                */ 15200001
*                 2   *      CHAR(1),     /* RESERVED                */ 15250001
*                 2 NWTORMSG PTR(31);     /* WTOR MESSAGE HEADER        15300002
*                                            ADDRESS.                */ 15310002
*        /***        END  OF  NIPWTOR  PARAMETER  LIST             ***/ 15350001
*                                                                       15400001
*        /***        NIP SYSTEM PARAMETER QUEUE ENTRY              ***/ 15450001
*        /* THE FOLLOWING STRUCTURE MAPS THE NIP SYSTEM PARAMETER    */ 15460002
*        /* ENTRY WHICH IS AN INTERNAL CONTROL BLOCK USED BY NIP TO  */ 15470002
*        /* TRACK SQA BUFFERS USED TO CONTAIN WTOR REPLIES.  THIS    */ 15480002
*        /* IS DONE SO THAT IEAVNIPX CAN FREE THESE AREAS AT THE END */ 15490002
*        /* OF NIP PROCESSING.  ONE SPE IS CONTAINED IN THE NVTSPE   */ 15494002
*        /* FIELD OF THE NVT. IF OTHERS ARE REQUIRED, THEY ARE       */ 15496002
*        /* OBTAINED DYNAMICALLY FROM SQA AND CHAINED TO THE ONE IN  */ 15498002
*        /* THE NVT.                                                 */ 15498402
*        DECLARE 1 NIPSPE BASED ,         /* NIPSPE START            */ 15500001
*                 2 NIPSPEQ PTR(31),      /* CHAIN PTR               */ 15550001
*                 2 NIPSPEA PTR(31);      /* PARAMETER PTR           */ 15600001
*        /***                  END OF NIPSPE                       ***/ 15650001
*                                                                       15700001
*        /***              NIPMOUNT PARAMETER LIST                 ***/ 15750001
*        /* THE FOLLOWING STRUCTURE MAPS THE NIPMOUNT PARAMETER LIST */ 15760002
*        /* THAT IS GENERATED BY THE BAL MACRO -IEAPMNIP TYPE=MOUNTPL*/ 15770002
*        /* AND IS USED TO PASS INFORMATION TO THE NIPMOUNT SERVICE  */ 15780002
*        /* ROUTINE.  THIS MAPPING MUST BE INCLUDED IN ANY MODULE    */ 15790002
*        /* THAT USES THE NIPMOUNT SERVICE, SINCE IT IS REFERRED TO  */ 15792002
*        /* BY THE NIPMOUNT BAL CALL MACRO, IEAPMNIP TYPE=MOUNT.     */ 15794002
*                                                                       15796002
*        DECLARE 1 NIPMNTPL BASED,        /* PARM LIST START         */ 15800001
*               2 NMNTDS CHAR(12),        /* DATASET NAME  OR        */ 15850002
*                3 NMNTDSA PTR(31) BDY(BYTE), /* DS NAME ADDRESS     */ 15900001
*               2 NMNTVS CHAR(6),         /* VOLUME SERIAL  OR       */ 15950002
*                3 NMNTUCB FIXED(31) BDY(BYTE), /* UCB ADDRESS       */ 16000001
*               2 NMNTDT CHAR(2),         /* DEVICE TYPE             */ 16050001
*               2 NMNTFL CHAR(1),         /* NIPMOUNT FLAGS          */ 16100001
*                3 *        BIT(4),       /* ** RESERVED **          */ 16150002
*                3 NMNTFUS  BIT(1),       /* UCB SCAN ONLY REQUEST   */ 16160002
*                3 NMNTFLI  BIT(1),       /* DS NAME ADDR GIVEN      */ 16200001
*                3 NMNTFLC  BIT(1),       /* CONDITIONAL REQUEST     */ 16250001
*                3 NMNTFLB  BIT(1),       /* UCB ADDRESS GIVEN       */ 16300001
*               2 *      CHAR(3);         /* ** RESERVED **          */ 16350001
*        /***            END OF NIPMOUNT PARAMETER LIST            ***/ 16400001
*                                                                       16450001
*        /***                NIPOPEN PARAMETER LIST                ***/ 16500001
*        /* THE FOLLOWING STRUCTURE MAPS THE NIPOPEN PARAMETER LIST  */ 16510002
*        /* THAT IS GENERATED BY THE BAL MACRO -IEAPMNIP TYPE=OPENPL-*/ 16520002
*        /* AND IS USED TO PASS INFORMATION TO THE NIPOPEN SERVICE   */ 16530002
*        /* ROUTINE.  THIS MAPPING MUST BE INCLUDED IN ANY MODULE    */ 16540002
*        /* THAT USES THE NIPOPEN SERVICE, SINCE IT IS REFERRED TO BY*/ 16542002
*        /* THE NIPOPEN BAL CALL MACRO, IEAPMNIP TYPE=OPEN.          */ 16544002
*                                                                       16546002
*        DECLARE 1 NIPOPNPL BASED,        /* PARM LIST START         */ 16550001
*                 2 NOPNDS CHAR(12),      /* DATASET NAME OR         */ 16600002
*                  3 NOPNDSA PTR(31) BDY(BYTE), /* DS NAME ADDRESS   */ 16650001
*                 2 NOPNDCB PTR(31),      /* DCB ADDRESS             */ 16700001
*                 2 NOPNUCB PTR(32),      /* UCB ADDRESS     @Z30AAXC*/ 16750003
*                 2 NOPNFL CHAR(1),       /* NIPOPEN FLAGS           */ 16800001
*                  3 NOPNFRS  BIT(1),     /* PERMANENTLY RESIDENT DS */ 16850002
*                  3 NOPNFAU  BIT(1),     /* AUTHORIZED LIBRARY FLAG */ 16860002
*                  3 NOPNFLM  BIT(1),     /* SUPRESS DS NOT FOUND MSG*/ 16900001
*                  3 NOPNFLI  BIT(1),     /* DS NAME ADDR GIVEN      */ 16950001
*                  3 NOPNFLNB BIT(1),     /* INITIALIZE BASIC DEB    */ 17000002
*                  3 NOPNFLLB BIT(1),     /* END OF NUCLEUS DEB      */ 17050001
*                  3 NOPNFLLC BIT(1),     /* CONDITIONAL REQUEST     */ 17100001
*                  3 NOPNFLSX BIT(1),     /* FIRST EXTENT ONLY       */ 17150001
*                 2 NOPNRC   CHAR(1),     /* NIPOPEN RETURN CODE     */ 17200001
*                 2 *        CHAR(2);     /* ** RESERVED **          */ 17250001
*        /***           END OF NIPOPEN PARAMETER LIST              ***/ 17300001
*                                                                       17310002
*       /***     NIPSCHED    PARAMETER   LIST               *****/      17350002
*        /* THE FOLLOWING STRUCTURE MAPS THE NIPSCHED PARAMETER LIST */ 17360002
*        /* THAT IS GENERATED BY THE BAL MACRO -IEAPMNIP TYPE=SCHEDL-*/ 17370002
*        /* AND IS USED TO PASS INFORMATION TO THE NIPSCHED SERVICE  */ 17380002
*        /* ROUTINE.                                                 */ 17390002
*                                                                       17392002
*        DECLARE 1 NIPSCHDL BASED,                                      17400002
*                  2 NSCHDPTR PTR(31),  /*ADDRESS OF ROUTINE TO SCHED*/ 17450002
*                  2 NSCHDPRM PTR(31),  /* ADDRESS OF CALLERS AREA   */ 17460002
*                  2 NSCHDCPU CHAR(2);  /* CPU ADDRESS FOR SCHEDULE  */ 17500002
*      /*****  END OF NIPSCHED  PARAMETER  LIST             ********/   17550002
./ ADD NAME=IEAPPNIP
         MACRO                                                          00000100
         IEAPPNIP &WTOHDR=NO,&WTORLST=NO,&SPE=NO,&MNTPL=NO,&OPNPL=NO,  X00000200
               &SCHDL=NO,&PAHDR=NO,&PAREA=NO,&PARMTAB=NO,&PTE=NO        00000300
*/********************************************************************/ 00000400
*/*                                                                  */ 00000500
*/*                                                                  */ 00000600
*/*                                                                  */ 00000700
*/********************************************************************/ 00000800
*/*      %INCLUDE SYSLIB(IEAPMNIP)                                   */ 00000900
*                                                                  0128 00001000
         AIF   ('&WTOHDR' EQ 'NO').SKIPIT1                              00001100
*   /*****************************************************************/ 00001200
*   /*                                                               */ 00001300
*   /* ** NIPWTO MESSAGE HEADER THE FOLLOWING STRUCTURE MAPS THE     */ 00001400
*   /* NIPWTO MESSAGE HEADER THAT IS GENERATED BY THE BAL MACRO      */ 00001500
*   /* -IEAPMNIP TYPE=HEADER- AND IS USED TO PASS INFORMATION TO THE */ 00001600
*   /* NIPWTO SERVICE ROUTINE. THE MESSAGE LENGTH FIELD, NWTOLNG,    */ 00001700
*   /* INCLUDES THE LENGTH OF THE MESSAGE HEADER ITSELF.             */ 00001800
*   /*                                                               */ 00001900
*   /*****************************************************************/ 00002000
*                                                                  0128 00002100
*   DECLARE                                                        0128 00002200
*     1 NWTOHDR BASED,              /* MESSAGE HEADER START          */ 00002300
NWTOHDR  DSECT                                                          00002400
*      2 NWTOLNG FIXED(15),         /* MESSAGE LENGTH                */ 00002500
NWTOLNG  DS    Y                                                        00002600
*      2 NWTOFL CHAR(2),            /* NIP MESSAGE FLAGS             */ 00002700
NWTOFL   DS    X                                                        00002800
*       3 NWTOFLNH BIT(1),          /* NOT TO BE HARDCOPIED          */ 00002900
NWTOFLNH EQU   X'80'                                                    00003000
*       3 NWTOFLNC BIT(1),          /* SUPRESS BLANK COMPRESS        */ 00003100
NWTOFLNC EQU   X'40'                                                    00003200
*       3 * BIT(14);                /* RESERVED                      */ 00003300
.SKIPIT1 ANOP  ,                                                        00003400
         AIF   ('&WTORLST' EQ 'NO').SKIPIT2                             00003500
*                                                                  0128 00003600
*   /*****************************************************************/ 00003700
*   /*                                                               */ 00003800
*   /* ** END OF NIPWTO MESSAGE HEADER ** NIPWTOR PARAMETER LIST THE */ 00003900
*   /* FOLLOWING STRUCTURE MAPS THE NIPWTOR PARAMETER LIST THAT IS   */ 00004000
*   /* GENERATED BY THE BAL MACRO -IEAPMNIP TYPE=PLIST- AND IS USED  */ 00004100
*   /* TO PASS INFORMATION TO THE NIPWTOR SERVICE ROUTINE.           */ 00004200
*   /*                                                               */ 00004300
*   /*****************************************************************/ 00004400
*                                                                  0129 00004500
*   DECLARE                                                        0129 00004600
*     1 NWTORLST BASED,             /* PARM LIST START               */ 00004700
NWTORLST DSECT                                                          00004800
*      2 NWTORRPA PTR(31),          /* REPLY AREA ADDRESS            */ 00004900
NWTORRPA DS    F                                                        00005000
*      2 NWTORECB PTR(31),          /* REPLY ECB ADDRESS             */ 00005100
NWTORECB DS    F                                                        00005200
*      2 NMTORRDL FIXED(15),        /* REPLY AREA LENGTH             */ 00005300
NMTORRDL DS    H                                                        00005400
*      2 NWTORFL CHAR(1),           /* NIP WTOR FLAGS                */ 00005500
NWTORFL  DS    X                                                        00005600
*       3 NWTORFLA BIT(1),          /* ASYNCHRONOUS REQUEST          */ 00005700
NWTORFLA EQU   X'80'                                                    00005800
*       3 * BIT(3),                 /* RESERVED                      */ 00005900
*       3 NWTORFLB BIT(1),          /* PROVIDE SQA BUFFER            */ 00006000
NWTORFLB EQU   X'08'                                                    00006100
*       3 * BIT(3),                 /* RESERVED                      */ 00006200
*      2 * CHAR(1),                 /* RESERVED                      */ 00006300
         DS    X                                                        00006400
*      2 NWTORMSG PTR(31);          /* WTOR MESSAGE HEADER ADDRESS.  */ 00006500
NWTORMSG DS    H                                                        00006600
.SKIPIT2 ANOP  ,                                                        00006700
         AIF   ('&SPE' EQ 'NO').SKIPIT3                                 00006800
*                                                                  0129 00006900
*   /*****************************************************************/ 00007000
*   /*                                                               */ 00007100
*   /* ** END OF NIPWTOR PARAMETER LIST ** NIP SYSTEM PARAMETER QUEUE*/ 00007200
*   /* ENTRY THE FOLLOWING STRUCTURE MAPS THE NIP SYSTEM PARAMETER   */ 00007300
*   /* ENTRY WHICH IS AN INTERNAL CONTROL BLOCK USED BY NIP TO TRACK */ 00007400
*   /* SQA BUFFERS USED TO CONTAIN WTOR REPLIES. THIS IS DONE SO THAT*/ 00007500
*   /* IEAVNIPX CAN FREE THESE AREAS AT THE END OF NIP PROCESSING.   */ 00007600
*   /* ONE SPE IS CONTAINED IN THE NVTSPE FIELD OF THE NVT. IF OTHERS*/ 00007700
*   /* ARE REQUIRED, THEY ARE OBTAINED DYNAMICALLY FROM SQA AND      */ 00007800
*   /* CHAINED TO THE ONE IN THE NVT.                                */ 00007900
*   /*                                                               */ 00008000
*   /*****************************************************************/ 00008100
*                                                                  0130 00008200
*   DECLARE                                                        0130 00008300
*     1 NIPSPE BASED,               /* NIPSPE START                  */ 00008400
NIPSPE   DSECT                                                          00008500
*      2 NIPSPEQ PTR(31),           /* CHAIN PTR                     */ 00008600
NIPSPEQ  DS    F                                                        00008700
*      2 NIPSPEA PTR(31);           /* PARAMETER PTR                 */ 00008800
NIPSPEA  DS    F                                                        00008900
.SKIPIT3 ANOP  ,                                                        00009000
         AIF   ('&MNTPL' EQ 'NO').SKIPIT4                               00009100
*                                                                  0130 00009200
*   /*****************************************************************/ 00009300
*   /*                                                               */ 00009400
*   /* ** END OF NIPSPE ** NIPMOUNT PARAMETER LIST THE FOLLOWING     */ 00009500
*   /* STRUCTURE MAPS THE NIPMOUNT PARAMETER LIST THAT IS GENERATED  */ 00009600
*   /* BY THE BAL MACRO -IEAPMNIP TYPE=MOUNTPL AND IS USED TO PASS   */ 00009700
*   /* INFORMATION TO THE NIPMOUNT SERVICE ROUTINE. THIS MAPPING MUST*/ 00009800
*   /* BE INCLUDED IN ANY MODULE THAT USES THE NIPMOUNT SERVICE,     */ 00009900
*   /* SINCE IT IS REFERRED TO BY THE NIPMOUNT BAL CALL MACRO,       */ 00010000
*   /* IEAPMNIP TYPE=MOUNT.                                          */ 00010100
*   /*                                                               */ 00010200
*   /*****************************************************************/ 00010300
*                                                                  0131 00010400
*   DECLARE                                                        0131 00010500
*     1 NIPMNTPL BASED,             /* PARM LIST START               */ 00010600
NIPMNTPL DSECT                                                          00010700
*      2 NMNTDS CHAR(12),           /* DATASET NAME OR               */ 00010800
NMNTDSA  DS    0A                                                       00010900
NMNTDS   DS    CL12                                                     00011000
*       3 NMNTDSA PTR(31) BDY(BYTE),/* DS NAME ADDRESS               */ 00011100
*      2 NMNTVS CHAR(6),            /* VOLUME SERIAL OR              */ 00011200
NMNTUCB  DS    0A                                                       00011300
NMNTVS   DS    CL6                                                      00011400
*       3 NMNTUCB FIXED(31) BDY(BYTE),/* UCB ADDRESS                 */ 00011500
*      2 NMNTDT CHAR(2),            /* DEVICE TYPE                   */ 00011600
NMNTDT   DS    XL2                                                      00011700
*      2 NMNTFL CHAR(1),            /* NIPMOUNT FLAGS                */ 00011800
NMNTFL   DS    X                                                        00011900
*       3 * BIT(4),                 /* ** RESERVED **                */ 00012000
*       3 NMNTFUS BIT(1),           /* UCB SCAN ONLY REQUEST         */ 00012100
NMNTFUS  EQU   X'08'                                                    00012200
*       3 NMNTFLI BIT(1),           /* DS NAME ADDR GIVEN            */ 00012300
NMNTFLI  EQU   X'04'                                                    00012400
*       3 NMNTFLC BIT(1),           /* CONDITIONAL REQUEST           */ 00012500
NMNTFLC  EQU   X'02'                                                    00012600
*       3 NMNTFLB BIT(1),           /* UCB ADDRESS GIVEN             */ 00012700
NMNTFLB  EQU   X'01'                                                    00012800
*      2 * CHAR(3);                 /* ** RESERVED **                */ 00012900
         DS    XL3                                                      00013000
.SKIPIT4 ANOP  ,                                                        00013100
         AIF   ('&OPNPL' EQ 'NO').SKIPIT5                               00013200
*                                                                  0131 00013300
*   /*****************************************************************/ 00013400
*   /*                                                               */ 00013500
*   /* ** END OF NIPMOUNT PARAMETER LIST ** NIPOPEN PARAMETER LIST   */ 00013600
*   /* THE FOLLOWING STRUCTURE MAPS THE NIPOPEN PARAMETER LIST THAT  */ 00013700
*   /* IS GENERATED BY THE BAL MACRO -IEAPMNIP TYPE=OPENPL- AND IS   */ 00013800
*   /* USED TO PASS INFORMATION TO THE NIPOPEN SERVICE ROUTINE. THIS */ 00013900
*   /* MAPPING MUST BE INCLUDED IN ANY MODULE THAT USES THE NIPOPEN  */ 00014000
*   /* SERVICE, SINCE IT IS REFERRED TO BY THE NIPOPEN BAL CALL      */ 00014100
*   /* MACRO, IEAPMNIP TYPE=OPEN.                                    */ 00014200
*   /*                                                               */ 00014300
*   /*****************************************************************/ 00014400
*                                                                  0132 00014500
*   DECLARE                                                        0132 00014600
*     1 NIPOPNPL BASED,             /* PARM LIST START               */ 00014700
NIPOPNPL DSECT                                                          00014800
*      2 NOPNDS CHAR(12),           /* DATASET NAME OR               */ 00014900
NOPNDSA  DS    0A                                                       00015000
NOPNDS   DS    CL12                                                     00015100
*       3 NOPNDSA PTR(31) BDY(BYTE),/* DS NAME ADDRESS               */ 00015200
*      2 NOPNDCB PTR(31),           /* DCB ADDRESS                   */ 00015300
NOPNDCB  DS    A                                                        00015400
*      2 NOPNUCB PTR(32),           /* UCB ADDRESS           @Z30AAXC*/ 00015500
NOPNUCB  DS    A                                                        00015600
*      2 NOPNFL CHAR(1),            /* NIPOPEN FLAGS                 */ 00015700
NOPNFL   DS    X                                                        00015800
*       3 NOPNFRS BIT(1),           /* PERMANENTLY RESIDENT DS       */ 00015900
NOPNFRS  EQU   X'80'                                                    00016000
*       3 NOPNFAU BIT(1),           /* AUTHORIZED LIBRARY FLAG       */ 00016100
NOPNFAU  EQU   X'40'                                                    00016200
*       3 NOPNFLM BIT(1),           /* SUPRESS DS NOT FOUND MSG      */ 00016300
NOPNFLM  EQU   X'20'                                                    00016400
*       3 NOPNFLI BIT(1),           /* DS NAME ADDR GIVEN            */ 00016500
NOPNFLI  EQU   X'10'                                                    00016600
*       3 NOPNFLNB BIT(1),          /* INITIALIZE BASIC DEB          */ 00016700
NOPNFLNB EQU   X'08'                                                    00016800
*       3 NOPNFLLB BIT(1),          /* END OF NUCLEUS DEB            */ 00016900
NOPNFLLB EQU   X'04'                                                    00017000
*       3 NOPNFLLC BIT(1),          /* CONDITIONAL REQUEST           */ 00017100
NOPNFLLC EQU   X'02'                                                    00017200
*       3 NOPNFLSX BIT(1),          /* FIRST EXTENT ONLY             */ 00017300
NOPNFLSX EQU   X'01'                                                    00017400
*      2 NOPNRC CHAR(1),            /* NIPOPEN RETURN CODE           */ 00017500
NOPNRC   DS    X                                                        00017600
*      2 * CHAR(2);                 /* ** RESERVED **                */ 00017700
         DS    XL2                                                      00017800
.SKIPIT5 ANOP  ,                                                        00017900
         AIF   ('&SCHDL' EQ 'NO').SKIPIT6                               00018000
*                                                                  0132 00018100
*   /*****************************************************************/ 00018200
*   /*                                                               */ 00018300
*   /* ** END OF NIPOPEN PARAMETER LIST ** NIPSCHED PARAMETER LIST   */ 00018400
*   /* THE FOLLOWING STRUCTURE MAPS THE NIPSCHED PARAMETER LIST THAT */ 00018500
*   /* IS GENERATED BY THE BAL MACRO -IEAPMNIP TYPE=SCHEDL- AND IS   */ 00018600
*   /* USED TO PASS INFORMATION TO THE NIPSCHED SERVICE ROUTINE.     */ 00018700
*   /*                                                               */ 00018800
*   /*****************************************************************/ 00018900
*                                                                  0133 00019000
*   DECLARE                                                        0133 00019100
*     1 NIPSCHDL BASED,                                            0133 00019200
NIPSCHDL DSECT                                                          00019300
*      2 NSCHDPTR PTR(31),          /* ADDRESS OF ROUTINE TO SCHED   */ 00019400
NSCHDPTR DS    A                                                        00019500
*      2 NSCHDPRM PTR(31),          /* ADDRESS OF CALLERS AREA       */ 00019600
NSCHDPRM DS    A                                                        00019700
*      2 NSCHDCPU CHAR(2);          /* CPU ADDRESS FOR SCHEDULE      */ 00019800
NSCHDCPU DS    XL2                                                      00019900
*                                                                  0133 00020000
*   /*****************************************************************/ 00020100
*   /*                                                               */ 00020200
*   /* **** END OF NIPSCHED PARAMETER LIST                           */ 00020300
*   /*                                                               */ 00020400
*   /*****************************************************************/ 00020500
*                                                                  0134 00020600
.SKIPIT6 ANOP  ,                                                        00020700
         AIF   ('&PAHDR' EQ 'NO').SKIPIT7                               00020800
*                                                                  0134 00020900
*/********************************************************************/ 00021000
*/*                                                                  */ 00021100
*/*      INCLUDE NIP PARAMETER AREA AND PARAMETER TABLE DSECTS       */ 00021200
*/*                                                                  */ 00021300
*/********************************************************************/ 00021400
*/*      %INCLUDE SYSLIB(IEAPPNIP)                                   */ 00021500
*/*  *****************************************************************/ 00021600
*/*                          I E A P P N I P                         */ 00021700
*/*     MAPPING OF NIP PARAMETER AREA AND PARAMETER ADDRESS TABLE    */ 00021800
*/*                                                                  */ 00021900
*/*                     DATE=05/22/74,VS2-3 VERSION                  */ 00022000
*/*                                                                  */ 00022100
*/*  *****************************************************************/ 00022200
*/*  *****          NIP  PARAMETER  AREA  (NIPPAREA)            ******/ 00022300
*/*   PARAMETER AREA HEADER                                          */ 00022400
*                                                                  0134 00022500
*   DECLARE                                                        0134 00022600
*     1 NIPPAHDR CHAR(8) BDY(DWORD) BASED,                         0134 00022700
NIPPAHDR DSECT                                                          00022800
*      2 NIPPAQ PTR(31),            /* CHAIN PTR TO NEXT ON QUEUE    */ 00022900
NIPPAQ   DS    A                                                        00023000
*      2 NIPPABYT PTR(31);          /* PTR - NEXT AVAIL. BYTE        */ 00023100
NIPPABYT DS    A                                                        00023200
.SKIPIT7 ANOP  ,                                                        00023300
         AIF   ('&PAREA' EQ 'NO').SKIPIT8                               00023400
*                                                                  0135 00023500
*/*   PARAMETER AREA                                                 */ 00023600
*                                                                  0135 00023700
*   DECLARE                                                        0135 00023800
*     1 NIPPAREA BDY(DWORD) BASED,  /* PARAMETER AREA BEGINNING      */ 00023900
NIPPAREA DSECT                                                          00024000
*      2 * CHAR(LENGTH(NIPPAHDR)),  /* PARMAREA HEADER               */ 00024100
         DS    2A                                                       00024200
*                                                                  0135 00024300
*     /***************************************************************/ 00024400
*     /*                                                             */ 00024500
*     /* HERE BEGINS: FOR INITIAL PARMAREA - INITIAL FIELDS FOR OTHER*/ 00024600
*     /* PARMAREAS - RECORD BUFFER AREA                              */ 00024700
*     /*                                                             */ 00024800
*     /***************************************************************/ 00024900
*                                                                  0135 00025000
*      2 NIPPARC FIXED(31),         /* RETURN CODE FROM IEAPSPIO     */ 00025100
NIPPARC  DS    A                                                        00025200
*      2 NIPPABDL CHAR(18),         /* PARMLIB BLDL ENTRY            */ 00025300
NIPPABDL DS    0XL18                                                    00025400
*       3 NIPPABDH CHAR(4),         /* BLDL HEADER                   */ 00025500
NIPPABDH DS    0XL4                                                     00025600
*        4 NIPPA2BF CHAR(1),        /* BEGINNING OF BUFFER AREA      */ 00025700
NIPPA2BF DS    X                                                        00025800
         DS    XL3                                                      00025900
*       3 NIPPANAM CHAR(8),         /* PARMLIB MEMBER NAME           */ 00026000
NIPPANAM DS    CL8                                                      00026100
*       3 NIPPATTR CHAR(3),         /* MEMBER TTR ENTRY              */ 00026200
NIPPATTR DS    XL3                                                      00026300
*       3 * CHAR(3),                /* * RESERVED FOR BLDL ENTRY *   */ 00026400
         DS    XL3                                                      00026500
*      2 * CHAR(2),                 /* UNASSIGNED                    */ 00026600
         DS    XL2                                                      00026700
*      2 NIPPAIOD CHAR(216) BDY(DWORD),/* I/O DATA AREA              */ 00026800
NIPPAIOD DS    0XL216                                                   00026900
*       3 NIPPATXT CHAR(32),        /* CCW'S - READ TEXT RECORDS     */ 00027000
NIPPATXT DS    XL32                                                     00027100
*       3 NIPPASID CHAR(5),         /* SEARCH ID FOR NEXT TEXT RCD   */ 00027200
NIPPASID DS    XL5                                                      00027300
*       3 * CHAR(3),                /* ** UNASSIGNED **              */ 00027400
         DS    XL3                                                      00027500
*       3 NIPPAIOB CHAR(40),        /* PARMLIB IOB                   */ 00027600
NIPPAIOB DS    XL40                                                     00027700
*       3 NIPPADCB CHAR(4),         /* PARMLIB DCB                   */ 00027800
NIPPADCB DS    A                                                        00027900
*       3 NIPPAECB CHAR(4),         /* PARMLIB ECB                   */ 00028000
NIPPAECB DS    0F                                                       00028100
*        4 NIPPAECC CHAR(1),        /* - PARMLIB ECB CONDITION CODE  */ 00028200
NIPPAECC DS    X                                                        00028300
*        4 * CHAR(3),               /* - REST OF PARMLIB ECB         */ 00028400
         DS    XL3                                                      00028500
*       3 NIPPADEB CHAR(48),        /* PARMLIB DEB                   */ 00028600
NIPPADEB DS    XL48                                                     00028700
*       3 NIPPARCD CHAR(80),        /* READ AREA FOR PARMLIB RCDS    */ 00028800
NIPPARCD DS    XL80                                                     00028900
*      2 * CHAR(4),                 /* UNASSIGNED                    */ 00029000
         DS    XL4                                                      00029100
*      2 NIPPAPTB CHAR(296),        /* PARAMETER ADDR TABLE          */ 00029200
NIPPAPTB DS    XL320                PARMTABF - PARAMETER ADDR TABLE     00029300
*      2 NIPPABUF CHAR(1);          /* BEGIN INITIAL PARMAREA BUFFER */ 00029400
NIPPABUF DS    X                                                        00029500
*/*  *****             END  OF  NIP  PARAMETER  AREA            ******/ 00029600
*/*  *****             NIP  PARAMETER  ADDRESS  TABLE           ******/ 00029700
.SKIPIT8 ANOP  ,                                                        00029800
         AIF   ('&PARMTAB' EQ 'NO').SKIPIT9                             00029900
*                                                                  0136 00030000
*/*   PARAMETER ADDRESS TABLE -                                      */ 00030100
*                                                                  0136 00030200
*   DECLARE                                                        0136 00030300
*     1 PARMTAB BASED,              /* BEGIN PARAMETER ADDRESS TAB   */ 00030400
PARMTABF DSECT                                                          00030500
*      2 PTABSTRT CHAR(8),          /* DUMMY HEADER                  */ 00030600
PTABSTRT DS    CL8                                                      00030700
*      2 APF PTR(31),               /* AUTHORIZED PROG. LIBRARIES    */ 00030800
APF      DS    A                                                        00030900
*      2 * CHAR(4),                 /* FLAGS AND SOURCE ID           */ 00031000
         DS    XL4                                                      00031100
*      2 APG PTR(31),               /* AUTO. PRIORITY GROUP          */ 00031200
APG      DS    A                                                        00031300
*      2 * CHAR(4),                 /* FLAGS AND SOURCE ID           */ 00031400
         DS    XL4                                                      00031500
*      2 BLDL PTR(31),              /* PARMLIB MEMBER FOR BLDL       */ 00031600
BLDL     DS    A                                                        00031700
*      2 * CHAR(4),                 /* FLAGS AND SOURCE ID           */ 00031800
         DS    XL4                                                      00031900
*      2 BLDLF PTR(31),             /* FIXED BLDL LIST               */ 00032000
BLDLF    DS    A                                                        00032100
*      2 * CHAR(4),                 /* FLAGS AND SOURCE ID           */ 00032200
         DS    XL4                                                      00032300
*      2 CLPA PTR(31),              /* CREATE LINK PACK AREA         */ 00032400
CLPA     DS    A                                                        00032500
*      2 * CHAR(4),                 /* FLAGS AND SOURCE ID           */ 00032600
         DS    XL4                                                      00032700
*      2 CMD PTR(31),               /* CANNED OPERATOR COMMANDS      */ 00032800
CMD      DS    A                                                        00032900
*      2 * CHAR(4),                 /* FLAGS AND SOURCE ID           */ 00033000
         DS    XL4                                                      00033100
*      2 CONT PTR(31),              /* LINE CONTINUATION             */ 00033200
CONT     DS    A                                                        00033300
*      2 * CHAR(4),                 /* FLAGS AND SOURCE ID           */ 00033400
         DS    XL4                                                      00033500
*      2 CPQE PTR(31),              /* CHANNEL PROG QUEUE EXTENSION  */ 00033600
CPQE     DS    A                                                        00033700
*      2 * CHAR(4),                 /* FLAGS AND SOURCE ID           */ 00033800
         DS    XL4                                                      00033900
*      2 CSA PTR(31),               /* COMMON SERVICE AREA SIZE      */ 00034000
CSA      DS    A                                                        00034100
*      2 * CHAR(4),                 /* FLAGS AND SOURCE ID           */ 00034200
         DS    XL4                                                      00034300
*      2 CVIO PTR(31),              /* WARM START VAM DATA SETS      */ 00034400
CVIO     DS    A                                                        00034500
*      2 * CHAR(4),                 /* FLAGS AND SOURCE ID           */ 00034600
         DS    XL4                                                      00034700
*      2 DUMP PTR(31),              /* TAPE FOR SYS1.DUMP            */ 00034800
DUMP     DS    A                                                        00034900
*      2 * CHAR(4),                 /* FLAGS AND SOURCE ID           */ 00035000
         DS    XL4                                                      00035100
*      2 FIX PTR(31),               /* ROUTINES IN FIXED LPA EXTN    */ 00035200
FIX      DS    A                                                        00035300
*      2 * CHAR(4),                 /* FLAGS AND SOURCE ID           */ 00035400
         DS    XL4                                                      00035500
*      2 HARDCPY PTR(31),           /* HARDCOPY LOG                  */ 00035600
HARDCPY  DS    A                                                        00035700
*      2 * CHAR(4),                 /* FLAGS AND SOURCE ID           */ 00035800
         DS    XL4                                                      00035900
*      2 IPS PTR(31),               /* OPTIMIZER IPS GROUP           */ 00036000
IPS      DS    A                                                        00036100
*      2 * CHAR(4),                 /* FLAGS AND SOURCE ID           */ 00036200
         DS    XL4                                                      00036300
*      2 LNK PTR(31),               /* LNKLSTXX VALUES               */ 00036400
LNK      DS    A                                                        00036500
*      2 * CHAR(4),                 /* FLAGS AND SOURCE ID           */ 00036600
         DS    XL4                                                      00036700
*      2 LOGCLS PTR(31),            /* LOG CLASS VALUES              */ 00036800
LOGCLS   DS    A                                                        00036900
*      2 * CHAR(4),                 /* FLAGS AND SOURCE ID           */ 00037000
         DS    XL4                                                      00037100
*      2 LOGLMT PTR(31),            /* LOG LIMIT VALUES              */ 00037200
LOGLMT   DS    A                                                        00037300
*      2 * CHAR(4),                 /* FLAGS AND SOURCE ID           */ 00037400
         DS    XL4                                                      00037500
*      2 MAXUSER PTR(31),           /* MAXIMUM NO. OF ADDRESS SPACES */ 00037600
MAXUSER  DS    A                                                        00037700
*      2 * CHAR(4),                 /* FLAGS AND SOURCE ID           */ 00037800
         DS    XL4                                                      00037900
*      2 MLPA PTR(31),              /* ROUTINES IN LPA EXTENSION     */ 00038000
MLPA     DS    A                                                        00038100
*      2 * CHAR(4),                 /* FLAGS AND SOURCE ID           */ 00038200
         DS    XL4                                                      00038300
*      2 NUCMAP PTR(31),            /* BUILD ANOTHER NUCMAP FOR DSS  */ 00038400
NUCMAP   DS    A                                                        00038500
*      2 * CHAR(4),                 /* FLAGS AND SOURCE ID           */ 00038600
         DS    XL4                                                      00038700
*      2 OPI PTR(31),               /* OPERATOR INTERVENTION         */ 00038800
OPI      DS    A                                                        00038900
*      2 * CHAR(4),                 /* FLAGS AND SOURCE ID           */ 00039000
         DS    XL4                                                      00039100
*      2 OPT PTR(31),               /* OPTIMIZER TUNING PARAMETERS   */ 00039200
OPT      DS    A                                                        00039300
*      2 * CHAR(4),                 /* FLAGS AND SOURCE ID           */ 00039400
         DS    XL4                                                      00039500
*      2 PAGEP PTR(31),             /* PAGE DS PARMS - PARMLIB       */ 00039600
PAGEP    DS    A                                                        00039700
*      2 * CHAR(4),                 /* FLAGS AND SOURCE ID           */ 00039800
         DS    XL4                                                      00039900
*      2 PAGEO PTR(31),             /* PAGE DS PARMS - OPERATOR      */ 00040000
PAGEO    DS    A                                                        00040100
*      2 * CHAR(4),                 /* FLAGS AND SOURCE ID           */ 00040200
         DS    XL4                                                      00040300
*      2 REAL PTR(31),              /* V=R ADDRESS LIMIT             */ 00040400
NREAL    DS    A                                                        00040500
*      2 * CHAR(4),                 /* FLAGS AND SOURCE ID           */ 00040600
         DS    XL4                                                      00040700
*      2 SMF PTR(31),               /* PTR TO SMF PARMLIB MEMBER     */ 00040800
SMF      DS    A                                                        00040900
*      2 * CHAR(4),                 /* FLAGS AND SOURCE ID           */ 00041000
         DS    XL4                                                      00041100
*      2 SQA PTR(31),               /* SQA VIRTUAL SPACE             */ 00041200
SQA      DS    A                                                        00041300
*      2 * CHAR(4),                 /* FLAGS AND SOURCE ID           */ 00041400
         DS    XL4                                                      00041500
*      2 SYSP PTR(31),              /* SYSTEM PARAMETER LIST         */ 00041600
SYSP     DS    A                                                        00041700
*      2 * CHAR(4),                 /* FLAGS AND SOURCE ID           */ 00041800
         DS    XL4                                                      00041900
*      2 VAL PTR(31),               /* VOLUME ATTRIBUTE PROCESSING   */ 00042000
VAL      DS    A                                                        00042100
*      2 * CHAR(4),                 /* FLAGS AND SOURCE ID           */ 00042200
         DS    XL4                                                      00042300
*      2 VRREGN PTR(31),            /* DEFAULT V=R SPACE ALLOCATED   */ 00042400
VRREGN   DS    A                                                        00042500
*      2 * CHAR(4),                 /* FLAGS AND SOURCE ID           */ 00042600
         DS    XL4                                                      00042700
*      2 WTOBFRS PTR(31),           /* NUMBER OF WTO BUFFERS         */ 00042800
WTOBFRS  DS    A                                                        00042900
*      2 * CHAR(4),                 /* FLAGS AND SOURCE ID           */ 00043000
         DS    XL4                                                      00043100
*      2 WTORPLY PTR(31),           /* WTOR REPLY BUFFER NUMBER      */ 00043200
WTORPLY  DS    A                                                        00043300
*      2 * CHAR(4),                 /* FLAGS AND SOURCE ID           */ 00043400
         DS    XL4                                                      00043500
*      2 PURGE PTR(31),             /* PURGE KEYWORD         @Y30LPXD*/ 00043600
PURGE    DS    A                                                        00043700
*      2 * CHAR(4),                 /* FLAGS AND SOURCE ID   @Y30LPXD*/ 00043800
         DS    XL4                                                      00043900
*      2 * CHAR(8),                 /* PARMLIB READ FLAGS    @Y30LPXD*/ 00044000
         DS    0XL8                                                     00044100
*       3 NIPPAFLG CHAR(1),         /* PARMLIB READ FLAGS    @Y30LPXD*/ 00044200
NIPPAFLG DS    X                                                        00044300
*        4 NIPPAFL1 BIT(1),         /* MEMBER NOT FOUND MSG SUPPRESS */ 00044400
NIPPAFL1 EQU   X'80'                                                    00044500
*        4 * BIT(7),                /* RESERVED              @Y30LPXD*/ 00044600
*       3 * CHAR(7),                /* RESERVED              @Y30LPXD*/ 00044700
         DS    CL7                                                      00044800
*      2 RSU PTR(31),               /* RSU PARM PTR          @Y30LPXD*/ 00044900
RSU      DS    A                                                        00045000
*      2 * CHAR(4),                 /* FLAGS AND SOURCE ID   @Y30LPXD*/ 00045100
         DS    XL4                                                      00045200
SWAP     DS    A                    SWAP PARM PTR                       00045300
         DS    XL4                                                      00045400
PAGNUM   DS    A                    PAGNUM PARM PTR                     00045500
         DS    XL4                                                      00045600
DUPLEX   DS    A                    DUPLEX PARM PTR                     00045700
         DS    XL4                                                      00045800
*      2 PTABEND(2) PTR(31);        /* DUMMY TRAILER                 */ 00045900
PTABEND  DS    2A                                                       00046000
.SKIPIT9 ANOP  ,                                                        00046100
         AIF   ('&PTE' EQ 'NO').SKIPITA                                 00046200
*                                                                  0137 00046300
*/*  *****        END  OF  NIP  PARAMETER  ADDRESS  TABLE       ******/ 00046400
*/*  *****         NIP  PARAMETER  ADDRESS  TABLE  ENTRY        ******/ 00046500
*/*   NIP PARMTAB ENTRY MAP                                          */ 00046600
*                                                                  0137 00046700
*   DECLARE                                                        0137 00046800
*     1 NIPPTE BASED,               /* BEGIN PARMTAB ENTRY           */ 00046900
NIPPTE   DSECT                                                          00047000
*      2 NIPPTADR PTR(31),          /* PARAMETER ORIGIN ADDRESS      */ 00047100
NIPPTADR DS    A                                                        00047200
*      2 NIPPTOPF CHAR(1),          /* OPTION FLAGS BYTE             */ 00047300
NIPPTOPF DS    X                                                        00047400
*       3 NIPPTOPI BIT(1),          /* OPI OPTION                    */ 00047500
NIPPTOPI EQU   X'80'                                                    00047600
*       3 NIPPTLST BIT(1),          /* LIST REQUEST OPTION           */ 00047700
NIPPTLST EQU   X'40'                                                    00047800
*       3 NIPPTCAN BIT(1),          /* CANCEL REQUEST FLAG           */ 00047900
NIPPTCAN EQU   X'20'                                                    00048000
*       3 * BIT(5),                 /* ** UNASSIGNED **              */ 00048100
*      2 NIPPTATF CHAR(1),          /* ATTRIBUTE FLAGS BYTE          */ 00048200
NIPPTATF DS    X                                                        00048300
*       3 NIPPTMRG BIT(1),          /* MERGE ATTRIBUTE               */ 00048400
NIPPTMRG EQU   X'80'                                                    00048500
*       3 * BIT(7),                 /* ** UNASSIGNED **              */ 00048600
*      2 NIPPTSID CHAR(2);          /* INPUT SOURCE ID : X'0000' - 0137 00048700
NIPPTSID DS    CL2                                                      00048800
*                                      OPERATOR C'XX' - PLIB MEMBER     00048900
*                                      SUFFIX                        */ 00049000
*/*  *****    END OF NIP  PARAMETER  ADDRESS  TABLE  ENTRY      ******/ 00049100
.SKIPITA ANOP  ,                                                        00049200
         MEND                                                           00049300
./ ADD NAME=IECDCAT,SSI=82380009
*%       GOTO  CATPLS1;             /* BILINGUAL MACRO                  00050000
         MACRO                                                          00100000
         IECDCAT                                                        00150000
         DSECT                                                          00200000
CAT      DS    0F                                                       00250000
         SPACE 1                   */                                   00300000
*%CATPLS1 : ;                                                           00350000
*/* ******************************************************************/ 00400000
*/*                                                                  */ 00450000
*/*  THIS DSECT DESCRIBES AN ENTRY IN THE CHANNEL AVAILABILITY       */ 00500000
*/*  TABLE. THE TABLE IS CHANNEL SET RELATED AND RESIDES IN SQA.     */ 00550000
*/*  EACH PHYSICAL CHANNEL IN THE CHANNEL SET CONTAINS AN ENTRY      */ 00600000
*/*  IN THE CAT AND IS INDEXED BY THAT CHANNEL NUMBER. THE ENTRY     */ 00650000
*/*  CONTAINS THE CHANNEL ID, CHANNEL STATUS, AND CHANNEL            */ 00700000
*/*  STATISTICS.                                                     */ 00750000
*/*  MODIFICATIONS ARE SERIALIZED VIA DISABLED STATE                 */ 00800000
*/*  IN THE CPU CONNECTED TO THIS CAT'S CHANNEL SET.                 */ 00850000
*/*                                                                  */ 00900000
*/*                                                                  */ 00950000
*/*                                                                  */ 01000000
*/*                                                                  */ 01050000
*/* ******************************************************************/ 01100000
* %      GOTO CATPLS2;             /*                                   01150000
         SPACE 1                                                        01200000
CATFLG   DS    XL1                 CAT ENTRY FLAG BYTE                  01250000
CATRES1  EQU   X'80'               RESERVED                             01300000
CATNOP   EQU   X'40'               CHANNEL NOT OPERATIVE                01350000
CATNGEN  EQU   X'20'               CHANNEL NOT SYSGENNED                01400000
CATNCPU  EQU   X'10'               CHANNEL NOT ON THIS CPU              01450000
CATNID   EQU   X'08'               CHANNEL ID (CATCHID) INVALID         01500000
CATFLG5  EQU   X'04'               RESERVED                             01550000
CATFLG6  EQU   X'02'               RESERVED                             01600000
CATDSABL EQU   X'01'               CHANNEL DISABLED            @ZA30350 01650000
CATFLA   DS    XL1                 IOS FLAG BYTE                        01700000
CATBSY   EQU   X'80'               CHANNEL BUSY                         01750000
CATIORST EQU   X'40'               CHAN NEED I/O RESTART       @G552PLM 01770055
CATCCRST EQU   X'20'               CHAN ERR ON I/O INTERRUPT   @G51BPLM 01800051
CATMCRST EQU   X'10'               CHAN ERR ON MACH CHK INTRPT @G51BPLM 01810051
CATSOL   EQU   X'08'               SIO CC=0 DONE               @ZA30350 01820000
CATFLARS EQU   X'07'               RESERVED                    @ZA30350 01830000
CATSIOCT DS    XL2                 CHANNEL SIO COUNT                    01850000
CATCHID  DS    0XL4                CHANNEL ID                           01900000
CATTYPE  DS    0XL1                CHANNEL TYPE (4 BITS ONLY)  @G64APLK 01901000
CATMODEL DS    XL2                 CHANNEL MODEL NUMBER        @G64APLK 01902000
CATIOELL DS    XL2                 IOEL LENGTH                 @G64APLK 01903000
         DS    XL8                 RESERVED                    @G64APLK 01904000
CATELP2  EQU    4                  ENTRY LENGTH IN POWERS OF 2 @G64APLK 01950000
CATEL    EQU   *-CAT               CHANNEL TABLE ENTRY LENGTH           02000000
CATDIM   EQU   16                  NUMBER OF CAT ENTRIES IN THE FULL    02010064
*                                  CHANNEL AVAILABILITY TABLE  @G64APLK 02020064
         MEND  ,                   */                                   02050000
*%CATPLS2 : ;                                                           02100000
*   DCL 1 CAT  BASED(CATPTR),                                           02150000
*       2 CATENTRY CHAR(1),        /* ENTRY NAME              */        02200000
*         3 CATFLG CHAR(1),        /* CAT FLAG BYTE           */        02250000
*          4 CATRES1 BIT(1),       /* RESERVED                */        02300000
*          4 CATNOP  BIT(1),       /* CHANNEL NOT OPERATIVE   */        02350000
*          4 CATNGEN BIT(1),       /* CHANNEL NOT SYSGENNED   */        02400000
*          4 CATNCPU BIT(1),       /* CHANNEL NOT ON THIS CPU */        02450000
*          4 CATNID  BIT(1),       /* CHANNEL ID INVALID      */        02500000
*          4 CATFLG5 BIT(1),       /* RESERVED                */        02550000
*          4 CATFLG6 BIT(1),       /* RESERVED                */        02600000
*          4 CATDSABL BIT(1),      /* CHANNEL DISABLED       @ZA30350*/ 02650000
*       2 CATFLA   BIT(8),         /* IOS FLAG BYTE           */        02700000
*         3 CATBSY  BIT(1),        /* CHANNEL BUSY            */        02750000
*         3 CATIORST BIT(1),       /* CHAN NEEDS I/O RESTART @G552PLM*/ 02770055
*         3 CATCCRST BIT(1),       /* CHAN ERR I/O INTRUPT   @G51BPLM*/ 02800051
*         3 CATMCRST BIT(1),       /* CHAN ERR ON MACH CHK   @G51BPLM*/ 02810051
*         3 CATSOL BIT(1),         /* SIO CC=0 DONE          @ZA30350*/ 02820000
*         3 CATFLARS BIT(3),       /* RESERVED               @ZA30350*/ 02830000
*       2 CATSIOCT  CHAR(2),       /* CHANNEL SIO COUNT       */        02850000
*       2 CATCHID,                 /* CHANNEL ID              */        02900000
*         3 CATTYPE BIT(4),        /* CHANNEL TYPE           @G64APLK*/ 02900100
*         3 CATMODEL BIT(12),      /* CHANNEL MODEL NUMBER   @G64APLK*/ 02900200
*         3 CATIOELL FIXED(16),    /* IOEL LENGTH            @G64APLK*/ 02900300
*       2 *         CHAR(8),       /* RESERVED               @G64APLK*/ 02900400
*       2 CATEND  CHAR(0);         /* END OF CAT              */        02950000
*   DCL CATELP2 BIT(8) CONSTANT('04'X),  /* ENTRY LENGTH IN             03000000
*                                     POWERS OF 2            @G64APLK*/ 03050000
*      CATDIM CONSTANT(16);        /* NUMBER OF CAT ENTRIES IN THE FULL 03100000
*                                     CHANNEL AVAILABILITY TABLE        03150000
*                                                            @G64APLK*/ 03150100
*%DCL  CATEL  CHAR;                /* LENGTH OF CAT           */        03200000
*%CATEL='ADDR(CATEND)-ADDR(CATENTRY)';                                  03250000
./ ADD NAME=IEZCTGFL,SSI=42841037
*  %GO TO CTGFLX01;                                                     00050002
*  /*                                                                   00100002
         MACRO                                                          00150002
         IEZCTGFL ,                                                     00200002
CTGFL    DSECT ,                        */                              00210002
*%CTGFLX01:;                                                            00250002
*/********************************************************************/ 02000003
*/*                                                                  */ 02050003
*/*   MACRO NAME = IEZCTGFL                                          */ 02100003
*/*                                                                  */ 02150003
*/*   DESCRIPTIVE NAME = CATALOG FIELD PARAMETER LIST                */ 02200003
*/*                                                                  */ 02250003
*/*   FUNCTION = THE FIELD PARAMETER LIST (CTGFL) DEFINES ONE OF     */ 02300003
*/*              THE CATALOG RECORD'S FIELDS OR A GROUP OF           */ 02350003
*/*              LOGICALLY RELATED FIELDS.  THE CTGFL IS BUILT       */ 02400003
*/*              BEFORE AN OS/VS COMPONENT ISSUES THE CATLG          */ 02450003
*/*              MACRO INSTRUCTION (SVC 26) TO PROCESS A             */ 02500003
*/*              CATALOG RECORD.  THE CTGFL IS USED IN TWO           */ 02550003
*/*              SITUATIONS:                                         */ 02600003
*/*                (1)  IT IDENTIFIES CATALOG RECORD INFORMATION     */ 02650003
*/*                     TO RETRIEVE OR UPDATE.  THE CTGPL CONTAINS   */ 02700003
*/*                     THE ADDRESS OF EACH CTGFL USED IN THIS WAY.  */ 02750003
*/*                (2)  IT IDENTIFIES CATALOG RECORD INFORMATION     */ 02800003
*/*                     TO COMPARE AGAINST CALLER-SUPPLIED DATA.     */ 02850003
*/*                     THIS IS A "TEST" CTGFL AND IS ADDRESSED BY   */ 02900003
*/*                     ANOTHER CTGFL.                               */ 02950003
*/*                                                                  */ 03000003
*/*   CONTROL BLOCK STRUCTURE = THE CTGFL IS POINTED TO BY THE       */ 03050003
*/*                             CCA ('CCAFLPT' OR 'CCATEST').        */ 03100003
*/*                                                                  */ 03150003
*/*   INCLUDED MACROS = NONE                                         */ 03200003
*/*                                                                  */ 03250003
*/*   METHOD OF ACCESS = PL/S - NO DECLARES NECESSARY                */ 03300003
*/*                                                                  */ 03350003
*/*   STATUS = VS/2 RELEASE 3   (CHANGE FLAG @Y30SSXX)               */ 03400003
*/*                                                                  */ 03450003
*/*   DATE OF LAST CHANGE = 17 JUL 74                                */ 03500003
*/*                                                                  */ 03550003
*/********************************************************************/ 03600003
*%DECLARE (CTGFLLEN, CTGFL999, CTGFLLVL) CHAR;                          03650003
*%CTGFLLEN = 'LENGTH(CTGFL)';       /* LENGTH OF CTGFL               */ 03700003
*%GOTO CTGFLX03;                                                        03750003
* /*                                                                    06250002
         AGO   .CTGFL01                 */                              06300002
*%CTGFLX03:;                                                            06350003
*%IF CTGFL999 ^= ','                /* IF BLOCK NOT CONTINUED,       */ 10000003
*  %THEN %CTGFL999 = ';';           /*   THEN CLOSE DECLARE STMNT    */ 12000003
*%IF CTGFLLVL  = ''                 /* IF BLOCK NOT CONCATENATED,    */ 14000003
*  %THEN %GOTO CTGFL001;            /*   THEN GENERATE DECLARE       */ 16000003
*%CTGFLDUM = CTGFLLVL³³' CTGFL';    /* SET MINOR LEVEL NUMBER        */ 18000003
*   CTGFLDUM                        /* CTGFL CONCATENATED LEVEL      */ 20000003
*%GOTO CTGFL002;                    /* SKIP DECLARE                  */ 22000003
*%CTGFL001:;                        /* DECLARE                       */ 24000003
    DECLARE                                                             25000003
*     1 CTGFL BASED(CTGFLPTR)       /* DECLARE CTGFL LEVEL ONE       */ 26000003
*%CTGFL002:;                        /* SKIP DECLARE                  */ 28000003
*        BDY(WORD),                 /* WORD BOUNDARY                 */ 30000003
*       5 CTGFLDNO PTR(8),          /* NO. PAIRS DATA LENGTH/ADDR    */ 32000003
*       5 CTGFLDCD BIT(8),          /* TEST CONDITION                */ 34000003
*       5 CTGFLDGC PTR(8),          /* GROUP CODE NUMBER             */ 54000003
*       5 CTGFLDRE BIT(8),          /* TEST RESULT                   */ 56000003
*         10 *        BIT(7),       /* RESERVED                      */ 58000003
*         10 CTGFLDTS BIT(1),       /* 0 = SUCCESSFUL TEST,          */ 60000003
*                                   /* 1 = TEST FAILED               */ 62000003
*       5 CTGFLDWA BIT(32),         /* CATALOG WORK AREA             */ 64000003
*       5 CTGFLDNM PTR(31),         /* FIELD NAME ADDRESS            */ 66000003
*       5 CTGFLCHN PTR(31),         /* ADDR OF NEXT FIELD MACRO      */ 68000003
*                                   /* OR ZERO                       */ 70000003
*       5 CTGFLDAT(*),              /* PAIRS OF DATA LENGTH/ADDR     */ 72000003
*         10 CTGFLNG FIXED(31),     /* DATA LENGTH                   */ 74000003
*         10 CTGFLPT  PTR(31) CTGFL999 /* DATA ADDRESS               */ 76000003
*/********************************************************************/ 76100003
*/*     CONSTANTS USED TO SET AND/OR TEST FIELDS DECLARED ABOVE      */ 76200003
*/********************************************************************/ 76300003
    DECLARE                         /* TEST CONDITION - CTGFLDCD     */ 76400003
      CTGFLDEQ BIT(8) CONSTANT('80'X), /* EQUAL                      */ 76500003
      CTGFLDNE BIT(8) CONSTANT('60'X), /* NOT EQUAL                  */ 76600003
      CTGFLDGT BIT(8) CONSTANT('20'X), /* GREATER THAN               */ 76700003
      CTGFLDLT BIT(8) CONSTANT('40'X), /* LESS THAN                  */ 76800003
      CTGFLDGE BIT(8) CONSTANT('A0'X), /* GREATER THAN OR EQUAL      */ 76900003
      CTGFLDLE BIT(8) CONSTANT('C0'X), /* LESS THAN OR EQUAL         */ 77000003
      CTGFLDZ  BIT(8) CONSTANT('80'X), /* TEST UNDER MASK FOR ZEROES */ 77100003
      CTGFLDON BIT(8) CONSTANT('10'X), /* TEST UNDER MASK FOR ONES   */ 77200003
      CTGFLDMX BIT(8) CONSTANT('40'X); /* TEST UNDER MASK FOR MIXED  */ 77300003
* %GO TO CTGFLX02;                                                      78050002
*/*                                                                     78100002
.CTGFL01 ANOP                                                           78150002
*                                                                       78210002
CTGFLDNO DS    XL1                      NUMBER PAIRS DATA LNG/ADDR      78250002
*                                                                       78260002
CTGFLDCD DS    XL1                      TEST CONDITION                  78300002
CTGFLDEQ EQU   X'80'                    EQUAL                           78350002
CTGFLDNE EQU   X'60'                    NOT EQUAL                       78400002
CTGFLDGT EQU   X'20'                    GREATER THAN                    78450002
CTGFLDLT EQU   X'40'                    LESS THAN                       78500002
CTGFLDGE EQU   X'A0'                    GREATER THAN OR EQUAL           78550002
CTGFLDLE EQU   X'C0'                    LESS THAN OR EQUAL              78600002
CTGFLDZ  EQU   X'80'                    TEST UNDER MASK FOR ZEROES      78650002
CTGFLDON EQU   X'10'                    TEST UNDER MASK FOR ONES        78700002
CTGFLDMX EQU   X'40'                    TEST UNDER MASK FOR MIXED       78750002
*                                                                       78800002
CTGFLDGC DS    XL1                      GROUP CODE NUMBER               78850002
*                                                                       78900002
CTGFLDRE DS    XL1                      TEST RESULT                     78950002
CTGFLDTS EQU   X'01'                    TEST MASK - CTGFLDRE            79100002
*                                       = 0 - SUCCESSFUL TEST,          79110002
*                                       = 1 - TEST FAILED               79120002
*                                                                       79150002
CTGFLDWA DS    F                        CATALOG WORK AREA               79200002
*                                                                       79350002
CTGFLDNM DS    A                        FIELD NAME ADDRESS              79400002
*                                                                       79450002
CTGFLCHN DS    A                        ADDRESS OF NEXT FIELD           79500002
*                                                                       79550002
*                                                                       79560002
CTGFLDAT DS    0CL8                     PAIRS OF DATA LENGTH/ADDRESS    79600002
CTGFLNG  DS    F                        DATA LENGTH                     79650002
CTGFLPT  DS    A                        DATA ADDRESS                    79700002
*                                                                       79750002
*                                                                       79800002
         MEND  ,                        */                              79850002
* %CTGFLX02:;                                                           79900002
./ ADD NAME=IHANVT
         MACRO ,                                                        00000100
         IHANVT &DSECT=YES,&NIPM=NO                                     00000200
***************************************************************         00000300
*                                                             *         00000400
*   Common Name: NIP Vector Table                             *         00000500
*   Macro ID: IHANVT                                          *         00000600
*   DSECT name: NVT                                           *         00000700
*   Created by: IEAVNIPO, IEAVNIPH                            *         00000800
*   Subpool and Key: Nucleus, then moved to subpool 252       *         00000900
*   and key a                                                 *         00001000
*   Size: 552 bytes                                           *         00001100
*   Pointed to by: Register 2 during NIP processing           *         00001200
*   Serialization: None                                       *         00001300
*   Function: The NVT is the basic control block used during  *         00001400
*   NIP processing. It contains pointers to numerous          *         00001500
*   NIP-associated control blocks and to various NIP service  *         00001600
*   routines.                                                 *         00001700
*                                                             *         00001800
***************************************************************         00001900
*   Header copied from                                        *         00002000
*     OS/VS2 System                                           *         00002100
*     Programming Library:                                    *         00002200
*     Debugging Handbook                                      *         00002300
*     Volume 3                                                *         00002400
*     GC28-0710-0                                             *         00002500
***************************************************************         00002600
         LCLC  &CON                                                     00002700
         AIF   ('&DSECT' EQ 'NO').NODS                                  00002800
NVT      DSECT ,                                                        00002900
         AGO   .PROEND                                                  00003000
.NODS    ANOP  ,                                                        00003100
NVT      DC    0D'0'                                                    00003200
.PROEND  ANOP  ,                                                        00003300
&CON     SETC  'V'                                                      00003400
         AIF   ('&NIPM' EQ 'NO').NOAC                                   00003500
&CON     SETC  'A'                                                      00003600
.NOAC    ANOP  ,                                                        00003700
* NVT DESCRIPTORS FOR NIP LOADING                                       00003800
NVTNPSUF DC    XL52'0'                                                  00003900
         DC    XL1'0'                                                   00004000
NVTNPSFX DC    XL1'00'                                                  00004100
NVTNPATR DC    X'00'        NVTNPREN                                    00004200
NVTNPREN EQU   X'C0'                                                    00004300
NVTNPREU EQU   X'40'                                                    00004400
NVTFLLB  DC    X'00'                                                    00004500
NVTFLSLB EQU   X'80'                                                    00004600
* NVT POINTERS TO NUCLEUS CONTROL BLOCKS                                00004700
NVTMSTCB DC    A(0)        V(IEAMSTCB)                                  00004800
NVTCMTCB DC    A(0)        V(IEECVTCB)                                  00004900
NVTMASCB DC    A(0)        V(IEAMASCB)                                  00005000
NVTRSV41 DC    A(0)                                                     00005100
NVTRSV42 DC    A(0)                                                     00005200
NVTSVCTB DC    A(0)         V(SVCTABLE)                                 00005300
NVTVBLDL DC    A(0)         V(IEARESBL)                                 00005400
NVTIGCER DC    A(0)         V(IGCERROR)                                 00005500
NVTVVMDI DC    A(0)                                                     00005600
NVTMSLNK DC    A(0)         V(IEAMSLNK)                                 00005700
NVTDSSNG DC    A(0)                                                     00005800
NVTMFA   DC    A(0)         V(IEAVMFA)                                  00005900
NVTNVRSZ DC    A(0)                                                     00006000
NVTRSV49 DC    A(0)                                                     00006100
         DC    A(0)                                                     00006200
NVTIGXER DC    A(0)         V(IGXERROR)                                 00006300
NVTLNGFX DC    X'00000000'  X'00080000'                                 00006400
NVTLSQAS DC    X'00000000'  X'00800000'                                 00006500
NVTSQANO DC    H'0'         H'40'                                       00006600
NVTLSQNO DC    H'0'         H'2'                                        00006700
NVTRGNAV DC    H'0'         H'25'                                       00006800
NVTNBMIN DC    H'0'         H'8'                                        00006900
NVTRSVMN DC    H'0'         H'16'                                       00007000
NVTNVSQA DC    H'0'         H'3'                                        00007100
* NVT SAVE AREAS - NUCLEUS CONTROL BLOCKS                               00007200
NVTABSAV DS    0XL8                                                     00007300
NVTABFST DC    A(0)                                                     00007400
NVTABSEC DC    A(0)                                                     00007500
NVTSVC60 DC    XL8'0'                                                   00007600
NVTPQSAV DC    F'0'                                                     00007700
NVTALSQA DC    A(0)                                                     00007800
NVTLSPQE DC    A(0)                                                     00007900
NVTMFASA DC    A(0)                                                     00008000
NVTRTMSA DC    A(0)                                                     00008100
NVTSTMAP DC    A(0)                                                     00008200
* NVT POINTERS TO NUCLEUS ADDITIONS                                     00008300
NVTNUCND DC    A(0)                                                     00008400
NVTNBFND DC    A(0)                                                     00008500
NVTVVPG1 DC    A(0)                                                     00008600
NVTN0MSG DC    A(0)                                                     00008700
NVTSGPSA DC    A(0)                                                     00008800
         DC    H'0'                                                     00008900
NVTNXSIZ DC    H'0'         H'8'                                        00009000
NVTNXPTR DC    A(0)                                                     00009100
* NVT SYSGEN VARIABLES                                                  00009200
NVTTRACE DC    H'0'         H'400'                                      00009300
NVTFLSG  DC    X'00'                                                    00009400
* NVT STATUS FLAGS                                                      00009500
NVTFLCN  DC    X'00'                                                    00009600
NVTFLAC  EQU   X'80'                                                    00009700
NVTFLIOC EQU   X'40'                                                    00009800
NVTMP    EQU   X'20'                                                    00009900
NVTFLASM EQU   X'10'                                                    00010000
NVTFLNHC EQU   X'08'                                                    00010100
NVTFLNCK EQU   X'04'                                                    00010200
NVTFLRAC EQU   X'02'                                                    00010300
NVTCLKER EQU   X'01'                                                    00010400
         DC    A(0)                                                     00010500
NVTMCPSW DC    XL8'0'                                                   00010600
* NVT PSW DESCRIPTORS SYSTEM WAIT STATE PSW                             00010700
NVTWTPSW DS    0XL8                                                     00010800
NVTWPSW1 DC    X'00000000'  X'000200FF'                                 00010900
NVTWPSW2 DS    0XL4                                                     00011000
NVTIDPSW DC    XL2'0'                                                   00011100
NVTIDPM  EQU   X'07D4' - IEAVNIPM                                       00011200
NVTIDPX  EQU   X'07E7' - IEAVNIPX                                       00011300
NVTID01  EQU   X'0001' - IEAVNP01                                       00011400
NVTIDA2  EQU   X'00A2' - IEAVNPA2 (MODULE IEAVNP02)                     00011500
NVTIDB2  EQU   X'00B2' - IEAVNPB2 (MODULE IEAVNP02)                     00011600
NVTID03  EQU   X'0003' - IEAVNP03                                       00011700
NVTID04  EQU   X'0004' - IEAVNP04                                       00011800
NVTID05  EQU   X'0005' - IEAVNP05                                       00011900
NVTIDB5  EQU   X'00B5' - IEAVNPB5                                       00012000
NVTID06  EQU   X'0006' - IEAVNP06                                       00012100
NVTIDA6  EQU   X'00A6' - IEAVNPA6                                       00012200
NVTIDB6  EQU   X'00B6' - IEAVNPB6                                       00012300
NVTID07  EQU   X'0007' - IEAVNP07                                       00012400
NVTIDA8  EQU   X'00A8' - IEAVNPA8 (MODULE IEAVNP08)                     00012500
NVTIDB8  EQU   X'00B8' - IEAVNPB8 (MODULE IEAVNP08)                     00012600
NVTIDC8  EQU   X'00C8' - IEAVNPC8 (MODULE IEAVNP08)                     00012700
NVTID09  EQU   X'0009' - IEAVNP09                                       00012800
NVTID10  EQU   X'0010' - IEAVNP10                                       00012900
NVTID11  EQU   X'0011' - IEAVNP11                                       00013000
NVTID12  EQU   X'0012' - IEAVNP12                                       00013100
NVTID13  EQU   X'0013' - IEAVNP13                                       00013200
NVTID15  EQU   X'0015' - IEAVNP15                                       00013300
NVTID16  EQU   X'0016' - IEAVNP16                                       00013400
NVTID17  EQU   X'0017' - IEAVNP17                                       00013500
NVTFLWS1 DC    X'0'                                                     00013600
NVTFLWSC DS    0X                                                       00013700
NVTIX    DC    X'0'                                                     00013800
* NVT POINTERS TO IEAVNIPM ROUTINES                                     00013900
NVTLOAD  DC    &CON.(NIPLOAD)                                           00014000
NVTSENSE DC    &CON.(NIPSENSE)                                          00014100
NVTSWAIT DC    &CON.(NIPSWAIT)                                          00014200
NVTTIME  DC    &CON.(NIPTIME)                                           00014300
NVTUCBFN DC    &CON.(NIPUCBFN)                                          00014400
NVTWTO   DC    V(NIPWTO)                                                00014500
NVTWTOR  DC    V(NIPWTOR)                                               00014600
NVTWTOR2 DC    V(NIPWTOR2)                                              00014700
NVTOPEN  DC    V(NIPOPEN)                                               00014800
NVTMOUNT DC    V(NIPMOUNT)                                              00014900
NVTPRMPT DC    &CON.(NIPPRMPT)                                          00015000
NVTVIRT  DC    &CON.(NIPVIRT)                                           00015100
NVTREAL  DC    &CON.(NIPREAL)                                           00015200
NVTSCHED DC    &CON.(NIPSCHED)                                          00015300
NVTOPIO  DC    &CON.(NIPOPIO)                                           00015400
NVTNIPM  DC    3A(0)                                                    00015500
NVTNMBLD DC    &CON.(NPMLBLDL)                                          00015600
         DC    4A(0)                                                    00015700
* NVT POINTERS TO IEAVNIPM DEFINED CONTROL BLOCKS AND POINTERS          00015800
NVTDCBIC DC    V(NIPDCBIC)                                              00015900
NVTDCBOC DC    V(NIPDCBOC)                                              00016000
NVTDCBSN DC    &CON.(NIPDCBSN)                                          00016100
* NVT POINTERS TO SQA BUFFERS/QUEUES                                    00016200
NVTMBUF  DC    A(0)                                                     00016300
NVTMBEND DC    A(0)                                                     00016400
NVTSPE   DC    2A(0)                                                    00016500
* NVT SAVE AREAS USED BY IEAVNIPM ROUTINES                              00016600
NVTTOD   DC    A(0)                                                     00016700
NVTCPUAD DC    H'0'                                                     00016800
         DC    H'0'                                                     00016900
NVTABCD1 DC    H'0'                                                     00017000
NVTABWS1 DC    X'0'                                                     00017100
         DC    X'0'                                                     00017200
* NVT SAVE AREAS USED BY IEAVNPXX ROUTINES                              00017300
NVTRSV43 DC    A(0)                                                     00017400
NVTPAREA DC    A(0)                                                     00017500
NVTPTAB  DC    A(0)                                                     00017600
NVTQSBUF DC    A(0)                                                     00017700
NVTRSV44 DC    H'0'                                                     00017800
NVTSPUCB DC    H'0'                                                     00017900
NVTVVTCB DC    A(0)                                                     00018000
NVTVRTCB DC    A(0)                                                     00018100
         DC    2A(0)                                                    00018200
NVTVRBLD DC    A(0)                                                     00018300
NVTBLDL  DC    A(0)                                                     00018400
NVTCSLIB DC    A(0)                                                     00018500
NVTCSLNM DC    A(0)                                                     00018600
NVTCSIOB DC    A(0)                                                     00018700
NVTCSLPG DC    A(0)                                                     00018800
NVTLPACT DC    X'0'                                                     00018900
         DC    XL3'0'                                                   00019000
NVTXCTL  DS    0XL8                                                     00019100
NVTXFST  DC    A(0)                                                     00019200
NVTXSEC  DC    A(0)                                                     00019300
NVTLOCAT DS    0XL8                                                     00019400
NVTLFST  DC    A(0)                                                     00019500
NVTLSEC  DC    A(0)                                                     00019600
* SAVE AREA FOR V=V TCB JPQ FIELD                                       00019700
NVTVJPQ  DC    A(0)                                                     00019800
* SAVE AREA FOR V=V TCB JPQ FIELD                                       00019900
NVTVLLE  DC    A(0)                                                     00020000
* SAVE AREA FOR V=V TCB PQE FIELD                                       00020100
NVTVPQE  DC    A(0)                                                     00020200
* SAVE AREA FOR V=V TCB MSS FIELD                                       00020300
NVTVMSS  DC    A(0)                                                     00020400
* SAVE AREA FOR V=R TCB JPQ FIELD                                       00020500
NVTRJPQ  DC    A(0)                                                     00020600
* SAVE AREA FOR V=R TCB LLE FIELD                                       00020700
NVTRLLE  DC    A(0)                                                     00020800
* SAVE AREA FOR V=R TCB PQE FIELD                                       00020900
NVTRPQE  DC    A(0)                                                     00021000
* SAVE AREA FOR V=R TCB MSS FIELD                                       00021100
NVTRMSS  DC    A(0)                                                     00021200
* HIGH VIRTUAL ADDRESS OF PLPA                                          00021300
NVTLPAND DC    A(0)                                                     00021400
NVTRSV4A DC    A(0)                                                     00021500
* CURRENT LOW VIRTUAL ADDRESS OF COMMON AREA                            00021600
NVTLVIRT DC    A(0)                                                     00021700
* START OF V=R REGION                                                   00021800
NVTVRREG DC    A(0)                                                     00021900
* LENGTH OF V=R AREA AVAILABLE IN PAGES                                 00022000
NVTVRLNG DC    A(0)                                                     00022100
NVTRSV45 DC    2A(0)                                                    00022200
* SAVEAREA FOR FINAL VERSION OF ASVT                                    00022300
NVTFASVT DC    A(0)                                                     00022400
* SAVE AREA FOR CVTREAL VALUE CALCULATED                                00022500
NVTREALR DC    A(0)                                                     00022600
         DC    A(0)                                                     00022700
NVTRSV46 DC    A(0)                                                     00022800
NVTRSV47 DC    A(0)                                                     00022900
NVTRSV48 DC    A(0)                                                     00023000
* SYSTEM PARAMETER OPTIONS                                              00023100
NVTFLPO  DC    X'0'                                                     00023200
NVTFLLST EQU   X'80'                                                    00023300
NVTSYSP  EQU   X'40'                                                    00023400
NVTFLQS  EQU   X'08'                                                    00023500
NVTFLWS  EQU   X'04'                                                    00023600
         DC    XL3'0'                                                   00023700
NVTRCODE DC    &CON.(NPMPSW2)                                           00023800
NVTRLOCK DC    &CON.(NIPLOCK)                                           00023900
NVTRMSG  DC    &CON.(NPSWAITM)                                          00024000
* LOW VIRTUAL ADDRESS OF PLPA                                           00024100
NVTLPALO DC    A(0)                                                     00024200
* LPA HASH VALUE                                                        00024300
NVTLPAHA DC    A(0)                                                     00024400
         MEND  ,                                                        00024500
./ ENDUP
/*
//*
//U42S03  EXEC PGM=IFOX00,PARM='OBJECT,NODECK,NOTERM,XREF(SHORT),RENT'
//SYSPRINT DD  SYSOUT=*
//SYSUT1   DD  UNIT=VIO,SPACE=(CYL,10)
//SYSUT2   DD  UNIT=VIO,SPACE=(CYL,10)
//SYSUT3   DD  UNIT=VIO,SPACE=(CYL,10)
//SYSLIB   DD  DSN=&&PVTMACS,DISP=(OLD,DELETE)
//         DD  DSN=SYS1.MACLIB,DISP=SHR
//         DD  DSN=SYS1.SMPMTS,DISP=SHR
//         DD  DSN=SYS1.AMODGEN,DISP=SHR
//         DD  DSN=SYSGEN.RAKF.V1R2M6.MACLIB,DISP=SHR
//SYSGO    DD  DSN=&&SMPMCS,DISP=(MOD,PASS)
//SYSIN    DD  *
         TITLE 'IEAVNP12 - NIP LOCATE                                  *00000100
                        '                                               00000200
IEAVNP12 CSECT ,                                                   0001 00000300
@MAINENT DS    0H                                                  0001 00000400
         USING *,R15                                            DSK1308 00000500
         B     @PROLOG                                             0001 00000600
         DC    AL1(23)                                             @42C 00000702
         DC    C'IEAVNP12 84.132 '                                 @42C 00000802
         DC    C'ZP60042'                                          @42A 00000902
         DROP  R15                                              DSK1308 00001000
@PROLOG  STM   R14,R12,12(R13)                                  DSK1308 00001100
         BALR  R12,0                                            DSK1308 00001200
@PSTART  DS    0H                                                  0001 00001300
         USING @PSTART,R12                                      DSK1308 00001400
         L     R0,@SIZDATD                                      DSK1308 00001500
         GETMAIN  R,LV=(0)                                              00001600
         LR    R11,R1                                           DSK1308 00001700
         USING @DATD,R11                                        DSK1308 00001800
         ST    R13,@SA00001+4                                   DSK1308 00001900
         LM    R0,R1,20(R13)                                    DSK1308 00002000
         ST    R11,8(,R13)                                      DSK1308 00002100
         LR    R13,R11                                          DSK1308 00002200
*                                                                       00002300
* REFS ARE GENERATED FOR NVT FIELDS THAT CONTAIN ADDRESSES OF           00002400
* NIP SERVICE ROUTINES, SO IEAPMNIP MACRO CALLS TO THESE ROUTINES       00002500
* WILL ASSEMBLE PROPERLY.                                               00002600
         STM R2,R3,LOCPTR                                               00002700
*   ERRCD=ZERO;                                                    0238 00002800
         SLR   R1,R1                                            DSK1308 00002900
         ST    R1,ERRCD                                         DSK1308 00003000
*   SW='00000000'B;                 /* SET ALL FLAGS OFF             */ 00003100
         MVI   SW,B'00000000'                                      0239 00003200
*   DICTSTR=ADDR(ZDT);              /* DICTIONARY STARTING ADD       */ 00003300
         LA    R2,ZDT                                           DSK1308 00003400
         ST    R2,DICTSTR                                       DSK1308 00003500
*   DICTEND=ADDR(ZCS);                                             0241 00003600
         LA    R3,ZCS                                           DSK1308 00003700
         ST    R3,DICTEND                                       DSK1308 00003800
*   DICTTYP=ADDR(ZTYP);             /* ITYPENT FLD OF DICT           */ 00003900
         LA    R4,ZTYP                                          DSK1308 00004000
         ST    R4,DICTTYP                                       DSK1308 00004100
*   DICTTYP=DICTTYP->DICTST;        /* DISPLAC IN CATALOG            */ 00004200
         SLR   R5,R5                                            DSK1308 00004300
         IC    R5,DICTST(,R4)                                   DSK1308 00004400
         ST    R5,DICTTYP                                       DSK1308 00004500
*   WKLEN=LENGTH(CATLGBUF)*TEN;     /* GET CORE TO HOLD CATALOG      */ 00004600
         MVC   WKLEN(2),@CH5120                                    0244 00004701
*   CALL GETWORK;                   /* RECORD READ                   */ 00004800
         BAL   R14,GETWORK                                      DSK1308 00004900
*   CATBFPTR=WKCORE;                /* SAVE POINTER                  */ 00005000
         L     R7,WKCORE                                        DSK1308 00005100
         ST    R7,CATBFPTR                                      DSK1308 00005200
*   DO IX=TEN TO 1 BY-1;            /* INIT CATBUFPTRS               */ 00005300
         LA    R7,10                                            DSK1308 00005400
@DL00247 DS    0H                                                  0248 00005500
*     BFCTR(IX)=ZERO;               /* USE COUNT TO 0                */ 00005600
         SLR   R6,R6                                            DSK1308 00005700
         LR    R8,R7                                            DSK1308 00005800
         SLA   R8,3                                             DSK1308 00005900
         STC   R6,BFCTR-8(R8)                                   DSK1308 00006000
*     BFCI(IX)=ZERO;                /* CI NBR IS 0                   */ 00006100
         LA    R9,BFCI-8(R8)                                    DSK1308 00006200
         STCM  R6,7,0(R9)                                       DSK1308 00006300
*     BFPTR(IX)=ADDR(CCACPE(IX));   /* BUFFER POINTER                */ 00006400
         LR    R6,R7                                            DSK1308 00006500
         SLA   R6,4                                             DSK1308 00006600
         LA    R6,CCACPE-16(R6)                                 DSK1308 00006700
         ST    R6,BFPTR-8(R8)                                   DSK1308 00006800
*   END;                                                           0251 00006900
         BCTR  R7,0                                             DSK1308 00007000
         LTR   R7,R7                                            DSK1308 00007100
         BP    @DL00247                                            0251 00007200
*   BFCTR(1)=H255;                  /* INITIAL ENTRY REC NEEDED      */ 00007300
         MVI   BFCTR,X'FF'                                         0252 00007400
*   GEN SETS(CTGPLPTR);                                            0253 00007500
        L     R1,@SA00001+K4           POINT TO CALLERS SAVEAREA        00007600
        L     R1,O24(,R1)              LOAD CALLERS PARM LIST PTR       00007700
        ST    R1,CTGPLPTR              STORE CATLG PARM LIST POINTER    00007800
*   CALL CTLBKPTR;                  /* SET POINTERS TO THE CATALOG 0254 00007900
*                                      CONTROL BLOCKS THAT WE NEED   */ 00008000
         BAL   R14,CTLBKPTR                                     DSK1308 00008100
*   IF CTGAM0=OFFX THEN             /* DO WE HAVE A O.S. LOCATE?     */ 00008200
         L     R7,CTGPLPTR                                      DSK1308 00008300
         TM    CTGOPTN3-CTGPL(R7),CTGAM0                           @42C 00008400
         BNZ   @RF00255                                            0255 00008500
*     DO;                           /* YES DO                        */ 00008600
*       CALL MAPOSCPL;              /* CREATE A CPL FPL FROM THE THE    00008700
*                                      CAMLST THE USER GAVE          */ 00008800
         BAL   R14,MAPOSCPL                                     DSK1308 00008900
*       CALL GETTRNM;               /* GET TRUE NAME RECORD          */ 00009000
         BAL   R14,GETTRNM                                      DSK1308 00009100
*       CALL FINDCI;                /* GET A RECORD BY CI NBR        */ 00009200
         BAL   R14,FINDCI                                       DSK1308 00009300
*       CPX=CPE0;                   /* INIT RECORD POINTER           */ 00009400
         ST    R6,CPX                                           DSK1308 00009500
*       CTGFLPTR=CTGFIELD(ONE);     /* SET PTR TO FIELD REQUEST      */ 00009600
         L     R9,CTGPLPTR                                      DSK1308 00009700
         L     R9,CTGFIELD-CTGPL(,R9)                              @42C 00009802
         ST    R9,CTGFLPTR                                      DSK1308 00009900
*       CALL CTINTFAC;              /* CATLG INTERFACE               */ 00010000
         BAL   R14,CTINTFAC                                     DSK1308 00010100
*       CAMWORK=CAMPTR3;            /* POINT TO OUTPUT AREA          */ 00010200
         L     R9,CAMLSTPT                                      DSK1308 00010300
         L     R2,CAMPTR3(,R9)                                  DSK1308 00010400
*       CALL MAPCPLOS;              /* MAP FROM CPL-FPL FORM TO THAT    00010500
*                                      REQUIRED BY O.S.              */ 00010600
         BAL   R14,MAPCPLOS                                     DSK1308 00010700
*     END;                                                         0265 00010800
*   ELSE                            /* WE HAVE A VSAM LOCATE         */ 00010900
*     DO;                                                          0266 00011000
         B     @RC00255                                            0266 00011100
@RF00255 DS    0H                                                  0267 00011200
*       IF CTGNAME=ON THEN          /* 44 BYTE NAME?                 */ 00011300
         L     R7,CTGPLPTR                                      DSK1308 00011400
         TM    CTGOPTN1-CTGPL(R7),CTGNAME                          @42C 00011500
         BNO   @RF00267                                            0267 00011600
*         DO;                                                      0268 00011700
*           CALL GETTRNM;           /* GET TRUE NAME RECORD          */ 00011800
         BAL   R14,GETTRNM                                      DSK1308 00011900
*         END;                                                     0270 00012000
*       ELSE                        /* LOCATE BY CI NBR              */ 00012100
*         CIWORK=CIWORK2;           /* MOVE CI NBR FROM CPL          */ 00012200
         B     @RC00267                                            0271 00012300
@RF00267 L     R1,CTGPLPTR                                      DSK1308 00012400
         L     R1,CTGENT-CTGPL(,R1)                                @42C 00012500
         MVC   CIWORK(3),CIWORK2(R1)                            DSK1308 00012600
*       CALL FINDCI;                /* GET PROPER CI INTO CORE       */ 00012700
@RC00267 BAL   R14,FINDCI                                       DSK1308 00012800
*       CPX=CPE0;                                                  0273 00012900
         ST    R6,CPX                                           DSK1308 00013000
*       GPFLDPTR=CTGWKA+FOUR;       /* SET OUTPUT POINTER            */ 00013100
         L     R1,CTGPLPTR                                      DSK1308 00013200
         L     R2,CTGWKA-CTGPL(,R1)                                @42C 00013300
         LA    R8,4                                             DSK1308 00013400
         ALR   R8,R2                                            DSK1308 00013500
*       CTWKLIMT=WORKLEN+CTGWKA;    /* SET WORK AREA LIMIT           */ 00013600
         LH    R9,WORKLEN(,R2)                                  DSK1308 00013700
         ALR   R9,R2                                            DSK1308 00013800
         ST    R9,CTWKLIMT                                      DSK1308 00013900
*       DO IX=1 TO CTGNOFLD;        /* PROCESS ALL FIELDS REQUEST    */ 00014000
         LA    R7,1                                             DSK1308 00014100
         B     @DE00276                                            0276 00014200
@DL00276 DS    0H                                                  0277 00014300
*         CTGFLPTR=CTGFIELD(IX);    /* FIELD PTR FOR CAT INTERFAC    */ 00014400
         LR    R9,R7                                            DSK1308 00014500
         SLA   R9,2                                             DSK1308 00014600
         L     R6,CTGPLPTR                                      DSK1308 00014700
         L     R9,CTGFIELD-4-CTGPL(R9,R6)                          @42C 00014800
         ST    R9,CTGFLPTR                                      DSK1308 00014900
*         CTGFLPT(ONE)=GPFLDPTR;    /* SET OUTPUT POINTER            */ 00015000
         ST    R8,CTGFLPT-CTGFL(,R9)                            DSK1308 00015100
*         CALL CTINTFAC;            /* CATALOG INTERFACE             */ 00015200
         BAL   R14,CTINTFAC                                     DSK1308 00015300
*         CTGFLNG(ONE)=GPFLDPTR-CTGFLPT(ONE);/* SET LENGTH           */ 00015400
         L     R6,CTGFLPTR                                      DSK1308 00015500
         LR    R9,R8                                            DSK1308 00015600
         SL    R9,CTGFLPT-CTGFL(,R6)                            DSK1308 00015700
         ST    R9,CTGFLNG-CTGFL(,R6)                            DSK1308 00015800
*         IF CTGFLNG(ONE)=ZERO THEN /* SET OUTPUT PTR ONLY IF DATA   */ 00015900
         SLR   R14,R14                                          DSK1308 00016000
         CR    R9,R14                                           DSK1308 00016100
         BNE   @RF00281                                            0281 00016200
*           CTGFLPT(ONE)=ZERO;      /* INDICATE NO VALUE             */ 00016300
         ST    R14,CTGFLPT-CTGFL(,R6)                           DSK1308 00016400
*       END;                                                       0283 00016500
@RF00281 AL    R7,@CF1                                          DSK1308 00016601
@DE00276 L     R6,CTGPLPTR                                      DSK1308 00016700
         SLR   R9,R9                                            DSK1308 00016800
         IC    R9,CTGNOFLD-CTGPL(,R6)                              @42C 00016900
         CR    R7,R9                                            DSK1308 00017000
         BNH   @DL00276                                            0283 00017100
*     END;                                                         0284 00017200
*EXIT:                                                             0285 00017300
*   IF OSSW=ON THEN                 /* WAS IT AN O.S. TYPE LOCATE?   */ 00017400
@RC00255 DS    0H                                                  0285 00017500
EXIT     TM    SW,OSSW                                             @42C 00017602
         BNO   @RF00285                                            0285 00017700
*     DO;                           /* YES DO                        */ 00017800
*       FREEAD=CTGPLPTR;            /* ADDRESS OF CORE TO FREE       */ 00017900
         L     R14,CTGPLPTR                                     DSK1308 00018000
         ST    R14,FREEAD                                       DSK1308 00018100
*       FREELEN=CTGDDNM;            /* LENGTH OF CORE TO FREE        */ 00018200
         L     R0,CTGDDNM-CTGPL(,R14)                              @42C 00018300
         ST    R0,FREELEN                                       DSK1308 00018400
*       CALL FREEWORK;              /* FREE WORKING STORAGE          */ 00018500
         BAL   R14,FREEWORK                                     DSK1308 00018600
*     END;                                                         0290 00018700
*   FREELEN=LENGTH(CATLGBUF)*TEN;   /* BUFFER LENGTH                 */ 00018800
@RF00285 MVC   FREELEN(4),@CF5120                                  0291 00018901
*   FREEAD=CATBFPTR;                                               0292 00019000
         L     R2,CATBFPTR                                      DSK1308 00019100
         ST    R2,FREEAD                                        DSK1308 00019200
*   CALL FREEWORK;                  /* CALL FREEMAIN ROUTINE         */ 00019300
         BAL   R14,FREEWORK                                     DSK1308 00019400
*   RETURN CODE(ERRCD);             /* RETURN TO USER (NORMAL EXIT)  */ 00019500
*                                                                  0294 00019600
         L     R3,ERRCD                                         DSK1308 00019700
         L     R13,4(,R13)                                      DSK1308 00019800
         L     R0,@SIZDATD                                      DSK1308 00019900
         LR    R1,R11                                           DSK1308 00020000
         FREEMAIN R,LV=(0),A=(1)                                        00020100
         LR    R15,R3                                           DSK1308 00020200
         L     R14,12(,R13)                                     DSK1308 00020300
         LM    R0,R12,20(R13)                                   DSK1308 00020400
         BR    R14                                              DSK1308 00020500
*   /*****************************************************************/ 00020600
*   /*                                                               */ 00020700
*   /* E X I T                                                       */ 00020800
*   /*                                                               */ 00020900
*   /*****************************************************************/ 00021000
*                                                                  0295 00021100
*MAPOSCPL:                                                         0295 00021200
*                                                                  0295 00021300
*   /*****************************************************************/ 00021400
*   /*                                                               */ 00021500
*   /* MAP AN OS CAMLIST INTO A VSAM CPL-FPL COMBINATION             */ 00021600
*   /*                                                               */ 00021700
*   /*****************************************************************/ 00021800
*                                                                  0295 00021900
*   PROC OPTIONS(NOSAVE,NOSAVEAREA);                               0295 00022000
@EL00001 DS    0H                                               DSK1308 00022100
@EF00001 DS    0H                                               DSK1308 00022200
@ER00001 DS    0H                                               DSK1308 00022300
MAPOSCPL DS    0H                                                  0296 00022400
*   GEN(ST     R14,RSAVA);                                         0296 00022500
         ST     R14,RSAVA                                               00022600
*   WKLEN=LENGTH(CTGPL)+FOUR        /* GET CORE FOR SIMULATED CPL    */ 00022700
*       +LENGTH(CTGFL)              /* AND AN FPL                    */ 00022800
*       +H44                        /* ROOM TO COPY NAME             */ 00022900
*       +H272;                      /* AND A CATALOG WORK AREA       */ 00023000
         MVC   WKLEN(2),@CH02591                                   0297 00023100
*   CALL GETWORK;                   /* GET WORKING STORAGE           */ 00023200
         BAL   R14,GETWORK                                      DSK1308 00023300
*   OSSW=ON;                        /* SET O.S. LOCATE FLAG          */ 00023400
         OI    SW,OSSW                                             @42C 00023502
*   CAMLSTPT=CTGPLPTR;              /* SAVE THE CAMLST POINTER       */ 00023600
         L     R7,CTGPLPTR                                      DSK1308 00023700
         ST    R7,CAMLSTPT                                      DSK1308 00023800
*   CTGPLPTR=WKCORE;                                               0301 00023900
         L     R7,WKCORE                                        DSK1308 00024000
         ST    R7,CTGPLPTR                                      DSK1308 00024100
*   CTGDDNM=WKLEN;                  /* SAVE FOR FREEMAIN             */ 00024200
         LH    R8,WKLEN                                         DSK1308 00024300
         ST    R8,CTGDDNM-CTGPL(,R7)                               @42C 00024400
*   CTGFLPTR=WKCORE+LENGTH(CTGPL)+FOUR;/* LEAVE ROOM FOR CTGFIELD    */ 00024500
         LA    R9,32                                            DSK1308 00024600
         ALR   R9,R7                                            DSK1308 00024700
         ST    R9,CTGFLPTR                                      DSK1308 00024800
*   CTGOPTN1='84'X;                 /* SET OPTION FLAGS              */ 00024900
         MVI   CTGOPTN1-CTGPL(R7),CTGBYPSS+CTGNAME                 @42C 00025000
*   CTGOPTN2='00'X;                 /*                               */ 00025100
         MVI   CTGOPTN2-CTGPL(R7),X'00'                            @42C 00025200
*   CTGOPTN3='20'X;                                                0306 00025300
         MVI   CTGOPTN3-CTGPL(R7),CTGLOC                           @42C 00025400
*   CTGOPTN4='00'X;                 /* SET LAST OPTION BYTE          */ 00025500
         MVI   CTGOPTN4-CTGPL(R7),X'00'                            @42C 00025600
*   CTGENT=ADDR(CTGFL)+LENGTH(CTGFL);/* POINTER TO DATA SET NAME     */ 00025700
         AL    R9,@CF16                                         DSK1308 00025801
         ST    R9,CTGENT-CTGPL(,R7)                                @42C 00025900
*   DSNAME=' ';                     /* SET AREA TO BLANKS            */ 00026000
         MVI   DSNAME(R9),C' '                                  DSK1308 00026100
         MVC   DSNAME+1(43,R9),DSNAME(R9)                       DSK1308 00026200
*   DO IX=1 TO 44 WHILE(CAMPTR1->DSNAME(IX:IX)^=' ');              0310 00026300
         LA    R7,1                                             DSK1308 00026400
@DL00310 L     R1,CAMLSTPT                                      DSK1308 00026500
         L     R2,CAMPTR1(,R1)                                  DSK1308 00026600
         LR    R3,R2                                            DSK1308 00026700
         ALR   R3,R7                                            DSK1308 00026800
         BCTR  R3,0                                             DSK1308 00026900
         CLI   DSNAME(R3),C' '                                  DSK1308 00027000
         BE    @DC00310                                            0310 00027100
*     DSNAME(IX:IX)=CAMPTR1->DSNAME(IX:IX);                        0311 00027200
         L     R1,CTGPLPTR                                      DSK1308 00027300
         L     R1,CTGENT-CTGPL(,R1)                                @42C 00027400
         ALR   R1,R7                                            DSK1308 00027500
         BCTR  R1,0                                             DSK1308 00027600
         ALR   R2,R7                                            DSK1308 00027700
         BCTR  R2,0                                             DSK1308 00027800
         MVC   DSNAME(1,R1),DSNAME(R2)                          DSK1308 00027900
*   END;                                                           0312 00028000
         AL    R7,@CF1                                          DSK1308 00028101
         C     R7,@CF44                                         DSK1308 00028201
         BNH   @DL00310                                            0312 00028300
@DC00310 DS    0H                                                  0313 00028400
*   CTGWKA=WKCORE+WKLEN-H272;       /* POINT TO WORK AREA            */ 00028500
         L     R7,CTGPLPTR                                      DSK1308 00028600
         LH    R9,WKLEN                                         DSK1308 00028700
         AL    R9,WKCORE                                        DSK1308 00028800
         SL    R9,@CF272                                        DSK1308 00028901
         ST    R9,CTGWKA-CTGPL(,R7)                                @42C 00029000
*   WORKLEN=H260;                   /* SET WORK AREA LENGTH TO WHAT     00029100
*                                      WE CAN MAP BACK               */ 00029200
         LA    R14,260                                          DSK1308 00029300
         STH   R14,WORKLEN(,R9)                                 DSK1308 00029400
*   GPFLDPTR=CTGWKA+FOUR;           /* SET START                     */ 00029500
         LA    R8,4                                             DSK1308 00029600
         ALR   R8,R9                                            DSK1308 00029700
*   CTWKLIMT=CTGWKA+WORKLEN;        /* SET END OF AREA               */ 00029800
         ALR   R9,R14                                           DSK1308 00029900
         ST    R9,CTWKLIMT                                      DSK1308 00030000
*   CTGNOFLD=ONE;                   /* INDICATE ONE FIELD            */ 00030100
         MVI   CTGNOFLD-CTGPL(R7),X'01'                            @42C 00030200
*   CTGFIELD(ONE)=CTGFLPTR;         /* POINT TO FPL                  */ 00030300
         L     R9,CTGFLPTR                                      DSK1308 00030400
         ST    R9,CTGFIELD-CTGPL(,R7)                              @42C 00030500
*   CTGFLDNM=ADDR('OSLOCATE');      /* POINT TO COMBO FIELD FOR    0319 00030600
*                                      ANSWERING OS LOCATES          */ 00030700
         LA    R7,@CC02522                                      DSK1308 00030800
         ST    R7,CTGFLDNM-CTGFL(,R9)                           DSK1308 00030900
*   GEN(L      R14,RSAVA);          /* RESTORE RETURN ADDRESS        */ 00031000
         L      R14,RSAVA                                               00031100
*   END MAPOSCPL;                                                  0321 00031200
@EL00002 DS    0H                                                  0321 00031300
@EF00002 DS    0H                                                  0321 00031400
@ER00002 BR    R14                                              DSK1308 00031500
*MAPCPLOS:                                                         0322 00031600
*                                                                  0322 00031700
*   /*****************************************************************/ 00031800
*   /*                                                               */ 00031900
*   /* MAP THE CATALOG DATA FROM THE CPL-FPL-WORKAREA INTO THE CAMLST*/ 00032000
*   /* WORK AREA                                                     */ 00032100
*   /*                                                               */ 00032200
*   /*****************************************************************/ 00032300
*                                                                  0322 00032400
*   PROC OPTIONS(NOSAVE,NOSAVEAREA);                               0322 00032500
MAPCPLOS DS    0H                                                  0323 00032600
*   GEN(ST     R14,RSAVA);          /* SAVE RETURN ADDRESS           */ 00032700
         ST     R14,RSAVA                                               00032800
*   HLD=GPFLDPTR-TWELVE;            /* SAVE ADDRESS OF LAST ENTRY    */ 00032900
         LR    R9,R8                                            DSK1308 00033000
         SL    R9,@CF12                                         DSK1308 00033101
*   GPFLDPTR=CTGWKA+FOUR;           /* POINT TO START OF 1ST VALUE   */ 00033200
         LA    R8,4                                             DSK1308 00033300
         L     R3,CTGPLPTR                                      DSK1308 00033400
         AL    R8,CTGWKA-CTGPL(,R3)                                @42C 00033500
*   IF GPFLDPTR>HLD THEN            /* ARE THERE VALUES?             */ 00033600
         CR    R8,R9                                            DSK1308 00033700
         BNH   @RF00326                                            0326 00033800
*     DO;                                                          0327 00033900
*       ERRCD=RCDSNF;               /* NO, SET ERROR CODE            */ 00034000
         MVC   ERRCD(4),@CF36                                      0328 00034101
*       RETURN TO EXIT;             /* BAIL OUT                      */ 00034200
         LA    R14,EXIT                                         DSK1308 00034300
@EL00003 DS    0H                                                  0329 00034400
@EF00003 DS    0H                                                  0329 00034500
@ER00003 BR    R14                                              DSK1308 00034600
*     END;                                                         0330 00034700
*   ELSE                            /* TRANSFER THE DATA             */ 00034800
*     DO;                                                          0331 00034900
@RF00326 DS    0H                                                  0332 00035000
*       CAMVOLPT(ONE)=GPVOLPTR;     /* MOVE ONE VOLUME PTR           */ 00035100
         MVC   CAMVOLPT(12,R2),GPVOLPTR(R8)                     DSK1308 00035200
*       GPFLDPTR=GPFLDPTR+TWELVE;   /* STEP WORKAREA POINTER         */ 00035300
         AL    R8,@CF12                                         DSK1308 00035401
*       IX=ONE;                     /* INITIALIZE INDEX              */ 00035500
         LA    R7,1                                             DSK1308 00035600
*       DO GPFLDPTR=GPFLDPTR TO HLD BY TWELVE/* LOOP THROUGH VALUES  */ 00035700
*             WHILE(IX^<TWENTY);    /* COLLECTED FROM THE CATALOG    */ 00035800
         B     @DE00335                                            0335 00035900
@DL00335 C     R7,@CF20                                         DSK1308 00036001
         BL    @DC00335                                            0335 00036100
*         DO IX1=1 TO IX            /* NO DUPLICATE VOLUME ENTRIES   */ 00036200
*               WHILE(CAMVOLSR(IX1)^=GPVOLSER);                    0336 00036300
         LA    R3,1                                             DSK1308 00036400
         B     @DE00336                                            0336 00036500
@DL00336 LR    R6,R3                                            DSK1308 00036600
         MH    R6,@CH12                                         DSK1308 00036701
         ALR   R6,R2                                            DSK1308 00036800
         AL    R6,@CFNEG6                                       DSK1308 00036901
         CLC   CAMVOLSR-6(6,R6),GPVOLSER(R8)                    DSK1308 00037000
         BE    @DC00336                                            0336 00037100
*         END;                                                     0337 00037200
         AL    R3,@CF1                                          DSK1308 00037301
@DE00336 DS    0H                                               DSK1308 00037400
         ST    R3,IX2                                           DSK1308 00037500
         CR    R3,R7                                            DSK1308 00037600
         BNH   @DL00336                                            0337 00037700
@DC00336 DS    0H                                                  0338 00037800
*         IF IX1=IX THEN            /* DID WE FIND A DUPLICATE?      */ 00037900
         C     R7,IX2                                           DSK1308 00038000
         BNE   @RF00338                                            0338 00038100
*           DO;                     /* NO MOVE VOLUME POINTER        */ 00038200
*             CAMVOLPT(IX)=GPVOLPTR;/*                               */ 00038300
         LR    R3,R7                                            DSK1308 00038400
         MH    R3,@CH12                                         DSK1308 00038501
         ALR   R3,R2                                            DSK1308 00038600
         AL    R3,@CFNEG10                                      DSK1308 00038701
         MVC   CAMVOLPT-2(12,R3),GPVOLPTR(R8)                   DSK1308 00038800
*             IX=IX+ONE;            /* STEP INDEX                    */ 00038900
         AL    R7,@CF1                                          DSK1308 00039001
*           END;                                                   0342 00039100
*       END;                                                       0343 00039200
@RF00338 AL    R8,@CF12                                         DSK1308 00039301
@DE00335 CR    R8,R9                                            DSK1308 00039400
         BNH   @DL00335                                            0343 00039500
@DC00335 DS    0H                                                  0344 00039600
*       CAMWKCNT=IX;                /* SET COUNT OF ENTRIES          */ 00039700
         STH   R7,CAMWKCNT(,R2)                                 DSK1308 00039800
*     END;                                                         0345 00039900
*   GEN(L      R14,RSAVA);          /* RESTORE ADDRESS               */ 00040000
         L      R14,RSAVA                                               00040100
*   /**TOP**OF**BLOCK**/   INDIRECT CATALOG ENTRY SUPPORT FOR NIP  @42A 00040202
         CLI   CAMWKCNT+1(R2),1        SINGLE-VOLUME DATA SET?     @42A 00040302
         BNE   @EL00003                NO, RETURN                  @42A 00040402
         CLC   CAMVOLSR(6,R2),SIXSTARS IS THE VOLSER 6 ASTERISKS?  @42A 00040502
         BNE   @EL00003                NO, RETURN                  @42A 00040602
         L     R3,CVTPTR(,0)           POINT TO THE CVT            @42A 00040702
         L     R3,CVTSYSAD-CVT(,R3)    POINT TO IPL VOLUME UCB     @42A 00040802
         USING UCBOB,R3                                            @42A 00040902
         MVC   CAMVOLSR(6,R2),UCBVOLI  LOAD VOLUME SERIAL          @42A 00041002
         MVC   CAMVOLPT(4,R2),UCBTYP   LOAD DEVICE TYPE            @42A 00041102
         NI    CAMVOLPT+1(R2),255-UCBRR-UCBVLPWR-UCBDVPWR          @42A 00041202
*   /**END**OF**BLOCK**/   INDIRECT CATALOG ENTRY SUPPORT FOR NIP  @42A 00041302
*   END MAPCPLOS;                                                  0347 00041400
         B     @EL00003                                            0347 00041500
*CTINTFAC:                                                         0348 00041600
*                                                                  0348 00041700
*   /*****************************************************************/ 00041800
*   /*                                                               */ 00041900
*   /* INTERFACE WITH THE CATALOG ROUTINE TRAP TEST FIELDS           */ 00042000
*   /*                                                               */ 00042100
*   /*****************************************************************/ 00042200
*                                                                  0348 00042300
*   PROC OPTIONS(NOSAVE,NOSAVEAREA);                               0348 00042400
CTINTFAC DS    0H                                                  0349 00042500
*   GEN(ST   R14,RSAVAA);                                          0349 00042600
         ST   R14,RSAVAA                                                00042700
*   IF CTGFLCHN^=ZERO THEN          /* IS THERE A TEST FIELD?        */ 00042800
         L     R6,CTGFLPTR                                      DSK1308 00042900
         L     R9,CTGFLCHN-CTGFL(,R6)                           DSK1308 00043000
         LTR   R9,R9                                            DSK1308 00043100
         BZ    @RF00350                                            0350 00043200
*     DO;                           /* YES DO                        */ 00043300
*       SAVFLPTR=CTGFLPTR;          /* SAVE FIELD POINTER            */ 00043400
         LR    R2,R6                                            DSK1308 00043500
*       CTGFLPTR=CTGFLCHN;          /* USE TEST FIELD POINTER        */ 00043600
         ST    R9,CTGFLPTR                                      DSK1308 00043700
*       IF FLNAME^='ITYPEXT ' THEN  /* IS SSW TEST                   */ 00043800
         L     R3,CTGFLDNM-CTGFL(,R9)                           DSK1308 00043900
         CLC   FLNAME(8,R3),@CC02529                            DSK1308 00044000
         BE    @RF00354                                            0354 00044100
*         DO;                       /* NO ERROR                      */ 00044200
*           ERRCD=RCINFNAM;         /* ERROR CODE                    */ 00044300
         MVC   ERRCD(4),@CF108                                     0356 00044401
*           RETURN TO EXIT;         /* BAIL OUT                      */ 00044500
         LA    R14,EXIT                                         DSK1308 00044600
@EL00004 DS    0H                                                  0357 00044700
@EF00004 DS    0H                                                  0357 00044800
@ER00004 BR    R14                                              DSK1308 00044900
*         END;                                                     0358 00045000
*       ELSE                        /* SSW TEST                      */ 00045100
*         SWSSW=ON;                 /* INTRESTED IN SSW DATA         */ 00045200
@RF00354 OI    SW,SWSSW                                            @42C 00045302
*       IX8=CTGFLDCD;               /* SET PTR TO TEST FIELD         */ 00045400
         L     R6,CTGFLPTR                                      DSK1308 00045500
         SLR   R9,R9                                            DSK1308 00045600
         IC    R9,CTGFLDCD-CTGFL(,R6)                           DSK1308 00045700
         ST    R9,IX9                                           DSK1308 00045800
*       IX9=CTGFLPT(ONE);                                          0361 00045900
         L     R9,CTGFLPT-CTGFL(,R6)                            DSK1308 00046000
         ST    R9,IX10                                          DSK1308 00046100
*       IXA=CTGFLNG(ONE);                                          0362 00046200
         L     R3,CTGFLNG-CTGFL(,R6)                            DSK1308 00046300
*       CTGFLPTR=SAVFLPTR;          /* RESTOTRE POINTERS             */ 00046400
         ST    R2,CTGFLPTR                                   03 DSK1308 00046500
*     END;                                                         0364 00046600
*   CALL CATLG;                     /* NO TEST CALL CATLG            */ 00046700
@RF00350 BAL   R14,CATLG                                        DSK1308 00046800
*   SWSSW=OFFX;                                                    0366 00046900
*   SWBADTST=OFFX;                  /* TURN OFF BAD SSW TEST         */ 00047000
         NI    SW,255-SWSSW-SWBADTST                               @42C 00047102
*   GEN(L    R14,RSAVAA);                                          0368 00047200
         L    R14,RSAVAA                                                00047300
*   END CTINTFAC;                                                  0369 00047400
         B     @EL00004                                            0369 00047500
*CATLG:                                                            0370 00047600
*                                                                  0370 00047700
*   /*****************************************************************/ 00047800
*   /*                                                               */ 00047900
*   /* GET REQUESTED FIELD(S) FROM THE CATALOG                       */ 00048000
*   /*                                                               */ 00048100
*   /*****************************************************************/ 00048200
*                                                                  0370 00048300
*   PROC OPTIONS(NOSAVE,NOSAVEAREA);                               0370 00048400
CATLG    DS    0H                                                  0371 00048500
*   GEN(ST     R14,RSAVA);                                         0371 00048600
         ST     R14,RSAVA                                               00048700
*   CPE0=CPX;                                                      0372 00048800
         L     R6,CPX                                           DSK1308 00048900
*   SWCOMB=OFFX;                    /* SET COMBINATION SW OFF        */ 00049000
         NI    SW,255-SWCOMB                                       @42C 00049102
*   DICTWK(1:2)=FLNAME(1:2);        /* FIRST HALVE OF CONDENSED NM   */ 00049200
         L     R9,CTGFLPTR                                      DSK1308 00049300
         L     R9,CTGFLDNM-CTGFL(,R9)                           DSK1308 00049400
         MVC   DICTWK(2),FLNAME(R9)                             DSK1308 00049500
*   DICTWK(3:4)=FLNAME(5:6);        /* SECOND HALVE OF COND NAME     */ 00049600
         MVC   DICTWK+2(2),FLNAME+4(R9)                         DSK1308 00049700
*   DO DICTPTR=DICTSTR TO DICTEND BY 8/* SEARCH DICTIONARY FOR       */ 00049800
*         WHILE(DICTWK^=DICTNAME);  /* REQUESTED ENTRY NULL DO LOOP  */ 00049900
         L     R9,DICTSTR                                       DSK1308 00050000
         B     @DE00376                                            0376 00050100
@DL00376 CLC   DICTWK(4),DICTNAME(R9)                           DSK1308 00050200
         BE    @DC00376                                            0376 00050300
*   END;                                                           0377 00050400
         AL    R9,@CF8                                          DSK1308 00050501
@DE00376 C     R9,DICTEND                                       DSK1308 00050600
         BNH   @DL00376                                            0377 00050700
@DC00376 DS    0H                                                  0378 00050800
*   IF DICTWK^=DICTNAME THEN        /* FOUND?                        */ 00050900
         CLC   DICTWK(4),DICTNAME(R9)                           DSK1308 00051000
         BE    @RF00378                                            0378 00051100
*     DO;                           /* NO, DO                        */ 00051200
*       ERRCD=RCINFNAM;             /* SET RETURN CODE               */ 00051300
         MVC   ERRCD(4),@CF108                                     0380 00051402
*       RETURN TO EXIT;             /* BAIL OUT                      */ 00051500
         LA    R14,EXIT                                         DSK1308 00051600
@EL00005 DS    0H                                                  0381 00051700
@EF00005 DS    0H                                                  0381 00051800
@ER00005 BR    R14                                              DSK1308 00051900
*     END;                                                         0382 00052000
*   IF DICTCOMB=ON THEN             /* COMBINATION?                  */ 00052100
@RF00378 DS    0H                                               DSK1308 00052200
         TM    DICTCOMB(R9),B'00100000'                         DSK1308 00052300
         BNO   @RF00383                                            0383 00052400
*     SWCOMB=ON;                                                   0384 00052500
         OI    SW,SWCOMB                                           @42C 00052602
*   IF(DICTGC=ZERO&DICTCOMB=OFFX)³DICTWK='CACB' THEN/* COMB OR GROUP    00052700
*                                      OR CATLG ACB REQ?             */ 00052800
@RF00383 DS    0H                                               DSK1308 00052900
         CLI   DICTGC(R9),0                                     DSK1308 00053000
         BNE   @GL00001                                            0385 00053100
         TM    DICTCOMB(R9),B'00100000'                         DSK1308 00053200
         BZ    @RT00385                                            0385 00053300
@GL00001 CLC   DICTWK(4),@CC02534                                  0385 00053400
         BNE   @RF00385                                            0385 00053500
@RT00385 DS    0H                                                  0386 00053600
*     DO;                                                          0386 00053700
*       IF DICTWK='CACB' THEN       /* REQ FOR CATLG ACB ADDR?       */ 00053800
         CLC   DICTWK(4),@CC02534                                  0387 00053900
         BNE   @RF00387                                            0387 00054000
*         DO;                                                      0388 00054100
*           GPFIELD(1:4)=CBSACB;    /* GIVE THE ACBADDRESS           */ 00054200
         L     R6,CBSPTR                                        DSK1308 00054300
         MVC   GPFIELD(4,R8),CBSACB(R6)                         DSK1308 00054400
*           GPFLDPTR=GPFLDPTR+FOUR;                                0390 00054500
         AL    R8,@CF4                                          DSK1308 00054601
*         END;                                                     0391 00054700
*       ELSE                        /* NOT CATLG ACB REQ             */ 00054800
*         CALL MOVFIXED;            /* MOVE A FIXED LENGTH FIELD     */ 00054900
         B     @RC00387                                            0392 00055000
@RF00387 BAL   R14,MOVFIXED                                     DSK1308 00055100
*     END;                                                         0393 00055200
*   ELSE                            /* COMBINATION OR GROUP          */ 00055300
*     DO;                                                          0394 00055400
         B     @RC00385                                            0394 00055500
@RF00385 DS    0H                                                  0395 00055600
*       IX3=ZERO;                   /* INITIALIZE TO AVOID MSG       */ 00055700
         SLR   R14,R14                                          DSK1308 00055800
         ST    R14,IX4                                          DSK1308 00055900
*       IF SWCOMB=OFFX THEN         /* IF WE DON"T HAVE A COMBINATION   00056000
*                                      FIELD                         */ 00056100
         TM    SW,SWCOMB                                           @42C 00056202
         BNZ   @RF00396                                            0396 00056300
*         IX2=ONE;                  /* SET LOOP COUNT TO 1           */ 00056400
         MVC   IX3(4),@CF1                                      DSK1308 00056501
*       ELSE                        /* IS COMBINATION FIELD          */ 00056600
*         DO;                                                      0398 00056700
         B     @RC00396                                            0398 00056800
@RF00396 DS    0H                                                  0399 00056900
*           IX3=ADDR(ZCS)+DICTST-ONE;/* POINT TO START OF DICTIONARY */ 00057000
         LA    R15,ZCS                                          DSK1308 00057100
         SLR   R14,R14                                          DSK1308 00057200
         IC    R14,DICTST(,R9)                                  DSK1308 00057300
         ALR   R15,R14                                          DSK1308 00057400
         BCTR  R15,0                                            DSK1308 00057500
         ST    R15,IX4                                          DSK1308 00057600
*           IX2=DICTLC;             /* LOOP COUNT = NBR OF FIELD     */ 00057700
         SLR   R15,R15                                          DSK1308 00057800
         IC    R15,DICTLC(,R9)                                  DSK1308 00057900
         ST    R15,IX3                                          DSK1308 00058000
*         END;                                                     0401 00058100
*       SWREPT=ON;                  /* TURN REPEATING SW ON          */ 00058200
@RC00396 DS    0H                                                  0403 00058300
*       SWVALUE=ON;                 /* SET VALUE FLAG ON             */ 00058400
         OI    SW,SWREPT+SWVALUE                                   @42C 00058502
*       GRPSEQNO=ONE;               /* SET THE GROUP SEQUENCE NBR    */ 00058600
         MVI   GRPSEQNO,X'01'                                      0404 00058700
*       DO WHILE SWREPT=ON&SWVALUE=ON;/* GET REPEATING VALUES        */ 00058800
         B     @DE00405                                            0405 00058900
@DL00405 DS    0H                                                  0406 00059000
*         SWDEL=OFFX;               /* DELETED SW OFF                */ 00059100
*         SWREPT=OFFX;                                             0407 00059200
*         SWVALUE=OFFX;                                            0408 00059300
*         SWREEP=OFFX;              /* RELREPNO SW OFF       @Z40WSRG*/ 00059400
         NI    SW,255-SWREEP-SWREPT-SWVALUE-SWDEL                  @42C 00059502
*         DO IX1=1 TO IX2           /* GET ALL VALUES OF COMB        */ 00059600
*               WHILE(SWDEL=OFFX);  /* QUIT IF GROUP DELETED         */ 00059700
         LA    R0,1                                             DSK1308 00059800
         B     @DE00410                                            0410 00059900
@DL00410 TM    SW,SWDEL                                            @42C 00060002
         BNZ   @DC00410                                            0410 00060100
*           IF SWCOMB=ON THEN       /* COMBINATION FIELD?            */ 00060200
         TM    SW,SWCOMB                                           @42C 00060302
         BNO   @RF00411                                            0411 00060400
*             DICTPTR=COMBPTR(IX1)*EIGHT-/* SET DICTPTR USING THE    */ 00060500
*                 EIGHT+ADDR(ZDT);  /* COMB PART OF DICTIONARY       */ 00060600
         L     R1,IX4                                           DSK1308 00060700
         LR    R2,R0                                            DSK1308 00060800
         BCTR  R1,0                                             DSK1308 00060900
         SLR   R9,R9                                            DSK1308 00061000
         IC    R9,COMBPTR(R2,R1)                                DSK1308 00061100
         SLA   R9,3                                             DSK1308 00061200
         SL    R9,@CF8                                          DSK1308 00061301
         LA    R14,ZDT                                          DSK1308 00061400
         ALR   R9,R14                                           DSK1308 00061500
*           IF DICTNAME='REEP' THEN /* IS RELREPNO THE FIELD?        */ 00061600
@RF00411 DS    0H                                               DSK1308 00061700
         CLC   DICTNAME(4,R9),@CC02536                          DSK1308 00061800
         BNE   @RF00413                                            0413 00061900
*             SWREEP=ON;            /* SET SW TO GET RELREPNO        */ 00062000
         OI    SW,SWREEP                                           @42C 00062102
*           ELSE                    /* NOT RELREPNO FIELD            */ 00062200
*             IF DICTGC=ZERO THEN   /* DO WE HAVE A GROUP?           */ 00062300
         B     @RC00413                                            0415 00062400
@RF00413 DS    0H                                               DSK1308 00062500
         CLI   DICTGC(R9),0                                     DSK1308 00062600
         BNE   @RF00415                                            0415 00062700
*               CALL MOVFIXED;      /* MOVE FIXED FIELD TO OUTPUT    */ 00062800
         BAL   R14,MOVFIXED                                     DSK1308 00062900
*             ELSE                  /* WE HAVE A GROUP               */ 00063000
*               CALL GETGROUP;      /* GET A GROUP ELEMENT           */ 00063100
         B     @RC00415                                            0417 00063200
@RF00415 BAL   R14,GETGROUP                                     DSK1308 00063300
*         END;                                                     0418 00063400
@RC00415 DS    0H                                                  0418 00063500
@RC00413 DS    0H                                               DSK1308 00063600
         LA    R0,1                                             DSK1308 00063700
         AL    R0,IX2                                           DSK1308 00063800
@DE00410 DS    0H                                               DSK1308 00063900
         ST    R0,IX2                                           DSK1308 00064000
         C     R0,IX3                                           DSK1308 00064100
         BNH   @DL00410                                            0418 00064200
@DC00410 DS    0H                                                  0419 00064300
*         GRPSEQNO=GRPSEQNO+ONE;    /* STEP GROUP SEQUENCE NBR       */ 00064400
         IC    R1,GRPSEQNO                                      DSK1308 00064500
         LA    R1,1(,R1)                                        DSK1308 00064600
         STC   R1,GRPSEQNO                                      DSK1308 00064700
*       END;                                                       0420 00064800
@DE00405 TM    SW,SWREPT+SWVALUE                                   @42C 00064902
         BO    @DL00405                                            0420 00065000
*     END;                                                         0421 00065100
*   GEN(L      R14,RSAVA);                                         0422 00065200
@RC00385 DS    0H                                                  0422 00065300
         L      R14,RSAVA                                               00065400
*   END CATLG;                                                     0423 00065500
         B     @EL00005                                            0423 00065600
*GETGROUP:                                                         0424 00065700
*                                                                  0424 00065800
*   /*****************************************************************/ 00065900
*   /*                                                               */ 00066000
*   /* GET A VALUE FROM A GROUP OCCURENCE ENTRY IN THE CATLAOG       */ 00066100
*   /*                                                               */ 00066200
*   /*****************************************************************/ 00066300
*                                                                  0424 00066400
*   PROC OPTIONS(NOSAVE,NOSAVEAREA);                               0424 00066500
GETGROUP DS    0H                                                  0425 00066600
*   GEN(ST     R14,RSAVB);                                         0425 00066700
         ST     R14,RSAVB                                               00066800
*   CALL FINDGOP;                   /* FIND THE PROPER GOP           */ 00066900
         BAL   R14,FINDGOP                                      DSK1308 00067000
*   IF(CCACPE5<CCACPE3)&(CATGODEL=OFFX) THEN/* DID WE FIND A VALUE   */ 00067100
         C     R2,CCACPE3(,R6)                              042 DSK1308 00067200
         BNL   @RF00427                                            0427 00067300
         TM    CATGODEL(R2),B'01000000'                         DSK1308 00067400
         BNZ   @RF00427                                            0427 00067500
*     DO;                           /* YES CONTINUE                  */ 00067600
*       IF SWREEP=ON THEN           /* RELREPNO REQUESTED?           */ 00067700
         TM    SW,SWREEP                                           @42C 00067802
         BNO   @RF00429                                            0429 00067900
*         DO;                       /* YES DO                        */ 00068000
*           RREPNO=GRPSEQNO;        /* MOVE TO OUTPUT                */ 00068100
         SLR   R3,R3                                            DSK1308 00068200
         IC    R3,GRPSEQNO                                      DSK1308 00068300
         STH   R3,RREPNO(,R8)                                   DSK1308 00068400
*           GPFLDPTR=GPFLDPTR+TWO;  /* ADVANCE PTR                   */ 00068500
         AL    R8,@CF2                                          DSK1308 00068601
*           SWREEP=OFFX;            /* RESET SWITCH                  */ 00068700
         NI    SW,255-SWREEP                                       @42C 00068802
*         END;                                                     0434 00068900
*       IF DICTREP=ON THEN          /* IS REPEATING FIELD?           */ 00069000
@RF00429 DS    0H                                               DSK1308 00069100
         TM    DICTREP(R9),B'01000000'                          DSK1308 00069200
         BNO   @RF00435                                            0435 00069300
*         SWREPT=ON;                /* SET REPEAT SW                 */ 00069400
         OI    SW,SWREPT                                           @42C 00069502
*       IF CATGOEXT=ON THEN         /* IS ENTRY IN ANOTHER RECORD    */ 00069600
@RF00435 TM    CATGOEXT(R2),B'10000000'                         DSK1308 00069700
         BNO   @RF00437                                            0437 00069800
*         DO;                       /* YES, GO GET IT                */ 00069900
*           CIWORK=CATGOCI;         /* MOVE CI NBR TO WORKAREA       */ 00070000
         MVC   CIWORK(3),CATGOCI(R2)                            DSK1308 00070100
*           CALL FINDCI;            /* FIND THE DESIRED REC          */ 00070200
         BAL   R14,FINDCI                                       DSK1308 00070300
*           CALL FINDGOP;           /* FIND THE PROPER GOP           */ 00070400
         BAL   R14,FINDGOP                                      DSK1308 00070500
*           IF CCACPE5^<CCACPE3³    /* MUST BE THERE                 */ 00070600
*               CATGOEXT=ON³        /* MUST NOT BE EXTERNAL          */ 00070700
*               CATGODEL=ON THEN    /* RECD'S MUST AGREE             */ 00070800
         C     R2,CCACPE3(,R6)                                  DSK1308 00070900
         BNL   @RT00442                                            0442 00071000
         TM    CATGOEXT(R2),B'11000000'                         DSK1308 00071100
         BZ    @RF00442                                            0442 00071200
@RT00442 DS    0H                                                  0443 00071300
*             DO;                   /* WE HAVE A BAD RECORD          */ 00071400
*               ERRCD=RCINFNAM;     /* SET ERROR CODE                */ 00071500
         MVC   ERRCD(4),@CF108                                     0444 00071601
*               RETURN TO EXIT;     /* BAIL OUT                      */ 00071700
         LA    R14,EXIT                                         DSK1308 00071800
@EL00006 DS    0H                                                  0445 00071900
@EF00006 DS    0H                                                  0445 00072000
@ER00006 BR    R14                                              DSK1308 00072100
*             END;                                                 0446 00072200
*         END;                                                     0447 00072300
@RF00442 DS    0H                                                  0448 00072400
*       CALL MOVGROUP;              /* MOVE A G O ELEMENT            */ 00072500
@RF00437 BAL   R14,MOVGROUP                                     DSK1308 00072600
*     END;                                                         0449 00072700
*   ELSE                            /* NO VALUE                      */ 00072800
*     IF(CCACPE5<CCACPE3)&(CATGODEL=ON) THEN/* DELETED RECORD?       */ 00072900
         B     @RC00427                                            0450 00073000
@RF00427 C     R2,CCACPE3(,R6)                                  DSK1308 00073100
         BNL   @RF00450                                            0450 00073200
         TM    CATGODEL(R2),B'01000000'                         DSK1308 00073300
         BNO   @RF00450                                            0450 00073400
*       SWDEL=ON;                                                  0451 00073500
         OI    SW,SWDEL                                            @42C 00073602
*   CPE0=CPX;                       /* RESTORE POINTER               */ 00073700
@RF00450 DS    0H                                                  0452 00073800
@RC00427 L     R6,CPX                                           DSK1308 00073900
*   GEN(L      R14,RSAVB);                                         0453 00074000
         L      R14,RSAVB                                               00074100
*   END GETGROUP;                                                  0454 00074200
         B     @EL00006                                            0454 00074300
*FINDGOP:                                                          0455 00074400
*                                                                  0455 00074500
*   /*****************************************************************/ 00074600
*   /*                                                               */ 00074700
*   /* FIND THE PROPER GROUP OCCURENCE POINTER                       */ 00074800
*   /*                                                               */ 00074900
*   /*****************************************************************/ 00075000
*                                                                  0455 00075100
*   PROC OPTIONS(NOSAVE,NOSAVEAREA);                               0455 00075200
FINDGOP  DS    0H                                                  0456 00075300
*   GEN(ST     R14,RSAVC);                                         0456 00075400
         ST     R14,RSAVC                                               00075500
*   CCACPE5=ADDR(REPGOPT(ONE));     /* POINT TO START OF GROUP     0457 00075600
*                                      OCCURENCE POINTERS            */ 00075700
         L     R2,CCACPE2(,R6)                                  DSK1308 00075800
         LA    R2,REPGOPT(,R2)                                  DSK1308 00075900
*   DO WHILE((CCACPE5<CCACPE3)&     /* NOT PASSED TO GOP'S           */ 00076000
*         ((DICTGC^=(CATGOGC1&TRUEGC))³/* FIND THE RIGHT GROUP       */ 00076100
*         (CATGOSEQ^=GRPSEQNO)));   /* AND THE RIGHT REPETITION      */ 00076200
         B     @DE00458                                            0458 00076300
@DL00458 DS    0H                                                  0459 00076400
*     CCACPE5=CCACPE5+LENGTH(CATGOPT);/* STEP BASE                   */ 00076500
         AL    R2,@CF5                                          DSK1308 00076601
*   END;                                                           0460 00076700
@DE00458 C     R2,CCACPE3(,R6)                                  DSK1308 00076800
         BNL   @DC00458                                            0460 00076900
         SLR   R3,R3                                            DSK1308 00077000
         IC    R3,CATGOGC1(,R2)                                 DSK1308 00077100
         SLR   R4,R4                                            DSK1308 00077200
         IC    R4,TRUEGC                                        DSK1308 00077300
         NR    R3,R4                                            DSK1308 00077400
         SLR   R5,R5                                            DSK1308 00077500
         IC    R5,DICTGC(,R9)                                   DSK1308 00077600
         CR    R3,R5                                            DSK1308 00077700
         BNE   @DL00458                                            0460 00077800
         CLC   CATGOSEQ(1,R2),GRPSEQNO                          DSK1308 00077900
         BNE   @DL00458                                            0460 00078000
@DC00458 DS    0H                                                  0461 00078100
*   GEN(L      R14,RSAVC);                                         0461 00078200
         L      R14,RSAVC                                               00078300
*   END FINDGOP;                                                   0462 00078400
@EL00007 DS    0H                                                  0462 00078500
@EF00007 DS    0H                                                  0462 00078600
@ER00007 BR    R14                                              DSK1308 00078700
*MOVFIXED:                                                         0463 00078800
*                                                                  0463 00078900
*   /*****************************************************************/ 00079000
*   /*                                                               */ 00079100
*   /* MOVE A FIXED LENGTH FIELD FROM A CATALOG RECORD TO THE USERS  */ 00079200
*   /* WORK AREA                                                     */ 00079300
*   /*                                                               */ 00079400
*   /*****************************************************************/ 00079500
*                                                                  0463 00079600
*   PROC OPTIONS(NOSAVE,NOSAVEAREA);                               0463 00079700
MOVFIXED DS    0H                                                  0464 00079800
*   GEN(ST   R14,RSAVC);                                           0464 00079900
         ST   R14,RSAVC                                                 00080000
*   FLLENGTH=DICTLC;                                               0465 00080100
         SLR   R14,R14                                          DSK1308 00080200
         IC    R14,DICTLC(,R9)                                  DSK1308 00080300
         STH   R14,FLLENGTH                                     DSK1308 00080400
*   CALL TESTSIZE;                  /* CHK WKAREA SIZE               */ 00080500
         BAL   R14,TESTSIZE                                     DSK1308 00080600
*   IX4=DICTST+ONE;                                                0467 00080700
         LA    R15,1                                            DSK1308 00080800
         SLR   R14,R14                                          DSK1308 00080900
         IC    R14,DICTST(,R9)                                  DSK1308 00081000
         ALR   R15,R14                                          DSK1308 00081100
         ST    R15,IX5                                          DSK1308 00081200
*   GPFIELD(1:FLLENGTH)=            /* OUTPUT AREA                   */ 00081300
*       CATRCD(IX4:IX4+FLLENGTH);   /* INPUT AREA                    */ 00081400
         LH    R14,FLLENGTH                                     DSK1308 00081500
         LR    R0,R14                                           DSK1308 00081600
         BCTR  R0,0                                             DSK1308 00081700
         L     R1,CCACPE1(,R6)                                  DSK1308 00081800
         ALR   R1,R15                                           DSK1308 00081900
         BCTR  R1,0                                             DSK1308 00082000
         LR    R15,R0                                           DSK1308 00082100
         EX    R15,@SM02610                                     DSK1308 00082200
*   GPFLDPTR=GPFLDPTR+FLLENGTH;     /* ADVANCE POINTER               */ 00082300
         ALR   R8,R14                                           DSK1308 00082400
*   SWVALUE=ON;                     /* INDICATE WE GOT A FIELD       */ 00082500
         OI    SW,SWVALUE                                          @42C 00082602
*   GEN(L    R14,RSAVC);                                           0471 00082700
         L    R14,RSAVC                                                 00082800
*   END MOVFIXED;                                                  0472 00082900
@EL00008 DS    0H                                                  0472 00083000
@EF00008 DS    0H                                                  0472 00083100
@ER00008 BR    R14                                              DSK1308 00083200
*MOVGROUP:                                                         0473 00083300
*                                                                  0473 00083400
*   /*****************************************************************/ 00083500
*   /*                                                               */ 00083600
*   /* MOVE AN ELEMENT OF A GROUP OCCURENCE                          */ 00083700
*   /*                                                               */ 00083800
*   /*****************************************************************/ 00083900
*                                                                  0473 00084000
*   PROC OPTIONS(NOSAVE,NOSAVEAREA);                               0473 00084100
MOVGROUP DS    0H                                                  0474 00084200
*   GEN(ST    R14,RSAVC);                                          0474 00084300
         ST    R14,RSAVC                                                00084400
*   CCACPE6=CCACPE3+CATGODSP;       /* SET POINTER TO FIELD          */ 00084500
         ICM   R3,12,CATGODSP(R2)                               DSK1308 00084600
         SRA   R3,16                                            DSK1308 00084700
         AL    R3,CCACPE3(,R6)                                  DSK1308 00084800
         ST    R3,CCACPE6                                       DSK1308 00084900
*   IF(SWSSW=ON)&SWBADTST=OFFX THEN /* INTRESTED IN SSW              */ 00085000
         TM    SW,SWSSW                                            @42C 00085102
         BNO   @RF00476                                            0476 00085200
         TM    SW,SWBADTST                                         @42C 00085302
         BNZ   @RF00476                                            0476 00085400
*     DO;                           /* MAKE CONDITION TEST           */ 00085500
*       RFY                                                        0478 00085600
*        (R1,                                                      0478 00085700
*         R14,                                                     0478 00085800
*         R15) RSTD;                                               0478 00085900
*       R15=IX9->TESTSW;            /* POINT AT TEST FIELD           */ 00086000
         L     R6,IX10                                          DSK1308 00086100
         SLR   R15,R15                                             0479 00086200
         IC    R15,TESTSW(,R6)                                  DSK1308 00086300
*       R14=CCACPE6+DICTTYP;        /* POINT AT CATALOG FIELD        */ 00086400
         AL    R3,DICTTYP                                       DSK1308 00086500
         LR    R14,R3                                           DSK1308 00086600
*       R1=IX8;                     /* TEST CONDITION                */ 00086700
         L     R1,IX9                                           DSK1308 00086800
*       GEN;                                                       0482 00086900
        EX    R15,SSWTEST              TEST USER SPECIFIED CONDITION    00087000
        EX    R1,SSWTSTBR              USE BC INST FOR USERS CC         00087100
        B     SSWFAIL                  TEST FAILED                      00087200
SSWTEST TM    0(R14),0                 TEST FIELD                       00087300
SSWTSTBR BC   0,SSWOK                  IF COND SATISIFYED BR            00087400
*SSWFAIL:                                                          0483 00087500
*       SWBADTST=ON;                /* SET TEST FAILED SW            */ 00087600
SSWFAIL  OI    SW,SWBADTST                                         @42C 00087702
*SSWOK:                             /* PASSED USER TEST              */ 00087800
*       RFY                                                        0484 00087900
*        (R1,                                                      0484 00088000
*         R14,                                                     0484 00088100
*         R15) UNRSTD;                                             0484 00088200
SSWOK    DS    0H                                                  0485 00088300
*     END;                                                         0485 00088400
*   IF SWBADTST=OFFX THEN           /* DID WE PASS TEST?             */ 00088500
@RF00476 TM    SW,SWBADTST                                         @42C 00088602
         BNZ   @RF00486                                            0486 00088700
*     DO;                                                          0487 00088800
*       IF DICTVAR=OFFX THEN        /* IS IT A VARIABLE LENGTH FLD   */ 00088900
         TM    DICTVAR(R9),B'10000000'                          DSK1308 00089000
         BNZ   @RF00488                                            0488 00089100
*         DO;                       /* NO, DO                        */ 00089200
*           CCACPE6=CCACPE6+DICTST;                                0490 00089300
         SLR   R6,R6                                            DSK1308 00089400
         IC    R6,DICTST(,R9)                                   DSK1308 00089500
         AL    R6,CCACPE6                                       DSK1308 00089600
         ST    R6,CCACPE6                                       DSK1308 00089700
*           FLLENGTH=DICTLC;                                       0491 00089800
         SLR   R6,R6                                            DSK1308 00089900
         IC    R6,DICTLC(,R9)                                   DSK1308 00090000
         STH   R6,FLLENGTH                                      DSK1308 00090100
*           CALL TESTSIZE;          /* CHK WKAREA SIZE               */ 00090200
         BAL   R14,TESTSIZE                                     DSK1308 00090300
*           GPFIELD(1:FLLENGTH)=    /* OUTPUT AREA                   */ 00090400
*               CCACPE6->GPFIELD(1:FLLENGTH);/* INPUT AREA           */ 00090500
         LH    R6,FLLENGTH                                      DSK1308 00090600
         LR    R14,R6                                           DSK1308 00090700
         BCTR  R14,0                                            DSK1308 00090800
         L     R1,CCACPE6                                       DSK1308 00090900
         EX    R14,@SM02612                                     DSK1308 00091000
*           GPFLDPTR=GPFLDPTR+FLLENGTH;/* ADVANCE OUTPUT POINTER     */ 00091100
         ALR   R8,R6                                            DSK1308 00091200
*         END;                                                     0495 00091300
*       ELSE                        /* NOT VARIABLE LENGTH           */ 00091400
*         DO;                                                      0496 00091500
         B     @RC00488                                            0496 00091600
@RF00488 DS    0H                                                  0497 00091700
*           CCACPE7=CCACPE6+LENFIX; /* POINT TO START OF VAR FLDS    */ 00091800
         L     R6,CCACPE6                                       DSK1308 00091900
         SLR   R14,R14                                          DSK1308 00092000
         IC    R14,LENFIX(,R6)                                  DSK1308 00092100
         ALR   R14,R6                                           DSK1308 00092200
         ST    R14,CCACPE7                                      DSK1308 00092300
*           IF DICTLC>CNTVAR THEN   /* CATLG ERROR?                  */ 00092400
         CLC   DICTLC(1,R9),CNTVAR(R6)                          DSK1308 00092500
         BNH   @RF00498                                            0498 00092600
*             DO;                   /* YES QUIT                      */ 00092700
*               NVTFLWSC=NVTWCN10;                                 0500 00092800
         L     R6,NVTPTR                                        DSK1308 00092900
         MVI   NVTFLWSC-NVT(R6),X'5F'                           DSK1308 00093000
*               GEN(LM   R2,R3,LOCPTR);                            0501 00093100
         LM   R2,R3,LOCPTR                                              00093200
*               GEN(IEAPMNIP TYPE=SWAIT);/* GO TO SYSTEM WAIT ROUTINE*/ 00093300
         IEAPMNIP TYPE=SWAIT,PLS=NO                             DSK1308 00093400
*             END;                                                 0503 00093500
*           DO IX4=2 TO DICTLC;     /* ADVANCE CATALOG PTR TO FLD    */ 00093600
@RF00498 LA    R6,2                                             DSK1308 00093700
         B     @DE00504                                            0504 00093800
@DL00504 DS    0H                                                  0505 00093900
*             FLLENGTH=VARLEN+TWO;                                 0505 00094000
         L     R14,CCACPE7                                      DSK1308 00094100
         ICM   R15,12,VARLEN(R14)                               DSK1308 00094200
         SRA   R15,16                                           DSK1308 00094300
         AL    R15,@CF2                                         DSK1308 00094401
         STH   R15,FLLENGTH                                     DSK1308 00094500
*             CCACPE7=CCACPE7+FLLENGTH;                            0506 00094600
         ALR   R14,R15                                          DSK1308 00094700
         ST    R14,CCACPE7                                      DSK1308 00094800
*           END;                                                   0507 00094900
         AL    R6,@CF1                                          DSK1308 00095001
@DE00504 ST    R6,IX5                                           DSK1308 00095100
         SLR   R0,R0                                            DSK1308 00095200
         IC    R0,DICTLC(,R9)                                   DSK1308 00095300
         CR    R6,R0                                            DSK1308 00095400
         BNH   @DL00504                                            0507 00095500
*           FLLENGTH=VARLEN+TWO;    /* STEP FLLENGTH ONE MORE TIM    */ 00095600
         L     R6,CCACPE7                                       DSK1308 00095700
         ICM   R6,12,VARLEN(R6)                                 DSK1308 00095800
         SRA   R6,16                                            DSK1308 00095900
         LA    R6,2(,R6)                                        DSK1308 00096000
         STH   R6,FLLENGTH                                      DSK1308 00096100
*           CALL TESTSIZE;          /* CHK WKAREA SIZE               */ 00096200
         BAL   R14,TESTSIZE                                     DSK1308 00096300
*           GPFIELD(1:FLLENGTH)=    /* OUTPUT AREA                   */ 00096400
*               CCACPE7->GPFIELD(1:FLLENGTH);/* INPUT AREA           */ 00096500
         LH    R6,FLLENGTH                                      DSK1308 00096600
         LR    R14,R6                                           DSK1308 00096700
         BCTR  R14,0                                            DSK1308 00096800
         L     R1,CCACPE7                                       DSK1308 00096900
         EX    R14,@SM02612                                     DSK1308 00097000
*           GPFLDPTR=GPFLDPTR+FLLENGTH;                            0511 00097100
         ALR   R8,R6                                            DSK1308 00097200
*         END;                                                     0512 00097300
*     END;                                                         0513 00097400
@RC00488 DS    0H                                                  0514 00097500
*   SWVALUE=ON;                     /* INDICATE WE GOT A FIELD       */ 00097600
@RF00486 OI    SW,SWVALUE                                          @42C 00097702
*   GEN(L    R14,RSAVC);                                           0515 00097800
         L    R14,RSAVC                                                 00097900
*   END MOVGROUP;                                                  0516 00098000
@EL00009 DS    0H                                                  0516 00098100
@EF00009 DS    0H                                                  0516 00098200
@ER00009 BR    R14                                              DSK1308 00098300
*FINDCI:                                                           0517 00098400
*                                                                  0517 00098500
*   /*****************************************************************/ 00098600
*   /*                                                               */ 00098700
*   /* FIND A RECORD BY CI NBR. EITHER ON DISK OR IN CORE(BUFFER)    */ 00098800
*   /*                                                               */ 00098900
*   /*****************************************************************/ 00099000
*                                                                  0517 00099100
*   PROC OPTIONS(NOSAVE,NOSAVEAREA);                               0517 00099200
FINDCI   DS    0H                                                  0518 00099300
*   GEN(ST     R14,RSAVC);                                         0518 00099400
         ST     R14,RSAVC                                               00099500
*   IX2=ONE;                        /* INITIALIZE SECONDARY INDEX    */ 00099600
         LA    R2,1                                             DSK1308 00099700
         ST    R2,IX3                                           DSK1308 00099800
*   CPE0=ZERO;                      /* INIT OUTPUT AREA              */ 00099900
         SLR   R6,R6                                            DSK1308 00100000
         ST    R2,IX2                                           DSK1308 00100100
A000774  DS    0H                                               DSK1308 00100200
         SLA   R2,3                                             DSK1308 00100300
         LA    R3,665(R2,R11)                                   DSK1308 00100400
         SLR   R4,R4                                            DSK1308 00100500
         ICM   R4,7,0(R3)                                       DSK1308 00100600
*   DO IX1=1 TO TEN                 /* SEE IF REC IS IN BUFFER       */ 00100700
*         WHILE(BFCI(IX1)^=ZERO);   /* OR FIND AN AVAILABLE SLOT     */ 00100800
@DL00521 DS    0H                                               DSK1308 00100900
         LTR   R4,R4                                            DSK1308 00101000
         BZ    @DC00521                                            0521 00101100
*     IF BFCI(IX1)=CIWORK THEN      /* DID WE FIND IT?               */ 00101200
         SLR   R5,R5                                            DSK1308 00101300
         ICM   R5,7,CIWORK                                      DSK1308 00101400
         CR    R4,R5                                            DSK1308 00101500
         BNE   @RF00522                                            0522 00101600
*       DO;                         /* YES, DO                       */ 00101700
*         CPE0=BFPTR(IX1);          /* SET OUTPUT POINTER            */ 00101800
         L     R6,BFPTR-8(R2)                                   DSK1308 00101900
*         IF BFCTR(IX1)^=H255 THEN  /* IF NOT THE MAIN CI            */ 00102000
         SLR   R3,R3                                            DSK1308 00102100
         IC    R3,BFCTR-8(R2)                                   DSK1308 00102200
         C     R3,@CF255                                        DSK1308 00102301
         BE    @RF00528                                         DSK1308 00102400
*           BFCTR(IX1)=BFCTR(IX1)+ONE;/* INCR USE COUNTER            */ 00102500
         AL    R3,@CF1                                          DSK1308 00102601
         STC   R3,BFCTR-8(R2)                                   DSK1308 00102700
*       END;                                                       0527 00102800
*     ELSE                          /* NO UNUSED SLOTS               */ 00102900
*       IF BFCTR(IX1)<BFCTR(IX2) THEN/* SMALLEST USE CNT?            */ 00103000
         B     @RF00528                                         DSK1308 00103100
@RF00522 DS    0H                                               DSK1308 00103200
         L     R4,IX2                                           DSK1308 00103300
         LR    R5,R4                                            DSK1308 00103400
         SLA   R5,3                                             DSK1308 00103500
         L     R14,IX3                                          DSK1308 00103600
         SLA   R14,3                                            DSK1308 00103700
         LA    R1,BFCTR-8(R5)                                   DSK1308 00103800
         LA    R15,BFCTR-8(R14)                                 DSK1308 00103900
         CLC   0(1,R1),0(R15)                                   DSK1308 00104000
         BNL   @RF00528                                            0528 00104100
*         IX2=IX1;                  /* YES RESET                     */ 00104200
         ST    R4,IX3                                           DSK1308 00104300
*   END;                                                           0530 00104400
@RF00528 DS    0H                                                  0530 00104500
         LA    R2,1                                             DSK1308 00104600
@RC00522 AL    R2,IX2                                           DSK1308 00104700
         ST    R2,IX2                                           DSK1308 00104800
         C     R2,@CF10                                         DSK1308 00104901
         BNH   A000774                                          DSK1308 00105000
@DC00521 DS    0H                                                  0531 00105100
*   IF CPE0=ZERO THEN               /* DID WE FIND IT?               */ 00105200
         LTR   R6,R6                                            DSK1308 00105300
         BNZ   @RF00531                                            0531 00105400
*     DO;                           /* NO, DO                        */ 00105500
*       BUFCDDDD=CIWORK*AMDCINV;    /* COMPUTE NEW RBA               */ 00105600
         L     R6,AMBPTR                                        DSK1308 00105700
         L     R6,AMBDSB-IDAAMB(,R6)                            DSK1308 00105800
         SLR   R3,R3                                            DSK1308 00105900
         ICM   R3,7,CIWORK                                      DSK1308 00106000
         M     R2,AMDCINV-IDAAMDSB(,R6)                         DSK1308 00106100
         ST    R3,BUFCDDDD-IDABUFC(,R10)                        DSK1308 00106200
*/* NOTE:                                                            */ 00106300
*/*      THE WAY THE RBA IS COMPUTED MAY CHANGE WHEN THE CATALOG     */ 00106400
*/*      COPY ROUTINE IS AVAILABLE.                                  */ 00106500
*                                                                  0534 00106600
*       CALL RDRBA;                 /* CALL THE BLOCK PROCESSOR      */ 00106700
         BAL   R14,RDRBA                                        DSK1308 00106800
*       IF BFCI(IX1)^=ZERO THEN     /* IF THERE IS NO EMPTY SLOT     */ 00106900
         L     R6,IX2                                           DSK1308 00107000
         SLA   R6,3                                             DSK1308 00107100
         LA    R1,665(R6,R11)                                   DSK1308 00107200
         SLR   R6,R6                                            DSK1308 00107300
         ICM   R6,7,0(R1)                                       DSK1308 00107400
         LTR   R6,R6                                            DSK1308 00107500
         BZ    @RF00535                                            0535 00107600
*         IX1=IX2;                  /* USE THE LEAST USED SLOT       */ 00107700
         L     R6,IX3                                           DSK1308 00107800
*       BFCI(IX1)=CIWORK;           /* SET THE CI NBR                */ 00107900
         ST    R6,IX2                                           DSK1308 00108000
@RF00535 DS    0H                                               DSK1308 00108100
         L     R6,IX2                                           DSK1308 00108200
         SLA   R6,3                                             DSK1308 00108300
         LA    R1,BFCI-8(R6)                                    DSK1308 00108400
         MVC   0(3,R1),CIWORK                                   DSK1308 00108500
*       IF BFCTR(IX1)^=H255 THEN    /* IF NOT THE MAIN REC           */ 00108600
         SLR   R2,R2                                            DSK1308 00108700
         IC    R2,BFCTR-8(R6)                                   DSK1308 00108800
         C     R2,@CF255                                        DSK1308 00108901
         BE    @RF00538                                            0538 00109000
*         BFCTR(IX1)=ONE;           /* INIT THE USE COUNT            */ 00109100
         LA    R3,1                                             DSK1308 00109200
         STC   R3,BFCTR-8(R6)                                   DSK1308 00109300
*       IX4=ADDR(CATLGBUF(IX1));    /* ADDR OF AREA TO PUT REC       */ 00109400
@RF00538 DS    0H                                               DSK1308 00109500
         L     R4,IX2                                           DSK1308 00109600
         SLA   R4,9                                             DSK1308 00109700
         L     R1,CATBFPTR                                      DSK1308 00109800
         AL    R1,@CFNG512                                      DSK1308 00109901
         LA    R2,CATLGBUF(R4,R1)                               DSK1308 00110000
         ST    R2,IX5                                           DSK1308 00110100
*       IX5=BUFCBAD;                /* ADDR OF I/O BUFFER            */ 00110200
         L     R4,BUFCBAD-IDABUFC(,R10)                         DSK1308 00110300
         ST    R4,IX6                                           DSK1308 00110400
*       GEN REFS(IX4,IX5,CATCISZ) SETS(CATLGBUF,TEMPSR);           0542 00110500
        STM   R2,R5,TEMPSR                                              00110600
         L     R2,IX6                  FROM ADDRESS             DSK1308 00110700
         L     R4,IX5                  TO ADDRESS               DSK1308 00110800
        LA    R3,LNTHINDX              LENGTH OF RECORD                 00110900
        LR    R5,R3                    LENGTH OF RECORD                 00111000
        MVCL  R4,R2                    MOVE RECORD                      00111100
        LM    R2,R4,TEMPSR                                              00111200
         L     R5,IX2                                           DSK1308 00111300
*       CPE0=ADDR(CCACPE(IX1));     /* BASE FOR BASES                */ 00111400
         LR    R6,R5                                            DSK1308 00111500
         SLA   R6,4                                             DSK1308 00111600
         LA    R6,CCACPE-16(R6)                                 DSK1308 00111700
*       CCACPE1=ADDR(CATLGBUF(IX1));                               0544 00111800
         SLA   R5,9                                             DSK1308 00111900
         L     R1,CATBFPTR                                      DSK1308 00112000
         AL    R1,@CFNG512                                      DSK1308 00112101
         LA    R2,CATLGBUF(R5,R1)                               DSK1308 00112200
         ST    R2,CCACPE1(,R6)                                  DSK1308 00112300
*       CCACPE7=CCACPE1+NREPLF;     /* START OF VARIABLE FLDS        */ 00112400
         SLR   R3,R3                                            DSK1308 00112500
         IC    R3,NREPLF(,R2)                                   DSK1308 00112600
         ALR   R3,R2                                            DSK1308 00112700
         ST    R3,CCACPE7                                       DSK1308 00112800
*       DO IX2=2 TO NREPCV;         /* FIND END OF VARIABLE FLDS     */ 00112900
         LA    R4,2                                             DSK1308 00113000
         B     @DE00546                                            0546 00113100
@DL00546 DS    0H                                                  0547 00113200
*         CCACPE7=CCACPE7+VARLEN+TWO;                              0547 00113300
         L     R5,CCACPE7                                       DSK1308 00113400
         ICM   R14,12,VARLEN(R5)                                DSK1308 00113500
         SRA   R14,16                                           DSK1308 00113600
         ALR   R14,R5                                           DSK1308 00113700
         AL    R14,@CF2                                         DSK1308 00113801
         ST    R14,CCACPE7                                      DSK1308 00113900
*       END;                                                       0548 00114000
         AL    R4,@CF1                                          DSK1308 00114101
@DE00546 ST    R4,IX3                                           DSK1308 00114200
         L     R5,CCACPE1(,R6)                                  DSK1308 00114300
         SLR   R14,R14                                          DSK1308 00114400
         IC    R14,NREPCV(,R5)                                  DSK1308 00114500
         CR    R4,R14                                           DSK1308 00114600
         BNH   @DL00546                                            0548 00114700
*       CCACPE2=CCACPE7;            /* PTR TO CTL INFO FOR REPEAT  0549 00114800
*                                      FIELDS                        */ 00114900
         L     R15,CCACPE7                                      DSK1308 00115000
         ST    R15,CCACPE2(,R6)                                 DSK1308 00115100
*       CCACPE3=CCACPE2+REPCNT*(LENGTH(CATGOPT))+/* POINTER TO       */ 00115200
*           LENGTH(EXTRCDPT)+LENGTH(REPCNT);/* GRP OCCURRENCES       */ 00115300
         SLR   R14,R14                                          DSK1308 00115400
         IC    R14,REPCNT(,R15)                                 DSK1308 00115500
         MH    R14,@CH5                                         DSK1308 00115601
         ALR   R15,R14                                          DSK1308 00115700
         AL    R15,@CF6                                         DSK1308 00115801
         ST    R15,CCACPE3(,R6)                                 DSK1308 00115900
*       CCACPE4=CCACPE1+RCDSIZ;     /* POINTER TO END OF RECORD      */ 00116000
         L     R15,CCACPE1(,R6)                                 DSK1308 00116100
         ICM   R14,12,RCDSIZ(R15)                               DSK1308 00116200
         SRA   R14,16                                           DSK1308 00116300
         ALR   R14,R15                                          DSK1308 00116400
         ST    R14,CCACPE4(,R6)                                 DSK1308 00116500
*       GEN(L      R14,RSAVC);                                     0552 00116600
         L      R14,RSAVC                                               00116700
*     END;                                                         0553 00116800
*   END FINDCI;                                                    0554 00116900
@EL00010 DS    0H                                                  0554 00117000
@EF00010 DS    0H                                                  0554 00117100
@ER00010 BR    R14                                              DSK1308 00117200
*GETTRNM:                                                          0555 00117300
*                                                                  0555 00117400
*   /*****************************************************************/ 00117500
*   /*                                                               */ 00117600
*   /* GET THE TRUE NAME RECORD (PROPER INDEX WILL BE IN IX)         */ 00117700
*   /*                                                               */ 00117800
*   /*****************************************************************/ 00117900
*                                                                  0555 00118000
*   PROC OPTIONS(NOSAVE,NOSAVEAREA);                               0555 00118100
GETTRNM  DS    0H                                                  0556 00118200
*   GEN(ST     R14,RSAVA);                                         0556 00118300
         ST     R14,RSAVA                                               00118400
*   AMBPTR=AMBLIX;                  /* POINT TO INDEX                */ 00118500
         L     R3,AMBLIX-IDAAMBL(,R6)                           DSK1308 00118600
         ST    R3,AMBPTR                                        DSK1308 00118700
*   BUFCPTR=IOMBUFC;                                               0558 00118800
         L     R7,AMBIOMB-IDAAMB(,R3)                           DSK1308 00118900
         L     R10,IOMBUFC-IOMB(,R7)                            DSK1308 00119000
*   BUFCDDDD=AMDHLRBA;              /* SET FIRST RBA                 */ 00119100
         L     R3,AMBDSB-IDAAMB(,R3)                            DSK1308 00119200
         L     R9,AMDHLRBA-IDAAMDSB(,R3)                        DSK1308 00119300
         ST    R9,BUFCDDDD-IDABUFC(,R10)                        DSK1308 00119400
*   SCIBRCD=-ONE;                   /* SET FOR DO LOOP               */ 00119500
         SLR   R2,R2                                            DSK1308 00119600
         BCTR  R2,0                                             DSK1308 00119700
*   DO WHILE(IXHLV^=ONE³SCIBRCD^=ZERO);/* DO UNTIL WE GET TO THE SS  */ 00119800
         B     @DE00561                                            0561 00119900
@DL00561 DS    0H                                                  0562 00120000
*     CALL RDRBA;                   /* GET AN INDEX RECORD           */ 00120100
         BAL   R14,RDRBA                                        DSK1308 00120200
*     RFY                                                          0563 00120300
*       RETCODE RSTD;                                              0563 00120400
*     CALL SCIB;                    /* SCAN INDEX BLOCK              */ 00120500
         BAL   R14,SCIB                                         DSK1308 00120600
*     SCIBRCD=RETCODE;              /* SAVE RETURN CD                */ 00120700
         LR    R2,R15                                           DSK1308 00120800
*     IF RETCODE^=ZERO THEN         /* DID WE FIND AN ENTRY?         */ 00120900
         LTR   R15,R15                                          DSK1308 00121000
         BZ    @RF00566                                            0566 00121100
*       BUFCDDDD=IXHHP;             /* NO USE THE HOROZANTAL PTR     */ 00121200
         L     R3,BUFCBAD-IDABUFC(,R10)                         DSK1308 00121300
         L     R9,IXHHP-IDAIXH(,R3)                             DSK1308 00121400
         ST    R9,BUFCDDDD-IDABUFC(,R10)                        DSK1308 00121500
*     ELSE                          /* ENTRY FOUND                   */ 00121600
*       DO;                                                        0568 00121700
         B     @RC00566                                            0568 00121800
@RF00566 DS    0H                                                  0569 00121900
*         IX4=IXSHEP+LENGTH(IBFLPF) /* POINT TO THE RECORD           */ 00122000
*             +LENGTH(IBFLPL);      /* POINTER                       */ 00122100
         LA    R14,IXSPAREA                                     DSK1308 00122200
         LA    R3,2                                             DSK1308 00122300
         AL    R3,IXSHEP(,R14)                                  DSK1308 00122400
         ST    R3,IX5                                           DSK1308 00122500
*         IX5=IXHPTLS;              /* GET MASK FOR HEADER           */ 00122600
         L     R7,BUFCBAD-IDABUFC(,R10)                         DSK1308 00122700
         SLR   R9,R9                                            DSK1308 00122800
         IC    R9,IXHPTLS-IDAIXH(,R7)                           DSK1308 00122900
         ST    R9,IX6                                           DSK1308 00123000
*         GEN REFS(IX4,IX5);                                       0571 00123100
        STM   R2,R5,TEMPSR                                              00123200
        SR    R2,R2                                                     00123300
         L     R5,IX5                 LOAD ADDR OF POINTER      DSK1308 00123400
         L     R4,IX6                 LOAD MASK FROM REC HEADER DSK1308 00123500
        EX    R4,INSERT                ICM THE NEXT REC PTR             00123600
         ST    R2,IX5                 SAVE VALUE                DSK1308 00123700
        LM    R2,R5,TEMPSR             RECOVER REGS                     00123800
        B     NOINST                   DONT MOVE POINTER                00123900
INSERT  ICM   R2,0,0(R5)                MOVES POINTER FROM BUFFER       00124000
NOINST  EQU *                          BR POINT                         00124100
*         BUFCDDDD=IX4*AMDCINV+IXHBRBA;/* COMPUTE RBA OF NEXT REC    */ 00124200
         L     R14,AMBPTR                                       DSK1308 00124300
         L     R3,AMBDSB-IDAAMB(,R14)                           DSK1308 00124400
         L     R5,IX5                                           DSK1308 00124500
         M     R4,AMDCINV-IDAAMDSB(,R3)                         DSK1308 00124600
         L     R7,BUFCBAD-IDABUFC(,R10)                         DSK1308 00124700
         AL    R5,IXHBRBA-IDAIXH(,R7)                           DSK1308 00124800
         ST    R5,BUFCDDDD-IDABUFC(,R10)                        DSK1308 00124900
*         HLDRBA=BUFCDDDD;                                         0573 00125000
         ST    R5,HLDRBA                                        DSK1308 00125100
*       END;                                                       0574 00125200
*     RFY                                                          0575 00125300
*       RETCODE UNRSTD;                                            0575 00125400
@RC00566 DS    0H                                                  0576 00125500
*   END;                                                           0576 00125600
@DE00561 L     R9,BUFCBAD-IDABUFC(,R10)                         DSK1308 00125700
         CLI   IXHLV-IDAIXH(R9),1                               DSK1308 00125800
         BNE   @DL00561                                            0576 00125900
         LTR   R2,R2                                            DSK1308 00126000
         BNZ   @DL00561                                            0576 00126100
*   AMBPTR=AMBLDTA;                 /* POINT TO INDEX                */ 00126200
         L     R7,AMBLDTA-IDAAMBL(,R6)                          DSK1308 00126300
         ST    R7,AMBPTR                                        DSK1308 00126400
*   BUFCPTR=IOMBUFC;                                               0578 00126500
         L     R9,AMBIOMB-IDAAMB(,R7)                           DSK1308 00126600
         L     R10,IOMBUFC-IOMB(,R9)                            DSK1308 00126700
*   BUFCDDDD=HLDRBA;                /* COMPUTE RBA OF NEXT REC       */ 00126800
         L     R9,HLDRBA                                        DSK1308 00126900
         ST    R9,BUFCDDDD-IDABUFC(,R10)                        DSK1308 00127000
*   CALL RDRBA;                     /* RD BY RBA                     */ 00127100
         BAL   R14,RDRBA                                        DSK1308 00127200
*   RFY                                                            0581 00127300
*     R0 RSTD;                                                     0581 00127400
*   R0=ONE;                                                        0582 00127500
         LA    R0,1                                                0582 00127600
*   IF RDF1LAST=ON THEN             /* DO WE HAVE A COUNT    @ZA07015*/ 00127700
         L     R1,BUFCBAD-IDABUFC(,R10)                         DSK1308 00127800
         TM    RDF1LAST(R1),B'01000000'                         DSK1308 00127900
         BNO   @RF00583                                            0583 00128000
*     IX=RECCNT;                    /* YES USE IT            @ZA07015*/ 00128100
         SLR   R7,R7                                            DSK1308 00128200
         ICM   R7,3,RECCNT(R1)                                  DSK1308 00128300
*   ELSE                                                           0585 00128400
*     IX=1;                         /* NO, USE A COUNT OF 1  @ZA07015*/ 00128500
         B     @RC00583                                            0585 00128600
@RF00583 LA    R7,1                                             DSK1308 00128700
*   DO IX=IX TO 1 BY-1              /* SEARCH THE TRUE NAME CI     0586 00128800
*                                                            @ZA07015*/ 00128900
*         WHILE(R0^=ZERO);                                         0586 00129000
@RC00583 B     @DE00586                                            0586 00129100
@DL00586 LTR   R0,R0                                               0586 00129200
         BZ    @DC00586                                            0586 00129300
*     IF TRUENAME(IX)=DSNAME THEN   /* FOR THE TRUE NAME RECORD      */ 00129400
         LR    R9,R7                                            DSK1308 00129500
         MH    R9,@CH02592                                      DSK1308 00129600
         L     R1,BUFCBAD-IDABUFC(,R10)                         DSK1308 00129700
         L     R6,CTGPLPTR                                      DSK1308 00129800
         L     R6,CTGENT-CTGPL(,R6)                                @42C 00129900
         ST    R9,@TF00001                                      DSK1308 00130000
         ALR   R9,R1                                            DSK1308 00130100
         AL    R9,@CFNEG47                                      DSK1308 00130201
         CLC   TRUENAME(44,R9),DSNAME(R6)                       DSK1308 00130300
         BNE   @RF00587                                            0587 00130400
*       DO;                                                        0588 00130500
*         CIWORK=TRUENMCI(IX);      /* SET VALUE FOR LATER           */ 00130600
         AL    R1,@TF00001                                      DSK1308 00130700
         AL    R1,@CFNEG3                                       DSK1308 00130801
         MVC   CIWORK(3),TRUENMCI-44(R1)                        DSK1308 00130900
*         R0=ZERO;                  /* GET OUT OF LOOP               */ 00131000
         SLR   R0,R0                                               0590 00131100
*       END;                                                       0591 00131200
*   END;                                                           0592 00131300
@RF00587 BCTR  R7,0                                             DSK1308 00131400
@DE00586 LTR   R7,R7                                            DSK1308 00131500
         BP    @DL00586                                            0592 00131600
@DC00586 DS    0H                                                  0593 00131700
*   IF R0^=ZERO THEN                /* DID WE FIND THE TRUE NAME     */ 00131800
         LTR   R0,R0                                               0593 00131900
         BZ    @RF00593                                            0593 00132000
*     DO;                                                          0594 00132100
*       ERRCD=RCENT;                /* SET ERROR CODE                */ 00132200
         MVC   ERRCD(4),@CF8                                       0595 00132301
*       RETURN TO EXIT;             /* BAIL OUT                      */ 00132400
         LA    R14,EXIT                                         DSK1308 00132500
@EL00011 DS    0H                                                  0596 00132600
@EF00011 DS    0H                                                  0596 00132700
@ER00011 BR    R14                                              DSK1308 00132800
*     END;                                                         0597 00132900
*   GEN(L    R14,RSAVA);                                           0598 00133000
@RF00593 DS    0H                                                  0598 00133100
         L    R14,RSAVA                                                 00133200
*   END GETTRNM;                                                   0599 00133300
         B     @EL00011                                            0599 00133400
*RDRBA:                                                            0600 00133500
*                                                                  0600 00133600
*   /*****************************************************************/ 00133700
*   /*                                                               */ 00133800
*   /* SET UP TO CALL THE BLOCK PROCESSOR                            */ 00133900
*   /*                                                               */ 00134000
*   /*****************************************************************/ 00134100
*                                                                  0600 00134200
*   PROC;                                                          0600 00134300
RDRBA    STM   R14,R12,@SA00012                                 DSK1308 00134400
*   ECB=ZERO;                       /* SET THE ECB                   */ 00134500
         L     R1,AMBPTR                                        DSK1308 00134600
         L     R1,AMBIOMB-IDAAMB(,R1)                           DSK1308 00134700
         L     R2,IOMECBPT-IOMB(,R1)                            DSK1308 00134800
         SLR   R3,R3                                            DSK1308 00134900
         ST    R3,ECB(,R2)                                      DSK1308 00135000
*   RFY                                                            0602 00135100
*    (R0,                                                          0602 00135200
*     R1,                                                          0602 00135300
*     R14,                                                         0602 00135400
*     R15) RSTD;                                                   0602 00135500
*   BUFCRRD=ON;                     /* INDICATE READ                 */ 00135600
*   BUFCXEDB=OFFX;                  /* TURN OFF EDB ERROR FLG        */ 00135700
         OI    BUFCIOFL-IDABUFC(R10),BUFCRRD                    DSK1308 00135800
         NI    BUFCIOFL-IDABUFC(R10),255-BUFCXEDB               DSK1308 00135900
*   BUFCER1=OFFX;                   /* TURN OFF READ ERROR FLAG      */ 00136000
*   BUFCER2=OFFX;                   /* TURN OFF WRITE ERROR FLAG     */ 00136100
         NI    BUFCFLG1-IDABUFC(R10),255-BUFCER1-BUFCER2        DSK1308 00136200
*   BUFCAVL='FF'X;                  /* INDICATE AVAILABLE            */ 00136300
         MVI   BUFCAVL-IDABUFC(R10),X'FF'                       DSK1308 00136400
*   IOMFLAGS='0000'X;               /* RESET BLOCK PROCC FLAGS       */ 00136500
         L     R4,AMBPTR                                        DSK1308 00136600
         L     R5,AMBIOMB-IDAAMB(,R4)                           DSK1308 00136700
         XC    IOMFLAGS-IOMB(3,R5),IOMFLAGS-IOMB(R5)            DSK1308 00136800
*   R0=ADDR(SRB);                                                  0609 00136900
         L     R6,IOMIOSB-IOMB(,R5)                             DSK1308 00137000
         L     R0,IOSSRB-IOSB(,R6)                              DSK1308 00137100
*   R1=ADDR(IOSB);                                                 0610 00137200
         LR    R1,R6                                            DSK1308 00137300
*   R15=ABPABP;                     /* ENTRY POINT ADDR FOR BP       */ 00137400
         L     R2,CVTADR                                        DSK1308 00137500
         L     R3,CVTIOBP-CVT(,R2)                              DSK1308 00137600
         L     R15,ABPABP(,R3)                                  DSK1308 00137700
*   ABPWORK(1:80)=ABPCALL(1:80);    /* MOVE TO WORKING STG           */ 00137800
         MVC   ABPWORK(12),ABPCALL                              DSK1308 00137900
*   GEN(BAL R14,ABPWORK);           /* FOR RENTRENT CODE             */ 00138000
         BAL   R14,ABPWORK                                      DSK1308 00138100
*   GEN DATA DEFS(ABPCALL);                                        0614 00138200
*LAB:                                                              0615 00138300
*   IF BUFCER1=ON³BUFCER2=ON³       /* I/O ERROR?                    */ 00138400
*       BUFCXEDB=ON THEN            /* POSSIBLE BAD CTL BLK          */ 00138500
LAB      TM    BUFCFLG1-IDABUFC(R10),BUFCER1+BUFCER2            DSK1308 00138600
         BNZ   @RT00615                                            0615 00138700
         TM    BUFCIOFL-IDABUFC(R10),BUFCXEDB                   DSK1308 00138800
         BNO   @RF00615                                            0615 00138900
@RT00615 DS    0H                                                  0616 00139000
*     DO;                                                          0616 00139100
*       ERRCD=RCIOL;                /* SET RETURN CODE               */ 00139200
         MVC   ERRCD(4),@CF24                                      0617 00139301
*       RETURN TO EXIT;             /* BAIL OUT                      */ 00139400
         LA    R14,EXIT                                         DSK1308 00139500
         LM    R15,R12,@SA00012+4                               DSK1308 00139600
         BR    R14                                              DSK1308 00139700
*     END;                                                         0619 00139800
*   R1=ADDR(ECB);                   /* SET UP FOR WAIT               */ 00139900
@RF00615 L     R2,AMBPTR                                        DSK1308 00140000
         L     R3,AMBIOMB-IDAAMB(,R2)                           DSK1308 00140100
         L     R1,IOMECBPT-IOMB(,R3)                            DSK1308 00140200
*   GEN(WAIT ECB=(1));                                             0621 00140300
         WAIT ECB=(1)                                                   00140400
*   IF ECBCODE^='7F'X THEN          /* ERROR?                        */ 00140500
         L     R2,AMBPTR                                        DSK1308 00140600
         L     R3,AMBIOMB-IDAAMB(,R2)                           DSK1308 00140700
         L     R4,IOMECBPT-IOMB(,R3)                            DSK1308 00140800
         CLI   ECBCODE(R4),X'7F'                                DSK1308 00140900
         BE    @RF00622                                            0622 00141000
*     DO;                                                          0623 00141100
*       ERRCD=RCIOL;                /* YES, SET RETURN CODE          */ 00141200
         MVC   ERRCD(4),@CF24                                      0624 00141301
*       RETURN TO EXIT;             /* BAIL OUT                      */ 00141400
         LA    R14,EXIT                                         DSK1308 00141500
         LM    R15,R12,@SA00012+4                               DSK1308 00141600
         BR    R14                                              DSK1308 00141700
*     END;                                                         0626 00141800
*   END RDRBA;                                                     0627 00141900
@EL00012 DS    0H                                                  0627 00142000
@EF00012 DS    0H                                                  0627 00142100
@ER00012 LM    R14,R12,@SA00012                                 DSK1308 00142200
         BR    R14                                              DSK1308 00142300
*CTLBKPTR:                                                         0628 00142400
*                                                                  0628 00142500
*   /*****************************************************************/ 00142600
*   /*                                                               */ 00142700
*   /* ESTABLISH CONTACT WITH THE MASTER CATALOG CONTROL BLOCKS AND  */ 00142800
*   /* SET UP POINTERS                                               */ 00142900
*   /*                                                               */ 00143000
*   /*****************************************************************/ 00143100
*                                                                  0628 00143200
*   PROC OPTIONS(NOSAVE,NOSAVEAREA);                               0628 00143300
CTLBKPTR DS    0H                                                  0629 00143400
*   GEN(ST     R14,RSAVA);                                         0629 00143500
         ST     R14,RSAVA                                               00143600
*   CBSPTR=CVTCBSP;                 /* ADDRESSING FOR THE AMCBS      */ 00143700
         L     R7,CVTADR                                        DSK1308 00143800
         L     R8,CVTCBSP-CVT(,R7)                              DSK1308 00143900
         ST    R8,CBSPTR                                        DSK1308 00144000
*   AMBLPTR=ACBAMBL;                /* ADDRESSING FOR THE AMBL       */ 00144100
         L     R8,CBSACB(,R8)                                   DSK1308 00144200
         L     R6,ACBAMBL-IFGACB(,R8)                           DSK1308 00144300
*   AMBPTR=AMBLDTA;                 /* PT FIRST AT THE DATA AMB      */ 00144400
         L     R8,AMBLDTA-IDAAMBL(,R6)                          DSK1308 00144500
         ST    R8,AMBPTR                                        DSK1308 00144600
*   HLD=ZERO;                       /* SET TO AVOIND MSG             */ 00144700
         SLR   R9,R9                                            DSK1308 00144800
*   DO IX=2 TO 1 BY-1;              /* BOTH DATA AND INDEX           */ 00144900
         LA    R7,2                                             DSK1308 00145000
@DL00634 DS    0H                                                  0635 00145100
*     IF AMBPTR=AMBLDTA THEN        /* PLH IS ATTACHED ONLY TO DATA  */ 00145200
         L     R8,AMBPTR                                        DSK1308 00145300
         C     R8,AMBLDTA-IDAAMBL(,R6)                          DSK1308 00145400
         BNE   @RF00635                                            0635 00145500
*       DO;                                                        0636 00145600
*         IOMPLH=AMBPH+LENGTH(IDAPLHDR);/* POINT AT PLACEHOLDER      */ 00145700
         L     R2,AMBIOMB-IDAAMB(,R8)                           DSK1308 00145800
         LA    R3,16                                            DSK1308 00145900
         AL    R3,AMBPH-IDAAMB(,R8)                             DSK1308 00146000
         ST    R3,IOMPLH-IOMB(,R2)                              DSK1308 00146100
*         HLD=IOMPLH;               /* SAVE TO USE WITH INDEX        */ 00146200
         LR    R9,R3                                            DSK1308 00146300
*       END;                                                       0639 00146400
*     ELSE                          /* INDEX AMB                     */ 00146500
*       IOMPLH=HLD;                 /* POINT TO PLACEHOLDER          */ 00146600
         B     @RC00635                                            0640 00146700
@RF00635 L     R8,AMBPTR                                        DSK1308 00146800
         L     R8,AMBIOMB-IDAAMB(,R8)                           DSK1308 00146900
         ST    R9,IOMPLH-IOMB(,R8)                              DSK1308 00147000
*     IOMBUFC=AMBBUFC+LENGTH(IDABUFDR);/* POINT TO BUFC              */ 00147100
@RC00635 L     R8,AMBPTR                                        DSK1308 00147200
         L     R2,AMBIOMB-IDAAMB(,R8)                           DSK1308 00147300
         LA    R3,20                                            DSK1308 00147400
         AL    R3,AMBBUFC-IDAAMB(,R8)                           DSK1308 00147500
         ST    R3,IOMBUFC-IOMB(,R2)                             DSK1308 00147600
*     IOMCPA=IOMBUFC->BUFCCPA;      /* REQUIRED BY BLOCK PROCESS     */ 00147700
         L     R8,BUFCCPA-IDABUFC(,R3)                          DSK1308 00147800
         ST    R8,IOMCPA-IOMB(,R2)                              DSK1308 00147900
*     AMBPTR=AMBLIX;                /* SWITCH POINTERS TO INDEX      */ 00148000
         L     R8,AMBLIX-IDAAMBL(,R6)                           DSK1308 00148100
         ST    R8,AMBPTR                                        DSK1308 00148200
*   END;                                                           0644 00148300
         BCTR  R7,0                                             DSK1308 00148400
         LTR   R7,R7                                            DSK1308 00148500
         BP    @DL00634                                            0644 00148600
*   AMBPTR=AMBLDTA;                 /* SET FOR LOCATE BY CI          */ 00148700
         L     R7,AMBLDTA-IDAAMBL(,R6)                          DSK1308 00148800
         ST    R7,AMBPTR                                        DSK1308 00148900
*   BUFCPTR=IOMBUFC;                /* DATA SIDE ONLY THEN           */ 00149000
         L     R7,AMBIOMB-IDAAMB(,R7)                           DSK1308 00149100
         L     R10,IOMBUFC-IOMB(,R7)                            DSK1308 00149200
*   GEN(L    R14,RSAVA);                                           0647 00149300
         L    R14,RSAVA                                                 00149400
*   END CTLBKPTR;                                                  0648 00149500
@EL00013 DS    0H                                                  0648 00149600
@EF00013 DS    0H                                                  0648 00149700
@ER00013 BR    R14                                              DSK1308 00149800
*TESTSIZE:                                                         0649 00149900
*                                                                  0649 00150000
*   /*****************************************************************/ 00150100
*   /*                                                               */ 00150200
*   /* MAKE SURE THAT THE FIELD WE ARE BEING ASKED TO MOVE WILL FIT  */ 00150300
*   /* IN TO THE OUTPUT AREA                                         */ 00150400
*   /*                                                               */ 00150500
*   /*****************************************************************/ 00150600
*                                                                  0649 00150700
*   PROC OPTIONS(NOSAVE,NOSAVEAREA);                               0649 00150800
TESTSIZE DS    0H                                                  0650 00150900
*   GEN(ST    R14,RSAVD);                                          0650 00151000
         ST    R14,RSAVD                                                00151100
*   IF GPFLDPTR+FLLENGTH>CTWKLIMT THEN/* FIELD TO BIG?               */ 00151200
         LR    R2,R8                                            DSK1308 00151300
         AH    R2,FLLENGTH                                      DSK1308 00151400
         C     R2,CTWKLIMT                                      DSK1308 00151500
         BNH   @RF00651                                            0651 00151600
*     DO;                                                          0652 00151700
*       ERRCD=RCVLSM;               /* WORKAREA TO SMALL             */ 00151800
         MVC   ERRCD(4),@CF44                                      0653 00151901
*       RETURN TO EXIT;             /* BAIL OUT                      */ 00152000
         LA    R14,EXIT                                         DSK1308 00152100
@EL00014 DS    0H                                                  0654 00152200
@EF00014 DS    0H                                                  0654 00152300
@ER00014 BR    R14                                              DSK1308 00152400
*     END;                                                         0655 00152500
*   GEN(L    R14,RSAVD);                                           0656 00152600
@RF00651 DS    0H                                                  0656 00152700
         L    R14,RSAVD                                                 00152800
*   END TESTSIZE;                                                  0657 00152900
         B     @EL00014                                            0657 00153000
*GETWORK:                                                          0658 00153100
*                                                                  0658 00153200
*/* GET WORKING STORAGE - USE & FREED IN THIS MODULE                 */ 00153300
*                                                                  0658 00153400
*   PROC OPTIONS(NOSAVE,NOSAVEAREA);                               0658 00153500
GETWORK  DS    0H                                                  0659 00153600
*   GEN(ST     R14,RSAVC);                                         0659 00153700
         ST     R14,RSAVC                                               00153800
*   WKLEN=(WKLEN+SEVEN)/EIGHT*EIGHT;                               0660 00153900
         LA    R8,7                                             DSK1308 00154000
         AH    R8,WKLEN                                         DSK1308 00154100
         SRDA  R8,32                                            DSK1308 00154200
         D     R8,@CF8                                          DSK1308 00154301
         SLA   R9,3                                             DSK1308 00154400
         STH   R9,WKLEN                                         DSK1308 00154500
*   RFY                                                            0661 00154600
*     RETCODE RSTD;                                                0661 00154700
*   GEN REFS(WKLEN,LOCPTR) SETS(WKCORE,RETCODE);                   0662 00154800
         STM R2,R5,TEMPSR                                               00154900
         LH    R5,WKLEN                                                 00155000
         LM   R2,R3,LOCPTR                                              00155100
         GETMAIN EC,LV=(R5),A=WKCORE,SP=0,MF=(E,MAINLIST)               00155200
*   IF RETCODE^=ZERO THEN           /* IF GETMAIN WAS UNSUCCESSFULL  */ 00155300
         LTR   R15,R15                                          DSK1308 00155400
         BZ    @RF00663                                            0663 00155500
*     DO;                                                          0664 00155600
*       NVTFLWSC=NVTWCN01;                                         0665 00155700
         L     R7,NVTPTR                                        DSK1308 00155800
         MVI   NVTFLWSC-NVT(R7),X'63'                           DSK1308 00155900
*       GEN(IEAPMNIP TYPE=SWAIT);   /* GO TO SYSTEM WAIT ROUTINE     */ 00156000
         IEAPMNIP TYPE=SWAIT,PLS=NO                             DSK1308 00156100
*     END;                                                         0667 00156200
*   GEN(L     R4,WKCORE);                                          0668 00156300
@RF00663 DS    0H                                                  0668 00156400
         L     R4,WKCORE                                                00156500
*   GEN(SR    R3,R3);                                              0669 00156600
         SR    R3,R3                                                    00156700
*   GEN(MVCL R4,R2);                                               0670 00156800
         MVCL R4,R2                                                     00156900
*   GEN(LM R2,R5,TEMPSR);                                          0671 00157000
         LM R2,R5,TEMPSR                                                00157100
*   RFY                                                            0672 00157200
*     RETCODE UNRSTD;                                              0672 00157300
*   GEN(L      R14,RSAVC);                                         0673 00157400
         L      R14,RSAVC                                               00157500
*   END GETWORK;                                                   0674 00157600
@EL00015 DS    0H                                                  0674 00157700
@EF00015 DS    0H                                                  0674 00157800
@ER00015 BR    R14                                              DSK1308 00157900
*FREEWORK:                                                         0675 00158000
*                                                                  0675 00158100
*/* FREE TEMPORARY WORKING STORAGE                                   */ 00158200
*                                                                  0675 00158300
*   PROC OPTIONS(NOSAVE,NOSAVEAREA);                               0675 00158400
FREEWORK DS    0H                                                  0676 00158500
*   GEN(ST     R14,RSAVC);                                         0676 00158600
         ST     R14,RSAVC                                               00158700
*   GEN REFS(LOCPTR) SETS(FREELEN,FREEAD,MAINLIST);                0677 00158800
         STM  R2,R5,TEMPSR                                              00158900
         L     R5,FREELEN                                               00159000
         LA    R4,FREEAD                                                00159100
         LM   R2,R3,LOCPTR                                              00159200
         FREEMAIN E,LV=(R5),A=(R4),SP=0,MF=(E,MAINLIST)                 00159300
         LM  R2,R5,TEMPSR                                               00159400
*   GEN(L      R14,RSAVC);                                         0678 00159500
         L      R14,RSAVC                                               00159600
*   END FREEWORK;                                                  0679 00159700
@EL00016 DS    0H                                                  0679 00159800
@EF00016 DS    0H                                                  0679 00159900
@ER00016 BR    R14                                              DSK1308 00160000
*SCIB:                                                             0680 00160100
*                                                                  0680 00160200
*   /*****************************************************************/ 00160300
*   /*                                                               */ 00160400
*   /* SCAN INDEX BLOCK ROUTTNE ---- THIS ROUTINE IS TAKEN ALMOST    */ 00160500
*   /* INTACT FROM IDA019RC. THE CHANGES ARE FOR THE PURPOSE OF      */ 00160600
*   /* KEEPING THE REGISTERS FREE.                                   */ 00160700
*   /*                                                               */ 00160800
*   /*****************************************************************/ 00160900
*                                                                  0680 00161000
*   PROC;                                                          0680 00161100
SCIB     STM   R14,R12,@SA00017                                 DSK1308 00161200
*   IX4=BUFCBAD;                    /* ADDRESS OF THE START OF INPUT    00161300
*                                      BUFFER                        */ 00161400
         L     R9,BUFCBAD-IDABUFC(,R10)                         DSK1308 00161500
         ST    R9,IX5                                           DSK1308 00161600
*   IX5=ADDR(IDAIXSPL);             /* ADDRESS OF WORK AREA          */ 00161700
         LA    R2,IXSPAREA                                      DSK1308 00161800
         ST    R2,IX6                                           DSK1308 00161900
*   IX6=CTGENT;                     /* POINTER TO THE DSNAME         */ 00162000
         L     R4,CTGPLPTR                                      DSK1308 00162100
         L     R5,CTGENT-CTGPL(,R4)                                @42C 00162200
         ST    R5,IX8                                           DSK1308 00162300
*   GEN REFS(IBFLPF,IBFLPL,IXHLEO,IXHLL,IXHSEO,IXSEKON,IXSHEP,IXSLEP,   00162400
*       IXSPEC,IXSSEP,IXHFLPLN,IX4,IX5,IX6);                       0684 00162500
         L     R4,IX5                                           DSK1308 00162600
         L     RWORK3,IX6                                       DSK1308 00162700
         L     RPARM1,IX8                                       DSK1308 00162800
        SR    RWORK1,RWORK1            CLEAR REGISTER                   00162900
        STC   RWORK1,IXSPEC(RWORK3)    CLEAR PREVIOUS COUNTER           00163000
        SR    RWORK0,RWORK0            CLEAR REGISTER                   00163100
        IC    RWORK0,IXHFLPLN-IDAIXH(R4)                        DSK1308 00163200
        STC   RWORK0,IXSEKON(RWORK3)   SAVE IN WORK AREA                00163300
        OI    IXSBFLG(RWORK3),X80      SET FLAG SHOWING SECTION SEARCH  00163400
        ICM   RWORK1,K3,IXHLL-IDAIXH(R4)                        DSK1308 00163500
        AR    RWORK1,R4                                         DSK1308 00163600
        SR    RWORK1,RWORK0            BACK UP OVER F,L, POINTER        00163700
        ST    RWORK1,IXSLEP(RWORK3)    SAVE LOW KEY ADDRESS             00163800
        SR    RWORK1,RWORK1            CLEAR REG                        00163900
        ICM   RWORK1,K3,IXHSEO-IDAIXH(R4)                       DSK1308 00164000
        AR    RWORK1,R4                                         DSK1308 00164100
        SR    R15,R15                   ADDRESS                         00164200
COMFN1  SR    RWORK2,RWORK2            CLEAR REGISTERS                  00164300
COMFN2  SR    RWORK4,RWORK4             ...                             00164400
        SR    RWORK5,RWORK5             ...                             00164500
COMFN3  ST    RWORK1,IXSHEP(RWORK3)    SAVE STARTING POINT              00164600
        IC    RWORK2,IBFLPF(RWORK1)    PICK UP F FIELD                  00164700
        CR    RWORK2,R15               COMPARE IT TO NO. HITS           00164800
        BNE   SCIB2                    MISMATCH                         00164900
        TM    IBFLPL(RWORK1),X255     IS THE L FIELD ZERO               00165000
        BZ    SCIB9                    YES, DISCONTINUE THIS SEARCH     00165100
        IC    RWORK5,IBFLPL(RWORK1)    GET LENGTH OF KEY                00165200
        SR    RWORK1,RWORK5            MOVE POINTER TO BEGINNING OF     00165300
COMAI   IC    RWORK4,DZ(RPARM1,R15)     KEY--PICK UP ARG. CHARACTER     00165400
        IC    RWORK2,DZ(RWORK1)        PICK UP INDEX CHARACTER          00165500
        CR    RWORK4,RWORK2            ARE THEY EQUAL                   00165600
        BNE   SCIB1                    NO                               00165700
        LA    R15,ONE(R15)               YES, BUMP UP NO. HITS          00165800
        LA    RWORK1,ONE(RWORK1)       MOVE POINTER TO NEXT CHARACTER   00165900
        BCT   RWORK5,COMAI             BACK TO COMPARE IF ANY ARE LEFT  00166000
SCIB9   TM    IXSBFLG(RWORK3),X80      IS THIS A SECTION SEARCH         00166100
        BNZ   SCIB10                   YES                              00166200
        SR    R15,R15                  CLEAR REG  INDICATING SUCCESS    00166300
*SCIB91:                                                           0685 00166400
*   RETURN CODE(R15);               /* RETURN TO CALLER              */ 00166500
SCIB91   L     R14,@SA00017                                     DSK1308 00166600
         LM    R0,R12,@SA00017+8                                DSK1308 00166700
         BR    R14                                              DSK1308 00166800
*   GEN;                                                           0686 00166900
SCIB1   BH    SCIB3                    IS THE ARG GREATER--YES          00167000
        B     SCIB9                    NO, SEARCH COMPLETE              00167100
SCIB2   BL    SCIB9                    IF F LESS THAN N GO              00167200
SCIB3   TM    IXSBFLG(RWORK3),X80     F HIGHER, IS THIS SECT. SEARCH    00167300
        BZ    SCIB5                    NO, INNER SECT, SEARCH           00167400
*                                                                       00167500
*   THE FOLLOWING CODE IS REQUIRED TO TEST FOR END OF BUFFER, THAT IS,  00167600
*   NO MORE SECTIONS FOLLOW TO BE SEARCHED.  IF NOT END OF SECTION      00167700
*   POINTERS MUST BE UPDATED TO NEXT SECTION.  ALSO THE LOW KEY ADD.    00167800
*   OF THE NEXT SECTION MUST BE SAVED. THE NO OF CHARACTERS WHICH HAVE  00167900
*   COMPARED EQUAL (HITS) IS ALSO SAVED FOR LATER USE IN SEARCHING      00168000
*   WITHIN THE SECTION.                                                 00168100
*                                                                       00168200
        ICM   RWORK2,K3,IXHLEO-IDAIXH(R4)                       DSK1308 00168300
        AR    RWORK2,R4                                         DSK1308 00168400
        CR    RWORK2,RWORK1            HAVE WE MOVED BEYOND END         00168500
        BNL   SCIB7                    YES, NO MATCH IN THIS BUFFER     00168600
        L     RWORK1,IXSHEP(RWORK3)    POINT BACK TO OLD BASE           00168700
        LR    RWORK5,RWORK1            GET SAME ADDRESS IN RW5          00168800
        IC    RWORK4,IBFLPL(RWORK1)    GET L FROM INDEX                 00168900
        STC   R15,IXSPEC(RWORK3)       SAVE FOR PREVIOUS ENTRY COUNT    00169000
        SR    RWORK5,RWORK4            MOVE BACK TO KEY AREA            00169100
        SH    RWORK5,HLF2              MOVE TO POINTER                  00169200
        ICM   RWORK4,K3,DZ(RWORK5)     PICK UP DISP. TO NEXT SECTION    00169300
        SR    RWORK5,RWORK0            MOVE ADDRESS PAST POINT, L,F     00169400
        ST    RWORK5,IXSLEP(RWORK3)    SAVE LOW ENTRY OF SECT IN WORK   00169500
        SR    RWORK1,RWORK4            UPDATE TO NEXT SECTION           00169600
        B     COMFN1                   BACK TO CONTINUE SEARCH          00169700
*                                                                       00169800
*   THE FOLLOWING CODE UPDATES POINTERS TO CONTINUE SEARCH              00169900
*   WITHIN A SECTION.  WE CANNOT EXIT WITHOUT LOCATING AN ENTRY         00170000
*   SINCE A SECTION SEARCH CAUSED US TO DO THE INNER SECTION SEARCH     00170100
*                                                                       00170200
SCIB5   L     RWORK1,IXSHEP(RWORK3)    START WITH ORIGINAL POINTER      00170300
        IC    RWORK4,IBFLPL(RWORK1)    GET L VALUE                      00170400
        SR    RWORK1,RWORK4            BACK OVER KEY                    00170500
        SR    RWORK1,RWORK0            BACK OVER POINTER,L,F            00170600
        STC   R15,IXSPEC(RWORK3)       SAVE NO. MATCHES FOR PREV. CNT.  00170700
        B     COMFN2                   BACK FOR SEARCH                  00170800
*                                                                       00170900
*  BLOCK HAS BEEN SEARCHED AND NO SECTION ENTRY WAS GREATER THAN OR     00171000
*  EQUAL TO THE KEY -  EXIT TO CALLER WITH R15 = 4                      00171100
*                                                                       00171200
SCIB7   LH    R15,HLF4                                                  00171300
        B     SCIB91                   EXIT                             00171400
*                                                                       00171500
*   THE FOLLOWING CODE IS ENTERED WHEN A SECTION SEARCH HAS BEEN        00171600
*   TERMINATED BY A SATISFIED SEARCH.  AT THIS POINT IT IS NECESSARY    00171700
*   TO INITIALIZE FOR AN INNER SECTION SEARCH                           00171800
*                                                                       00171900
SCIB10  IC    R15,IXSPEC(RWORK3)       RESTORE NO. MATCHES TO WHAT IT   00172000
*                                       WAS AT BEGINNING OF SECTION     00172100
        L     RWORK4,IXSHEP(RWORK3)    GET AND STORE                    00172200
        ST    RWORK4,IXSSEP(RWORK3)     ADDRESS OF SECTION ENTRY        00172300
*                                        IN WORK AREA                   00172400
        L     RWORK1,IXSLEP(RWORK3)    PICK UP ADDRESS OF 1ST. ENTRY    00172500
*                                       IN THIS SECTION                 00172600
        XI    IXSBFLG(RWORK3),X80      TURN OFF SECTION SEARCH          00172700
        B     COMFN2                    LOOP BACK                       00172800
        DS    0H                       ASSURE ALIGNMENT                 00172900
HLF2    DC    H'2'                                                      00173000
HLF4    DC    H'4'                                                      00173100
DZ      EQU   0                        DEFINE ZERO DISPLACEMENT         00173200
RWORK0  EQU   0                                                         00173300
RWORK1  EQU   5                                                         00173400
RWORK2  EQU   6                                                         00173500
RWORK3  EQU   7                                                         00173600
RWORK4  EQU   3                                                         00173700
RWORK5  EQU   9                                                         00173800
RPARM1  EQU   8                                                         00173900
X80     EQU  X'80'                                                      00174000
X255    EQU  X'FF'                                                      00174100
ONE     EQU  1                                                          00174200
K3      EQU  3                                                          00174300
LNTHINDX EQU  512                                                       00174400
*   END SCIB;                                                      0687 00174500
@EL00017 DS    0H                                                  0687 00174600
@EF00017 DS    0H                                                  0687 00174700
@ER00017 LM    R14,R12,@SA00017                                 DSK1308 00174800
         BR    R14                                              DSK1308 00174900
*   END IEAVNP12                                                   0688 00175000
*                                                                  0688 00175100
*/* THE FOLLOWING INCLUDE STATEMENTS WERE FOUND IN THIS PROGRAM.     */ 00175200
*/*%INCLUDE SYSLIB  (AMCBS   )                                       */ 00175300
*/*%INCLUDE SYSLIB  (CVT     )                                       */ 00175400
*/*%INCLUDE SYSLIB  (IDAAMB  )                                       */ 00175500
*/*%INCLUDE SYSLIB  (IDAAMBL )                                       */ 00175600
*/*%INCLUDE SYSLIB  (IDAAMDSB)                                       */ 00175700
*/*%INCLUDE SYSLIB  (IDABUFC )                                       */ 00175800
*/*%INCLUDE SYSLIB  (IDAIOMB )                                       */ 00175900
*/*%INCLUDE SYSLIB  (IDAIXSPL)                                       */ 00176000
*/*%INCLUDE SYSLIB  (IDAIRD  )                                       */ 00176100
*/*%INCLUDE SYSLIB  (IDAPLH  )                                       */ 00176200
*/*%INCLUDE SYSLIB  (IEAPMNIP)                                       */ 00176300
*/*%INCLUDE SYSLIB  (IECDIOSB)                                       */ 00176400
*/*%INCLUDE SYSLIB  (IEZABP  )                                       */ 00176500
*/*%INCLUDE SYSLIB  (IEZCTGPL)                                       */ 00176600
*/*%INCLUDE SYSLIB  (IEZCTGFL)                                       */ 00176700
*/*%INCLUDE SYSLIB  (IFGACB  )                                       */ 00176800
*/*%INCLUDE SYSLIB  (IHANVT  )                                       */ 00176900
*/*%INCLUDE SYSLIB  (IHASRB  )                                       */ 00177000
*/*%INCLUDE SYSLIB  (IGGMCTRC)                                       */ 00177100
*                                                                  0688 00177200
*       ;                                                          0688 00177300
@DATA    DS    0H                                                       00177400
@CH02592 DC    H'47'                                                    00177500
@CH02591 DC    H'364'                                                   00177600
@SM02610 MVC   GPFIELD(0,R8),CATRCD(R1)                         DSK1308 00177700
@SM02612 MVC   GPFIELD(0,R8),GPFIELD(R1)                        DSK1308 00177800
@DATD    DSECT                                                          00177900
         DS    0F                                                       00178000
@SA00001 DS    18F                                                      00178100
@SA00012 DS    15F                                                      00178200
@SA00017 DS    15F                                                      00178300
@TF00001 DS    F                                                        00178400
IEAVNP12 CSECT                                                          00178500
         DS    0F                                                       00178600
@CF1     DC    F'1'                                                     00178701
@CF2     DC    F'2'                                                     00178801
@CF4     DC    F'4'                                                     00178901
@CF5     DC    F'5'                                                     00179001
@CH5     EQU   @CF5+2                                                   00179101
@CF6     DC    F'6'                                                     00179201
@CF8     DC    F'8'                                                     00179301
@CF10    DC    F'10'                                                    00179401
@CF12    DC    F'12'                                                    00179501
@CH12    EQU   @CF12+2                                                  00179601
@CF16    DC    F'16'                                                    00179701
@CF20    DC    F'20'                                                    00179801
@CF24    DC    F'24'                                                    00179901
@CF36    DC    F'36'                                                    00180001
@CF44    DC    F'44'                                                    00180101
@CF108   DC    F'108'                                                   00180201
@CF255   DC    F'255'                                                   00180301
@CF272   DC    F'272'                                                   00180401
@CF5120  DC    F'5120'                                                  00180501
@CH5120  EQU   @CF5120+2                                                00180601
@CFNG512 DC    F'-512'                                                  00180701
@CFNEG47 DC    F'-47'                                                   00180801
@CFNEG10 DC    F'-10'                                                   00180901
@CFNEG6  DC    F'-6'                                                    00181001
@CFNEG3  DC    F'-3'                                                    00181101
@DATD    DSECT                                                          00181200
         DS    0D                                                       00181300
CBSPTR   DS    A                                                        00181400
CTGPLPTR DS    A                                                        00181500
CTGFLPTR DS    A                                                        00181600
FREEAD   DS    A                                                        00181700
FREELEN  DS    A                                                        00181800
WKCORE   DS    A                                                        00181900
AMBPTR   DS    A                                                        00182000
CAMLSTPT DS    A                                                        00182100
CATBFPTR DS    A                                                        00182200
CCACPE6  DS    A                                                        00182300
CCACPE7  DS    A                                                        00182400
DICTEND  DS    A                                                        00182500
DICTSTR  DS    A                                                        00182600
DICTTYP  DS    A                                                        00182700
HLDRBA   DS    A                                                        00182800
IX2      DS    A                                                        00182900
IX3      DS    A                                                        00183000
IX4      DS    A                                                        00183100
IX5      DS    A                                                        00183200
IX6      DS    A                                                        00183300
IX8      DS    A                                                        00183400
IX9      DS    A                                                        00183500
IX10     DS    A                                                DSK1308 00183600
CPX      DS    A                                                        00183700
CTWKLIMT DS    F                                                        00183800
ERRCD    DS    F                                                        00183900
CATWKPR  DS    A                                                        00184000
CATWKPTR DS    A                                                        00184100
FLPTR    DS    A                                                        00184200
IXB      DS    A                                                        00184300
IX7      DS    A                                                        00184400
LCNT     DS    A                                                        00184500
RSAVA    DS    A                                                        00184600
RSAVAA   DS    A                                                        00184700
RSAVB    DS    A                                                        00184800
RSAVC    DS    A                                                        00184900
RSAVD    DS    A                                                        00185000
RSAVE    DS    A                                                        00185100
SAVGPPTR DS    A                                                        00185200
WKADDR   DS    A                                                        00185300
WKLEN    DS    H                                                        00185400
FLLENGTH DS    H                                                        00185500
GRPSEQNO DS    AL1                                                      00185600
         DS    CL3                                                      00185700
LOCPTR   DS    CL8                                                      00185800
         ORG   LOCPTR                                                   00185900
NVTPTR   DS    AL4                                                      00186000
CVTADR   DS    AL4                                              DSK1308 00186100
         ORG   LOCPTR+8                                                 00186200
DICTWK   DS    CL4                                                      00186300
SW       DS    BL1                                                      00186400
SWCOMB   EQU   X'80'                                               @42C 00186502
SWREEP   EQU   X'40'                                               @42C 00186602
SWREPT   EQU   X'20'                                               @42C 00186702
SWVALUE  EQU   X'10'                                               @42C 00186802
SWSSW    EQU   X'08'                                               @42C 00186902
SWDEL    EQU   X'04'                                               @42C 00187002
SWBADTST EQU   X'02'                                               @42C 00187102
OSSW     EQU   X'01'                                               @42C 00187202
         DS    CL3                                                      00187300
IXSPAREA DS    CL32                                                     00187400
CIWORK   DS    CL3                                                      00187500
         DS    CL1                                                      00187600
ABPWORK  DS    CL80                                                     00187700
MAINLIST DS    3A                                                       00187800
CCACPE   DS    10CL16                                                   00187900
BUFWORK  DS    CL8                                                      00188000
         ORG   BUFWORK+0                                                00188100
BFCTR    DS    CL1                                                      00188200
BFCI     DS    AL3                                                      00188300
         ORG   BFCI+0                                                   00188400
BFCCI    DS    CL3                                                      00188500
         ORG   BUFWORK+4                                                00188600
BFPTR    DS    AL4                                                      00188700
         ORG   BUFWORK+80                                               00188800
TEMPSR   DS    4A                                                       00188900
IEAVNP12 CSECT                                                          00189000
         DS    0F                                                       00189100
@SIZDATD DC    AL1(0)                                                   00189200
         DC    AL3(@ENDDATD-@DATD)                                      00189300
         DS    0D                                                       00189400
@CC02522 DC    C'OSLOCATE'                                              00189500
@CC02529 DC    C'ITYPEXT '                                              00189600
@CC02534 DC    C'CACB'                                                  00189700
@CC02536 DC    C'REEP'                                                  00189800
TRUEGC   DC    X'3F'                                                    00189900
SIXSTARS DC    CL6'******'                                         @42A 00190002
         DC    0D'0'                                            DSK1308 00190100
PATCH    DC    CL40' '                                                  00190200
@DATD    DSECT                                                          00190300
K4      EQU  4                                                          00190400
O24     EQU 24                                                          00190500
IEAVNP12 CSECT                                                          00190600
ZDT      DC    0D'0'                                            DSK1308 00190700
        DICT  AMDSBCAT,64,2,96,1                                        00190800
        DICT  ATTR1,16,107,1,0                                          00190900
        DICT  ATTR2,16,108,1,0                                          00191000
        DICT  BUFSIZE,0,110,4,0                                         00191100
        DICT  CATACB,96,1,4,0                                           00191200
        DICT  CATTR,16,107,1,0                                          00191300
        DICT  DEVTYP,64,2,4,3                                           00191400
        DICT  DSATTR,32,91,2,0                                          00191500
        DICT  DSTYPNAM,32,1,2,0                                         00191600
        DICT  ENTNAME,0,49,44,0                                         00191700
        DICT  ENTIDNO,0,1,3,0                                           00191800
        DICT  ENTYPE,0,44,1,0                                           00191900
        DICT  EXTENT,200,20,3,3                                         00192000
        DICT  FILESEQ,64,12,2,3                                         00192100
        DICT  HARBA,64,24,4,3                                           00192200
        DICT  HIKEYV,192,0,2,3                                          00192300
        DICT  HKRBA,64,16,4,3                                           00192400
        DICT  HURBA,64,20,4,3                                           00192500
        DICT  HURBADS,0,121,4,0                                         00192600
ZTYP    DS    0D                                                        00192700
        DICT  ITYPEXT,80,36,1,3                                         00192800
        DICT  LOKEYV,192,0,1,3                                          00192900
        DICT  NAME,64,3,3,2                                             00193000
        DICT  NAMEDS,32,20,2,2                                          00193100
        DICT  NOBYTAU,64,43,4,3                                         00193200
        DICT  NOTRKAU,64,34,2,3                                         00193300
        DICT  NOBLKTRK,64,32,2,3                                        00193400
        DICT  NOBYTTRK,64,39,4,3                                        00193500
        DICT  NOEXTNT,64,15,1,3                                         00193600
        DICT  OSLOCATE,32,32,4,0                                        00193700
        DICT  OWNERID,0,93,8,0                                          00193800
        DICT  PHYBLKSZ,64,28,4,3                                        00193900
        DICT  RELREPNO,96,3,2,0                                         00194000
        DICT  TOVOLDEV,32,27,6,3                              @Z40WSRG  00194100
        DICT  TYPE,64,2,1,2                                             00194200
        DICT  VOLSER,64,6,6,3                                           00194300
        DICT  VOLDEV,32,34,4,3                                          00194400
        DICT  VOLPHY,32,38,11,3                                         00194500
        DICT  VOLFLG,80,14,1,3                                          00194600
ZCS     DS    0D                                                        00194700
DSPN    COMB  (ENTYPE,ENTIDNO)                                          00194800
DSTR    COMB  (ATTR1,ATTR2)                                             00194900
NADS    COMB  (TYPE,NAME)                                               00195000
OSCA    COMB  (DEVTYP,VOLSER,FILESEQ)                                   00195100
VOEV    COMB  (DEVTYP,PHYBLKSZ,NOBLKTRK,NOTRKAU,NOBYTTRK,NOBYTAU)       00195200
VOHY    COMB  (RELREPNO,VOLSER,VOLFLG,NOEXTNT,HKRBA,HURBA,            **00195300
               HARBA,ITYPEXT,LOKEYV,HIKEYV,EXTENT)                      00195400
TOLD    COMB  (DEVTYP,PHYBLKSZ,NOBLKTRK,NOTRKAU,NOBYTTRK,NOBYTAU)       00195500
*                                                             @Z40WSRG  00195600
IEAVNP12 CSECT                                                          00195700
*                                  /*   THE WK AREA HAS 1 EXTRA WORD*/  00195800
        CNOP  0,4                                                       00195900
ABPCALL  STM   R0,R15,ABPWORK+(SAVEXXXX-ABPCALL)                DSK1308 00196000
        BALR  R14,R15                  GO TO BLOCK PROCESSOR            00196100
        USING *,R14                                                     00196200
        LM    R0,R15,SAVEXXXX                                           00196300
        BR    R14                      BRANCH BACK TO MAINLINE          00196400
        DROP  R14                                                       00196500
SAVEXXXX DC    F'0'                                             DSK1308 00196600
@DATD    DSECT                                                          00196700
         ORG   *+1-(*-@DATD)/(*-@DATD) INSURE DSECT DATA                00196800
@ENDDATD EQU   *                                                        00196900
IEAVNP12 CSECT                                                          00197000
         CVT      DSECT=YES,LIST=YES                            DSK1308 00197100
         IDAAMBL  ,                                             DSK1308 00197200
         IDAAMB   ,                                             DSK1308 00197300
         IDAAMDSB ,                                             DSK1308 00197400
         IECDCAT  ,                                             DSK1308 00197500
         IECDIOSB ,                                             DSK1308 00197600
         IKJRB    ,                                             DSK1308 00197700
RBIQENA  EQU      RBSTAB2                                       DSK1308 00197800
         IEACIWA  ,                                             DSK1308 00197900
         IHANVT   ,                                             DSK1308 00198000
         IEAPPNIP MNTPL=YES                                     DSK1308 00198100
         IEAPPNIP OPNPL=YES                                     DSK1308 00198200
         IDAIOMB  ,                                             DSK1308 00198300
         IEZCTGPL ,                                                @42A 00198400
         IEZCTGFL ,                                             DSK1308 00198500
         IDAIXH   ,                                             DSK1308 00198600
         IDABUFC  ,                                             DSK1308 00198700
         IFGACB   ,                                             DSK1308 00198800
         IEFUCBOB PREFIX=NO                                        @42A 00198902
R0       EQU   0                       REGISTER 0               DSK1308 00199000
R1       EQU   1                       REGISTER 1               DSK1308 00199100
R2       EQU   2                       REGISTER 2               DSK1308 00199200
R3       EQU   3                       REGISTER 3               DSK1308 00199300
R4       EQU   4                       REGISTER 4               DSK1308 00199400
R5       EQU   5                       REGISTER 5               DSK1308 00199500
R6       EQU   6                       REGISTER 6               DSK1308 00199600
R7       EQU   7                       REGISTER 7               DSK1308 00199700
R8       EQU   8                       REGISTER 8               DSK1308 00199800
R9       EQU   9                       REGISTER 9               DSK1308 00199900
R10      EQU   10                      REGISTER 10              DSK1308 00200000
R11      EQU   11                      REGISTER 11              DSK1308 00200100
R12      EQU   12                      REGISTER 12              DSK1308 00200200
R13      EQU   13                      REGISTER 13              DSK1308 00200300
R14      EQU   14                      REGISTER 14              DSK1308 00200400
R15      EQU   15                      REGISTER 15              DSK1308 00200500
AMCBS    EQU   0                                                        00200600
CBSACB   EQU   AMCBS+8                                                  00200700
CBSCMP   EQU   AMCBS+16                                                 00200800
CBSVSRT  EQU   AMCBS+32                                                 00200900
IDAIXSPL EQU   0                                                        00201000
IXSBFLG  EQU   IDAIXSPL+17                                              00201100
IXSEKON  EQU   IDAIXSPL+18                                              00201200
IXSPEC   EQU   IDAIXSPL+19                                              00201300
IXSHEP   EQU   IDAIXSPL+20                                              00201400
IXSSEP   EQU   IDAIXSPL+24                                              00201500
IXSLEP   EQU   IDAIXSPL+28                                              00201600
IDAIBFLP EQU   0                                                        00201700
IBFLPF   EQU   IDAIBFLP                                                 00201800
IBFLPL   EQU   IDAIBFLP+1                                               00201900
IBFLP3   EQU   IDAIBFLP+2                                               00202000
IBFLP2   EQU   IBFLP3                                                   00202100
IDASELL  EQU   0                                                        00202200
IDAIXK   EQU   0                                                        00202300
IEZABP   EQU   0                                                        00202400
ABPABP   EQU   IEZABP+8                                                 00202500
DICTENT  EQU   0                                                        00202600
DICTNAME EQU   DICTENT                                                  00202700
DICTFLGS EQU   DICTENT+4                                                00202800
DICTVAR  EQU   DICTFLGS                                                 00202900
DICTREP  EQU   DICTFLGS                                                 00203000
DICTCOMB EQU   DICTFLGS                                                 00203100
DICTST   EQU   DICTENT+5                                                00203200
DICTLC   EQU   DICTENT+6                                                00203300
DICTGC   EQU   DICTENT+7                                                00203400
COMBPTR  EQU   0                                                        00203500
CCARAB   EQU   0                                                        00203600
CCACPE1  EQU   CCARAB                                                   00203700
CCACPE2  EQU   CCARAB+4                                                 00203800
CCACPE3  EQU   CCARAB+8                                                 00203900
CCACPE4  EQU   CCARAB+12                                                00204000
CATGOPT  EQU   0                                                        00204100
CATGOCI  EQU   CATGOPT                                                  00204200
CATGODSP EQU   CATGOCI+1                                                00204300
CATGOGC1 EQU   CATGOPT+3                                                00204400
CATGOEXT EQU   CATGOGC1                                                 00204500
CATGODEL EQU   CATGOGC1                                                 00204600
CATGOSEQ EQU   CATGOPT+4                                                00204700
CATRCD   EQU   0                                                        00204800
RCDSIZ   EQU   CATRCD+45                                                00204900
NREPCV   EQU   CATRCD+47                                                00205000
NREPLF   EQU   CATRCD+48                                                00205100
REPCNTRL EQU   0                                                        00205200
EXTRCDPT EQU   REPCNTRL                                                 00205300
EXTGOGC1 EQU   EXTRCDPT+3                                               00205400
REPCNT   EQU   REPCNTRL+5                                               00205500
REPGOPT  EQU   REPCNTRL+6                                               00205600
VARFIELD EQU   0                                                        00205700
VARLEN   EQU   VARFIELD                                                 00205800
CNTRLINE EQU   0                                                        00205900
CNTVAR   EQU   CNTRLINE                                                 00206000
LENFIX   EQU   CNTRLINE+1                                               00206100
CAMLSTD  EQU   0                                                        00206200
CAMOPTNS EQU   CAMLSTD                                                  00206300
CAMOPTN3 EQU   CAMOPTNS+2                                               00206400
CAMPTR1  EQU   CAMLSTD+4                                                00206500
CAMPTR3  EQU   CAMLSTD+12                                               00206600
FLNAME   EQU   0                                                        00206700
GPFIELD  EQU   0                                                        00206800
RREPNO   EQU   0                                                        00206900
TESTSW   EQU   0                                                        00207000
CATWORK  EQU   0                                                        00207100
WORKLEN  EQU   CATWORK                                                  00207200
CATLGBUF EQU   0                                                        00207300
GPVOLPTR EQU   0                                                        00207400
GPVOLSER EQU   GPVOLPTR+4                                               00207500
TRNAMECI EQU   0                                                        00207600
TRNAMREC EQU   TRNAMECI                                                 00207700
TRUENAME EQU   TRNAMREC                                                 00207800
TRUENMCI EQU   TRNAMREC+44                                              00207900
RDF2     EQU   TRNAMECI+502                                             00208000
RECCNT   EQU   RDF2+1                                                   00208100
RDF1     EQU   TRNAMECI+505                                             00208200
RDF1FLGS EQU   RDF1                                                     00208300
RDF1LAST EQU   RDF1FLGS                                                 00208400
CIWORK2  EQU   0                                                        00208500
DSNAME   EQU   0                                                        00208600
CAMWKA   EQU   0                                                        00208700
CAMWKCNT EQU   CAMWKA                                                   00208800
CAMVOLPT EQU   CAMWKA+2                                                 00208900
CAMVOLSR EQU   CAMVOLPT+4                                               00209000
ECB      EQU   0                                                        00209100
ECBCODE  EQU   ECB                                                      00209200
         AGO   .@UNREFD                START UNREFERENCED COMPONENTS    00209300
.@UNREFD ANOP                          END UNREFERENCED COMPONENTS      00209400
@RC00387 EQU   @RC00385                                                 00209500
@RF00525 EQU   @RC00522                                                 00209600
@RF00531 EQU   @EL00010                                                 00209700
@RF00622 EQU   @EL00012                                                 00209800
@ENDDATA EQU   *                                                        00209900
         END   IEAVNP12,(C'PLS-III',0300,84132)                         00210000
/*
//*
//U42S04  EXEC PGM=IEBGENER
//SYSPRINT DD  SYSOUT=*
//SYSUT1   DD  *
  IDENTIFY IEAVNP12('ZP60042')
++MOD(IGG026DU) DISTLIB(AOSD0).
/*
//SYSUT2   DD  DSN=&&SMPMCS,DISP=(MOD,PASS)
//SYSIN    DD  DUMMY
//*
//U42S05  EXEC PGM=IEBUPDTE,PARM='NEW'
//SYSPRINT DD  SYSOUT=*
//SYSUT2   DD  DSN=&&PVTMACS,DISP=(NEW,PASS),
//             UNIT=VIO,SPACE=(TRK,(2,2,2)),
//             DCB=SYS1.MACLIB
//SYSIN    DD  *
./ ADD NAME=IHAPQE,SSI=13140103
*        %GOTO PQEBSL;      /* BILINGUAL MAPPING        /*   /*         04002021
         MACRO                                                          04010021
         IHAPQE   &TYPE                                                 06000021
*                                                                       06010021
*        RELEASE 1 AOS, 11/3/71, LEVEL=1                                06020021
*                                                                       06030021
         AIF   ('&TYPE' EQ 'INTERNAL').EQU                              06050021
PQESECT  DSECT      PARTITION QUEUE ELEMENT                             08000021
PQEFFBQE DS    A    PTR TO FIRST FBQE OR IF NONE TO PQE                 10000021
PQEBFBQE DS    A    PTR TO LAST FBQE OR IF NONE, TO PQE                 12000021
PQEFPQE  DS    A    ADDR NEXT PQE OR ZERO                               14000021
PQEBPQE  DS    A    ADDR PREVIOUS PQE OR ZERO                           16000021
PQETCB   DS    A    ADDR TCB FOR JOB STEP TO WHICH SPACE BELONGS        18000021
PQESIZE  DS    F    SIZE OF REGION DESCRIBED BY THIS PQE                20000021
PQEREGN  DS    A    ADDR FIRST BYTE OF REGION DESCRIBED BY THIS PQE     22000021
PQERFLGS DS    CL1  FLAG BYTE                                           24000021
PQEHRID  DS    CL1  HIERARCHY IDENTIFIER                                26000021
VMMFLGS  DS    BL1  SEVEN HIGH ORDER BITS ZERO                          26050021
VVVRFLG  EQU   X'01' REAL OR VIRTUAL REGION FLAG                        26100021
PQERSVD  DS    CL1  RESERVED                                            26150021
         MEXIT                                                          26200021
.EQU     ANOP                                                           26250021
PQEFFBQE EQU      0    PTR TO FIRST FBQE OR IF NONE TO PQE              26300021
PQEBFBQE EQU      4    PTR TO LAST FBQE OR IF NONE, TO PQE              26350021
PQEFPQE  EQU      8    ADDR NEXT PQE OR ZERO                            26400021
PQEBPQE  EQU      12    ADDR PREVIOUS PQE OR ZERO                       26450021
PQETCB   EQU      16    ADDR TCB FOR JOB STEP TO WHICH SPACE BELONGS    26500021
PQESIZE  EQU      20    SIZE OF REGION DESCRIBED BY THIS PQE            26550021
PQEREGN  EQU      24    ADDR FIRST BYTE OF REGION DESCRIBED BY THIS PQE 26600021
PQERFLGS EQU      28  FLAG BYTE                                         26650021
PQEHRID  EQU      29  HIERARCHY IDENTIFIER                              26700021
VMMFLGS  EQU      30  SEVEN HIGH ORDER BITS ZERO                        26750021
VVVRFLG  EQU   X'01' REAL OR VIRTUAL REGION FLAG                        26800021
PQERSVD  EQU      31  RESERVED                                          26850021
         MEND  , */                                                     30000021
*%PQEBSL:   ;                                                           32000021
*                                                                       32050021
*/*      RELEASE 1 AOS, 11/3/71, LEVEL=1                             */ 32100021
*                                                                       32150021
* DECLARE                                                               34000021
*   1 PQESECT   BASED(PQESEPTR),     /* PARTITION QUEUE ELEMENT      */ 36000021
*    2 PQEFFBQE    PTR(31),          /* PTR TO FIRST FBQE OR IF NONE    38000021
*                                       TO PQE                       */ 40000021
*    2 PQEBFBQE    PTR(31),          /* PTR TO LAST FBQE OR IF NONE,    42000021
*                                       TO PQE                       */ 44000021
*    2 PQEFPQE     PTR(31),          /* ADDR NEXT PQE OR ZERO        */ 46000021
*    2 PQEBPQE     PTR(31),          /* ADDR PREVIOUS PQE OR ZERO    */ 48000021
*    2 PQETCB      PTR(31),          /* ADDR TCB FOR JOB STEP TO        50000021
*                                       WHICH SPACE BELONGS          */ 52000021
*    2 PQESIZE     FIXED(31),        /* SIZE OF REGION DESCRIBED BY     54000021
*                                       THIS PQE                     */ 56000021
*    2 PQEREGN     PTR(31),          /* ADDR FIRST BYTE OF REGION       58000021
*                                       DESCRIBED BY THIS PQE        */ 60000021
*    2 PQERFLGS    CHAR(1),          /* FLAG BYTE                    */ 62000021
*    2 PQEHRID     CHAR(1),          /* HIERARCHY IDENTIFIER         */ 64000021
*    2 VMMFLGS     CHAR(1),          /* SEVEN HIGH ORDER BITS ZERO   */ 64050021
*    3 *           BIT(7),           /* ZERO BITS                    */ 64100021
*    3 VVVRFLG     BIT(1),           /* REAL OR VIRTUAL FLAG         */ 64150021
*    2 PQERSVD     CHAR(1);          /* RESERVED                     */ 64200021
./ ENDUP
/*
//*
//U42S06  EXEC PGM=IFOX00,PARM='OBJECT,NODECK,NOTERM,XREF(SHORT),RENT'
//SYSPRINT DD  SYSOUT=*
//SYSUT1   DD  UNIT=VIO,SPACE=(CYL,10)
//SYSUT2   DD  UNIT=VIO,SPACE=(CYL,10)
//SYSUT3   DD  UNIT=VIO,SPACE=(CYL,10)
//SYSLIB   DD  DSN=SYS1.MACLIB,DISP=SHR
//         DD  DSN=SYS1.SMPMTS,DISP=SHR
//         DD  DSN=SYS1.AMODGEN,DISP=SHR
//         DD  DSN=SYSGEN.RAKF.V1R2M6.MACLIB,DISP=SHR
//         DD  DSN=&&PVTMACS,DISP=(OLD,DELETE)
//SYSGO    DD  DSN=&&SMPMCS,DISP=(MOD,PASS)
//SYSIN    DD  *
IGG026DU TITLE '*****  IGG026DU    CATALOG CONTROLLER 3 DUMMY MODULE'   00000103
IGG026DU CSECT                                                          00000200
**********************************************************************  00000300
*                                                                    *  00000400
*        MODULE NAME - IGG026DU                                      *  00000500
*                                                                    *  00000600
*        DESCRIPTIVE NAME - CATALOG CONTROLLER LEVEL 3 DUMMY MODULE  *  00000700
*                                                                    *  00000800
*        COPYRIGHT - NONE                                            *  00000900
*                                                                    *  00001000
*        STATUS - VS/2 RELEASE 3.7 - SEE BELOW FOR ZP60042 UPDATES   *  00001103
*                                                                    *  00001200
*        FUNCTION                                                    *  00001300
*          THIS MODULE IS THE FIRST LOAD OF SVC 26 (CATALOG          *  00001400
*          MANAGEMENT). IT IS A DUMMY CSECT WHICH IMMEDIATELY PASSES *  00001500
*          CONTROL TO CATALOG MODULE IGC0002F WITHOUT CHANGING ANY   *  00001600
*          REGISTERS EXCEPT REGISTER 15.                             *  00001700
*                                                                    *  00001800
*          THIS CSECT MAY BE REPLACED BY A USER WRITTEN ROUTINE      *  00001900
*          IF DESIRED TO PERFORM PROCESSING BEFORE OR AFTER THE      *  00002000
*          SYSTEM CATALOG ROUTINES RECEIVE CONTROL.                  *  00002100
*                                                                    *  00002200
*          ANY USER WRITTEN ROUTINE WHICH REPLACES THIS CSECT MUST   *  00002300
*          BE RE-ENTRANT AND PASS CONTROL TO THE FIRST CATALOG       *  00002400
*          MODULE IGC0002F WITH THE REGISTER CONTENTS CONFORMING     *  00002500
*          TO STANDARD SVC ROUTINE CONVENTIONS. REGISTER 1 MUST      *  00002600
*          CONTAIN THE ADDRESS OF THE CATALOG PARAMETER LIST.        *  00002700
*                                                                    *  00002800
*          IF THE USER WRITTEN ROUTINE NEEDS TO SAVE REGISTERS,      *  00002900
*          IT MUST PROVIDE A RE-ENTRANT SAVE AREA TO SAVE AND        *  00003000
*          RESTORE ITS REGISTERS.  THE SVRB SAVE AREA SHOULD NOT     *  00003100
*          BE USED SINCE IT IS USED BY THE CATALOG ROUTINES.         *  00003200
*                                                                    *  00003300
*          DEPENDENCIES - EBCDIC CHARACTER CODE DEPENDENCIES - THIS  *  00003400
*                         MODULE MUST BE COMPILED AND EXECUTED ON    *  00003500
*                         A MACHINE WITH AN EBCDIC CHARACTER SET.    *  00003600
*                                                                    *  00003700
*                                                                    *  00003800
*          RESTRICTIONS - NONE                                       *  00003900
*                                                                    *  00004000
*          REGISTER CONVENTIONS -                                    *  00004100
*            UPON ENTRY TO IGG026DU:                                 *  00004200
*              R0 = AS SET BY SVC ISSUER                             *  00004301
*              R1 = CATALOG PARAMETER LIST ADDRESS                   *  00004401
*              R3 = POINTER TO CVT                                   *  00004500
*              R4 = POINTER TO TCB                                   *  00004600
*              R5 = POINTER TO SVRB                                  *  00004700
*              R6 = POINTER TO SVC ROUTINE                           *  00004803
*              R7 = POINTER TO ASCB                                  *  00004901
*             R14 = ADDRESS OF EXIT PROLOG                           *  00005000
*             R15 = AS SET BY SVC ISSUER, RETURN CODE ON EXIT        *  00005101
*                                                                    *  00005200
*        MODULE TYPE - PROCEDURE                                     *  00005300
*                                                                    *  00005400
*          PROCESSOR - ASSEMBLER                                     *  00005500
*                                                                    *  00005600
*          MODULE SIZE - SEE LENGTH PRINTED IN EXTERNAL SYMBOL       *  00005700
*            DICTIONARY IN ASSEMBLY LISTING.                         *  00005800
*                                                                    *  00005900
*          ATTRIBUTES - REENTRANT AND READ-ONLY                      *  00006000
*                                                                    *  00006100
*        ENTRY POINT -                                               *  00006200
*          THE ONLY EXTERNAL ENTRY POINT OF THIS MODULE IS THE       *  00006300
*          MODULE NAME - IGG026DU. INVOKED BY SVC 26.                *  00006400
*                                                                    *  00006500
*          PURPOSE - TO ALLOW A USER WRITTEN ROUTINE TO BE EASILY    *  00006600
*                    PLACED BEFORE THE ENTRY POINT OF CATALOG.       *  00006700
*                                                                    *  00006800
*          LINKAGE - IGG026DU IS THE FIRST LOAD OF SVC 26 AND IS     *  00006900
*                    ENTERED VIA STANDARD LINKAGE CONVENTIONS        *  00007000
*                    WHENEVER SVC 26 IS INVOKED.                     *  00007100
*                                                                    *  00007200
*          INPUT -                                                   *  00007300
*            INPUT IS IN THE FORM OF A CATALOG REQUEST PARAMETER     *  00007400
*            LIST POINTED TO BY REGISTER 1.  THE LIST MAY BE IN THE  *  00007500
*            FORM OF AN OS/VS CAMLST OR A VSAM REQUEST LIST.         *  00007600
*                                                                    *  00007700
*          OUTPUT - REGISTER 15 CONTAINS THE ENTRY POINT ADDRESS OF  *  00007800
*            CATALOG MODULE IGC0002F. REGISTERS 0 - 14 ARE THE SAME  *  00007900
*            AS THEY WERE UPON ENTRY TO IGG026DU.                    *  00008000
*                                                                    *  00008100
*          EXIT NORMAL -                                             *  00008200
*            CONTROL IS PASSED TO THE CATALOG CONTROLLER MODULE      *  00008300
*            IGC0002F.                                               *  00008400
*                                                                    *  00008500
*          EXIT ERROR - NONE                                         *  00008600
*                                                                    *  00008700
*        EXTERNAL REFERENCES - NONE                                  *  00008800
*                                                                    *  00008900
*          DATA SETS - NONE                                          *  00009000
*                                                                    *  00009100
*          DATA AREAS - NONE                                         *  00009200
*                                                                    *  00009300
*        TABLES - NONE                                               *  00009400
*                                                                    *  00009500
*        MACROS - NONE                                               *  00009600
*                                                                    *  00009700
*        CHANGE ACTIVITY -                                           *  00009800
*                                                                    *  00009900
*    MODULE NEW FOR VS2-3.7  SU60                              @G60ASBJ 00010000
*                                                                    *  00010103
*           $42 2020-05-31   ZP60042 - INDIRECT CATALOG SUPPORT.   @42A 00010203
*                                                                  @42A 00010303
*                            AS IMPLIED BY THE PROLOGUE ABOVE,     @42A 00010403
*                            MODIFYING THIS DUMMY (AS SUPPLIED)    @42A 00010503
*                            MODULE IS SIMPLER THAN FITTING        @42A 00010603
*                            UPDATES TO MODULE IGC0002F.           @42A 00010703
*                                                                  @42A 00010803
*                            THE MODIFICATIONS SUPPLIED HERE ARE   @42A 00010903
*                            TO SUPPORT "INDIRECT CATALOGING"      @42A 00011003
*                            WHERE (FOR SINGLE-VOLUME NON-VSAM     @42A 00011103
*                            DATA SETS) A CATALOGED VOLUME SERIAL  @42A 00011203
*                            OF SIX ASTERISKS SHALL BE TAKEN TO    @42A 00011303
*                            MEAN THE CURRENT IPL VOLUME OR        @42A 00011403
*                            SYSTEM RESIDENCE VOLUME OR "SYSRES".  @42A 00011503
*                                                                  @42A 00011603
*                            TO ACHIEVE THIS RESULT, OS LOCATE     @42A 00011703
*                            REQUESTS FROM NON-LPA CODE WILL BE    @42A 00011803
*                            DIRECTED TO RETURN TO THIS MODULE     @42A 00011903
*                            BEFORE GOING TO SVC EXIT PROCESSING.  @42A 00012003
*                                                                  @42A 00012103
*                            IF THE LOCATE SUCCESSFULLY FOUND A    @42A 00012203
*                            SINGLE-VOLUME DATA SET WITH A VOLUME  @42A 00012303
*                            SERIAL OF 6 ASTERISKS, THE LOCATE     @42A 00012403
*                            RESULTS WILL BE OVERLAID WITH THE     @42A 00012503
*                            DEVICE TYPE AND VOLUME SERIAL OF      @42A 00012603
*                            THE IPL VOLUME.                       @42A 00012703
*                                                                  @42A 00012803
*                            IF THE SVC 26 ISSUER RESIDES ABOVE    @42A 00012903
*                            CSA, THEN IT IS ASSUMED THAT THE      @42A 00013003
*                            CALLER IS ALLOCATION RESIDING IN      @42A 00013103
*                            THE LINK PACK AREA.  ALLOCATION       @42A 00013203
*                            SHOULD BE GIVEN THE LOCATE RESULTS    @42A 00013303
*                            WITHOUT ANY MODIFICATION SO THAT IT   @42A 00013403
*                            CAN TAKE THE STEPS NEEDED TO ENSURE   @42A 00013503
*                            THAT THE CATALOG ENTRY WILL NOT BE    @42A 00013603
*                            UPDATED BY DEALLOCATION.              @42A 00013703
*                                                                  @42A 00013803
*                            ALTHOUGH A COUPLE OF LINES FROM THE   @42A 00013903
*                            IBM TEMPLATE MAY HAVE SURVIVED BELOW, @42A 00014003
*                            ALL OF THE CODE BELOW CAN BE TREATED  @42A 00014103
*                            AS HAVING BEEN UPDATED EVEN THOUGH    @42A 00014203
*                            IT IS NOT TAGGED AS SUCH.             @42A 00014303
*                                                                    *  00014400
**********************************************************************  00014500
         EJECT                                                          00014603
*REGISTER USAGE:                                                        00014700
R0       EQU   0                       REGISTER 0  - NOT CHANGED        00014803
R1       EQU   1                       REGISTER 1 -> PLIST              00014900
R2       EQU   2                       REGISTER 2  - NOT RELEVANT       00015003
R3       EQU   3                       REGISTER 3 -> CVT                00015100
R4       EQU   4                       REGISTER 4 -> TCB                00015200
R5       EQU   5                       REGISTER 5 -> RB (SVC 26 SVRB)   00015300
R6       EQU   6                       REGISTER 6 -> LOCAL BASE         00015403
R7       EQU   7                       REGISTER 7 -> ASCB               00015500
R8       EQU   8                       REGISTER 8  - LOCAL WORK         00015603
R9       EQU   9                       REGISTER 9  - LOCAL WORK         00015703
R10      EQU   10                      REGISTER 10 - LOCAL WORK         00015803
R11      EQU   11                      REGISTER 11 - NOT RELEVANT       00015900
R12      EQU   12                      REGISTER 12 - NOT RELEVANT       00016000
R13      EQU   13                      REGISTER 13 - NOT RELEVANT       00016100
R14      EQU   14                      REGISTER 14 - RETURN POINT       00016200
R15      EQU   15                      REGISTER 15 - USED FOR BRANCH    00016300
         SPACE 3                                                        00016400
         USING IGG026DU,R6                                              00016500
         USING RBBASIC,R5                                               00016600
         USING TCB,R4                                                   00016700
         USING CVT,R3                                                   00016804
         USING PSA,0                                                    00016904
         CLI   TCBPKF,X'80'            SYSTEM KEY?                      00017000
         BL    USEKEY0                 YES, USING KEY ZERO IS FINE      00017100
         IC    R2,TCBPKF               NO, LOAD THE USER KEY            00017200
         SPKA  0(R2)                   SWITCH TO USER KEY               00017300
         L     R8,0(,R1)               LOAD THE FIRST PLIST WORD        00017400
         SPKA  0                       REVERT TO KEY ZERO               00017500
         B     GOT1STWD                                                 00017600
USEKEY0  L     R8,0(,R1)               LOAD THE FIRST PLIST WORD        00017700
*                                                                       00017801
*   EXAMINE THE SVC 26 REQUEST TYPE                                     00017901
*                                                                       00018001
GOT1STWD ST    R8,RBEXSAVE             SAVE IT FOR EXAMINATION          00018100
         LA    R8,RBEXSAVE             TO ASSIST PRE-XA ASSEMBLER       00018200
         USING CTGPL,R8                                                 00018300
         TM    CTGOPTN3,CTGSUPLT       REQUEST OF THE OS STYLE?         00018400
         BO    PROCEED                 NO, IT IS OF THE VSAM STYLE      00018500
         TM    CTGOPTN1,CTGNAME        SEARCH BY 44-BYTE NAME?          00018600
         BZ    PROCEED                 NO, SO NOT OF INTEREST           00018700
         DROP  R8                      (CTGPL)                          00018802
*                                                                       00018901
*   EXAMINE THE SVC 26 ISSUER                                           00019001
*                                                                       00019101
         TM    RBSTAB2,RBTCBNXT        IS THIS THE ONLY RB?             00019201
         BO    PROCEED                 YES, BUT THAT SHOULDN'T HAPPEN   00019301
         ICM   R8,7,RBLINKB            POINT TO SVC ISSUER RB           00019401
         DROP  R5                      (RBBASIC)                        00019501
         USING RBBASIC,R8                                               00019601
         TM    RBOPSW+4,X'7F'          CALLER FROM ABOVE THE LINE?      00019701
         BNZ   DETOUR                  YES, VET THE RESULT              00019801
         SPACE                                                          00019901
         L     R9,CVTGDA               POINT TO THE GDA                 00020001
         USING GDA,R9                                                   00020101
         L     R9,CSAPQEP              POINT TO THE CSA PQE             00020201
         DROP  R9                      (GDA)                            00020301
         USING PQESECT,R9                                               00020405
         L     R10,PQEREGN             POINT TO CSA                     00020501
         AL    R10,PQESIZE             POINT PASSED CSA                 00020601
         DROP  R9                      (PQESECT)                        00020705
         CLM   R10,7,RBOPSW            SVC ISSUER FROM LPA?             00020801
         BNH   PROCEED                 YES, ASSUME IT IS ALLOCATION     00020907
         DROP  R8                      (RBBASIC)                        00021001
         USING RBBASIC,R5                                               00021105
*                                                                       00021201
*   BACK END THIS SVC 26 REQUEST                                        00021301
*                                                                       00021401
DETOUR   LA    R14,BACKHERE            POST-PROCESS RESULT HERE         00021501
*                                                                       00021601
*   PROCEED WITH THE SVC 26 REQUEST                                     00021701
*                                                                       00021801
PROCEED  SR    R15,R15                 GET ZERO                         00021900
         ST    R15,RBEXSAVE            CLEAR WORK AREA                  00022000
         L     R15,IGC0002F            GET ADDRESS OF IGC0002F ENTRY    00022100
         BR    R15                     TRANSFER CONTROL TO IGC0002F     00022200
         DROP                                                           00022301
*                                                                       00022401
*   POST-PROCESS LOCATE RESULT                                          00022501
*                                                                       00022601
         USING PSA,0                                                    00022704
BACKHERE BALR  R6,0                    EMBRACE THE NEW REALITY          00022803
         USING NEWSTART,R6                                              00022903
NEWSTART L     R3,CVTPTR(,0)           POINT TO THE CVT                 00023003
         USING CVT,R3                                                   00023101
         L     R14,CVTEXPRO            POINT TO EXIT PROLOGUE           00023201
         LTR   R15,R15                 WAS THE RESULT SUCCESSFUL?       00023301
         BNZR  R14                     NO, RETURN WITH THE BAD NEWS     00023401
         L     R4,PSATOLD              POINT TO THE CURRENT TCB         00023501
         USING TCB,R4                                                   00023601
         L     R5,TCBRBP               POINT TO THE CURRENT RB (SVRB)   00023701
         USING RBBASIC,R5                                               00023801
         L     R1,RBGRS1               RESTORE CAMLST POINTER           00023902
         CLI   TCBPKF,X'80'            SYSTEM KEY?                      00024002
         BL    CHECKVOL                YES, USING KEY ZERO IS FINE      00024102
         IC    R2,TCBPKF               NO, LOAD THE USER KEY            00024202
         SPKA  0(R2)                   SWITCH TO USER KEY               00024302
CHECKVOL L     R9,12(,R1)              POINT TO THE OUTPUT AREA         00024402
         CLI   1(R9),1                 SINGLE-VOLUME DATA SET?          00024503
         BNE   GOODRSLT                NO, NOT APPROPRIATE TO EDIT HERE 00024603
         CLC   6(6,R9),SIXSTARS        VOL=SER=******?                  00024707
         BNE   GOODRSLT                NO, GOOD RESULT WITHOUT EDITING  00024803
         L     R10,CVTSYSAD            YES, POINT TO IPL VOLUME UCB     00024902
         USING UCBOB,R10                                                00025003
         MVC   6(6,R9),UCBVOLI         OVERLAY VOLUME SERIAL NUMBER     00025103
         MVC   2(4,R9),UCBTYP          OVERLAY DEVICE TYPE              00025203
*                                      RESET SAME BITS AS CATALOG ENTRY 00025303
         NI    3(R9),255-UCBRR-UCBVLPWR-UCBDVPWR                        00025403
GOODRSLT SPKA  0                       REVERT TO KEY ZERO               00025502
         BR    R14                     TERMINATE SVC 26 PROCESSING      00025602
         DROP                                                           00025700
*                                                                       00025801
*   CONSTANTS AND LITERALS                                              00025901
*                                                                       00026001
SIXSTARS DC    CL6'******'             SIX ASTERISKS                    00026106
IGC0002F DC    V(IGC0002F)             ENTRY POINT ADDRESS OF IGC0002F  00026200
         LTORG                                                          00026301
         DC    0D'0'                   END OF CONTROL SECTION           00026401
*                                                                       00026501
*   SYSTEM DATA AREAS                                                   00026601
*                                                                       00026701
         PRINT NOGEN                                                    00026800
         IHAPSA                                                         00026904
         CVT   DSECT=YES                                                00027004
         IKJTCB                                                         00027101
         IHARB                                                          00027200
         IHAGDA                                                         00027301
         IHAPQE                                                         00027401
         IEZCTGPL                                                       00027500
         IEFUCBOB PREFIX=NO                                             00027603
         SPACE 2                                                        00027703
         END   IGG026DU                                                 00027803
/*
//*
//U42S07  EXEC PGM=IEBGENER
//SYSPRINT DD  SYSOUT=*
//SYSUT1   DD  *
  IDENTIFY IGG026DU('ZP60042')
/*
//SYSUT2   DD  DSN=&&SMPMCS,DISP=(MOD,PASS)
//SYSIN    DD  DUMMY
//*  _________________________________________________________
//*
//*  USERMOD ZP60043
//U43S01  EXEC PGM=IEBGENER
//SYSPRINT DD  SYSOUT=*
//SYSUT1   DD  DATA
++USERMOD(ZP60043)              /* RESOLVE SYSRES FOR APF */   .
++VER(Z038) FMID(EBB1102)
  PRE(UZ60307)
 /*
   PROBLEM DESCRIPTION:
     THERE IS NO WAY TO SPECIFY THE IPL VOLUME FOR AN APF LIBRARY.
       ENTRIES FOR APF AUTHORIZED LIBRARIES IN THE IEAAPFXX MEMBER
       OF SYS1.PARMLIB MUST SPECIFY THE ACTUAL VOLUME SERIAL OF THE
       LIBRARY, WHICH IS NOT CONDUCIVE TO RELIABLY CLONING SYSTEM
       RESIDENCE VOLUMES FOR ALTERNATE IPL CONFIGURATIONS.

       THIS USERMOD FROM TOM ARMSTRONG UPDATES THE APF TABLE
       INITIALIZATION ROUTINE TO RECOGNIZE THAT A VOLUME SPECIFICATION
       OF SIX ASTERISKS INDICATES THE CURRENT IPL OR SYSTEM RESIDENCE
       VOLUME.  THE ACTUAL IPL VOLUME SERIAL WILL BE SUBSTITUTED INTO
       THE TABLE AT IPL TIME.

   SPECIAL CONDITIONS:
     ACTION:
       AN IPL MUST BE PERFORMED FOR THIS SYSMOD TO BECOME ACTIVE.

   COMMENTS:
     PRYCROFT SIX P/L PUBLIC DOMAIN USERMOD FOR MVS 3.8 NUMBER 43.

     REWORK HISTORY:
       2021-11-05: INITIAL AVAILABILITY.

     THE FOLLOWING MODULES AND/OR MACROS ARE AFFECTED BY THIS USERMOD:
     MODULES:
       IEAVNPA5
 */.
++MOD(IEAVNPA5) DISTLIB(AOSC5).
/*
//SYSUT2   DD  DSN=&&SMPMCS,DISP=(MOD,PASS)
//SYSIN    DD  DUMMY
//*
//U43S02  EXEC PGM=IFOX00,PARM='OBJECT,NODECK,NOTERM,XREF(SHORT)'
//SYSPRINT DD  SYSOUT=*
//SYSUT1   DD  UNIT=VIO,SPACE=(CYL,10)
//SYSUT2   DD  UNIT=VIO,SPACE=(CYL,10)
//SYSUT3   DD  UNIT=VIO,SPACE=(CYL,10)
//SYSLIB   DD  DSN=SYS1.MACLIB,DISP=SHR
//         DD  DSN=SYS1.SMPMTS,DISP=SHR
//         DD  DSN=SYS1.AMODGEN,DISP=SHR
//         DD  DSN=SYSGEN.RAKF.V1R2M6.MACLIB,DISP=SHR
//SYSGO    DD  DSN=&&SMPMCS,DISP=(MOD,PASS)
//SYSIN    DD  *
         TITLE 'IEAVNPA5, APF TABLE INITIALIZATION ROUTINE'             00000201
*                                                                       00000201
IEAVNPA5 CSECT                                                          00000301
*                                                                       00000201
*        STATUS -                                                       00000201
*        LASTUPD         = JCLIN    TYPE=UPD                            00000201
*        LIBRARIES       = DISTLIB=AOSC5                                00000201
*        FMID            = EBB1102                                      00000201
*        RMID            = UZ60307                                      00000201
*        LMOD            = IEAVNP05                                     00000201
*        SYSMOD HISTORY  = SYSMOD   TYPE       DATE   MCS  STATUS       00000201
*                          EBB1102  FUNCTION  00.000  MOD      ACC RGN  00000201
*                                                                       00000201
*        SOURCE FROM MVSSRC.SYM101.F19 WAS UPDATED BY DISASSEMBLY       00000201
*        TO MATCH THE LOAD MODULE AT THE UZ60307 LEVEL.                 00000201
*                                                                       00000201
*        CHANGE ACTIVITY -                                              00000201
*               ZP60043  - 1. SUPPORT FOR THE CURRENT IPLED SYSRES      00000201
*                             VOLUME IDENTIFIED WITH ****** IN THE      00000201
*                             IEAAPFXX LIST OF AUTHORISED PROGRAM       00000201
*                             LIBRARIES ON SPECIFIED DASD VOLUMES       00000201
*                          2. LOCALIZED CODE OPTIMZATION                00000201
*                                                                       00000201
         SAVE  (14,12),,'IEAVNPA5 ZP60043 &SYSDATE &SYSTIME'            00000501
*
         LA    R10,0(,R15)
*
         USING IEAVNPA5,R10
         USING CVT,R3                                                   00002003
*
         ST    R13,@SA00001+4                                           00002101
         LA    R14,@SA00001                                             00002201
         ST    R14,8(,R13)                                              00002301
         LR    R13,R14                                                  00002401
*                                                                       00002800
*/********************************************************************/ 00002900
*/*                                                                  */ 00003000
*/*        SUBROUTINE NPA5APF                                        */ 00003100
*/*                                                                  */ 00003200
*/*        FUNCTION - BUILD THE SYSTEM APF TABLE                     */ 00003300
*/*                                                                  */ 00003400
*/*        INPUT    - (1) R3 -> CVT                                  */ 00003507
*/*                   (2) APF PARMLIB MEMBER, IEAPAKXX               */ 00003600
*/*                   (3) R2 -> NIP VECTOR TABLE                     */ 00003707
*/*                                                                  */ 00003807
*/*        OUTPUT   - (1) CVTAUTHL - POINTER TO THE SYSTEM APF TABLE */ 00003900
*/*                   (2) SYSTEM APF TABLE COMPLETE                  */ 00004000
*/*                                                                  */ 00004100
*/********************************************************************/ 00004200
*                                                                       00004301
*NPA5APF:                                                               00004401
*   ENTRY;                                                              00004501
@EP00166 L     R0,APFTABSZ                                              00004602
*                                      GETMAIN 13000 BYTES FROM SP245   00004704
         GETMAIN R,LV=(R0)                                              00004801
*                                                                       00004903
         ST    R1,APFSAVE                                               00005003
*   R6=R1+2;                        /* INIT APF TABLE POINTER        */ 00005103
         LA    R12,2                                                    00005201
         LR    R6,R1                                                    00005303
         ALR   R6,R12                                                   00005403
*                                                                       00005501
*   /*****************************************************************/ 00005600
*   /*                                                               */ 00005700
*   /* THE SYSTEM APF TABLE WILL ALWAYS CONTAIN SYS1.LINKLIB AND     */ 00005800
*   /* SYS1.SVCLIB AS ENTRIES.                                       */ 00005900
*   /*                                                               */ 00006000
*   /*****************************************************************/ 00006100
*                                                                       00006202
*   APFTAB=LINKLIB;                 /* INIT LINKLIB ENTRY            */ 00006300
         MVI   APFTAB+19(R6),C' '                                       00006403
         MVC   APFTAB+20(31,R6),APFTAB+19(R6)                           00006503
         MVC   APFTAB(19,R6),LINKLIB                                    00006603
*   R7=CVTLINK->DCBDEBAD;           /* POINT TO DEB BASIC SECTION    */ 00006703
         L     R11,CVTLINK             R11 -> SYS1.LINKLIB DCB          00006803
         SLR   R7,R7                                                    00006903
         ICM   R7,B'0111',DCBDEBAD(R11)                                 00007003
*   R4=ADDR(DEBBASND);              /* POINT TO DEB DA SECTION       */ 00007103
         LA    R4,DEBBASND(,R7)                                         00007203
*   APFTVOL=DEBUCBAD->UCBVOLI;      /* INIT LINKLIB VOLID IN TAB     */ 00007300
         L     R11,DEBUCBAD(,R4)                                        00007403
         MVC   APFTVOL(6,R6),UCBVOLI-UCB(R11)                           00007504
*   R6=R6+19;                       /* POINT TO NXT ENTRY-SVCLIB     */ 00007603
         AH    R6,KH19                                                  00007703
*   APFTAB=SVCLIB;                  /* INIT SVCLIB ENTRY             */ 00007800
         MVI   APFTAB+18(R6),C' '                                       00007903
         MVC   APFTAB+19(32,R6),APFTAB+18(R6)                           00008003
         MVC   APFTAB(18,R6),SVCLIB                                     00008103
*   R7=CVTSVDCB->DCBDEBAD;          /* POINT TO DEB BASIC SECTION    */ 00008203
         L     R11,CVTSVDCB                                             00008303
         SLR   R7,R7                                                    00008403
         ICM   R7,B'0111',DCBDEBAD(R11)                                 00008503
*   R4=ADDR(DEBBASND);              /* POINT TO DEB DA SECTION       */ 00008603
         LA    R4,DEBBASND(,R7)                                         00008703
*   APFTVOL=DEBUCBAD->UCBVOLI;      /* INIT SVCLIB VOLID IN TAB      */ 00008800
         L     R11,DEBUCBAD(,R4)                                        00008903
         MVC   APFTVOL(6,R6),UCBVOLI-UCB(R11)                           00009004
*   R6=R6+18;                       /* POINT TO NEXT ENTRY           */ 00009103
         AH    R6,KH18                                                  00009203
*   APFSVCLK=R6;                    /* SAVE PTR TO END OF LAST ENT   */ 00009303
         ST    R6,APFSVCLK                                              00009403
*   ENTRYCTR=2;                     /* UPDATE COUNTER WITH NO OF ENT */ 00009502
         STH   R12,ENTRYCTR                                             00009602
*   /*****************************************************************/ 00009700
*   /*                                                               */ 00009800
*   /* IF APF=XX HAS BEEN SPECIFIED BY OPERATOR, PROCESS IEAAPFXX    */ 00009900
*   /* MEMBER OF SYS1.PARMLIB.                                       */ 00010000
*   /*                                                               */ 00010100
*   /*****************************************************************/ 00010200
*                                                                       00010302
*   R5=APF;                         /* GET POINTER TO SUBSTRING      */ 00010403
         L     R12,NVTPTAB(,R2)                                         00010502
         L     R5,8(,R12)              APF ENTRY                        00010603
*   IF R5=0 THEN                    /* WAS APF SPECIFIED?            */ 00010703
         LTR   R5,R5                                                    00010803
         BNZ   NPA5SCHK                                                 00010904
*     DO;                           /* APF NOT SPECIFIED             */ 00011000
*       CALL NPA5COMP;              /* COMPLETE TABLE BUILD          */ 00011100
         BAL   R14,NPA5COMP                                             00011202
*       RETURN;                     /* RETURN TO CALLER              */ 00011300
@EL00001 L     R13,4(,R13)                                              00011402
         RETURN (14,12)                                                 00011502
*                                                                       00011602
*     END;                                                              00011702
*   ELSE                                                                00011802
*     ;                             /* APF SPECIFIED                 */ 00011900
*NPA5SCHK:                          /* CHECK SUBSTRING               */ 00012000
*   CALL NPA5APRM;                  /* SYNTAX CHECK APF SUBSTRING    */ 00012100
NPA5SCHK BAL   R14,NPA5APRM                                             00012202
*   IF PRMRC¬='00'X THEN            /* WAS THERE A PARAMETER ERROR   */ 00012300
         CLI   PRMRC,X'00'                                              00012402
         BE    @RF00198                                                 00012502
*     DO;                           /* YES                           */ 00012600
*       ERRORCD=PINV;               /* SET ERROR CAUSE CODE          */ 00012700
         MVI   ERRORCD,X'04'                                            00012802
*       GO TO NPA5EROR;             /* PROCESS ERROR                 */ 00012900
         B     NPA5EROR                                                 00013002
*     END;                                                              00013102
*   ELSE                                                                00013202
*     ;                             /* PARAMETER SPECIFICATION OK    */ 00013300
@RF00198 B     NPA5TEND                                                 00013504
*   /*****************************************************************/ 00013600
*   /*                                                               */ 00013700
*   /* READ PARMLIB (IEAAPFXX) TEXT RECORDS UNTIL ALL ENTRIES ARE    */ 00013800
*   /* PROCESSED.                                                    */ 00013900
*   /*                                                               */ 00014000
*   /*****************************************************************/ 00014100
*                                                                       00014202
*   DO WHILE NPA5AEND='0'B;         /* LOOP TILL ALL TXT RECORDS HAVE   00014300
*                                      BEEN READ                     */ 00014400
*NPA5TEXT:                                                              00014602
*     CALL NPA5TXTR;                /* READ A TEXT RECORD            */ 00014700
NPA5TEXT BAL   R14,NPA5TXTR                                             00014802
*     IF TXTRC¬='00'X THEN          /* WAS READ SUCCESSFUL?          */ 00014900
         CLI   TXTRC,X'00'                                              00015002
         BNE   NPA5EROR                                                 00015103
*       GO TO NPA5EROR;             /* NO - PROCESS ERROR            */ 00015200
*     ELSE                                                              00015302
*       ;                           /* YES - CONTINUE                */ 00015400
*     APFLIBSZ=0;                   /* INIT LIBRARY SIZE TO 0        */ 00015500
         SLR   R12,R12                                                  00015602
         STH   R12,APFLIBSZ                                             00015702
*NPA5SCAN:                                                              00015802
*     LIBPTR=R4;                    /* SAVE PTR TO LIBRARY NAME      */ 00015903
NPA5SCAN ST    R4,LIBPTR                                                00016003
*     DO WHILE 0(1)¬=' ';           /* DETERMINE LIBNAME SIZE        */ 00016103
         B     @DE00211                                                 00016202
*                                                                       00016302
*       APFLIBSZ=APFLIBSZ+1;        /* INCREMENT LIBNAME COUNTER     */ 00016400
@DL00211 LA    R12,1                                                    00016502
         LH    R11,APFLIBSZ                                             00016602
         ALR   R11,R12                                                  00016702
         STH   R11,APFLIBSZ                                             00016802
*       R4=R4+1;                    /* POINT TO NEXT CHAR OF LIBNM   */ 00016903
         ALR   R4,R12                                                   00017003
*     END;                          /* END OF SCAN LOOP              */ 00017100
@DE00211 CLI   0(R4),C' '                                               00017203
         BNE   @DL00211                                                 00017302
*     IF APFLIBSZ>44 THEN           /* IS LIBNAME INVALID            */ 00017400
         LH    R12,APFLIBSZ                                             00017502
         CH    R12,KH44                                                 00017602
         BNH   @RF00215                                                 00017702
*       DO;                         /* YES - PROCESS ERROR           */ 00017800
*         ERRORCD=LINV;             /* SET ERROR CAUSE CODE          */ 00017900
         MVI   ERRORCD,X'08'                                            00018002
*         GO TO NPA5EROR;           /* PROCESS ERROR                 */ 00018100
         B     NPA5EROR                                                 00018202
*                                                                       00018302
*       END;                        /* END ERROR PROCESSING          */ 00018400
*     ELSE                                                              00018502
*       ;                           /* VALID LIBNAME                 */ 00018600
*     IF APFLIBSZ=0 THEN            /* IS TEXT RECORD BLANK          */ 00018700
@RF00215 ICM   R12,B'0011',APFLIBSZ                                     00018803
         BZ    NPA5TEND                                                 00018903
*       GO TO NPA5TEND;             /* YES - GET NEXT RECORD         */ 00019000
*     ELSE                                                              00019102
*       ;                           /* NO - PROCESS LIBNAME IF          00019202
*                                      STORAGE IS AVAILABLE          */ 00019300
*     IF((R6+LENGTH(APFTENTR))-APFSAVE)>2040 THEN/* APF TABLE           00019403
*                                      SIZE (2040) EXCEEDED          */ 00019500
         LA    R12,51                                                   00019602
         ALR   R12,R6                                                   00019703
         SL    R12,APFSAVE                                              00019802
         CH    R12,KH13000                                              00019905
         BNH   @RF00224                                                 00020002
*       DO;                         /* YES - PROCESS ERROR           */ 00020100
*         ERRORCD=STOR;             /* INDICATE CAUSE OF ERROR       */ 00020200
         MVI   ERRORCD,X'10'                                            00020302
*         GO TO NPA5EROR;           /* PROCESS ERROR                 */ 00020400
         B     NPA5EROR                                                 00020502
*                                                                       00020602
*       END;                                                            00020702
*     ELSE                                                              00020802
*       ;                           /* STORAGE AVAILABLE             */ 00020900
*     APFTDSN=LIBPTR->0(1:APFLIBSZ);/* MOVE DSSN TO TABLE            */ 00021003
@RF00224 MVI   APFTDSN+1(R6),C' '                                       00021103
         MVC   APFTDSN+2(42,R6),APFTDSN+1(R6)                           00021203
         LH    R12,APFLIBSZ                                             00021302
         BCTR  R12,0                                                    00021402
         L     R11,LIBPTR                                               00021502
         EX    R12,@SM02174                                             00021602
*     DO WHILE 0(1)=' ';            /* SKIP BLANKS BEFORE VOLID      */ 00021703
         B     @DE00231                                                 00021802
*                                                                       00021902
*       R4=R4+1;                    /* INCREMENT TO NXT CHAR         */ 00022003
@DL00231 AH    R4,@CH00034                                              00022103
*     END;                          /* END OF SCAN-FOR-BLANKS LOOP   */ 00022200
*                                                                       00022302
@DE00231 CLI   0(R4),C' '                                               00022403
         BE    @DL00231                                                 00022502
*     /***************************************************************/ 00022600
*     /*                                                             */ 00022700
*     /* PROCESS VOLID FIELD                                         */ 00022800
*     /*                                                             */ 00022900
*     /***************************************************************/ 00023000
*                                                                       00023102
*     APFVOLSZ=0;                   /* SET VOLID CHAR COUNTER TO 0   */ 00023200
         SLR   R12,R12                                                  00023302
         STH   R12,APFVOLSZ                                             00023402
*     VOLPTR=R4;                    /* SAVE PTR TO VOLID             */ 00023503
         ST    R4,VOLPTR                                                00023603
*     /***************************************************************/ 00023700
*     /*                                                             */ 00023800
*     /* DETERMINE DELIMITER FOLLOWING VOLID                         */ 00023900
*     /*                                                             */ 00024000
*     /***************************************************************/ 00024100
*                                                                       00024202
*     DO WHILE 0(1)¬=' '&0(1)¬=','&0(1)¬='FF'X;/* CHARACTER             00024303
*                                      A DELIMITER?                  */ 00024400
         B     @DE00236                                                 00024502
*                                                                       00024602
*       APFVOLSZ=APFVOLSZ+1;        /* INCREMENT VOLID SIZE          */ 00024700
@DL00236 LA    R12,1                                                    00024802
         LH    R11,APFVOLSZ                                             00024902
         ALR   R11,R12                                                  00025002
         STH   R11,APFVOLSZ                                             00025102
*       R4=R4+1;                    /* POINT TO NXT CHARACTER        */ 00025203
         ALR   R4,R12                                                   00025303
*     END;                          /* END OF VOLID SCAN LOOP        */ 00025400
@DE00236 CLI   0(R4),C' '                                               00025503
         BE    @DC00236                                                 00025602
         CLI   0(R4),C','                                               00025703
         BE    @DC00236                                                 00025802
         CLI   0(R4),X'FF'                                              00025903
         BNE   @DL00236                                                 00026002
*     IF SCAN(1)='FF'X¦APFVOLSZ>6 THEN/* VOLID ERROR                 */ 00026100
@DC00236 CLI   0(R4),X'FF'                                              00026203
         BE    @RT00240                                                 00026302
         LH    R12,APFVOLSZ                                             00026402
         CH    R12,KH6                                                  00026502
         BNH   @RF00240                                                 00026602
*       DO;                         /* YES- EITHER VOLID MISSING        00026702
*                                      (SCAN=FF) OR LIBSIZE TOO LARGE*/ 00026800
*         ERRORCD=VINV;             /* SET ERROR-CAUSE CODE          */ 00026900
@RT00240 MVI   ERRORCD,X'0C'                                            00027002
*         GO TO NPA5EROR;           /* PROCESS ERROR                 */ 00027100
         B     NPA5EROR                                                 00027202
*                                                                       00027302
*       END;                                                            00027402
*     ELSE                                                              00027502
*       ;                           /* NO- PROCESS VOLID             */ 00027600
*     APFWORK=APFLIBSZ+6;           /* SIZE OF LIBRARY AND VOLID     */ 00027700
@RF00240 LH    R12,APFLIBSZ                                             00027804
         LA    R12,6(,R12)                                              00027904
         STH   R12,APFWORK                                              00028002
*     APFTLEN=APFWORK+1;            /* UPDATE LENGTH FIELD FOR THIS     00028104
*                                      ENTRY                         */ 00028200
         MVC   APFTLEN(1,R6),APFWORK+1                                  00028304
*     APFTVOL=APFTVOL&&APFTVOL;     /* ZERO VOLID TABLE ENTRY        */ 00028400
         XC    APFTVOL(6,R6),APFTVOL(R6)                                00028503
*     APFTVOL=VOLPTR->0(1:APFVOLSZ);/* MOVE VOLID TO TABLE           */ 00028603
         MVI   APFTVOL+1(R6),C' '                                       00028703
         MVC   APFTVOL+2(4,R6),APFTVOL+1(R6)                            00028803
         LH    R12,APFVOLSZ                                             00028902
         BCTR  R12,0                                                    00029002
         L     R11,VOLPTR              R11 -> VOLSER                    00029102
         CLI   APFVOLSZ+1,6            L'VOLSER 6 BYTES ?     @ZP60043@
         BNE   MOVEVOLI                NO, CANNOT BE ******   @ZP60043@
         CLC   0(6,R11),SIXASTER       VOLSER=****** ?        @ZP60043@
         BNE   MOVEVOLI                NO, NO SUBSTITUTION    @ZP60043@
         L     R11,CVTSYSAD            R11 -> SYSRES UCB      @ZP60043@
         LA    R11,UCBVOLI-UCB(R11)    R11 -> UCBVOLI         @ZP60043@
MOVEVOLI EX    R12,@SM02176            MVC APFTVOL(0,R6),0(R11)         00029202
*     IF 0(1)=' ' THEN              /* LAST TEXT RECORD              */ 00029303
         CLI   0(R4),C' '                                               00029403
         BNE   @RF00250                                                 00029502
*       NPA5AEND='1'B;              /* YES - SET SWITCH TO TERM      */ 00029600
         OI    NPA5SWCH,NPA5AEND                                        00029704
*     ELSE                                                              00029802
*       ;                           /* NO - SCAN=,                   */ 00029900
*     R6=R6+APFWORK+1;              /* POINT TO NEXT TABLE ENTRY     */ 00030003
@RF00250 LA    R12,1                                                    00030102
         LR    R11,R6                                                   00030203
         AH    R11,APFWORK                                              00030302
         ALR   R11,R12                                                  00030402
         LR    R6,R11                                                   00030503
*     ENTRYCTR=ENTRYCTR+1;          /* UPDATE NO ENTRIES COUNTER     */ 00030604
         AH    R12,ENTRYCTR                                             00030702
         STH   R12,ENTRYCTR                                             00030802
         CH    R12,KH255               EXCEED LIMIT ?                   00030904
         BNE   NPA5TEND                NO, BRANCH                       00031004
         OI    NPA5SWCH,NPA5EXCC                                        00031104
         TM    NPA5SWCH,NPA5AEND                                        00031204
         BNZ   NPA5TEND                                                 00031304
         MVI   ERRORCD,X'14'           EXCEED MAX NUMBER OF ENTRIES     00031404
         B     NPA5EROR                                                 00031504
*
*NPA5TEND:                                                              00031602
*   END;                            /* END ENTRY PROCESSING LOOP     */ 00031700
NPA5TEND TM    NPA5SWCH,NPA5AEND+NPA5EXCC                               00031804
         BZ    NPA5TEXT                                                 00031902
*   CALL NPA5COMP;                  /* COMPLETE APF TABLE BUILD      */ 00032000
         BAL   R14,NPA5COMP                                             00032102
*   RETURN;                         /* RETURN TO CALLER              */ 00032200
         B     @EL00001                                                 00032302
*                                                                       00032402
*   /*****************************************************************/ 00032500
*   /*                                                               */ 00032600
*   /* BEGIN ERROR PROCESSING                                        */ 00032700
*   /*                                                               */ 00032800
*   /*****************************************************************/ 00032900
*                                                                       00033002
*NPA5EROR:                                                              00033102
*   CALL NPA5ERTN;                  /* CALL ERROR PROCESSING RTN     */ 00033200
NPA5EROR BAL   R14,NPA5ERTN                                             00033302
*   IF PRMERRC¬=RETRY THEN          /* WAS RECOVERY SUCESSFUL        */ 00033400
         CLI   PRMERRC,X'00'                                            00033502
         BE    @RF00259                                                 00033602
*     DO;                           /* NO - COMPLETE TABLE TO POINT     00033700
*                                      OF ERROR                      */ 00033800
*       CALL NPA5COMP;              /* COMPLETE TABLE BUILD          */ 00033900
         BAL   R14,NPA5COMP                                             00034002
*       RETURN;                     /* RETURN TO CALLER              */ 00034100
         B     @EL00001                                                 00034202
*                                                                       00034302
*     END;                                                              00034402
*   ELSE                                                                00034502
*     ;                             /* RECOVERY SUCCESSFUL-REBUILD      00034602
*                                      TABLE                         */ 00034700
*   R6=APFSVCLK;                    /* RESTORE PTR TO FIRST ENTRY       00034803
*                                      FOLLOWING LINKLIB-SVCLIB         00034902
*                                      ENTRIES                       */ 00035000
@RF00259 L     R6,APFSVCLK                                              00035103
*   NPA5PARM='0'B;                  /* SET PDS READ FLAG             */ 00035200
*   NPA5AEND='0'B;                  /* SET PROCESS TXT RECORD FLAG   */ 00035300
*   NPA5EXCC='0'B                                                       00035404
         NI    NPA5SWCH,255-NPA5PARM-NPA5AEND-NPA5EXCC                  00035504
*   ENTRYCTR=2;                     /* SET COUNTER FOR NO. ENTRIES TO   00035600
*                                      2 (LINKLIB=SVCLIB)            */ 00035700
         MVC   ENTRYCTR,KH2                                             00035804
*   GO TO NPA5SCHK;                 /* CHECK SUBSTRING               */ 00035900
         B     NPA5SCHK                                                 00036002
*                                                                       00036102
*/********************************************************************/ 00036200
*/*                                                                  */ 00036300
*/*        SUBROUTINE NPA5COMP                                       */ 00036400
*/*                                                                  */ 00036500
*/*        FUNCTION - COMPLETE APF TABLE BUILD PROCESSING            */ 00036600
*/*                                                                  */ 00036700
*/*        INPUT    - (1) R3    - POINTER TO CVT                     */ 00036803
*/*                   (2) R6- POINTER TO END OF LAST ENTRY IN        */ 00036903
*/*                               APF TABLE                          */ 00037000
*/*                   (3) APFSAVE-POINTER TO START OF APF TABLE      */ 00037100
*/*                   (4) ENTRYCTR- NO. ENTRIES IN TABLE             */ 00037200
*/*                                                                  */ 00037300
*/*        OUTPUT   - (1) CVTAUTHL - POINTER TO THE SYSTEM APF TABLE */ 00037400
*/*                   (2) APF TABLE HEADER UPDATED WITH NO. ENTRIES  */ 00037500
*/*                       AND SIZE OF TABLE IN DOUBLEWORDS           */ 00037600
*/*                                                                  */ 00037700
*/********************************************************************/ 00037800
*                                                                       00037902
NPA5COMP STM   R14,R12,12(R13)                                          00038202
*   R6=(R6+7)&ROUNDDWD;             /* ROUND TO DWD BOUNDARY         */ 00038303
         LA    R12,7                                                    00038402
         ALR   R12,R6                                                   00038503
         N     R12,@CF00110                                             00038602
         LR    R6,R12                                                   00038703
*   APFWORK=(R6-APFSAVE)/8;         /* COMPUTE APF TABLE SIZE IN        00038803
*                                      DOUBLEWORDS                   */ 00038900
         L     R12,APFSAVE                                              00039002
         LR    R11,R6                                                   00039104
         SLR   R11,R12                                                  00039204
         STH   R11,APFWORK                                              00039304
*   APFTABLN=APFWORK+1;             /* UPDATE TOTAL APF TABLE SIZE IN   00039404
*                                      APF HEADER                    */ 00039500
         MVI   APFTABLN(R12),X'00'                                      00039604
*   APFTNENT=ENTRYCNT+1;            /* UPDATE NO ENTRIES IN TABLE    */ 00039704
         MVC   APFTNENT(1,R12),ENTRYCTR+1                               00039804
*   FMSIZE=13000-(APFWORK*8);       /* COMPUTE AMOUNT OF STORAGE NOT    00039906
*                                      USED                          */ 00040000
         LCR   R11,R11                                                  00040104
         AH    R11,KH13000                                              00040204
         ST    R11,FMSIZE                                               00040304
*   IF FMSIZE¬=0 THEN               /* IS A FREEMAIN NECESSARY       */ 00040400
         LTR   R11,R11                                                  00040504
         BZ    @RF00279                NO, ALL STORAGE USED !!!!        00040602
*     DO;                           /* YES                           */ 00040700
*       FMSIZE=SPF5;                /* SET SUBPOOL TO 245            */ 00040806
         MVI   FMSIZE,X'F5'                                             00040906
*       R0=FMSIZE;                  /* SET UP R0 FOR FREEMAIN        */ 00041001
*                                                                       00041102
         L     R0,FMSIZE                                                00041202
*       /*************************************************************/ 00041300
*       /*                                                           */ 00041400
*       /* ISSUE FREEMAIN TO FREE AREA NOT USED FROM ADDRESS R6      */ 00041503
*       /* FOR R0 BYTES                                              */ 00041601
*       /*                                                           */ 00041700
*       /*************************************************************/ 00041800
*                                                                       00041902
         FREEMAIN R,LV=(0),A=(R6)                                       00042003
*     END;                                                              00042102
*   ELSE                                                                00042202
*     ;                                                                 00042300
*   CVTAUTHL=APFSAVE;               /* INSERT APF TABLE ADDR IN CVT  */ 00042404
@RF00279 MVC   CVTAUTHL,APFSAVE                                         00042503
*   RETURN;                         /* RETURN TO CALLER              */ 00042600
@ER00002 RETURN (14,12)                                                 00042702
*                                                                       00042802
*   END NPA5COMP;                                                       00043002
*                                                                       00043102
*/********************************************************************/ 00043200
*/*                                                                  */ 00043300
*/*        SUBROUTINE NPA5APRM                                       */ 00043400
*/*                                                                  */ 00043500
*/*        INPUT    - (1) R5 - POINTER TO SUBSTRING INPUT            */ 00043603
*/*                                                                  */ 00043700
*/*        OUTPUT   - (1) PLISTNAM - NAME OF PARMLIB MEMBER, I.E.,   */ 00043800
*/*                                  IEAAPFXX                        */ 00043900
*/*                   (2) NPA5PARM - REQUEST TO READ PARMLIB MEMBER  */ 00044000
*/*                                  IEAAPFXX                        */ 00044100
*/*                                                                  */ 00044200
*/********************************************************************/ 00044300
*                                                                       00044402
*NPA5APRM:                                                              00044502
NPA5APRM STM   R14,R12,12(R13)                                          00044602
*NPA5ALFT:                                                              00044702
*   DO WHILE 0(1)='(';              /* IF FIRST CHAR IS ( SKIP TO       00044803
*                                      NEXT CHAR                     */ 00044900
NPA5ALFT B     @DE00293                                                 00045002
*                                                                       00045102
*     R5=R5+1;                      /* INCREMENT TXT PTR             */ 00045203
@DL00293 AH    R5,@CH00034                                              00045303
*   END;                                                                00045402
@DE00293 CLI   0(R5),C'('                                               00045603
         BE    @DL00293                                                 00045702
*   /*****************************************************************/ 00045800
*   /*                                                               */ 00045900
*   /* INSURE NEXT 2 CHARACTERS ARE ALPHANUMERIC                     */ 00046000
*   /*                                                               */ 00046100
*   /*****************************************************************/ 00046200
*                                                                       00046302
*   DO R1=0 TO 1 BY 1 WHILE 0(1)>='0'&0(1)<='9'¦/*                      00046403
*                                      CHECK FOR ALPHANUM            */ 00046500
*         0(1)>='A'&0(1)<='Z';/* CHARACTERS                          */ 00046603
         SLR   R1,R1                                                    00046703
@DL00297 CLI   0(R5),C'0'                                               00046803
         BL    @GL00004                                                 00046902
         CLI   0(R5),C'9'                                               00047003
         BNH   @DB00297                                                 00047102
@GL00004 CLI   0(R5),C'A'                                               00047203
         BL    @DC00297                                                 00047302
         CLI   0(R5),C'Z'                                               00047403
         BH    @DC00297                                                 00047502
*     R5=R5+1;                      /* INCREMENT TO NEXT CHAR        */ 00047703
@DB00297 AH    R5,@CH00034                                              00047803
*   END;                                                                00047902
         AH    R1,@CH00034                                              00048003
         CH    R1,@CH00034                                              00048103
         BNH   @DL00297                                                 00048202
*   IF R1¬=2¦0(1)¬=''''&0(1)¬=')' THEN                                  00048303
@DC00297 CH    R1,KH2                                                   00048403
         BNE   @RT00300                                                 00048502
         CLI   0(R5),C''''                                              00048603
         BE    @RF00300                                                 00048702
         CLI   0(R5),C')'                                               00048803
         BE    @RF00300                                                 00048902
*     DO;                           /* IF 2 CHAR NOT CHECKED ABOVE OR   00049000
*                                      0 IS NOT A VALID                 00049103
*                                      DELIMITER, THEN RETURN WITH      00049202
*                                      ERROR CONDITION               */ 00049300
*       PRMRC='04'X;                /* ERROR CODE TO CALLER          */ 00049400
@RT00300 MVI   PRMRC,X'04'                                              00049502
*       RETURN;                                                         00049602
@ER00003 RETURN (14,12)                                                 00049702
*                                                                       00049802
*     END;                                                              00049902
*   ELSE                                                                00050002
*     ;                             /* SUBSTRING OK                  */ 00050100
*   R5=R5-2;                        /* POINT TO FIRST VALID CHAR     */ 00050203
@RF00300 BCTR  R5,0                                                     00050303
         BCTR  R5,0                                                     00050403
*   PLISTEL=0(1:2);                 /* SUFFIX FOR IEAAPF MEMBER      */ 00050503
         MVC   PLISTEL,0(R5)                                            00050603
*   NPA5PARM='1'B;                  /* REQUEST TO READ PARMLIB MEMBER   00050700
*                                      IEAAPFXX                      */ 00050800
         OI    NPA5SWCH,NPA5PARM                                        00050904
*   PRMRC='00'X;                    /* SET GOOD RC                   */ 00051000
         MVI   PRMRC,X'00'                                              00051102
*   RETURN;                         /* RETURN TO CALLER              */ 00051200
         B     @ER00003                                                 00051302
*                                                                       00051402
*   END NPA5APRM;                   /* END OF SUBROUTINE                00051502
*                                                                    */ 00051600
@PB00003 B     @PB00004                                                 00051702
*                                                                       00051802
*/********************************************************************/ 00051900
*/*                                                                  */ 00052000
*/*        SUBROUTINE NPA5TXTR                                       */ 00052100
*/*                                                                  */ 00052200
*/*        INPUT    - (1) NPA5PARM- WHEN SET TO 1 INDICATES PARMLIB  */ 00052300
*/*                                 MEMBER IEAAPFXX SHOULD BE READ   */ 00052400
*/*                                 WHEN SET TO 0  INDICATES ONLY    */ 00052500
*/*                                 TXT READS FROM IEAAPFXX ARE      */ 00052600
*/*                                 REQUIRED                         */ 00052700
*/*                   (2) PLISTNAM- PARMLIB LIST NAME,I.E., IEAAPFXX */ 00052800
*/*                                                                  */ 00052900
*/*        OUTPUT   - (1) NPA5PARM- ON FIRST CALL TO THIS ROUTINE,IS */ 00053000
*/*                                 SET TO 0                         */ 00053100
*/*                   (2) R4 - POINTER TO FIRST NON-BLANK CHAR       */ 00053203
*/*                                 OF PARMLIB RECORD                */ 00053300
*/*                                                                  */ 00053400
*/********************************************************************/ 00053500
*                                                                       00053602
*NPA5TXTR:                                                              00053702
NPA5TXTR STM   R14,R3,@SA00004                                          00053802
         STM   R5,R12,@SA00004+24                                       00053902
*   IF NPA5PARM='1'B THEN           /* REQUEST TO READ IEAAPFXX      */ 00054000
NPA5TPRM TM    NPA5SWCH,NPA5PARM                                        00054104
         BNO   @RF00316                                                 00054202
*     DO;                           /* YES                           */ 00054300
*       NIPPANAM=PLISTNAM;          /* PASS IEAAPFXX TO NIPPMPDS     */ 00054400
         L     R12,NVTPAREA(,R2)                                        00054502
         MVC   NIPPANAM(8,R12),PLISTNAM                                 00054602
*       CALL NIPPMPDS;              /* READ PARMLIB MEM IEAAPFXX     */ 00054700
         BAL   R14,NIPPMPDS                                             00054802
         B     NPA5TGRC                READ SUCCESSFUL                  00054902
         B     NPA5TERR                READ ERROR                       00055002
*                                                                       00055102
*NPA5TGRC:                                                              00055202
*       NPA5PARM='0'B;              /* ON SUBSEQUENT CALLS TO THIS      00055302
*                                      RTN WILL READ TEXT RECORDS    */ 00055400
NPA5TGRC NI    NPA5SWCH,255-NPA5PARM                                    00055504
*     END;                                                              00055602
*   ELSE                                                                00055702
*     ;                             /* READ TEXT RECORD REGARDLESS OF   00055800
*                                      SWITCH SETTING                */ 00055900
*   CALL NIPPMTXT;                  /* READ TXT RCD                  */ 00056000
@RF00316 BAL   R14,NIPPMTXT                                             00056102
         B     NPA5TRTR                READ SUCCESSFUL                  00056202
         B     NPA5TERR                READ ERROR                       00056302
*                                                                       00056402
*NPA5TRTR:                                                              00056502
*   R4=R1;                          /* RETURN PTR TO TXT RECORD      */ 00056603
NPA5TRTR LR    R4,R1                                                    00056703
*   TXTRC='00'X;                    /* SET RC=0                      */ 00056800
         MVI   TXTRC,X'00'                                              00056902
*   RETURN;                         /* RETURN TO CALLER              */ 00057000
@ER00004 LM    R14,R3,@SA00004                                          00057102
         LM    R5,R12,@SA00004+24                                       00057202
         BR    R14                                                      00057302
*                                                                       00057402
*NPA5TERR:                                                              00057502
*                                                                       00057602
*   /*****************************************************************/ 00057700
*   /*                                                               */ 00057800
*   /* CALLING RTN WILL PROCESS READ ERROR                           */ 00057900
*   /*                                                               */ 00058000
*   /*****************************************************************/ 00058100
*                                                                       00058202
*   NPA5RTRY='1'B;                  /* INDICATE DIAGNOSTIC ISSUED    */ 00058300
NPA5TERR OI    NPA5SWCH,NPA5RTRY                                        00058404
*   TXTRC='04'X;                    /* INDICATE ERROR                */ 00058500
         MVI   TXTRC,X'04'                                              00058602
*   RETURN;                         /* CALLING ROUTINE WILL PROCESS     00058704
*                                      ERROR                         */ 00058800
         B     @ER00004                                                 00058902
*                                                                       00059002
*   END NPA5TXTR;                                                       00059102
@PB00004 B     @PB00005                                                 00059202
*                                                                       00059302
*/********************************************************************/ 00059400
*/*                                                                  */ 00059500
*/*        SUBROUTINE NPA5ERTN                                       */ 00059600
*/*                                                                  */ 00059700
*/*        FUNCTION - WRITE INDICATIVE ERROR MESSAGE FOR ERROR DURING*/ 00059800
*/*                   APF TABLE PROCESSING                           */ 00059900
*/*                                                                  */ 00060000
*/*        INPUT    -(1) NPA5RTRY - WHEN SET TO 1 INDICATES THAT     */ 00060100
*/*                                 ERROR CAUSE (I/O ERROR) MESSAGE  */ 00060200
*/*                                 HAS PREVIOUSLY BEEN ISSUED AND   */ 00060300
*/*                                 THAT ONLY A RETRY MESSAGE IS     */ 00060400
*/*                                 REQUIRED.                        */ 00060500
*/*                  (2) ERRORCD  - INDICATES CAUSE OF ERROR, EITHER:*/ 00060600
*/*                                                                  */ 00060700
*/*                                PINV (X'04') - APF PARAMETER ERROR*/ 00060800
*/*                                                                  */ 00060900
*/*                                LINV (X'08') - APF LIBRARY INVALID*/ 00061000
*/*                                                                  */ 00061100
*/*                                VINV (X'0C') - VOLID IS MISSING   */ 00061200
*/*                                                                  */ 00061300
*/*                                STOR (X'10') - EXCEED MAX APF     */ 00061400
*/*                                               TABLE SIZE         */ 00061500
*/*                                                                  */ 00061600
*/*                                ENTC (X'14') - EXCEED MAX APF     */ 00061704
*/*                                               ENTRY COUNT        */ 00061804
*/*                                                                  */ 00061904
*/*        OUTPUT   -(1) ERROR MESSAGE AND PROMPT TO RESPECIFY       */ 00062000
*/*                      PARAMETER                                   */ 00062100
*/*                                                                  */ 00062200
*/********************************************************************/ 00062300
*                                                                       00062402
*NPA5ERTN:                                                              00062502
NPA5ERTN STM   R14,R4,@SA00005                                          00062602
         STM   R6,R12,@SA00005+28                                       00062702
*                                                                       00062802
*   /*****************************************************************/ 00062900
*   /*                                                               */ 00063000
*   /* SEE IF ONLY A RETRY IS REQUESTED                              */ 00063100
*   /*                                                               */ 00063200
*   /*****************************************************************/ 00063300
*                                                                       00063402
*   IF NPA5RTRY='1'B¦ERRORCD=PINV THEN/* RETRY ONLY ON I/O           */ 00063500
         TM    NPA5SWCH,NPA5RTRY                                        00063604
         BO    NPA5PRPT                                                 00063703
         CLI   ERRORCD,X'04'                                            00063802
         BE    NPA5PRPT                                                 00063903
*     GO TO NPA5PRPT;               /* ERROR OR INVALID PARAMETER    */ 00064000
*                                                                       00064102
*   /*****************************************************************/ 00064200
*   /*                                                               */ 00064300
*   /* WAS THE APF LIBRARY INVALID FORMAT                            */ 00064400
*   /*                                                               */ 00064500
*   /*****************************************************************/ 00064600
*                                                                       00064702
*   IF ERRORCD=LINV THEN            /* LIBRARY INVALID               */ 00064800
         CLI   ERRORCD,X'08'                                            00064902
         BNE   @RF00341                                                 00065002
*     MSG9I3=CAUSELIB;              /* YES - SET ERROR CAUSE         */ 00065100
         MVC   MSG9I3(24),CAUSELIB                                      00065202
*   ELSE                                                                00065302
*     ;                                                                 00065402
*   /*****************************************************************/ 00065500
*   /*                                                               */ 00065600
*   /* WAS THE VOLID MISSING OR INCORRECT FORMAT                     */ 00065700
*   /*                                                               */ 00065800
*   /*****************************************************************/ 00065900
*                                                                       00066002
*   IF ERRORCD=VINV THEN            /* VOLID INVALID ?               */ 00066100
@RF00341 CLI   ERRORCD,X'0C'                                            00066202
         BNE   @RF00344                                                 00066302
*     MSG9I3=CAUSEVOL;              /* YES - SET ERROR CAUSE         */ 00066400
         MVC   MSG9I3(24),CAUSEVOL                                      00066502
*   ELSE                                                                00066602
*     ;                                                                 00066702
*   /*****************************************************************/ 00066800
*   /*                                                               */ 00066900
*   /* WAS MAX APF TABLE SIZE OF 2040 BYTES EXCEEDED                 */ 00067000
*   /*                                                               */ 00067100
*   /*****************************************************************/ 00067200
*                                                                       00067302
*   IF ERRORCD=STOR THEN            /* STOR UNAVAILABLE              */ 00067400
@RF00344 CLI   ERRORCD,X'10'                                            00067502
         BNE   @RF00347                                                 00067602
*     MSG9I3=CAUSESTR;              /* YES - SET ERROR CAUSE         */ 00067700
         MVC   MSG9I3(24),CAUSESTR                                      00067802
@RF00347 CLI   ERRORCD,X'14'            MORE THAN 255 ENTRIES ?         00067904
         BNE   @RF00348                 NO, BRANCH                      00068004
         MVC   MSG9I3(24),CAUSECNT                                      00068104
*   ELSE                                                                00068202
*     ;                                                                 00068302
*   MSG9I1=PLISTNAM;                /* PARMLIB LIST NAME             */ 00068400
@RF00348 MVI   MSG9I1+8,C' '                                            00068504
         MVC   MSG9I1(8),PLISTNAM                                       00068602
*   MSG9I2=APF1;                    /* MOVE PARAMETER TO MESSAGE     */ 00068700
         MVI   MSG9I2+3,C' '                                            00068802
         MVC   MSG9I2+4(2),MSG9I2+3                                     00068902
         MVC   MSG9I2(3),APF1                                           00069002
*   /*****************************************************************/ 00069100
*   /*                                                               */ 00069200
*   /* ISSUE MESSAGE IEA352I LIST LIS FOR PRM INVALID- CAUSE         */ 00069300
*   /*                                                               */ 00069400
*   /*****************************************************************/ 00069500
*                                                                       00069602
         IEAPMNIP TYPE=WTO,PARAM=MSG9S                                  00069700
*                                                                       00069802
*   /*****************************************************************/ 00069900
*   /*                                                               */ 00070000
*   /* ISSUE PROMPT TO RESPECIFY OR CANCEL THE APF PARAMETER         */ 00070100
*   /*                                                               */ 00070200
*   /*****************************************************************/ 00070300
*                                                                       00070402
*NPA5PRPT:                                                              00070502
*   PASSPARM=APF1;                  /* PASS APF PARAM TO PROMPT      */ 00070600
NPA5PRPT MVI   PASSPARM+3,C' '                                          00070702
         MVC   PASSPARM+4(4),PASSPARM+3                                 00070802
         MVC   PASSPARM(3),APF1                                         00070902
*                                                                       00071002
         IEAPMNIP TYPE=PRMPT,PARAM=PASSPARM,OPT=ERROR                   00071100
*                                                                       00071202
*   /*****************************************************************/ 00071300
*   /*                                                               */ 00071400
*   /* DID OPERATOR CANCEL THE MESSAGE                               */ 00071500
*   /*                                                               */ 00071600
*   /*****************************************************************/ 00071700
*                                                                       00071802
*   R4=ADDR(APF);                   /* GET PARMTAB ENTRY FOR APF     */ 00071903
         L     R4,NVTPTAB(,R2)                                          00072003
         LA    R4,8(,R4)               APF ENTRY                        00072103
*   IF NIPPTCAN='1'B THEN                                               00072202
         TM    NIPPTCAN(R4),B'00100000'                                 00072303
         BNO   @RF00358                                                 00072402
*     DO;                                                               00072502
*       PRMERRC=CANCEL;             /* OPERATOR CANCELLED RC=4       */ 00072600
         MVI   PRMERRC,X'04'                                            00072702
*       NPA5RTRY='0'B;              /* RESET RETRY-ONLY FLAG         */ 00072800
         NI    NPA5SWCH,255-NPA5RTRY                                    00072904
*       RETURN;                     /* RETURN TO CALLER              */ 00073000
@ER00005 LM    R14,R4,@SA00005                                          00073102
         LM    R6,R12,@SA00005+28                                       00073202
         BR    R14                                                      00073302
*     END;                                                              00073402
*   ELSE                                                                00073502
*     ;                             /* RETRY WITH NEW PARAM          */ 00073600
*   PRMERRC=RETRY;                  /* SET RC TO 0                   */ 00073700
@RF00358 MVI   PRMERRC,X'00'                                            00073802
*   R5=NIPPTADR;                    /* RESTORE PTR TO PARMT ENTRY    */ 00073903
         L     R5,NIPPTADR(,R4)                                         00074003
*   NPA5RTRY='0'B;                  /* RESET RETRY-ONLY FLAG         */ 00074100
         NI    NPA5SWCH,255-NPA5RTRY                                    00074204
*   RETURN;                         /* RETURN TO CALLER              */ 00074300
         B     @ER00005                                                 00074402
*                                                                    */ 00074504
*   END NPA5ERTN;                   /* END SUBROUTINE                   00074602
@PB00005 B     @EL00001                                                 00074703
*                                                                       00074802
*/********************************************************************/ 00074900
*/*                                                                  */ 00075000
*/* MACRO-      IEAPSPIO                                             */ 00075100
*/*                                                                  */ 00075200
*/* STATUS-     VERSION DATE=10/24/73, VS/2 RELEASE 2                */ 00075300
*/*                                                                  */ 00075400
*/* FUNCTION-   IEAPSPIO IS PART OF THE  SUPERVISOR                  */ 00075500
*/*             INITIALIZATION PROCESS FOR VS2.                      */ 00075600
*/*                                                                  */ 00075700
*/*             THIS MACRO GENERATES INLINE PL/S STATEMENTS          */ 00075800
*/*             WHICH FORM A SUBROUTINE TO FIND AND READ TEXT        */ 00075900
*/*             RECORDS FROM SYS1.PARMLIB.                           */ 00076000
*/*                                                                  */ 00076100
*/*  REGISTER DEPENDENCIES-                                          */ 00076200
*/*                                                                  */ 00076300
*/*                 1. IEAPSPIO DEPENDS ON THE INCLUDING ROUTINES    */ 00076400
*/*                    BASE REGISTERS FOR ADDRESSABILITY             */ 00076500
*/*                                                                  */ 00076600
*/*                 2. REGISTER 3 MUST CONTAIN THE ADDRESS OF        */ 00076700
*/*                    THE CVT ON ENTRY                              */ 00076800
*/*                                                                  */ 00076900
*/*                 3. REGISTER 2 MUST CONTAIN THE ADDRESS OF        */ 00077000
*/*                    THE NVT ON ENTRY                              */ 00077100
*/*                                                                  */ 00077200
*/*                 4. REGISTER 14 MUST CONTAIN THE ADDRESS OF       */ 00077300
*/*                    THE CALLERS RETURN POINT ON ENTRY             */ 00077400
*/*                                                                  */ 00077500
*/* ENTRY POINTS-                                                    */ 00077600
*/*                                                                  */ 00077700
*/*    TWO CALLING SEQUENCRS ARE AVAILABLE.  ONE PROVIDES            */ 00077800
*/*    COMPATIBILITY WITH THE VS2-1 VERSION OF THIS MACRO,           */ 00077900
*/*    THE OTHER CALLING SEQUENCE WAS DEVELOPED EXPRESSLY            */ 00078000
*/*    FOR VS2-2.                                                    */ 00078100
*/*                                                                  */ 00078200
*/*        VS2-1 COMPATIBLE VERSION-                                 */ 00078300
*/*                                                                  */ 00078400
*/*            1. CALL NIPPMPDS TO LOCATE (VIA BLDL) THE MEMBER      */ 00078500
*/*               OF SYS1.PARMLIB                                    */ 00078600
*/*                                                                  */ 00078700
*/*            2. CALL NIPPMTXT TO READ A TEXT RECORD FROM           */ 00078800
*/*               SYS1.PARMLIB                                       */ 00078900
*/*                                                                  */ 00079000
*/*        VS2-2 VERSION-                                            */ 00079100
*/*                                                                  */ 00079200
*/*            1. CALL NIPPMMEM TO LOCATE THE MEMBER AND RETURN      */ 00079300
*/*               A TEXT RECORD                                      */ 00079400
*/*                                                                  */ 00079500
*/*            2. REPEAT CALL TO NIPPMMEM TO READ ADDITIONAL         */ 00079600
*/*               TEXT RECORDS                                       */ 00079700
*/*                                                                  */ 00079800
*/* OUTPUT (NORMAL) -                                                */ 00079900
*/*                                                                  */ 00080000
*/*     THE ROUTINE WILL SAVE AND RESTORE ALL GENERAL REGISTERS      */ 00080100
*/*     WITH THE EXCEPTION OF R1.     ON A SUCCESSFUL READ,          */ 00080203
*/*     R1 (REGISTER 1) WILL BE SET TO POINT TO THE FIRST NON-       */ 00080303
*/*     BLANK CHARACTER IN THE TEXT RECORD.  IF THE RECORD           */ 00080400
*/*     COLUMNS 1 THRU 72 ALL CONTAIN BLANKS, R1 WILL                */ 00080503
*/*     POINT TO A BLANK IN COLUMN 72.  IF COLUMNS 1 THRU 71         */ 00080600
*/*     ARE BLANK BUT COLUMN 72 IS NON-BLANK, THE ROUTINE            */ 00080700
*/*     WILL AUTOMATICALLY ATTEMPT TO READ THE NEXT RECORD.  IN      */ 00080800
*/*     ALL CASES, COLUMN 72 WILL BE SET TO BLANK AND COLUMN 73 WILL */ 00080900
*/*     BE SET TO X'FF'.                                             */ 00081000
*/*                                                                  */ 00081100
*/* EXIT (NORMAL)-                                                   */ 00081200
*/*                                                                  */ 00081300
*/*     VS2-1 AND VS2-2 VERSIONS RETURN TO THE ADDRESS FOUND         */ 00081400
*/*     IN REGISTER 14 ON ENTRY.                                     */ 00081500
*/*                                                                  */ 00081600
*/* EXIT (ERROR)-                                                    */ 00081700
*/*                                                                  */ 00081800
*/*     VS2-1 COMPATIBLE VERSION-                                    */ 00081900
*/*                                                                  */ 00082000
*/*         RETURN TO THE ADDRESS IN REGISTER 14 +4                  */ 00082100
*/*                                                                  */ 00082200
*/*         NOTE- WHEN AN ERROR OCCURS ON AN ATTEMP TO READ A RECORD */ 00082300
*/*               THAT DOES NOT EXIST (E-O-F),                       */ 00082400
*/*               IT IS CONSIDERED A PERMANENT I/O ERROR             */ 00082500
*/*                                                                  */ 00082600
*/*     VS2-2 VERSION-                                               */ 00082700
*/*                                                                  */ 00082800
*/*        RETURN TO THE ADDRESS FOUND IN REGISTER 14 ON ENTRY       */ 00082900
*/*        WITH REGISTER 1 (R1) SET TO A NEGATIVE VALUE.     IN THE  */ 00083003
*/*        CASE WHERE R1 IS NEGATIVE ON RETURN, THE NIPPARC FIELD    */ 00083103
*/*        OF THE NIP PATAMETER AREA WILL INDICATE THE REASON FOR    */ 00083200
*/*        FAILURE AS FOLLOWS-                                       */ 00083300
*/*                            4 - MEMBER NOT FOUND                  */ 00083400
*/*                            8 - I/O ERROR DURING BLDL             */ 00083500
*/*                            12- I/O ERROR DURING READ             */ 00083600
*/*                            16- END-OF-FILE                       */ 00083700
*/*                                                                  */ 00083800
*/*     COMMON TO BOTH VERSIONS-                                     */ 00083900
*/*                                                                  */ 00084000
*/*        AN INTERPRETIVE MESSAGE WILL BE WRITTEN TO THE OPERATOR   */ 00084100
*/*        FOR EACH OF THE FIRST THREE ERROR CONDITIONS LISTED       */ 00084200
*/*        ABOVE.  THE CALLER MAY SUPPRESS THE 'MEMBER NOT FOUND'    */ 00084300
*/*        MESSAGE BY SETTING THE NIPPAFL1 FLAG FIELD TO BINARY      */ 00084400
*/*        ONE IN THE NIP PARAMETER AREA BEFORE CALLING THIS         */ 00084500
*/*        ROUTINE.  NO MESSAGE WILL BE WRITTEN FOR THE E-O-F        */ 00084600
*/*        CONDITION IF THE VS2-2 VERSION IS USED.                   */ 00084700
*/*                                                                  */ 00084800
*/* MACROS-                                                          */ 00084900
*/*     THE FOLLOWING MAPPING MACROS MUST BE                         */ 00085000
*/*     INCLUDED IN THE MODULE WHICH INCLUDES                        */ 00085100
*/*     IEAPSPIO-                                                    */ 00085200
*/*                                       IEZIOB                     */ 00085300
*/*                                       IHANVT                     */ 00085400
*/*                                       IHAECB                     */ 00085500
*/*                                       IEAPPNIP                   */ 00085600
*/*                                       IEFUCBOB                   */ 00085700
*/*                                       CVT                        */ 00085800
*/*                                                                  */ 00085900
*/* NOTES-                                                           */ 00086000
*/*        THE FIRST FOUR LETTERS OF ALL IEAPSPIO SYMBOLES ARE:      */ 00086100
*/*        NIPP OR IPPM.                                             */ 00086200
*/*                                                                  */ 00086300
*/*        REGISTERS 0, 1, 14, AND 15 WILL BE UNRESTRICTED AT THE    */ 00086400
*/*        END OF THE SEGMENT GENERATED BY IEAPSPIO.                 */ 00086500
*/*                                                                  */ 00086600
*/*        NIPPAREA WILL BE BASED ON NVTPAREA AND IOBSTDRD WILL BE   */ 00086700
*/*        BASED ON THE ADDR OF NIPPAIOB AT THE END OF THE SEGMENT   */ 00086800
*/*        GENERATED BY IEAPSPIO                                     */ 00086900
*/*                                                                  */ 00087000
*/*        IEAPSPIO MUST BE INCLUDED IN A CODE SEGMENT,              */ 00087100
*/*        NOT AT THE TOP OF THE PROCEDURE WITH THE                  */ 00087200
*/*        MAPPING MACROS LISTED ABOVE.                              */ 00087300
*/*                                                                  */ 00087402
*/********************************************************************/ 00087500
*                                                                       00087602
*                                                                       00087702
*   /*****************************************************************/ 00087800
*   /*                                                               */ 00087900
*   /* SAVE AREA FOR CALLER'S REGISTERS                              */ 00088000
*   /*                                                               */ 00088100
*   /*****************************************************************/ 00088200
*                                                                       00088302
*   DCL                                                                 00088402
*     NIPPMREG(16) FIXED(31);                                           00088502
*                                                                       00088602
*   /*****************************************************************/ 00088700
*   /*                                                               */ 00088800
*   /* SAVE AREA FOR CALLER'S RETURN ADDRESS                         */ 00088900
*   /*                                                               */ 00089000
*   /*****************************************************************/ 00089100
*                                                                       00089202
*   DCL                                                                 00089302
*     NIPPMADR PTR(31);                                                 00089402
*                                                                       00089502
*   /*****************************************************************/ 00089600
*   /*                                                               */ 00089700
*   /* POINTER TO DCB FOR BLDL                                       */ 00089800
*   /*                                                               */ 00089900
*   /*****************************************************************/ 00090000
*                                                                       00090102
*   DCL                                                                 00090202
*     NIPPMDCB PTR(31);                                                 00090302
*                                                                       00090402
*   /*****************************************************************/ 00090500
*   /*                                                               */ 00090600
*   /* POINTER TO BLDL HEADER FOR BLDL                               */ 00090700
*   /*                                                               */ 00090800
*   /*****************************************************************/ 00090900
*                                                                       00091002
*   DCL                                                                 00091102
*     NIPPMBDL PTR(31);                                                 00091202
*                                                                       00091302
*   /*****************************************************************/ 00091400
*   /*                                                               */ 00091500
*   /* NORMAL RETURN TO CALLER                                       */ 00091600
*   /*                                                               */ 00091700
*   /*****************************************************************/ 00091800
*                                                                       00091902
*   DCL                                                                 00092002
*     NIPPMAD0 LABEL BASED(NIPPMADR);                                   00092102
*                                                                       00092202
*   /*****************************************************************/ 00092300
*   /*                                                               */ 00092400
*   /* ERROR RETURN TO CALLER                                        */ 00092500
*   /*                                                               */ 00092600
*   /*****************************************************************/ 00092700
*                                                                       00092802
*   DCL                                                                 00092902
*     NIPPMAD4 LABEL BASED(NIPPMADR+4);                                 00093002
*                                                                       00093102
*   /*****************************************************************/ 00093200
*   /*                                                               */ 00093300
*   /* ESTABLISH BASE FOR NIP COMMUNICATION AREA                     */ 00093402
*   /*                                                               */ 00093500
*   /*****************************************************************/ 00093600
*                                                                       00093702
*   RESPECIFY                                                           00093802
*     NIPPAREA BASED(NVTPAREA);     /*                               */ 00093902
*                                                                       00094002
*   /*****************************************************************/ 00094100
*   /*                                                               */ 00094200
*   /* ONE BYTE SCANNING FIELD                                       */ 00094300
*   /*                                                               */ 00094400
*   /*****************************************************************/ 00094500
*                                                                       00094602
*   DCL                                                                 00094702
*     NIPPMBYT CHAR(1) BASED;                                           00094802
*                                                                       00094902
*   /*****************************************************************/ 00095000
*   /*                                                               */ 00095100
*   /* TEMPORARY POINTER                                             */ 00095202
*   /*                                                               */ 00095300
*   /*****************************************************************/ 00095400
*                                                                       00095502
*   DCL                                                                 00095602
*     NIPPMKPR PTR(31);                                                 00095702
*                                                                       00095802
*   /*****************************************************************/ 00095900
*   /*                                                               */ 00096000
*   /* INPUT RECORD READ FROM PARMLIB                                */ 00096102
*   /*                                                               */ 00096200
*   /*****************************************************************/ 00096300
*                                                                       00096402
*   DCL                                                                 00096502
*     NIPPMBUF CHAR(80) BASED(R1);                                      00096602
*                                                                       00096702
*   /*****************************************************************/ 00096800
*   /*                                                               */ 00096900
*   /* MBBCCHHR OF PARMLIB MEMBERS                                   */ 00097000
*   /*                                                               */ 00097100
*   /*****************************************************************/ 00097200
*                                                                       00097302
*   DCL                                                                 00097402
*     1 NIPPMMBC CHAR(8),                                               00097502
*      2 NIPPMMBB CHAR(3),                                              00097602
*      2 NIPPMCCH CHAR(5);                                              00097702
*                                                                       00097802
*   /*****************************************************************/ 00097900
*   /*                                                               */ 00098000
*   /* LOW ORDER 7 BYTES OF THE CSW STORED IN THE PARMLIB IOB BY EXCP*/ 00098100
*   /*                                                               */ 00098202
*   /*                                                               */ 00098300
*   /*****************************************************************/ 00098400
*                                                                       00098502
*   DCL                                                                 00098602
*     1 NIPPMCSW BASED(ADDR(IOBCSW)) BDY(BYTE),/*                    */ 00098702
*      2 * CHAR(3),                 /*                               */ 00098802
*      2 NIPPMCS2 BIT(8),           /* I/O OPERATION STATUS FLAGS /*    00098900
*                                                                    */ 00099002
*      2 * CHAR(3);                 /*                               */ 00099102
*                                                                       00099202
*   /*****************************************************************/ 00099300
*   /*                                                               */ 00099400
*   /* MASK TO TEST THE STATUS FLAGS OF THE PARMLIB CSW              */ 00099502
*   /*                                                               */ 00099600
*   /*****************************************************************/ 00099700
*                                                                       00099802
*   DCL                                                                 00099902
*     NIPPMMK1 BIT(8) BDY(BYTE) INIT('11110010'B);/*                 */ 00100002
*     NIPPMMK2 BIT(8) BDY(BYTE) INIT('11110001'B);/*                 */ 00100105
*     NIPPMMK3 BIT(8) BDY(BYTE) INIT('00100000'B);/*                 */ 00100205
*                                                                       00100302
*   /*****************************************************************/ 00100400
*   /*                                                               */ 00100500
*   /* INTERNALLY GENERATED LABELS                                   */ 00100600
*   /*                                                               */ 00100700
*   /*****************************************************************/ 00100800
*                                                                       00100902
*   DCL                                                                 00101002
*     NIPPMMB1 LABEL GENERATED INTERNAL;                                00101102
*   DCL                                                                 00101202
*     NIPPMMB2 LABEL GENERATED INTERNAL;                                00101302
*   DCL                                                                 00101402
*     NIPPMTND LABEL GENERATED INTERNAL;                                00101502
*                                                                       00101602
*   /*****************************************************************/ 00101700
*   /*                                                               */ 00101800
*   /* MAPPING AREAS INTO ERROR MESSAGES                             */ 00101900
*   /*                                                               */ 00102000
*   /*****************************************************************/ 00102100
*                                                                       00102202
*   DCL                                                                 00102302
*     NIPPMME1 CHAR(8) BASED(ADDR(NIPPMMB1));                           00102402
*   DCL                                                                 00102502
*     NIPPMME2 CHAR(8) BASED(ADDR(NIPPMMB2));                           00102602
*   DCL                                                                 00102702
*     NIPPMNAM CHAR(8) INIT(' ');   /* MEMBER NAME SAVE AREA         */ 00102802
*   DCL                                                                 00102902
*     NIPPMNEG FIXED(31) INIT('FFFFFFFF'X);/* NEGATIVE VALUE         */ 00103002
*NIPPMMEM:                                                              00103102
*   NIPPMADR=R14;                   /* SAVE CALLER'S RETURN REGISTER    00103202
*                                                                    */ 00103302
NIPPMMEM ST    R14,NIPPMADR                                             00103402
         STM   R2,R1,NIPPMREG          SAVE REGISTERS                   00103502
*   NIPPARC=NIPPARC&&NIPPARC;       /* SET RETURN CODE TO ZERO       */ 00103602
         L     R12,NVTPAREA(,R2)                                        00103702
         L     R11,NIPPARC(,R12)                                        00103802
         LR    R7,R11                                                   00103902
         XR    R7,R11                                                   00104002
         ST    R7,NIPPARC(,R12)                                         00104102
*   IF NIPPMNAM=NIPPANAM            /* IS THIS NEW MEMBER NAME       */ 00104202
*     THEN                                                              00104302
         CLC   NIPPMNAM,NIPPANAM(R12)                                   00104403
         BE    NIPPMPRD                                                 00104503
*     GO TO NIPPMPRD;               /* NO- GO READ RECORD            */ 00104602
*   NIPPMNAM=NIPPANAM;              /* YES- SAVE MEMBER NAME         */ 00104702
         MVC   NIPPMNAM,NIPPANAM(R12)                                   00104803
*   GO TO NIPPMENT;                 /* GO FIND MEMBER                */ 00104902
         B     NIPPMENT                                                 00105002
*                                                                       00105102
*NIPPMPDS:                                                              00105202
*   NIPPMADR=R14;                   /* SAVE CALLER'S RETURN ADDR     */ 00105302
NIPPMPDS ST    R14,NIPPMADR                                             00105402
         STM   R2,R1,NIPPMREG                   SAVE REGS               00105502
*   NIPPMNAM=NIPPMNAM&&NIPPMNAM;    /* CLEAR MEMBER NAME             */ 00105602
         XC    NIPPMNAM,NIPPMNAM                                        00105703
*NIPPMENT:                                                              00105802
*   R1=ADDR(NIPPADCB)-44;           /* R1= ADDR OF DCB               */ 00105902
NIPPMENT L     R12,NVTPAREA(,R2)                                        00106002
         LA    R1,NIPPADCB(,R12)                                        00106102
         SH    R1,KH44                                                  00106202
*   R0=ADDR(NIPPABDL);              /* R0= ADDR OF BLDL LIST         */ 00106302
         LA    R0,NIPPABDL(,R12)                                        00106402
*   /*****************************************************************/ 00106500
*   /*                                                               */ 00106600
*   /* READ PDS ENTRY FOR MEMBER                                     */ 00106700
*   /*                                                               */ 00106800
*   /*****************************************************************/ 00106900
*                                                                       00107002
         BLDL  (1),(0)                                                  00107102
*   NIPPARC=R15;                    /* SET RETURN CODE               */ 00107202
         L     R12,NVTPAREA(,R2)                                        00107302
         ST    R15,NIPPARC(,R12)                                        00107402
*   IF R15=4                        /* WAS MEMBER NAME FOUND         */ 00107502
*     THEN                                                              00107602
         CH    R15,KH4                                                  00107702
         BE    NIPPMPFN                                                 00107803
*     GO TO NIPPMPFN;               /* NO - TELL OPERATOR NOT FOUND  */ 00107900
*   IF R15=8                        /* WAS THERE AN I/O ERROR        */ 00108002
*     THEN                                                              00108102
         CH    R15,KH8                                                  00108206
         BE    NIPPMPER                                                 00108303
*     GO TO NIPPMPER;               /* YES - TELL OPERATOR I/O ERROR */ 00108400
*                                                                       00108502
*   /*****************************************************************/ 00108600
*   /*                                                               */ 00108700
*   /* SET UP PARAMETERS FOR CONVERSION ROUTINE                      */ 00108800
*   /*                                                               */ 00108900
*   /*****************************************************************/ 00109000
*                                                                       00109102
*   R0=NIPPATTR;                    /* R0 = ACTUAL TTR               */ 00109202
         SLR   R0,R0                                                    00109302
         ICM   R0,B'0111',NIPPATTR(R12)                                 00109402
         SLL   0,8(0)                  ZERO LOW BYTE IN R0              00109502
*   R1=ADDR(NIPPADEB);              /* R1 = ADDR OF DEB              */ 00109602
         L     R1,NVTPAREA(,R2)                                         00109702
         LA    R1,NIPPADEB(,R1)                                         00109802
*   R15=CVTPCNVT;                   /* R15 = ADDR OF CONVERSION         00109902
*                                      ROUTINE                       */ 00110002
         L     R15,CVTPCNVT                                             00110103
*   /*****************************************************************/ 00110200
*   /*                                                               */ 00110300
*   /* CONVERT TTR TO CCHHR FORMAT                                   */ 00110402
*   /*                                                               */ 00110500
*   /*****************************************************************/ 00110600
*                                                                       00110702
         STM   R2,R13,NIPPMSAV         SAVE REGISTERS                   00110802
         LA    R2,NIPPMMBC             RESULT FROM CONVERSION           00110907
         BALR  R14,R15                 CALL CONVERT RTN                 00111002
*        RESTORE REGISTERS                                              00111102
*NIPPMRST                                                               00111202
NIPPMRST LM    R2,R13,NIPPMSAV-NIPPMRST(R14)                            00111302
         B     NIPPMSKP                SKIP SAVE AREA                   00111402
*                                                                       00111502
*NIPPMSAV                                                               00111602
NIPPMSAV DC    12F'0'                  REG SAVE AREA                    00111702
*   IOBSEEK=NIPPMMBC;               /* RESET PARMLIB IOBSEEK TO THIS    00111800
*                                      MBBCCHHR                      */ 00111900
NIPPMSKP L     R12,NVTPAREA(,R2)                                        00112002
         MVC   NIPPASEK(8,R12),NIPPMMBC                                 00112107
*   NIPPASID=NIPPMCCH;              /* RESET PARMLIB SEARCH ID TO       00112202
*                                      THIS CCHHR                    */ 00112300
         MVC   NIPPASID(5,R12),NIPPMCCH                                 00112402
*   IF NIPPMNAM=NIPPANAM            /* SEE IF MEM NAMES MATCH        */ 00112502
*     THEN                                                              00112602
         CLC   NIPPMNAM,NIPPANAM(R12)                                   00112703
         BE    NIPPMPRD                                                 00112803
*     GO TO NIPPMPRD;               /* YES- NEW VERSION- GO READ     */ 00112903
         LM    R2,R1,NIPPMREG          RESTORE REGS                     00113002
*   GO TO NIPPMAD0;                 /* NORMAL RETURN TO CALLER       */ 00113102
         L     R12,NIPPMADR                                             00113202
         BR    R12                                                      00113302
*                                                                       00113402
*NIPPMPER:                                                              00113502
*   NIPPMME1=NIPPANAM;              /* MOVE MEMBER NAME TO I/O ERROR    00113600
*                                      MESSAGE                       */ 00113700
NIPPMPER LA    R12,NIPPMMB1                                             00113802
         L     R11,NVTPAREA(,R2)                                        00113902
         MVC   NIPPMME1(8,R12),NIPPANAM(R11)                            00114002
*                                                                       00114103
*   /*****************************************************************/ 00114200
*   /*                                                               */ 00114300
*   /* WTO I/O ERROR DURING BLDL MESSAGE                             */ 00114400
*   /*                                                               */ 00114500
*   /*****************************************************************/ 00114600
*                                                                       00114702
         IEAPMNIP TYPE=WTO,PARAM=NIPPMMS1 CALL WTO SERVICE ROUTINE      00114802
*                                                                       00114902
*   GO TO NIPPMPXT;                 /* ERROR RETURN TO CALLER        */ 00115000
         B     NIPPMPXT                                                 00115102
*                                                                       00115202
*NIPPMPFN:                                                              00115302
*   IF NIPPMNAM=NIPPANAM            /* SEE IF MEMBER NAMES MATCH        00115402
*                                                                    */ 00115502
*     THEN                                                              00115602
NIPPMPFN L     R12,NVTPAREA(,R2)                                        00115702
         CLC   NIPPMNAM,NIPPANAM(R12)                                   00115803
         BNE   @RF00438                                                 00115902
         L     R12,NVTPTAB(,R2)                                         00116005
*     IF NIPPAFL1='1'B              /* YES- SUPPRESS MESSAGE?        */ 00116102
*       THEN                                                            00116202
         TM    NIPPAFL1(R12),B'10000000'                                00116302
         BO    NIPPMPXT                                                 00116403
*       GO TO NIPPMPXT;             /* YES- GO EXIT TO CALLER        */ 00116502
*     ELSE                                                              00116602
*       ;                           /*                               */ 00116702
*   NIPPMME2=NIPPANAM;              /* MOVE MEMBER NAME TO NOT FOUND    00116800
*                                      MESSAGE                       */ 00116902
@RF00438 LA    R12,NIPPMMB2                                             00117002
         L     R11,NVTPAREA(,R2)                                        00117102
         MVC   NIPPMME2(8,R12),NIPPANAM(R11)                            00117202
*   /*****************************************************************/ 00117300
*   /*                                                               */ 00117400
*   /* WTO MEMBER NOT FOUND IN DATA SET MESSAGE                      */ 00117500
*   /*                                                               */ 00117600
*   /*****************************************************************/ 00117700
*                                                                       00117802
          IEAPMNIP TYPE=WTO,PARAM=NIPPMMS2 CALL WTO SERVICE ROUTINE     00117900
*NIPPMPXT:                                                              00118002
*   IF NIPPMNAM=NIPPANAM            /* SEE IF NAMES MATCH            */ 00118102
*     THEN                                                              00118202
NIPPMPXT L     R12,NVTPAREA(,R2)                                        00118302
         CLC   NIPPMNAM,NIPPANAM(R12)                                   00118403
         BNE   @RF00444                                                 00118502
*     DO;                                                               00118602
*       NIPPMNAM=NIPPMNAM&&NIPPMNAM;/* FORCE NEW NAME PATH ON NEXT      00118702
*                                      ENTRY                         */ 00118802
         XC    NIPPMNAM,NIPPMNAM                                        00118903
*       R1=NIPPMNEG;                /* SET NEGATIVE VALUE RC         */ 00119002
         L     R1,NIPPMNEG                                              00119102
         LM    R2,R0,NIPPMREG          RESTORE REGS                     00119202
*       GO TO NIPPMAD0;             /* EXIT TO CALLER                */ 00119302
         L     R12,NIPPMADR                                             00119402
         BR    R12                                                      00119502
*                                                                       00119602
*     END;                          /*                               */ 00119702
@RF00444 LM    R2,R1,NIPPMREG                 RESTORE REGS              00119802
*   GO TO NIPPMAD4;                 /* READ ERROR - RETURN TO CALLER    00119900
         L     R12,NIPPMADR                                             00120002
         LA    R12,NIPPMAD4+4(,R12)                                     00120102
         BR    R12                                                      00120202
*                                                                       00120302
*   /*****************************************************************/ 00120400
*   /*                                                               */ 00120500
*   /* ROUTINE TO READ PARMLIB TEXT                                  */ 00120600
*   /*                                                               */ 00120700
*   /*****************************************************************/ 00120800
*                                                                       00120902
*NIPPMTXT:                                                              00121002
*   NIPPMADR=R14;                   /* SAVE CALLER'S RETURN ADDRESS  */ 00121102
NIPPMTXT ST    R14,NIPPMADR                                             00121202
         STM   R2,R1,NIPPMREG               SAVE CALLERS REGS           00121302
*NIPPMPRD:                                                              00121402
*   NIPPAECB=NIPPAECB&&NIPPAECB;    /* ZERO WAIT ECB                 */ 00121500
NIPPMPRD L     R12,NVTPAREA(,R2)                                        00121602
         XC    NIPPAECB(4,R12),NIPPAECB(R12)                            00121702
*   IOBSEEK(4:7)=NIPPASID;          /* FILL IN CCHH IN IOB           */ 00121800
         LA    R11,72                                                   00121905
         ALR   R11,R12                                                  00122005
         MVC   IOBSEEK+3(4,R11),NIPPASID(R12)                           00122102
*                                                                       00122202
*   /*****************************************************************/ 00122300
*   /*                                                               */ 00122400
*   /* REINITIALIZE IOB FLAGS                                        */ 00122500
*   /*                                                               */ 00122600
*   /*****************************************************************/ 00122700
*                                                                       00122802
*   IOBFLAG1='42'X;                                                     00122902
         MVI   IOBFLAG1(R11),X'42'                                      00123002
*   IOBFLAG2='00'X;                                                     00123102
         MVI   IOBFLAG2(R11),X'00'                                      00123202
*   IOBFLAG3='00'X;                                                     00123302
         MVI   IOBFLAG3(R11),X'00'                                      00123402
*   IOBERRCT='0000'X;                                                   00123502
         SLR   R7,R7                                                    00123605
         STH   R7,IOBERRCT(,R11)                                        00123705
*   IOBCSW='00000000000000'X;                                           00123802
         MVC   IOBCSW(7,R11),@CB02161                                   00123902
*   IOBSENS0='00'X;                                                     00124002
         MVI   IOBSENS0(R11),X'00'                                      00124102
*   IOBSENS1='00'X;                                                     00124202
         MVI   IOBSENS1(R11),X'00'                                      00124302
*   /*****************************************************************/ 00124400
*   /*                                                               */ 00124500
*   /* READ PARMLIB TEXT RECORD                                      */ 00124600
*   /*                                                               */ 00124700
*   /*****************************************************************/ 00124800
*                                                                       00124902
*   R1=ADDR(NIPPAIOB);                                                  00125002
         LA    R1,NIPPAIOB(,R12)                                        00125105
*                                                                       00125202
         EXCP  (1)                 READ TEXT                            00125302
*                                                                       00125402
*   R1=ADDR(NIPPAECB);                                                  00125502
         L     R1,NVTPAREA(,R2)                                         00125602
         LA    R1,NIPPAECB(,R1)                                         00125702
*                                                                       00125802
         WAIT  ECB=(1)                  AWAIT I/O COMPLETION            00125902
*                                                                       00126002
*   /*****************************************************************/ 00126100
*   /*                                                               */ 00126200
*   /* TEST FOR I/O ERROR AFTER PARMLIB READ                         */ 00126302
*   /*                                                               */ 00126400
*   /*****************************************************************/ 00126500
*                                                                       00126602
*   IF NIPPAECC¬='7F'X              /* SKIP IF READ SUCCESSFUL       */ 00126702
*     THEN                                                              00126802
         L     R12,NVTPAREA(,R2)                                        00126902
         CLI   NIPPAECC(R12),X'7F'                                      00127002
         BE    IEA006AA                                                 00127107
*     DO;                                                               00127202
*       IF NIPPMNAM=NIPPANAM        /* SEE IF MEMBER NAMES MATCH     */ 00127302
*         THEN                                                          00127402
         CLC   NIPPMNAM,NIPPANAM(R12)                                   00127503
         BNE   NIPPMTER                                                 00127603
*         DO;                                                           00127702
*                                                                       00127802
*           /*********************************************************/ 00127900
*           /*                                                       */ 00128000
*           /* DOES THE I/O ERROR REPRESENT EOF                      */ 00128102
*           /*                                                       */ 00128200
*           /*********************************************************/ 00128300
*                                                                       00128402
*           IF NIPPAECC='41'X&      /* IOBCSW FIELD VALID?           */ 00128500
*                                                                       00128602
*           /*********************************************************/ 00128700
*           /*                                                       */ 00128800
*           /* FALL THROUGH IF UNIT EXCEPTION, CHANNEL END AND DEVICE*/ 00128900
*           /* END FLAGS ARE ON IN THE IOBCSW                        */ 00129000
*           /*                                                       */ 00129100
*           /*********************************************************/ 00129200
*                                                                       00129302
*               (NIPPACS2¦NIPPMMK1)='FF'X THEN                          00129407
         CLI   NIPPAECC(R12),X'41'                                      00129502
         BNE   @RF00468                                                 00129605
         MVC   @TS00001(1),NIPPACS2(R12)                                00129707
         OC    @TS00001(1),NIPPMMK1                                     00129802
         CLI   @TS00001,X'FF'                                           00129902
         BNE   @RF00468                                                 00130005
*             DO;                                                       00130102
*               NIPPARC=16;         /* INDICATE EOF CONDITION        */ 00130202
         MVC   NIPPARC(4,R12),KF16                                      00130302
         B     NIPPMPXT                                                 00130405
*               GOTO NIPPMPXT;      /* RETURN TO CALLER              */ 00130502
*             END;                  /*                               */ 00130602
*         END;                      /*                               */ 00130702
*     END;                          /*                               */ 00130802
@RF00468 L     R12,NVTPAREA(,R2)                                        00130905
         CLI   NIPPAECB(R12),X'41'                                      00131005
         BNE   NIPPMTER                                                 00131105
         MVC   @TS00001(1),84(R12)                                      00131205
         OC    @TS00001(1),NIPPMMK2                                     00131305
         CLI   @TS00001,X'FF'                                           00131405
         BNE   NIPPMTER                                                 00131505
         MVC   @TS00001(1),75(R12)                                      00131605
         NC    @TS00001(1),NIPPMMK3                                     00131705
         CLI   @TS00001,X'20'                                           00131805
         BNE   NIPPMTER                                                 00131905
         AH    R12,KH64                                                 00132005
         LA    R11,1                                                    00132105
         AH    R11,0(,R12)                                              00132205
         STH   R11,0(,R12)                                              00132305
         XC    2(2,R12),2(R12)                                          00132405
         MVI   4(R12),X'01'                                             00132505
         B     IEA006AA                                                 00132605
         B     NIPPMTER                                                 00132705
*
IEA006AA L     R1,NVTPAREA(,R2)                                         00132805
         LA    R1,NIPPARCD(,R1)                                         00132905
*                                                                       00133003
*   /*****************************************************************/ 00133100
*   /*                                                               */ 00133200
*   /* SCAN THROUGH LEADING BLANK CHARACTERS                         */ 00133300
*   /*                                                               */ 00133400
*   /*****************************************************************/ 00133500
*                                                                       00133602
*   NIPPMBUF(73:73)='FF'X;          /* PLACE 'FF'X IN COL 73         */ 00133700
         MVI   NIPPMBUF+72(R1),X'FF'                                    00133802
*   NIPPMKPR=1;                     /* COUNT STARTS AT ONE           */ 00133900
         MVC   NIPPMKPR(4),KF1                                          00134002
*NIPPMPBK:                                                              00134102
*   IF NIPPMBYT=' '                 /* IS THIS CHAR BLANK            */ 00134200
*     THEN                          /* YES - CHECK NEXT CHAR         */ 00134300
NIPPMPBK CLI   0(R1),C' '                                               00134402
         BNE   @RF00484                                                 00134502
*     DO;                                                               00134602
*       R1=R1+1;                    /* POINT TO NEXT CHAR            */ 00134702
         LA    R12,1                                                    00134802
         ALR   R1,R12                                                   00134902
*       NIPPMKPR=NIPPMKPR+1;        /* INCREMENT COUNTER             */ 00135002
         AL    R12,NIPPMKPR                                             00135102
         ST    R12,NIPPMKPR                                             00135202
*       IF NIPPMKPR=72              /* ARE FIRST 71 CHARS BLANK         00135302
*                                                                    */ 00135402
*         THEN                      /* YES-CHECK FOR CONTINUATION    */ 00135500
         CH    R12,KH72                                                 00135602
         BNE   NIPPMPBK                                                 00135703
*         DO;                                                           00135802
*           IF NIPPMBYT¬=' '        /* IS 72'ND CHAR BLK             */ 00135900
*             THEN                  /* NO - INDICATES CONTINUATION   */ 00136000
         CLI   0(R1),C' '                                               00136102
         BNE   NIPPMPRD                                                 00136203
*             GO TO NIPPMPRD;       /* READ NEXT RECORD              */ 00136300
*           ELSE                    /* 72ND IS BLANK - NO               00136402
*                                      CONTINUATION                  */ 00136500
*             GO TO NIPPMTND;       /* R1 POINTS TO 72ND BLANK          00136602
*                                      NORMAL RETURN TO CALLER       */ 00136700
         B     NIPPMTND                                                 00136802
*                                                                       00136902
*         END;                                                          00137002
*       ELSE                                                            00137102
*         GO TO NIPPMPBK;           /* COUNT IS NOT 72 YET- GO CHECK    00137200
*                                      NEXT CHAR                     */ 00137300
*     END;                                                              00137402
*   ELSE                            /* FIRST 71 CHARS ARE NOT        */ 00137500
*     DO;                           /* BLANK                         */ 00137600
*       NIPPMKPR=R1-NIPPMKPR+72;/* POINT TO 72'ND BYTE               */ 00137702
@RF00484 LR    R12,R1                                                   00137802
         SL    R12,NIPPMKPR                                             00137902
         AH    R12,KH72                                                 00138002
         ST    R12,NIPPMKPR                                             00138102
*       NIPPMBYT=' ';               /* INSURE BLANK AT END BY SETTING   00138200
*                                      72'ND BYTE TO BLANK           */ 00138302
         MVI   0(R12),C' '                                              00138402
*     END;                                                              00138502
NIPPMTND LM    R2,R0,NIPPMREG          RESTORE CALLERS REGS             00138602
*   GO TO NIPPMAD0;                 /* NORMAL RETURN TO CALLER       */ 00138700
         L     R12,NIPPMADR                                             00138802
         BR    R12                                                      00138902
*                                                                       00139002
*NIPPMTER:                                                              00139102
*   R1=ADDR(NIPPAIOB);              /* R1 = ADDR OF PARMLIB IOB      */ 00139202
NIPPMTER L     R1,NVTPAREA(,R2)                                         00139302
         LA    R1,NIPPAIOB(,R1)                                         00139402
*                                                                       00139502
*   /*****************************************************************/ 00139600
*   /*                                                               */ 00139700
*   /* NIPSENSE - FORMAT AND WRITE I/O ERROR MESSAGE                 */ 00139800
*   /*                                                               */ 00139900
*   /*****************************************************************/ 00140000
*                                                                       00140102
         IEAPMNIP TYPE=SENSE,PARAM=R1                                   00140202
*   NIPPARC=12;                     /* SET RETURN CODE TO 12         */ 00140302
         L     R12,NVTPAREA(,R2)                                        00140402
         MVC   NIPPARC(4,R12),KF12                                      00140502
*   IF NIPPMNAM=NIPPANAM            /* SEE IF MEMBER NAMES MATCH     */ 00140602
*     THEN                                                              00140702
         CLC   NIPPMNAM,NIPPANAM(R12)                                   00140803
         BE    NIPPMPXT                                                 00140903
*     GO TO NIPPMPXT;               /* YES-TAKE NEW VERSION EXIT     */ 00141002
         LM    R2,R1,NIPPMREG                 RESTORE CALLERS REGS      00141102
*   GO TO NIPPMAD4;                 /* READ ERROR - RETURN TO CALLER    00141200
*                                      + 4                           */ 00141300
         L     R12,NIPPMADR                                             00141402
         LA    R12,NIPPMAD4+4(,R12)                                     00141502
         BR    R12                                                      00141602
*                                                                       00141702
*   END IEAVNPA5                    /* END OF APF INIT ROUTINE          00142701
*                                                                    */ 00142800
*                                                                       00142901
*/* THE FOLLOWING INCLUDE STATEMENTS WERE FOUND IN THIS PROGRAM.     */ 00143000
*/*%INCLUDE SYSLIB  (IEAPMNIP)                                       */ 00143100
*/*%INCLUDE SYSLIB  (IHAECB  )                                       */ 00143200
*/*%INCLUDE SYSLIB  (IEZIOB  )                                       */ 00143300
*/*%INCLUDE SYSLIB  (IEZDEB  )                                       */ 00143400
*/*%INCLUDE SYSLIB  (IEAPPNIP)                                       */ 00143500
*/*%INCLUDE SYSLIB  (IEFUCBOB)                                       */ 00143600
*/*%INCLUDE SYSLIB  (IHANVT  )                                       */ 00143700
*/*%INCLUDE SYSLIB  (CVT     )                                       */ 00143800
*/*%INCLUDE SYSLIB  (IEAPSPIO)                                       */ 00143900
*                                                                       00144001
KH2      DC    H'2'                                                     00144201
KH4      DC    H'4'                                                     00144301
KH6      DC    H'6'                                                     00144401
KH8      DC    H'8'                                                     00144501
KH18     DC    H'18'                                                    00144601
KH19     DC    H'19'                                                    00144701
KH44     DC    H'44'                                                    00144801
KH64     DC    H'64'                                                    00144901
KH72     DC    H'72'                                                    00145001
KH255    DC    H'255'                                                   00145101
KH13000  DC    H'13000'                SAME AS APFTABSZ                 00145201
@SM02174 MVC   APFTDSN(0,R6),0(R11)                                     00145303
@SM02176 MVC   APFTVOL(0,R6),0(R11)                                     00145403
*                                                                       00145501
@SA00001 DC    18F'0'                                                   00145601
@SA00004 DC    14F'0'                                                   00145701
@SA00005 DC    14F'0'                                                   00145801
*                                                                       00145901
KF1      DC    F'1'                                                     00146001
@CH00034 EQU   KF1+2                                                    00146101
KF12     DC    F'12'                                                    00146201
KF16     DC    F'16'                                                    00146301
@CF00110 DC    XL4'FFFFFFF8'                                            00146400

         DC    0D'0'                                                    00146501
FMSIZE   DC    F'0'                    FREEMAIN PARAMTER                00146604
APFSAVE  DC    XL4'00'                                                  00146706
APFTABSZ DC    XL4'F50032C8'           SUBPOOL 245 SIZE 13000           00146804
APFSVCLK DC    A(0)                                                     00146901
LIBPTR   DC    A(0)                                                     00147001
VOLPTR   DC    A(0)                                                     00147101
NIPPMADR DC    A(0)                                                     00147201
NIPPMKPR DC    A(0)                                                     00147301
NIPPMNEG DC    XL4'FFFFFFFF'                                            00147400
NIPPMBDL DC    A(0)                                                     00147501
NIPPMDCB DC    A(0)                                                     00147601
APFLIBSZ DC    H'0'                                                     00147700
APFVOLSZ DC    H'0'                                                     00147800
APFWORK  DC    H'0'                                                     00147904
ENTRYCTR DC    H'0'                                                     00148004
@TS00001 DS    CL1                                                      00148100
@CB02161 DC    X'00000000000000'                                        00148200
TXTRC    DC    X'00'                                                    00148300
PRMRC    DC    X'00'                                                    00148400
PRMERRC  DC    X'00'                                                    00148500
ERRORCD  DC    X'00'                                                    00148600
*                                                                       00148703
NPA5SWCH DC    X'00'                                                    00148800
NPA5PARM EQU   X'80'                                                    00148904
NPA5AEND EQU   X'40'                                                    00149004
NPA5RTRY EQU   X'20'                                                    00149104
NPA5EXCC EQU   X'10'                   MORE THAN 255 ENTRIES            00149204
*                                                                       00149303
PASSPARM DC    CL8'APF'                                                 00149400
*                                                                       00149503
LINKLIB  DS    0CL19                                                    00149603
LINKSIZE DC    X'12'                                                    00149700
LINKVOL  DC    CL6'      '                                              00149800
LINKNAME DC    CL12'SYS1.LINKLIB'                                       00149900
*                                                                       00150003
SVCLIB   DS    0CL18                                                    00150103
SVCSIZE  DC    X'11'                                                    00150200
SVCVOL   DC    CL6'      '                                              00150300
SVCNAME  DC    CL11'SYS1.SVCLIB'                                        00150400
*                                                                       00150503
SIXASTER DC    CL6'******'             SUB WITH SYSRES VOLSER @ZP60043@ 00150503
*                                                                       00150503
PLISTNAM DS    0CL8                                                     00150603
PLISTNM  DC    CL6'IEAAPF'                                              00150700
PLISTEL  DC    CL2' '                                                   00150803
*                                                                       00150903
APF1     DC    CL3'APF'                                                 00151000
*                                                                       00151103
CAUSELIB DC    CL24'INCORRECT LIBNAME FORMAT'                           00151200
CAUSEVOL DC    CL24'INCORRECT VOLID FIELD'                              00151300
CAUSESTR DC    CL24'EXCEED APF TABLE STORAGE'                           00151400
CAUSECNT DC    CL24'EXCEED 255 TABLE ENTRIES'                           00151504
*                                                                       00151603
NIPPMMBC DS    0CL8                                                     00151703
NIPPMMBB DC    XL3'00'                                                  00151803
NIPPMCCH DC    XL5'00'                                                  00151903
*                                                                       00152003
NIPPMMK1 DC    B'11110010'                                              00152100
NIPPMMK2 DC    B'11110001'                                              00152205
NIPPMMK3 DC    B'00100000'                                              00152305
NIPPMNAM DC    CL8' '                                                   00152400
*                                                                       00152503
NIPPMREG DC    16F'0'                                                   00152603
IEAVNPA5 CSECT                                                          00152700
MSG9S    DC    0H'0'                                                    00152803
         IEAPMNIP TYPE=HEADER,MSGST=MSG9S,MSGEND=MSG9E                  00152903
MSG9P1   DC    C'IEA352I LIST '                                         00153003
MSG9I1   DC    CL9' '                                                   00153103
MSG9P2   DC    C'FOR '                                                  00153203
MSG9I2   DC    CL6' '                                                   00153303
MSG9P3   DC    C'INVALID - '                                            00153403
MSG9I3   DC    CL24' '                                                  00153503
MSG9E    EQU   *                                                        00153603
IEAVNPA5 CSECT                                                          00153700

NIPPMMS1 DC    0F'0'                                                    00153803
         IEAPMNIP TYPE=HEADER,MSGST=NIPPMMS1,MSGEND=NIPPMED1            00153901
         DC    CL34'IEA300I I/O ERROR DURING BLDL FOR '                 00154000
NIPPMMB1 DC    CL8'        '                                            00154100
         DC    CL16' IN SYS1.PARMLIB'                                   00154200
*NIPPMED1 EQU   *                                                       00154301
NIPPMED1 EQU   *                                                        00154401
*                                                                       00154503
NIPPMMS2 DC    0F'0'                                                    00154703
         IEAPMNIP TYPE=HEADER,MSGST=NIPPMMS2,MSGEND=NIPPMED2            00154800
         DC    CL8'IEA301I '                                            00154900
NIPPMMB2 DC    CL8'        '                                            00155001
         DC    CL26' NOT FOUND IN SYS1.PARMLIB'                         00155100
NIPPMED2 EQU   *                                                        00155201
IEAVNPA5 CSECT                                                          00155300
R0       EQU   00                      EQUATES FOR REGISTERS 0-15       00155401
R1       EQU   01                                                       00155501
RPARM    EQU   01                      USED IN IEAPMNIP MACRO           00155603
R2       EQU   02                                                       00155701
RNVT     EQU   R2                      USED IN IEAPMNIP MACRO           00157301
R3       EQU   03                                                       00155801
R4       EQU   04                                                       00155901
R5       EQU   05                                                       00156001
R6       EQU   06                                                       00156101
R7       EQU   07                                                       00156201
R8       EQU   08                                                       00156301
R9       EQU   09                                                       00156401
R10      EQU   10                                                       00156501
R11      EQU   11                                                       00156601
R12      EQU   12                                                       00156701
R13      EQU   13                                                       00156801
R14      EQU   14                                                       00156901
REXIT    EQU   14                      USED IN IEAPMNIP MACRO           00157003
R15      EQU   15                                                       00157103
RENTRY   EQU   15                      USED IN IEAPMNIP MACRO           00157203
APFTHDR  EQU   0                                                        00157400
APFTABLN EQU   APFTHDR                                                  00157500
APFTNENT EQU   APFTHDR+1                                                00157600
APFTAB   EQU   0                                                        00157700
APFTENTR EQU   APFTAB                                                   00157800
APFTLEN  EQU   APFTENTR                                                 00157900
APFTVOL  EQU   APFTENTR+1                                               00158000
APFTDSN  EQU   APFTENTR+7                                               00158100
NWTOHDR  EQU   0                                                        00158200
NWTOFL   EQU   NWTOHDR+2                                                00158300
NWTORLST EQU   0                                                        00158400
NWTORFL  EQU   NWTORLST+10                                              00158500
NIPSPE   EQU   0                                                        00158600
NIPMNTPL EQU   0                                                        00158700
NMNTDS   EQU   NIPMNTPL                                                 00158800
NMNTVS   EQU   NIPMNTPL+12                                              00158900
NMNTFL   EQU   NIPMNTPL+20                                              00159000
NIPOPNPL EQU   0                                                        00159100
NOPNDS   EQU   NIPOPNPL                                                 00159200
NOPNFL   EQU   NIPOPNPL+20                                              00159300
NIPSCHDL EQU   0                                                        00159400
ECB      EQU   0                                                        00159500
ECBRB    EQU   ECB                                                      00159600
ECBCC    EQU   ECBRB                                                    00159700
ECBCCCNT EQU   ECBRB+1                                                  00159800
IOBPREFX EQU   0                                                        00159900
IOBCFLG1 EQU   IOBPREFX                                                 00160000
IOBSTDRD EQU   0                                                        00160100
IOBFLAG1 EQU   IOBSTDRD                                                 00160200
IOBCYCCK EQU   IOBFLAG1                                                 00160300
IOBRSTRT EQU   IOBFLAG1                                                 00160400
IOBFLAG2 EQU   IOBSTDRD+1                                               00160500
IOBPURGE EQU   IOBFLAG2                                                 00160600
IOBRDHA0 EQU   IOBFLAG2                                                 00160700
IOBSENS0 EQU   IOBSTDRD+2                                               00160800
IOBS0B7  EQU   IOBSENS0                                                 00160900
IOBSENS1 EQU   IOBSTDRD+3                                               00161000
IOBECBPT EQU   IOBSTDRD+4                                               00161100
IOBFLAG3 EQU   IOBSTDRD+8                                               00161200
IOBFL3   EQU   IOBFLAG3                                                 00161300
IOBCSW   EQU   IOBSTDRD+9                                               00161400
IOBIOCSW EQU   IOBCSW                                                   00161500
IOBSTART EQU   IOBSTDRD+16                                              00161600
IOBDCBPT EQU   IOBSTDRD+20                                              00161700
IOBFLAG4 EQU   IOBDCBPT                                                 00161800
IOBRESTR EQU   IOBSTDRD+24                                              00161900
IOBINCAM EQU   IOBSTDRD+28                                              00162000
IOBBTAMF EQU   IOBINCAM                                                 00162100
IOBERRCT EQU   IOBSTDRD+30                                              00162200
DEBBASIC EQU   0                                                        00162300
DEBTCBAD EQU   DEBBASIC                                                 00162400
DEBDEBAD EQU   DEBBASIC+4                                               00162500
DEBIRBAD EQU   DEBBASIC+8                                               00162600
DEBOFLGS EQU   DEBIRBAD                                                 00162700
DEBOPATB EQU   DEBBASIC+12                                              00162800
DEBFLGS1 EQU   DEBBASIC+14                                              00162900
DEBUSRPG EQU   DEBBASIC+16                                              00163000
DEBRRQ   EQU   DEBBASIC+20                                              00163100
DEBECBAD EQU   DEBRRQ                                                   00163200
DEBDCBAD EQU   DEBBASIC+24                                              00163300
DEBPROTG EQU   DEBDCBAD                                                 00163400
DEBAPPAD EQU   DEBBASIC+28                                              00163500
DEBBASND EQU   DEBBASIC+32                                              00163600
DEBDASD  EQU   0                                                        00163700
DEBUCBAD EQU   DEBDASD                                                  00163800
DEBACSMD EQU   0                                                        00163900
DEBVOLSQ EQU   DEBACSMD                                                 00164000
DEBVOLBT EQU   DEBVOLSQ                                                 00164100
DEBDSNM  EQU   DEBACSMD+4                                               00164200
DEBUTSAA EQU   DEBDSNM                                                  00164300
DEBACS01 EQU   0                                                        00164400
DEBDSNAM EQU   DEBACS01                                                 00164500
DEBACS02 EQU   0                                                        00164600
DEBDBLK  EQU   DEBACS02                                                 00164700
DEBACS03 EQU   0                                                        00164800
DEBACS04 EQU   0                                                        00164900
DEBTBFRA EQU   DEBACS04                                                 00165000
DEBTCCWA EQU   DEBACS04+4                                               00165100
DEBACS05 EQU   0                                                        00165200
DEBFUCBA EQU   DEBACS05                                                 00165300
DEBLUCBA EQU   DEBACS05+4                                               00165400
DEBACS06 EQU   0                                                        00165500
DEBACS07 EQU   0                                                        00165600
DEBACS08 EQU   0                                                        00165700
DEBSUBNM EQU   0                                                        00165800
DEB      EQU   0                                                        00165900
DEBAVT   EQU   DEB                                                      00166000
DEBEOEA  EQU   DEBAVT                                                   00166100
DEBEOEAB EQU   DEBEOEA                                                  00166200
DEBSIOA  EQU   DEBAVT+4                                                 00166300
DEBSIOAB EQU   DEBSIOA                                                  00166400
DEBPCIA  EQU   DEBAVT+8                                                 00166500
DEBPCIAB EQU   DEBPCIA                                                  00166600
DEBCEA   EQU   DEBAVT+12                                                00166700
DEBCEAB  EQU   DEBCEA                                                   00166800
DEBXCEA  EQU   DEBAVT+16                                                00166900
DEBXCEAB EQU   DEBXCEA                                                  00167000
DEBPREFX EQU   DEB+20                                                   00167100
DEBXTNP  EQU   DEBPREFX+8                                               00167200
DEBXTN   EQU   0                                                        00167300
DEBXFLG1 EQU   DEBXTN+2                                                 00167400
NIPPAHDR EQU   0                                                        00167500
NIPPAREA EQU   0                                                        00167600
NIPPARC  EQU   NIPPAREA+8                                               00167700
NIPPABDL EQU   NIPPAREA+12                                              00167800
NIPPABDH EQU   NIPPABDL                                                 00167900
NIPPANAM EQU   NIPPABDL+4                                               00168000
NIPPATTR EQU   NIPPABDL+12                                              00168100
NIPPAIOD EQU   NIPPAREA+32                                              00168200
NIPPASID EQU   NIPPAIOD+32                                              00168300
NIPPAIOB EQU   NIPPAIOD+40                                              00168400
NIPPACS2 EQU   NIPPAIOD+52                                              00168507
NIPPASEK EQU   NIPPAIOD+72                                              00168607
NIPPADCB EQU   NIPPAIOD+80                                              00168700
NIPPAECB EQU   NIPPAIOD+84                                              00168800
NIPPAECC EQU   NIPPAECB                                                 00168900
NIPPADEB EQU   NIPPAIOD+88                                              00169000
NIPPARCD EQU   NIPPAIOD+136                                             00169100
NIPPAFLG EQU   NIPPAREA+272                                             00169207
NIPPAFL1 EQU   NIPPAFLG                                                 00169300
NIPPTE   EQU   0                                                        00169400
NIPPTADR EQU   NIPPTE                                                   00169500
NIPPTOPF EQU   NIPPTE+4                                                 00169600
NIPPTCAN EQU   NIPPTOPF                                                 00169700
NIPPTATF EQU   NIPPTE+5                                                 00169800
DCB      EQU   0                                                        00169900
DCBDEBAD EQU   DCB+45                                                   00170000
NVT      EQU   0                                                        00170100
NVTNPATR EQU   NVT+54                                                   00170200
NVTNPREN EQU   NVTNPATR                                                 00170300
NVTFLLB  EQU   NVT+55                                                   00170400
NVTABSAV EQU   NVT+140                                                  00170500
NVTFLCN  EQU   NVT+211                                                  00170600
NVTWTPSW EQU   NVT+224                                                  00170700
NVTWPSW2 EQU   NVTWTPSW+4                                               00170800
NVTFLWSC EQU   NVTWPSW2+3                                               00170900
NVTLOAD  EQU   NVT+232                                                  00171000
NVTSENSE EQU   NVT+236                                                  00171100
NVTSWAIT EQU   NVT+240                                                  00171200
NVTTIME  EQU   NVT+244                                                  00171300
NVTUCBFN EQU   NVT+248                                                  00171400
NVTWTO   EQU   NVT+252                                                  00171500
NVTWTOR  EQU   NVT+256                                                  00171600
NVTWTOR2 EQU   NVT+260                                                  00171700
NVTOPEN  EQU   NVT+264                                                  00171800
NVTMOUNT EQU   NVT+268                                                  00171900
NVTPRMPT EQU   NVT+272                                                  00172000
NVTVIRT  EQU   NVT+276                                                  00172100
NVTREAL  EQU   NVT+280                                                  00172200
NVTSCHED EQU   NVT+284                                                  00172300
NVTOPIO  EQU   NVT+288                                                  00172400
NVTPAREA EQU   NVT+368                                                  00172500
NVTPTAB  EQU   NVT+372                                                  00172600
NVTXCTL  EQU   NVT+428                                                  00172700
NVTLOCAT EQU   NVT+436                                                  00172800
NVTFLPO  EQU   NVT+528                                                  00172900
NIPPMAD0 EQU   0                                                        00173000
NIPPMAD4 EQU   0                                                        00173100
NIPPMBUF EQU   0                                                        00173300
NIPPMCSW EQU   0                                                        00173400
NIPPMCS2 EQU   NIPPMCSW+3                                               00173500
NIPPMME1 EQU   0                                                        00173600
NIPPMME2 EQU   0                                                        00173700
IOBORG01 EQU   IOBPREFX+8                                               00173800
IOBNIOBA EQU   IOBORG01                                                 00173900
IOBNFLG1 EQU   IOBNIOBA                                                 00174000
IOBORG02 EQU   IOBPREFX+8                                               00174100
IOBDQADA EQU   IOBORG02                                                 00174200
IOBDEQIN EQU   IOBDQADA                                                 00174300
IOBORG03 EQU   IOBPREFX+12                                              00174400
IOBORG04 EQU   IOBINCAM                                                 00174500
IOBORG12 EQU   IOBINCAM                                                 00174600
IOBFL4   EQU   IOBORG12                                                 00174700
IOBEXTEN EQU   IOBSTDRD+32                                              00174800
IOBSEEK  EQU   IOBEXTEN                                                 00174900
IOBBB    EQU   IOBSEEK+1                                                00175000
IOBCC    EQU   IOBSEEK+3                                                00175100
IOBHH    EQU   IOBSEEK+5                                                00175200
IOBORG05 EQU   IOBEXTEN                                                 00175300
IOBORG06 EQU   IOBEXTEN                                                 00175400
IOBNXTPT EQU   IOBORG06+4                                               00175500
IOBSTATA EQU   IOBNXTPT                                                 00175600
IOBORG07 EQU   IOBEXTEN+8                                               00175700
IOBORG08 EQU   IOBEXTEN+8                                               00175900
IOBINDCT EQU   IOBORG08+4                                               00176000
IOBUNSQR EQU   IOBORG08+5                                               00176100
IOBFCHAD EQU   IOBORG08+8                                               00176200
IOBORG09 EQU   IOBEXTEN+8                                               00176300
IOBDPLAD EQU   IOBORG09+4                                               00176400
IOBDTYPE EQU   IOBORG09+8                                               00176500
IOBDTYP2 EQU   IOBORG09+9                                               00176600
IOBDSTAT EQU   IOBORG09+10                                              00176700
IOBSTAT1 EQU   IOBDSTAT                                                 00176800
IOBORG10 EQU   IOBEXTEN+8                                               00176900
IOBSEEK2 EQU   IOBORG10                                                 00177000
IOBORG11 EQU   IOBEXTEN                                                 00177100
IOBERCT  EQU   IOBORG11                                                 00177200
IOBUCBXV EQU   IOBERCT                                                  00177300
IOBNAME  EQU   IOBORG11+4                                               00177400
DEBBAS02 EQU   DEBBASND                                                 00177500
DEBDDS1  EQU   DEBBAS02                                                 00177600
DEBSUCBA EQU   DEBDDS1                                                  00177700
DEBRDCB  EQU   DEBDDS1+4                                                00177800
DEBPDCB  EQU   DEBDDS1+8                                                00177900
DEBWDCB  EQU   DEBDDS1+12                                               00178000
DEBBAS01 EQU   DEBBASND                                                 00178100
DEBISAM  EQU   DEBBAS01                                                 00178200
DEBFIEAD EQU   DEBISAM                                                  00178300
DEBFPEAD EQU   DEBISAM+4                                                00178400
DEBFOEAD EQU   DEBISAM+8                                                00178500
DEBEXPT  EQU   DEBISAM+12                                               00178600
DEBRPSID EQU   DEBEXPT                                                  00178700
*                                                                       00178803
         PRINT NOGEN                                                    00178903
*                                                                       00179003
*        CVT                                                            00179103
*                                                                       00179203
         CVT   DSECT=YES                                                00179303
*                                                                       00179404
*        UCB                                                            00179504
*                                                                       00179604
UCB      DSECT                                                          00179704
*                                                                       00179804
         IEFUCBOB                                                       00179904
*                                                                       00180003
         PRINT GEN                                                      00180103
*                                                                       00180203
@ENDDATA EQU   *                                                        00180300
         END   IEAVNPA5                                                 00180400
/*
//*
//U42S03  EXEC PGM=IEBGENER
//SYSPRINT DD  SYSOUT=*
//SYSUT1   DD  *
  IDENTIFY IEAVNPA5('ZP60043')
/*
//SYSUT2   DD  DSN=&&SMPMCS,DISP=(MOD,PASS)
//SYSIN    DD  DUMMY
//*  _________________________________________________________
//*
//*  SMP INSTALL OF USERMODS ZP60041 AND ZP60042 AND ZP60043
//RECEIVE EXEC SMPREC
//SMPPTFIN DD  DSN=&&SMPMCS,DISP=(OLD,DELETE)
//SMPCNTL  DD  *
  RECEIVE SELECT(ZP60041,ZP60042,ZP60043).
/*
//*
//APPLY   EXEC SMPAPP
//SMPCNTL  DD  *
  APPLY SELECT(ZP60041,ZP60042,ZP60043) DIS(WRITE).
/*
//
